(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(e){var n=function(e,n){if("object"!==t(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var i=a.call(e,"string");if("object"!==t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===t(n)?n:String(n)}function n(t,n,a){return(n=e(n))in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t}var a,i,o,r,s,c,p,l,_,d,u,f,h="Open Sonic",g="http://opensnc.sourceforge.net",m=1e-4,b=99999999,y=1/0,x=999999999,v=Math.PI,w=!0,k={},S=function(){return k.sprites},j=function(t,e){return k.samples[e]},E={},M={},I={},O=function(t){return Promise.all(t.map(D))},D=function(t){return t=""+t,new Promise((function(e,n){if(I[t])e(I[t]);else{var a=new XMLHttpRequest;a.overrideMimeType("application/json"),a.open("GET",t,!0),a.onreadystatechange=function(){if(4===a.readyState){var n={};try{n=JSON.parse(a.responseText)}catch(e){console.log("error parsing json",t)}I[t]=n,e(n)}},a.send(null)}}))},T=function(t,e){!function(t,e,n){t[e]=n}(E,t,e)},L="undefined"==typeof arguments?void 0:arguments,R=function(t){if(L&&L.length>1)return console.log(L[0],L[1]);console.log(t)},A=function(t){if(L.length>1)return console.log("FATAL ERROR",L[0],L[1]);console.log("FATAL ERROR",t)},N=null,C=function(t){R("music_load('%s')");var e=new Audio;return e.src=t,function(t,e){!function(t,e,n){t[e]=n}(M,t,e)}(t,e),e},P=function(t,e){if(H()&&G(),null!=t){t.loop=!!e;try{t.play()}catch(t){}}N=t},G=function(){null!=N&&N.pause(),N=null},U=function(t){null!=N&&(t>1&&(t=1),t<0&&(t=0),N.volume=t)},B=function(){return null!=N?N.volume:0},H=function(){return null!=N&&!N.paused},X=function(t,e){e=""+e;var n=new Audio;n.src=e;var a=new Audio;a.src=e;var i=new Audio;i.src=e;var o=new Audio;return o.src=e,T(t,n),T(t+"2",a),T(t+"3",i),T(t+"4",o),n},W=function(t){Y(t,1,0,1,0)},Y=function(t,e,n,a,i){t&&t.play&&t.play()},$=function(t){return!!t&&!t.paused},z={video_resolution:null,fullscreen:null,smooth_graphics:null,show_fps:null,language:null},F=function(){if(console.log("SAVE PREFERENCES"),"undefined"!=typeof window)for(var t in z)console.log("SAVE PREVERFENCE",t,z),window.localStorage.setItem(t,z[t])},V=function(t){if("undefined"!=typeof window){var e=RegExp("[?&]"+t+"=([^&]*)").exec(window.location.search);return e&&decodeURIComponent(e[1].replace(/\+/g," "))}return null},q=0,Q=0,K=0,Z=function(){return Q},J=function(){var t=tt();return t<K&&(K=t),t-K},tt=function(){return Math.floor(Date.now())},et=function(t){return" "==t},nt=function(t){return void 0!==t&&t&&t.constructor===Array},at=function(t){return it(parseInt(Math.random(t)*t,10),1,t)},it=function(t,e,n){return Math.min(Math.max(t,e),n)},ot=function(t,e){return t[0]<e[2]&&t[2]>e[0]&&t[1]<e[3]&&t[3]>e[1]},rt=function(t,e){return ct(t,e,t.length)},st=function(t){return t>=0&&t<v/4-m?0:t>=v/4-m&&t<v/2-m?v/4:t>=v/2-m&&t<v/2+m?v/2:t>=v/2+m&&t<v-m?3*v/4:t>=v-m&&t<v+m?v:t>=v+m&&t<3*v/2-m?5*v/4:t>=3*v/2-m&&t<3*v/2+m?3*v/2:t>3*v/2+m&&t<=7*v/4+m?7*v/4:0},ct=function(t,e,n){var a,i,o=t,r=e;for(a=0;a<n;a++)i=o[a],o[a]=r[a],r[a]=i;return[o[a],r[a]]},pt=function(t,e){return{x:t,y:e}},lt=function(t,e){return{x:t.x+e.x,y:t.y+e.y}},_t=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},dt=function(t,e){return{x:e*t.x,y:e*t.y}},ut=function(t,e){var n=t.x,a=t.y,i={};return i.x=n*Math.cos(e)-a*Math.sin(e),i.y=a*Math.cos(e)+n*Math.sin(e),i},ft=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},ht=function(t){var e=ft(t);return e>m?pt(t.x/e,t.y/e):pt(0,0)},gt=480,mt=271,bt=!1,yt=!1,xt=!1,vt=1,wt=1,kt=function(){return pt(vt,wt)},St=function(t,e){0==l&&(l=1,_=!1,d=t,u=0,f=e)},jt=function(t,e){0==l&&(l=2,_=!1,d=t,u=0,f=e)},Et=function(){return _},Mt=function(){return 0!=l},It=function(t){s.fillStyle=t||"rgb(0, 0, 0)",s.fillRect(0,0,r.width,r.height)},Ot=function(t,e){It();var n=Tt();n.beginPath(),n.rect(130,115.5,210,20),n.fillStyle="black",n.fill(),n.lineWidth=1,n.strokeStyle="white",n.stroke(),e=e<1?0:e>202?202:202/e,n.beginPath(),n.rect(134,118.5,e,14),n.fillStyle="white",n.fill(),n.lineWidth=1,n.strokeStyle="black",n.stroke(),n.font="14px Arial",n.fillStyle="white",n.fillText(t,130,105.5)},Dt=function(){return r},Tt=function(){return c},Lt=function(){return p},Rt=function(){return bt},At=function(){return yt},Nt=function(){return xt},Ct=function(t){xt=t},Pt=function(t,e,n){p=t,yt=n,bt=e};function Gt(t,n){for(var a=0;a<n.length;a++){var i=n[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,e(i.key),i)}}var Ut,Bt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._container=e.container||document.body,this._strokeStyle=e.strokeStyle||"cyan",this._mouseSupport=void 0!==e.mouseSupport&&e.mouseSupport,this._stationaryBase=e.stationaryBase||!1,this._baseX=this._stickX=e.baseX||0,this._baseY=this._stickY=e.baseY||0,this._limitStickTravel=e.limitStickTravel||!1,this._stickRadius=void 0!==e.stickRadius?e.stickRadius:100,this._pressed=!1,this._touchIdx=null;var n=function(t,e){return function(){return t.apply(e,arguments)}};this._$onTouchStart=n(this._onTouchStart,this),this._$onTouchEnd=n(this._onTouchEnd,this),this._$onTouchMove=n(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=n(this._onMouseDown,this),this._$onMouseUp=n(this._onMouseUp,this),this._$onMouseMove=n(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))}var e,n,a;return e=t,a=[{key:"touchScreenAvailable",value:function(){return"createTouch"in document}}],(n=[{key:"destroy",value:function(){this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))}},{key:"deltaX",value:function(){return this._stickX-this._baseX}},{key:"deltaY",value:function(){return this._stickY-this._baseY}},{key:"up",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(e>=0||Math.abs(t)>2*Math.abs(e))}},{key:"down",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(e<=0||Math.abs(t)>2*Math.abs(e))}},{key:"right",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(t<=0||Math.abs(e)>2*Math.abs(t))}},{key:"left",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(t>=0||Math.abs(e)>2*Math.abs(t))}},{key:"_onUp",value:function(){this._pressed=!1,0==this._stationaryBase&&(this._baseX=this._baseY=0,this._stickX=this._stickY=0)}},{key:"_onDown",value:function(t,e){this._pressed=!0;var n=kt();t*=n.x,e*=n.y,this._stationaryBase,this._stickX=t,this._stickY=e}},{key:"_onMove",value:function(t,e){var n=kt();t*=n.x,e*=n.y,!0===this._pressed&&(this._stickX=t,this._stickY=e)}},{key:"_onMouseUp",value:function(t){return this._onUp()}},{key:"_onMouseDown",value:function(t){t.preventDefault();var e=t.clientX,n=t.clientY;return this._onDown(e,n)}},{key:"_onMouseMove",value:function(t){var e=t.clientX,n=t.clientY;return this._onMove(e,n)}},{key:"_onTouchStart",value:function(t){if(null===this._touchIdx&&!1!==this.dispatchEvent("touchStartValidation",t)){this.dispatchEvent("touchStart",t),t.preventDefault();var e=t.changedTouches[0];this._touchIdx=e.identifier;var n=e.pageX,a=e.pageY;return this._onDown(n,a)}}},{key:"_onTouchEnd",value:function(t){if(null!==this._touchIdx){this.dispatchEvent("touchEnd",t);for(var e=t.changedTouches,n=0;n<e.length&&e[n].identifier!==this._touchIdx;n++);if(n!==e.length)return this._touchIdx=null,t.preventDefault(),this._onUp()}}},{key:"_onTouchMove",value:function(t){if(null!==this._touchIdx){for(var e=t.changedTouches,n=0;n<e.length&&e[n].identifier!==this._touchIdx;n++);if(n!==e.length){var a=e[n];t.preventDefault();var i=a.pageX,o=a.pageY;return this._onMove(i,o)}}}},{key:"render",value:function(t){t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=3,t.arc(this._baseX,this._baseY,20,0,2*Math.PI,!0),t.stroke(),t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=1,t.arc(this._baseX,this._baseY,30,0,2*Math.PI,!0),t.stroke(),this._pressed&&(t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=3,t.arc(this._stickX,this._stickY,20,0,2*Math.PI,!0),t.stroke())}}])&&Gt(e.prototype,n),a&&Gt(e,a),Object.defineProperty(e,"prototype",{writable:!1}),t}();(Ut=Bt.prototype).addEventListener=function(t,e){return void 0===this._events&&(this._events={}),this._events[t]=this._events[t]||[],this._events[t].push(e),e},Ut.removeEventListener=function(t,e){void 0===this._events&&(this._events={}),t in this._events!=0&&this._events[t].splice(this._events[t].indexOf(e),1)},Ut.dispatchEvent=function(t){if(void 0===this._events&&(this._events={}),void 0!==this._events[t])for(var e=this._events[t].slice(),n=0;n<e.length;n++){var a=e[n].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==a)return a}};var Ht,Xt,Wt,Yt,$t,zt,Ft,Vt,qt,Qt,Kt,Zt,Jt,te,ee,ne,ae,ie,oe,re,se,ce,pe,le,_e,de,ue,fe,he,ge,me,be,ye=null,xe=!1,ve={37:"left",38:"up",39:"right",40:"down",17:"lcontrol",32:"space",13:"enter",27:"esc",192:"tilda"},we={x:0,y:0},ke={left:!1,middle:!1,right:!1},Se=function(){var t,e={type:2,enabled:!0};for(e.dx=e.dy=e.x=e.y=0,e.state=[],e.oldstate=[],e.howlong=[],t=0;t<9;t++)e.state[t]=e.oldstate[t]=!1,e.howlong[t]=0;return Ne(e),e},je=function(t){var e,n={type:1,enabled:!0};for(n.dx=n.dy=n.x=n.y=0,n.state=[],n.oldstate=[],n.howlong=[],e=0;e<9;e++)n.state[e]=n.oldstate[e]=!1,n.howlong[e]=0;if(t)for(n.keybmap=[],e=0;e<9;e++)n.keybmap[e]=t[e];else n.keybmap[1]=38,n.keybmap[2]=40,n.keybmap[3]=39,n.keybmap[4]=37,n.keybmap[5]=32,n.keybmap[6]=17,n.keybmap[7]=13,n.keybmap[8]=27,n.keybmap[9]=192;return Ne(n),n},Ee=function(){var t={type:0,enabled:!0};t.dx=t.dy=t.x=t.y=0,t.state=[],t.oldstate=[],t.howlong=[];for(var e=0;e<9;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return t.keybmap=[],t.keybmap[1]=38,t.keybmap[2]=40,t.keybmap[3]=39,t.keybmap[4]=37,t.keybmap[5]=32,t.keybmap[6]=17,t.keybmap[7]=13,t.keybmap[8]=27,Ne(t),t},Me=function(t){Ce(t),t=null},Ie=function(t,e){return!!e&&!!t.enabled&&t.state[parseInt(e,10)]},Oe=function(t,e){return!!e&&!!t.enabled&&t.state[parseInt(e,10)]&&!t.oldstate[parseInt(e,10)]},De=function(t,e){return!e||!!t.enabled&&!t.state[parseInt(e,10)]&&t.oldstate[parseInt(e,10)]},Te=function(t,e){t.state[parseInt(e,10)]=!0},Le=function(t){t.enabled=!1},Re=function(t){t.enabled=!0},Ae=function(t){return pt(t.x,t.y)},Ne=function(t){var e={};e.data=t,e.next=ye,ye=e},Ce=function(t){var e,n;if(ye.data==t)n=ye.next,ye=null,ye=n;else{for(e=ye;e.next&&e.next.data!=t;)e=e.next;e.next&&(n=e.next.next,e.next=null,e.next=n)}},Pe=function(t){var e=Object.create(null);function n(n){if(t.hasOwnProperty(n.keyCode)){var a="keydown"==n.type;e[t[n.keyCode]]=a,n.preventDefault()}}return addEventListener("keydown",n),addEventListener("keyup",n),e},Ge="data/languages/english.json",Ue={},Be=function(t){return new Promise((function(e,n){R('lang_loadfile("%s")...'),D(t).then((function(t){Ue=t,e(t)}))}))},He=function(t,e,n){return Ue[t]||t},Xe=function(t){return He(t)},We=[],Ye=0,$e=function(t){We[Ye++]=t,t&&t.init()},ze=function(){We[Ye-1].release(),We[Ye-1]=null,Ye--},Fe=function(){return We[Ye-1]},Ve={},qe=function(t){var e=j(0,t);return $(e)&&(e=j(0,t+"2"),$(e)&&(e=j(0,t+"3"),$(e)&&(e=j(0,t+"4")))),e},Qe=function(t){for(var e in t)Ve[e]=Ke(e,t[e])},Ke=function(t,e){var n=Ze();return n.data=X(t,e),n.data2=X(t,e),n},Ze=function(){return{data:null}},Je={},tn=function(t,e){return Tt().createImageData(t,e)},en=function(t){return new Promise((function(e,n){if(Je[t])return e(Je[t]);var a=document.createElement("img");a.src=t,a.addEventListener("load",(function(){return Je[t]=a,e(a)}))}))},nn=function(t,e,n,a,i,o,r,s){if(!t||!e)return!1;e.drawImage(t,n,a,r,s,i,o,r,s)},an=function(t,e,n,a,i){e.fillStyle=i,e.fillRect(n,a,n+1,a+1)},on=function(t,e,n){return"rgb("+t+","+e+","+n+")"},rn=function(t,e,n,a){for(var i=0;i<t.data.length;i+=4)t.data[i]=e,t.data[i+1]=n,t.data[i+2]=a},sn=function(t){t&&(t.data,t=null)},cn={},pn=["animal","bigring","bluering","bosses","bumber","charge","checkpointorb","chef","danger","dangpower","dnadoor","door","explosion","fireball","flyingboy","flyingeyes","font","glasses","goal","goldfish","hud","icon","itembox","joan","kleps","lady_bugsy","levelact","loop","menu","misc","nafder","neon","oranjection","ring","roboxer","shield","spikes","spring","surge","surpreyes","switch","teleporter"],ln=0,_n=[],dn=function(t,e){var n;return null!=(n=cn[t])?n.animation_data[e]:null},un=function(t,e){return t?t.frame_data[t.data[e]]:0},fn=function(t){return new Promise((function(e,n){hn(t).then(e)}))},hn=function(t){return new Promise((function(e,n){var a=gn(),i=vn(a,t);i=function(t){var e,n,a;for((t.frame_w>t.rect_w||t.frame_h>t.rect_h)&&(t.frame_w=Math.min(t.frame_w,t.rect_w),t.frame_h=Math.min(t.frame_h,t.rect_h)),(t.rect_w%t.frame_w>0||t.rect_h%t.frame_h>0)&&(t.rect_w=t.rect_w%t.frame_w>0?t.rect_w-t.rect_w%t.frame_w+t.frame_w:t.rect_w,t.rect_h=t.rect_h%t.frame_h>0?t.rect_h-t.rect_h%t.frame_h+t.frame_h:t.rect_h),a=t.rect_w/t.frame_w*(t.rect_h/t.frame_h),e=0;e<t.animation_count;e++)for(n=0;n<t.animation_data[e].frame_count;n++)t.animation_data[e].data[n]>=0&&t.animation_data[e].data[n]<a||(t.animation_data[e].data[n]=Math.min(t.animation_data[e].data[n],0,a-1));return t}(i),mn(i).then((function(n){i=yn(n),kn(t.name,i),ln++,Ot("Loading...",ln/_n.length),e(i)}))}))},gn=function(){var t={source_file:null,rect_x:0,rect_y:0,rect_w:0,rect_h:0};return t.frame_w=t.frame_h=0,t.hot_spot=pt(0,0),t.frame_count=0,t.frame_data=[],t.animation_count=0,t.animation_data=[],t},mn=function(t){return new Promise((function(e,n){en(t.source_file).then((function(n){t.frame_count=parseInt(t.rect_w/t.frame_w*(t.rect_h/t.frame_h),10),t.frame_data=[],t=bn(t,n),e(t)}))}))},bn=function(t,e){for(var n=0,a=0,i=0;i<parseInt(t.frame_count,10);i++)t.frame_data[i]={data:e,sx:n+t.rect_x,sy:a+t.rect_y,swidth:t.frame_w,sheight:t.frame_h,x:0,y:0,width:t.frame_w,height:t.frame_h},(n+=t.frame_w)>=t.rect_w&&(n=0,a+=t.frame_h);return t},yn=function(t){for(var e=0;e<t.animation_count;e++)t.animation_data[e].frame_data=t.frame_data,t.animation_data[e].hot_spot=t.hot_spot;return t},xn=function(t){return Promise.all(t.map(hn))},vn=function(t,e){if(t.source_file=""+e.source_file,t.rect_x=e.source_rect.xpos,t.rect_y=e.source_rect.ypos,t.rect_w=e.source_rect.width,t.rect_h=e.source_rect.height,t.frame_w=e.frame_size.width,t.frame_h=e.frame_size.height,e.hot_spot&&(t.hot_spot.x=e.hot_spot.xpos,t.hot_spot.y=e.hot_spot.ypos),e.animations){t.animation_count=e.animations.length;for(var n=0;n<t.animation_count;n++)t.animation_data[n]=wn(Sn(),e.animations[n]),0==t.animation_data[n].frame_count&&R("Animation error: invalid 'data' field. You must specify the frames of the animations")}return t},wn=function(t,e){return t.repeat=e.repeat,t.fps=e.fps,t.data=e.data,t.frame_count=e.data.length,t},kn=function(t,e){!function(t,e,n){k.sprites[e]=n}(S(),t,e)},Sn=function(){var t={repeat:!1,fps:8,frame_count:0,data:null};return t.hot_spot=pt(0,0),t.frame_data=null,t},jn=0,En=[],Mn=function(t){return En[t]},In=function(){return jn},On=function(t){var e=t.brick_ref.data;if(null!=e&&e.animation_data.length){e.animation_data[0].repeat;var n=e.animation_data[0].frame_count;t.animation_frame+=e.animation_data[0].fps*Z(),t.animation_frame>e.animation_data[0].frame_count-1&&(t.animation_frame=0),n=parseInt(t.animation_frame,10),t.brick_ref.image=e.frame_data[e.animation_data[0].data[n]]}return t},Dn=function(t){return t.brick_ref.image},Tn=function(t){var e=t.bricks;return Promise.all(e.map(Ln))},Ln=function(t){return new Promise((function(e,n){var a=function(){var t,e={data:null,image:null,property:0,angle:0,behavior:0,zindex:.5,behavior_arg:[]};for(t=0;t<5;t++)e.behavior_arg[t]=0;return e}(),i=t.type;"OBSTACLE"==i?a.property=1:"PASSABLE"==i?a.property=0:"CLOUD"==i?a.property=2:R("Can't read brick attributes: unknown brick type '%s'"),"DEFAULT"==(i=nt(t.behavior)?t.behavior[0]:t.behavior)?a.behavior=0:"CIRCULAR"==i?a.behavior=1:"BREAKABLE"==i?a.behavior=2:"FALL"==i?a.behavior=3:R("Can't read brick attributes: unknown brick type '%s'");for(var o=0;o<5;o++)a.behavior_arg[o]=t.behavior[1+o];a.behavior_arg[a.behavior_arg.length-1]=0,a.angle=t.angle,t.zindex&&(a.zindex=t.zindex),fn(t.sprite).then((function(t){a.data=t,a.image=t.frame_data[0],jn++,e(a)}))}))},Rn=void 0,An=!0,Nn=!1,Cn=!1,Pn=!1,Gn=!1,Un=function(){var t={};return t.spawn_point=pt(0,0),t.position=pt(t.spawn_point.x,t.spawn_point.y),t.angle=0,t.speed=pt(0,0),t.maxspeed=0,t.acceleration=0,t.jump_strength=0,t.is_jumping=!1,t.ignore_horizontal=!1,t.input=null,t.animation=null,t.animation_frame=0,t.animation_speed_factor=1,t.mirror=!1,t.visible=!0,t.alpha=1,t.hot_spot=pt(0,0),t.carried_by=null,t.carry_offset=pt(0,0),t.carrying=null,t},Bn=function(t){t.input&&Me(t.input),t=null},Hn=function(t,e){var n;if(e&&t&&(t.visible&&t.animation)){if(t.animation_frame+=t.animation.fps*t.animation_speed_factor*Z(),t.animation_frame>t.animation.frame_count-1&&(t.animation.repeat?t.animation_frame=0:t.animation_frame=t.animation.frame_count-1),t.position,!(n=Yn(t)))return!1;t.mirror&&ia(Tt(),parseInt(t.position.x-(e.x-240),10));var a=parseInt(t.position.x-(e.x-240),10),i=parseInt(t.position.y-(e.y-135.5),10),o=t.mirror?t.angle:-t.angle;t.angle&&(Tt().translate(a,i),Tt().rotate(o),Tt().translate(-a,-i)),Tt().drawImage(n.data,n.sx,n.sy,n.swidth,n.sheight,parseInt(t.position.x-t.hot_spot.x-(e.x-240),10),parseInt(t.position.y-t.hot_spot.y-(e.y-135.5),10),1*n.width,1*n.height),t.angle&&(Tt().translate(a,i),Tt().rotate(-o),Tt().translate(-a,-i)),t.mirror&&ia(Tt(),parseInt(t.position.x-(e.x-240),10))}},Xn=function(t,e,n,a){var i,o,r,s,c,p={};if(t.visible&&t.animation){if(isNaN(t.animation_frame)&&(t.animation_frame=0,t.animation.fps=1),t.animation_frame+=t.animation.fps*t.animation_speed_factor*Z(),t.animation_frame>t.animation.frame_count-1&&(t.animation.repeat?t.animation_frame=0:t.animation_frame=t.animation.frame_count-1),!(c=Yn(t)))return!1;for(p.x=t.position.x%(n?c.width:x)-t.hot_spot.x-(e.x-240)-(n?c.width:0),p.y=t.position.y%(a?c.height:x)-t.hot_spot.y-(e.y-135.5)-(a?c.height:0),r=n?gt/c.width+3:1,s=a?mt/c.height+3:1,i=0;i<r;i++)for(o=0;o<s;o++)Tt().drawImage(c.data,c.sx,c.sy,c.swidth,c.sheight,p.x+i*c.width,p.y+o*c.height,1*c.width,1*c.height)}},Wn=function(t,e){e||(e={x:0,y:0}),e.x=e.x||0,e.y=e.y||0,Math.abs(e.x)<m&&(e.x=0),t.position.x+=e.x*Math.cos(t.angle)+e.y*Math.sin(t.angle),t.position.y+=e.y*Math.cos(t.angle)-e.x*Math.sin(t.angle)},Yn=function(t){return un(t.animation,parseInt(t.animation_frame,10))},$n=function(t,e){return t.animation_frame=it(e,0,t.animation.frame_count),t},zn=function(t,e){return!(!t||!e)&&(t.animation!=e&&(t.animation=e,t.hot_spot=e.hot_spot,t.animation_frame=0,t.animation_speed_factor=1),t)},Fn=function(t){var e=t.animation_frame+t.animation.fps*t.animation_speed_factor*Z();return!t.animation.repeat&&e>t.animation.frame_count-1},Vn=function(t,e){var n=0,a=0,i=[];if(i[0]=[],i[1]=[],i[0][0]=_t(t.position,ut(t.hot_spot,-t.angle)),i[0][1]=lt(i[0][0],ut(pt(Yn(t).width,0),-t.angle)),i[0][2]=lt(i[0][0],ut(pt(Yn(t).width,Yn(t).height),-t.angle)),i[0][3]=lt(i[0][0],ut(pt(0,Yn(t).height),-t.angle)),i[1][0]=_t(e.position,ut(e.hot_spot,0)),i[1][1]=lt(i[1][0],ut(pt(Yn(e).width,0),0)),i[1][2]=lt(i[1][0],ut(pt(Yn(e).width,Yn(e).height),0)),i[1][3]=lt(i[1][0],ut(pt(0,Yn(e).height),0)),a+=Math.abs(t.angle)<m||Math.abs(t.angle-v/2)<m||Math.abs(t.angle-v)<m||Math.abs(t.angle-3*v/2)<m,a+=Math.abs(0)<m||Math.abs(0-v/2)<m||Math.abs(0-v)<m||Math.abs(0-3*v/2)<m){var o=[],r=[];for(n=0;n<2;n++)o[n]=[],o[n][0]=Math.min(i[n][0].x,i[n][1].x),o[n][1]=Math.min(i[n][0].y,i[n][1].y),o[n][2]=Math.max(i[n][2].x,i[n][3].x),o[n][3]=Math.max(i[n][2].y,i[n][3].y),o[n][0]>o[n][2]&&(r=rt(o[n][0],o[n][2]),o[n][0]=r[0],o[n][2]=r[1]),o[n][1]>o[n][3]&&(r=rt(o[n][1],o[n][3]),o[n][1]=r[0],o[n][3]=r[1]);return ot(o[0],o[1])}var s=[],c=[Math.max(Yn(t).width,Yn(t).height),Math.max(Yn(e).width,Yn(e).height)];for(n=0;n<2;n++)s[n]=dt(lt(i[n][0],i[n][2]),.5);return function(t,e,n,a){return ft(_t(t,n))<=e+a}(s[0],c[0],s[1],c[1])},qn=function(t,e){return Math.abs(t.angle)<m&&Math.abs(e.angle)<m?!!Vn(t,e)&&(parseInt(t.position.x-t.hot_spot.x,10),parseInt(t.position.y-t.hot_spot.y,10),parseInt(e.position.x-e.hot_spot.x,10),parseInt(e.position.y-e.hot_spot.y,10),Yn(t),Yn(e),!0):!!function(t,e){var n={},a={},i={},o={},r=[],s=[];return r=aa(Rn,t,r),s=aa(Rn,e,s),n.x=Math.min(r[0].x,Math.min(r[1].x,Math.min(r[2].x,r[3].x))),n.y=Math.min(r[0].y,Math.min(r[1].y,Math.min(r[2].y,r[3].y))),a.x=Math.min(s[0].x,Math.min(s[1].x,Math.min(s[2].x,s[3].x))),a.y=Math.min(s[0].y,Math.min(s[1].y,Math.min(s[2].y,s[3].y))),i.x=Math.max(r[0].x,Math.max(r[1].x,Math.max(r[2].x,r[3].x)))-n.x,i.y=Math.max(r[0].y,Math.max(r[1].y,Math.max(r[2].y,r[3].y)))-n.y,o.x=Math.max(s[0].x,Math.max(s[1].x,Math.max(s[2].x,s[3].x)))-a.x,o.y=Math.max(s[0].y,Math.max(s[1].y,Math.max(s[2].y,s[3].y)))-a.y,n.x+i.x>=a.x&&n.x<=a.x+o.x&&n.y+i.y>=a.y&&n.y<=a.y+o.y}(t,e)},Qn=function(t,e,n,a,i,o,r,s,c,p,l,_){var d=Yn(t).width,u=Yn(t).height,f=t.position,h=lt(f,ut(pt(0,-u+n),-t.angle)),g=lt(f,ut(pt(0,-n),-t.angle)),m=lt(f,ut(pt(-d/2+n,.5*-u),-t.angle)),b=lt(f,ut(pt(d/2-n,.5*-u),-t.angle)),y=lt(f,ut(pt(-d/2+n,-u+n),-t.angle)),x=lt(f,ut(pt(d/2-n,-u+n),-t.angle)),v=lt(f,ut(pt(-d/2+n,-n),-t.angle)),w=lt(f,ut(pt(d/2-n,-n),-t.angle));return Kn(t,e,h,x,b,w,g,v,m,y,a,i,o,r,s,c,p,l,_)},Kn=function(t,e,n,a,i,o,r,s,c,p,l,_,d,u,f,h,g,m,b){var y=[n.x-e,n.y-e,n.x+e,n.y+e],x=[r.x-e,r.y-e,r.x+e,r.y+e],v=[c.x-e,c.y-e,c.x+e,c.y+e],w=[i.x-e,i.y-e,i.x+e,i.y+e],k=[p.x-e,p.y-e,p.x+e,p.y+e],S=[a.x-e,a.y-e,a.x+e,a.y+e],j=[s.x-e,s.y-e,s.x+e,s.y+e],E=[o.x-e,o.y-e,o.x+e,o.y+e];return l&&(n&&(_=na(l,y)),r&&(h=na(l,x)),c&&(m=na(l,v)),i&&(u=na(l,w)),p&&(b=na(l,k)),a&&(d=na(l,S)),s&&(g=na(l,j)),o&&(f=na(l,E))),{up:_,down:h,left:m,right:u,upleft:b,upright:d,downleft:g,downright:f}},Zn=function(t){An=t},Jn=function(t,e,n,a,i,o,r,s,c,p){var l,_=[n,a,i,c,p];for(l=0;l<_.length;l++){var d=_[l];d&&d.brick_ref&&2==d.brick_ref.property&&(d=null,_[l]=d)}if(r&&r.brick_ref&&2==r.brick_ref.property){var u=Math.min(15,r.brick_ref.image.height/3);t.speed.y>=0&&t.position.y<r.y+e+1+u||(s&&s==r&&(s=null),o&&o==r&&(o=null),r=null)}return{up:_[0],upright:_[1],right:_[2],left:_[3],upleft:_[4],downright:o,down:r,downleft:s}},ta=function(t,e,n){var a,i,o,r,s,c,p,l,_,d,u,f=pt(0,0),h=Z(),g=t.position,b=function(t,e,n,a,i,o,r,s,c,p){var l,_,d,u=Yn(t).width,f=Yn(t).height,h=!(Math.abs(t.angle)<m||Math.abs(t.angle-v/2)<m||Math.abs(t.angle-v)<m||Math.abs(t.angle-3*v/2)<m),g=t.position;return h?(l=1,_=.7,d=.25):(l=.7,_=.5,d=.25),{up:lt(g,ut(pt(0,-f*l+e),-t.angle)),down:lt(g,ut(pt(0,2),-t.angle)),left:lt(g,ut(pt(-u*d+e,-f*_),-t.angle)),right:lt(g,ut(pt(u*d-e,-f*_),-t.angle)),upleft:lt(g,ut(pt(-u*d+e,-f*l+e),-t.angle)),upright:lt(g,ut(pt(u*d-e,-f*l+e),-t.angle)),downleft:lt(g,ut(pt(-u*d+e,2),-t.angle)),downright:lt(g,ut(pt(u*d-e,2),-t.angle))}}(t,-2);b=function(t,e,n,a,i,o,r,s,c,p,l,_,d,u,f,h,g,m){return Kn(t,2,n,a,i,o,r,s,c,p,e,l,_,d,u,f,h,g,m)}(t,e,a=b.up,b.upright,i=b.right,b.downright,b.down,b.downleft,o=b.left,b.upleft,r,s,c,p,l,_,d,u),r=b.up,s=b.upright,c=b.right,p=b.downright,l=b.down,_=b.downleft,d=b.left,u=b.upleft;var y=Jn(t,-2,r,s,c,p,l,_,d,u);return r=y.up,s=y.upright,c=y.right,d=y.left,u=y.upleft,l=y.down,_=y.downleft,p=y.downright,function(t,e){var n=Z();if(null!=t.carried_by){var a=t.carried_by;e&&0==e.brick_ref.angle&&parseInt(a.speed.y,10)>=5?(t.position=pt(t.carried_by.position.x,t.carried_by.position.y),t.carried_by.carrying=null,t.carried_by=null):(t.speed=pt(0,0),t.mirror=a.mirror,t.angle=0,t.position=_t(lt(a.position,dt(a.speed,n)),t.carry_offset))}}(t,l),null!=t.carried_by?pt(0,0):(function(t,e,n,a,i,o){o&&o.brick_ref.angle%90==0&&(t.speed.x>m||a.x>o.x)&&(t.speed.x=0,t.position.x=o.x+(e.x-a.x)),i&&i.brick_ref.angle%90==0&&(t.speed.x<-1e-4||n.x<i.x+i.brick_ref.image.width)&&(t.speed.x=0,t.position.x=i.x+i.brick_ref.image.width+(e.x-n.x))}(t,g,o,i,d,c),l?(t.is_jumping=!1,t.ignore_horizontal=!1,function(t,e,n,a,i){var o=a.brick_ref.angle;!Ie(t.input,5)||Ie(t.input,2)||i||(t.angle=0,t.is_jumping=!0,0==o?t.speed.y=-t.jump_strength:o>0&&o<90?(t.speed.x=Math.min(t.speed.x,-.7*t.jump_strength),t.speed.y=-.7*t.jump_strength):90==o?(actor.move(t,pt(-40,0)),t.speed.x=Math.min(t.speed.x,-t.jump_strength),t.speed.y=-t.jump_strength/2):o>90&&o<180?(actor.move(t,pt(0,40)),t.speed.x=Math.min(t.speed.x,-.7*t.jump_strength),t.speed.y=t.jump_strength):180==o?(actor.move(t,pt(0,40)),t.speed.x*=-1,t.speed.y=t.jump_strength):o>180&&o<270?(actor.move(t,pt(0,40)),t.speed.x=Math.max(t.speed.x,.7*t.jump_strength),t.speed.y=t.jump_strength):270==o?(actor.move(t,pt(40,0)),t.speed.x=Math.max(t.speed.x,t.jump_strength),t.speed.y=-t.jump_strength/2):o>270&&o<360&&(t.speed.x=Math.max(t.speed.x,.7*t.jump_strength),t.speed.y=-.7*t.jump_strength))}(t,0,0,l,r)):t.angle=0,f.y=Math.abs(t.speed.y)>m?t.speed.y*h+1*n*.5*(h*h):0,t.speed.y=Math.min(t.speed.y+1*n*h,480),function(t,e,n,a){a&&a.brick_ref.angle%90==0&&t.speed.y<-1e-4&&(t.position.y=a.y+a.brick_ref.image.height+(e.y-n.y),t.speed.y=10)}(t,g,a,r),function(t,e,n,a,i,o,r,s,c){var p;if(Z(),s&&!t.is_jumping)if(p=s.brick_ref.angle,t.speed.y=a.y=0,t.angle=p*v/180,0==p)t.position.y=i.y+e;else if(p>0&&p<90)i.y=s.y+s.brick_ref.image.height-(t.position.x-s.x)*Math.tan(t.angle),t.position.y=i.y+e,t.mirror;else if(90==p){if(Math.abs(t.speed.x)>5){var l=c?c.brick_ref.angle:-1;c&&l>=p&&l<p+90?(i.y=s.x,t.position.x=i.y+e):(t.angle=0,Wn(t,pt(-13,0)),t.is_jumping=!0,t.speed=pt(0,-.7*Math.abs(t.speed.x)))}else t.angle=0,Wn(t,pt(-10,0)),t.is_jumping=!0,t.ignore_horizontal=!1;t.mirror}else if(p>90&&p<180)Math.abs(t.speed.x)>5?(i.y=s.y-(t.position.x-s.x)*Math.tan(t.angle),t.position.y=i.y-e):(t.angle=0,Wn(t,pt(0,30)),t.is_jumping=!0);else if(180==p)t.speed.x>5&&!(t.mirror&w)||t.speed.x<-5&&t.mirror&w?(i.y=s.y+s.brick_ref.image.height,t.position.y=i.y-e):(t.angle=0,Wn(t,pt(0,40)),t.is_jumping=!0,t.speed.x=0);else if(p>180&&p<270)Math.abs(t.speed.x)>5?(i.y=s.y+s.brick_ref.image.height-(t.position.x-s.x)*Math.tan(t.angle),t.position.y=i.y-e):(t.angle=0,Wn(t,pt(0,30)),t.is_jumping=!0);else if(270==p){if(Math.abs(t.speed.x)>5){var _=r?r.brick_ref.angle:-1;r&&_>p-90&&_<=p?(i.y=s.x+s.brick_ref.image.width,t.position.x=i.y-e):(t.angle=0,Wn(t,pt(13,0)),t.is_jumping=!0,t.speed=pt(0,-.7*Math.abs(t.speed.x)))}else t.angle=0,Wn(t,pt(10,0)),t.is_jumping=!0,t.ignore_horizontal=!1;t.mirror}else p>270&&p<360&&(i.y=s.y-(t.position.x-s.x)*Math.tan(t.angle),t.position.y=i.y+e,t.mirror)}(t,-2,0,f,g,0,_,l,p),f.x=Math.abs(t.speed.x)>m?t.speed.x*h+1*t.acceleration*.5*(h*h):0,function(t,e,n){var a=Z();if(Ie(t.input,4)&&!Ie(t.input,3))t.ignore_horizontal||Ie(t.input,2)||(t.speed.x=Math.max(t.speed.x-1*t.acceleration*a,-t.maxspeed),t.mirror=w);else if(Ie(t.input,3)&&!Ie(t.input,4))t.ignore_horizontal||Ie(t.input,2)||(t.speed.x=Math.min(t.speed.x+1*t.acceleration*a,t.maxspeed),t.mirror=IF_NONE);else if(n){var i=0,o=n.brick_ref.angle;o%90==0?i=90==o&&t.mirror&w&&t.speed.x<0||270==o&&!(t.mirror&w)&&t.speed.x>0?t.speed.x>m?1:-t.speed.x>m?-1:0:t.speed.x>m?-1:-t.speed.x>m?1:0:(o>90&&o<180||o>180&&o<270)&&(i=t.speed.x>m?-1:-t.speed.x>m?1:0),t.speed.x+=1*i*t.acceleration*a}}(t,0,l),Math.abs(t.speed.x)<m&&(t.speed.x=f.x=0),f)},ea=function(t){var e=Z(),n=pt(0,0);return t.input?(Ie(t.input,3)&&!Ie(t.input,4)&&(t.speed.x=Math.min(t.speed.x+t.acceleration*e,t.maxspeed)),Ie(t.input,4)&&!Ie(t.input,3)&&(t.speed.x=Math.max(t.speed.x-t.acceleration*e,-t.maxspeed)),!Ie(t.input,4)&&!Ie(t.input,3)&&Math.abs(t.speed.x)>m&&(t.speed.x>0?t.speed.x=Math.max(t.speed.x-t.acceleration*e,0):t.speed.x=Math.min(t.speed.x+t.acceleration*e,0)),Ie(t.input,2)&&!Ie(t.input,1)&&(t.speed.y=Math.min(t.speed.y+t.acceleration*e,t.maxspeed)),Ie(t.input,1)&&!Ie(t.input,2)&&(t.speed.y=Math.max(t.speed.y-t.acceleration*e,-t.maxspeed)),!Ie(t.input,1)&&!Ie(t.input,2)&&Math.abs(t.speed.y)>m&&(t.speed.y>0?t.speed.y=Math.max(t.speed.y-t.acceleration*e,0):t.speed.y=Math.min(t.speed.y+t.acceleration*e,0))):t.speed=pt(0,0),n.x=Math.abs(t.speed.x)>m?t.speed.x*e+.5*t.acceleration*e*e:0,n.y=0,t.speed.x=n.x,t.speed.y=n.y,n},na=function(t,e){var n,a,i,o,r,s,c,p=null,l=!1;for(n=t;n&&!l;n=n.next)if(n.data){if(0==n.data.brick_ref.property||!n.data.enabled)continue;if(2==n.data.brick_ref.property&&p&&1==p.brick_ref.property)continue;if(1==n.data.brick_ref.behavior&&p&&1!=p.brick_ref.behavior&&n.data.y>=p.y)continue;if(Pn&&0==n.data.brick_ref.angle)continue;if(Gn&&180==n.data.brick_ref.angle)continue;if(Cn&&n.data.brick_ref.angle>0&&n.data.brick_ref.angle<180)continue;if(Nn&&n.data.brick_ref.angle>180&&n.data.brick_ref.angle<360)continue;var _=[n.data.x,n.data.y,n.data.x+n.data.brick_ref.image.width,n.data.y+n.data.brick_ref.image.height];if(ot(e,_))if(1!=n.data.brick_ref.behavior&&p&&1==p.brick_ref.behavior&&n.data.y<=p.y)p=n.data;else if(1==n.data.brick_ref.property&&p&&2==p.brick_ref.property)p=n.data;else if(2==n.data.brick_ref.property&&p&&2==p.brick_ref.property)n.data.y>p.y&&(p=n.data);else if(n.data.brick_ref.angle%90==0)p?An?p.brick_ref.angle%180!=0&&(p=n.data):p.brick_ref.angle%180==0&&(p=n.data):p=n.data;else for(a=n.data.brick_ref.angle,s=Math.tan(a*v/180),o=e[0];o<=e[2]&&!l;o++)for(r=e[1];r<=e[3]&&!l;r++){switch(i=!1,parseInt(a/90,10)%4){case 0:c=_[3]+s*(_[0]-o),i=_[0]<=o&&o<=_[2]&&c<=r&&r<=_[3];break;case 1:c=_[3]-s*(_[2]-o),i=_[0]<=o&&o<=_[2]&&_[1]<=r&&r<=c;break;case 2:c=_[3]-s*(_[0]-o),i=_[0]<=o&&o<=_[2]&&_[1]<=r&&r<=c;break;case 3:c=_[3]+s*(_[2]-o),i=_[0]<=o&&o<=_[2]&&c<=r&&r<=_[3]}i&&(p=n.data,l=!0)}}return p},aa=function(t,e,n){var a,i,o,r,s,c,p,l,_;return o=-e.angle,a=Yn(e).width,i=Yn(e).height,l=e.hot_spot,_=e.position,r=_t(pt(0,0),l),s=_t(pt(a,0),l),c=_t(pt(a,i),l),p=_t(pt(0,i),l),n[0]=lt(_,ut(r,o)),n[1]=lt(_,ut(s,o)),n[2]=lt(_,ut(c,o)),n[3]=lt(_,ut(p,o)),n},ia=function(t,e){return t.translate(e,0),t.scale(-1,1),t.translate(-e,0),t},oa=[],ra=function(t){var e,n={};for(n.type=it(t,0,9),n.text=null,n.width=0,n.visible=!0,n.hspace=n.vspace=1,n.value=[],n.position=pt(0,0),e=0;e<5;e++)n.value[e]=0;return n},sa=function(t,e){if(!t)return!1;for(var n,a=arguments.length,i=new Array(a>2?a-2:0),o=2;o<a;o++)i[o-2]=arguments[o];for(n=0;n<i.length;n++)i[n]=""+i[n];var r=(e=""+e).match(/\$[A-Z_\d]\w+/g);if(r)for(n=0;n<r.length;n++){var s=r[n].slice(1),c=Xe(s);c&&(e=e.replace("$"+s,c))}if(r=e.match(/\%[s]+/g))for(n=0;n<r.length;n++)if(i[n]){var p=i[n].match(/\$[A-Z_\d]\w+/g);p&&(i[n]=p[0].slice(1)),e=e.replace("%s",Xe(i[n]))}if(r=e.match(/\%[d]+/g))for(n=0;n<r.length;n++)i[n]&&(e=e.replace("%d",""+i[n]));return t.text=""+e,t},ca=function(t){return t.text?t.text:""},pa=function(t){return da(t)},la=function(t,e){t.width=Math.max(0,e)},_a=function(t,e){var n,a,i,o,r,s=0,c=0,p=[],l=0,_=0;p[_++]={r:!1,g:0,b:0};var d=da(t);if(n=d.x,a=d.y,t&&t.visible&&t.text)for(l=0;l<t.text.length;l++){if(i=t.text[l],r=!1,et(t.text[l-1])){var u=void 0,f=!1,h=0,g=t.text.slice(l),m=(g=(g=g.replace("(","")).replace(")","")).split(" ")[0];for(u=0;u<m.length;u++)"<"==m[u]&&(f=!0),f||h++,">"==m[u]&&(f=!1);r=t.width>0&&s+(n+t.hspace)*h-t.hspace>t.width}if("<"==i){var b=t.text.slice(l,l+7);if("<color="==b){var y,x,v;l+=7;var w=t.text.slice(l,l+6);y=fa(w.slice(0,2)),x=fa(w.slice(2,4)),v=fa(w.slice(4,6)),p[_++]={r:y,g:x,b:v},l+=7,i=t.text[l]}"</color"==b&&(l+=8,i=t.text[l],_>=2&&_--)}r&&(s=0,c+=a+t.vspace),"\n"!=i?(o=oa[t.type].ch[i])?(s+=o.width,et(t.text[l-1]),ua(Tt(),o,parseInt(t.position.x+s-(e.x-240),10),parseInt(t.position.y+c-(e.y-135.5),10),p[_-1].r,p[_-1].g,p[_-1].b)):s+=n+t.hspace:(s=0,c+=a+t.vspace)}},da=function(t){var e,n;if(t)for(e=0;e<256;e++)if(oa[t.type]&&null!=(n=oa[t.type].ch[e]))return pt(n.width,n.height);return pt(16,16)},ua=function(t,e,n,a,i,o,r){var s=e.data;t.drawImage(s,e.sx,e.sy,e.swidth,e.sheight,n,a-2,1*e.width,1*e.height)},fa=function(t){return(t=t.toLowerCase())>="0"&&t<="9"?t-"0":t>="a"&&t<="f"?t-"a"+10:255},ha=[],ga=[],ma=-1,ba=function(){var t;for(Qt=un(dn("SD_CONFIRMBOX",0),0),Kt=pt((gt-Qt.width)/2,mt),ie=Ee(),Jt=Un(),Jt=zn(Jt,dn("SD_TITLEFOOT",0)),Zt=ra(8),sa(Zt,te),la(Zt,164),t=0;t<ee;t++)ha[t]=[],ha[t][0]=ra(8),ha[t][1]=ra(8),sa(ha[t][0],ga[t]),sa(ha[t][1],"<color=ffff00>%s</color>",ga[t]);ma=0,ne=!0,ae=!1},ya=function(){var t,e=Z();if(ne&&(Kt.y<=(mt-Qt.height)/2?ne=!1:Kt.y-=1355*e),ae){if(Kt.y>=mt)return ae=!1,void ze();Kt.y+=1355*e}for(Jt.position=pt(Kt.x+ma*Qt.width/ee+10,Kt.y+.75*Qt.height-1),Zt.position=pt(Kt.x+10,Kt.y+10),t=0;t<ee;t++)ha[t][0].position=pt(Kt.x+t*Qt.width/ee+25,Kt.y+.75*Qt.height),ha[t][1].position=ha[t][0].position;ne||ae||(Oe(ie,4)?(W(qe("choose")),ma=((ma-1)%ee+ee)%ee):Oe(ie,3)?(W(qe("choose")),ma=(ma+1)%ee):(Oe(ie,5)||Oe(ie,7))&&(W(qe("select")),ae=!0))},xa=function(){var t,e,n=pt(240,135.5);for(It(),Tt().drawImage(Qt.data,Qt.sx,Qt.sy,Qt.swidth,Qt.sheight,Kt.x,Kt.y,Qt.swidth,Qt.sheight),_a(Zt,n),t=0;t<ee;t++)e=t==ma?1:0,_a(ha[t][e],n);Hn(Jt,n)},va=function(){Bn(Jt),Me(ie),sn(void 0)},wa=function(t,e,n){ma=-1,te=t,ga[0]=e,n?(ga[1]=n,ee=2):ee=1},ka=function(){if(-1!=ma){var t=ma+1;return ma=-1,t}return 0},Sa=function(t){return new Promise((function(e,n){R("background_load('%s')"),D(t).then(Ra).then((function(t){e(t)}))}))},ja=function(t){return R("background_unload()"),null},Ea=function(t){if(!t)return!1;var e,n;for(e=0;e<t.length;e++)(n=t[e]).strategy&&n.strategy.update&&n.strategy.update(n.strategy)},Ma=function(t,e){Oa(t,e,!1)},Ia=function(t,e){Oa(t,e,!0)},Oa=function(t,e,n){if(t){var a,i,o=pt(240,135.5),r=_t(e,o);for(a=0;a<t.length;a++)i=t[a],(!n&&i.zindex<=.5||n&&i.zindex>.5)&&(i.actor.position.x+=r.x*i.actor.speed.x,i.actor.position.y+=r.y*i.actor.speed.y,Xn(i.actor,o,i.repeat_x,i.repeat_y),i.actor.position.y-=r.y*i.actor.speed.y,i.actor.position.x-=r.x*i.actor.speed.x)}},Da=function(t){},Ta=function(t){var e=t,n=t.background,a=Z();n.actor.position.x+=e.speed_x*a,n.actor.position.y+=e.speed_y*a},La=function(t){var e,n,a,i=t,o=t.background,r=Z();e=i.timer+=r,n=Math.sin(i.angularspeed_x*e+i.initialphase_x),a=Math.cos(i.angularspeed_y*e+i.initialphase_y),o.actor.position.x+=-i.angularspeed_x*i.amplitude_x*n*r,o.actor.position.y+=i.angularspeed_y*i.amplitude_y*a*r},Ra=function(t){var e=t.bg;return Promise.all(e.map(Aa))},Aa=function(t,e){return new Promise((function(e,n){var a,i=function(){var t={};return t.actor=Un(),t.data=null,t.strategy=null,t.repeat_x=!1,t.repeat_y=!1,t.zindex=0,t}();switch(i.actor.spawn_point.x=t.initial_position.xpos,i.actor.spawn_point.y=t.initial_position.ypos,i.actor.position=pt(i.actor.spawn_point.x,i.actor.spawn_point.y),i.actor.speed.x=t.scroll_speed.xspeed,i.actor.speed.y=t.scroll_speed.yspeed,t.behavior&&nt(t.behavior)?t.behavior[0]:t.behavior){case"DEFAULT":i.strategy&&(i.strategy=(i.strategy,null)),i.strategy=((a={}).background=i,a.update=Da,a);break;case"LINEAR":i.strategy&&(i.strategy=(i.strategy,null)),i.strategy=function(t,e,n){var a={},i=a;return i.background=t,i.update=Ta,a.speed_x=e,a.speed_y=n,i}(i,t.behavior[1],t.behavior[2]);break;case"CIRCULAR":i.strategy&&(i.strategy=(i.strategy,null)),i.strategy=function(t,e,n,a,i,o,r){var s={},c=s;return c.background=t,c.update=La,s.timer=0,s.amplitude_x=e,s.amplitude_y=n,s.angularspeed_x=2*v*a,s.angularspeed_y=2*v*i,s.initialphase_x=o*v/180,s.initialphase_y=r*v/180,c}(i,t.behavior[1],t.behavior[2],t.behavior[3],t.behavior[4],t.behavior[5],t.behavior[6])}i.repeat_x=t.repeat_x,i.repeat_y=t.repeat_y,t.zindex&&(i.zindex=t.zindex),fn(t.sprite).then((function(t){i.data=t,i.actor.animation=t,i.actor.animation.data=[0],i.actor.image=i.actor.animation.frame_data[0],e(i)}))}))},Na=["<color=ffff00>$CREDITS_ENGINE</color>\n\n","<color=ffff00>$CREDITS_ACTIVE</color>\n\n","Alexandre Martins:\n$CREDITS_ALEXANDRE\n\n","Di Rodrigues:\n$CREDITS_DI\n\n","Colin:\n$CREDITS_COLIN\n\n","Mateus Reis:\n$CREDITS_MATEUSREIS\n\n","Christopher Martinus:\n$CREDITS_CHRISTOPHER\n\n","Celdecea:\n$CREDITS_CELDECEA\n\n","Christian Zigotzky:\n$CREDITS_XENO\n\n","Joepotato28:\n$CREDITS_JOE\n\n","Arthur Blot:\n$CREDITS_ARTHURBLOT\n\n","Reimund Renner:\n$CREDITS_REIMUND\n\n","Szymon Weihs:\n$CREDITS_SZYMON\n\n","Tomires:\n$CREDITS_TOMIRES\n\n","Sascha de waal:\n$CREDITS_SSDW\n\n","Francesco Sciusco:\n$CREDITS_FRANCESCO\n\n","<color=ffff00>$CREDITS_THANKS</color>\n\n","SourceForge.net\n","allegro.cc\n","OpenGameArt.org\n","GagaGames.com.br\n","Rsonist88\n","PlayDeb.net\n\n","<color=ffff00>$CREDITS_RETIRED</color>\n\n","Neoblast:\n$CREDITS_NEOBLAST\n\n","Bastian von Halem:\n$CREDITS_BASTIAN\n\n","Lainz:\n$CREDITS_LAINZ\n\n","Jogait:\n$CREDITS_JOGAIT\n\n"],Ca=function(){re=!1,le=Ee(),se=ra(4),console.log(se),sa(se,Xe("CREDITS_TITLE")),se.position.x=140,se.position.y=5,pe=ra(8),sa(pe,Xe("CREDITS_KEY")),pe.position.x=10,pe.position.y=mt-pa(pe).y-5,ce=ra(8);for(var t=0;t<Na.length;t++){var e=Na[t],n=e.match(/\$[A-Z_\d]\w+/m);if(n){for(var a=0;a<n.length;a++){var i=n[a].slice(1),o=Xe(i);o&&(e=e.replace("$"+i,o))}Na[t]=e}}Na=Na.join(""),sa(ce,Na,"%s"),la(ce,300),ce.position.x=10,ce.position.y=mt,_e=1;for(var r=ca(ce),s=0;s<r.length;s++)"\n"==r[s]&&_e++;_e+=10,oe=tn(gt,30),de=Sa("data/themes/credits.bg.json").then((function(t){de=t,console.log(de),St(on(0,0,0),1)})),St(on(0,0,0),1)},Pa=function(){var t,e=Z();if(Ea(de),ce.position.y-=3*pa(ce).y*e,ce.position.y<-_e*(pa(ce).y+(t=ce,pt(t.hspace,t.vspace)).y)&&(ce.position.y=mt),re||Mt()||(Oe(le,7)?(W(qe("select")),re=!0):Oe(le,8)&&(W(qe("return")),re=!0)),!H()){var n=music_load("data/music/options.mp4");P(n,b)}if(re){if(Et())return void ze();jt(on(0,0,0),1)}},Ga=function(){It();var t=pt(240,135.5);Ma(de,t),Ia(de,t),_a(ce,t),Tt().fillRect(0,0,oe.width,oe.height),Tt().fillRect(0,251,oe.width,oe.height),_a(se,t),_a(pe,t)},Ua=function(){de=ja(),sn(oe),Me(le)},Ba=10,Ha=[],Xa=function(){var t;for(ue=J(),(fe=ra(8)).position=pt(5,35),he=ra(4),sa(he,Xe("ENDOFDEMO_TITLE")),he.position=pt((gt-parseInt(pa(he).x,10)*ca(he)).length/2,5),t=0;t<Ba;t++)Ha[t]=Un(),Ha[t].spawn_point=Ha[t].position=pt(gt*t/Ba+15,215),zn(Ha[t],dn(t%2==1?"SD_BLUERING":"SD_RING",0));St(on(0,0,0),2)},Wa=function(){var t,e=J(),n=Math.max(0,(3-parseInt(e-ue,10))/1e3);if(sa(fe,Xe("ENDOFDEMO_TEXT"),h,g,n),e>=ue+3){if(Et())return ze(),void $e(Bh(Rh));jt(on(0,0,0),2)}for(t=0;t<Ba;t++)Ha[t].position.y=Ha[t].spawn_point.y+10*Math.sin(v*(.001*e)+2*v/Ba*t)},Ya=function(){var t,e=pt(240,135.5);for(It(),t=0;t<Ba;t++)Hn(Ha[t],e);_a(he,e),_a(fe,e)},$a=function(){var t;for(t=0;t<Ba;t++)Bn(Ha[t])},za={is_locked:!1,position:{x:0,y:0},dest:{x:0,y:0},speed:0,region_topleft:{x:0,y:0},region_bottomright:{x:0,y:0},dest_region_topleft:{x:0,y:0},dest_region_bottomright:{x:0,y:0},region_topleft_speed:0,region_bottomright_speed:0},Fa=function(t,e){t.x<za.region_topleft.x&&(t.x=za.region_topleft.x),t.y<za.region_topleft.y&&(t.y=za.region_topleft.y),t.x>za.region_bottomright.x&&(t.x=za.region_bottomright.x),t.y>za.region_bottomright.y&&(t.y=za.region_bottomright.y),za.dest=t,e>m?za.speed=ft(_t(za.position,za.dest))/e:za.position=za.dest,za.position.x=parseInt(t.x,10),za.position.y=parseInt(t.y,10)},Va=function(){return pt(za.position.x,za.position.y)},qa=function(t){var e=pt(t.x,t.y);za.dest=za.position=e},Qa=function(){var t,e,n,a;za.is_locked||(t=-99999999,e=-99999999,n=b,a=b,za.dest_region_topleft.x=Math.max(Math.min(t,n),240),za.dest_region_topleft.y=Math.max(Math.min(e,a),135.5),za.dest_region_bottomright.x=Math.min(Math.max(t,n),hd().x-240),za.dest_region_bottomright.y=Math.min(Math.max(e,a),hd().y-135.5),za.region_topleft_speed=ft(_t(za.region_topleft,za.dest_region_topleft))/.25,za.region_bottomright_speed=ft(_t(za.region_bottomright,za.dest_region_bottomright))/.25)},Ka=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Un(),t.actor.maxspeed=145+at(21),t.actor.input=Se(),e.is_running=!1,e.animal_id=at(12),zn(t.actor,dn("SD_ANIMAL",0))},Za=function(t){Bn(t.actor)},Ja=function(t,e,n,a,i,o){var r,s,c,p,l=t,_=t.actor,d=2*l.animal_id+(l.is_running?1:0);Te(_.input,5),_.jump_strength=1.3*(200+at(50)),_.speed.x>m?(_.speed.x=_.maxspeed,_.mirror=0):_.speed.x<-1e-4&&(_.speed.x=-_.maxspeed,_.mirror=w),zn(_,dn("SD_ANIMAL",d));var u=Qn(_,2,-2,a,r,null,p,null,s,null,c,null);r=u.up,u.upright,p=u.right,u.downright,s=u.down,u.downleft,c=u.left,u.upleft;var f=Jn(_,-2,r,null,p,null,s,null,c,null);r=f.up,f.upright,p=f.right,f.downright,s=f.down,f.downleft,c=f.left,f.upleft,s&&!l.is_running&&(l.is_running=!0,_.speed.x=(at(2)?-1:1)*_.maxspeed),c&&!r&&(_.speed.x=_.maxspeed),p&&!r&&(_.speed.x=-_.maxspeed),!l.is_running&&(s&&r||c&&p)&&(t.state=fs),Wn(_,ta(_,a,Sd()))},ti=function(t,e){Hn(t.actor,e)},ei=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Un(),oi(t,ri()),zn(t.actor,dn("SD_ENDLEVEL",0))},ni=function(t){Bn(t.actor),oi(t,null)},ai=function(t,e,n,a,i,o){var r=t;r.state.handle(r.state,t,e,n)},ii=function(t,e){Hn(t.actor,e)},oi=function(t,e){t.state=e},ri=function(){var t={},e=t;return t.handle=si,e.being_hit=!1,e.hit_count=0,t},si=function(t,e,n,a){var i,o,r,s=t,c=e.actor;for(i=0;i<a;i++){var p=n[i];_i(e,p)&&!s.being_hit&&(s.being_hit=!0,zn(c,dn("SD_ENDLEVEL",1)),W(qe("boss hit")),p.bounce(p),p.actor.speed.x*=-.5,++s.hit_count>=3&&oi(e,(o=void 0,r=void 0,r=o={},o.handle=ci,r.explode_timer=0,r.break_timer=0,o)))}Fn(c)&&s.being_hit&&(zn(c,dn("SD_ENDLEVEL",0)),s.being_hit=!1)},ci=function(t,e,n,a){var i,o=t,r=e.actor,s=Z();if(o.explode_timer+=s,o.break_timer+=s,o.explode_timer>=.1){var c=pt(r.position.x-r.hot_spot.x+at(Yn(r).width),r.position.y-r.hot_spot.y+at(Yn(r).height/2));Ed(bs,c),W(qe("explode")),o.explode_timer=0}o.break_timer>=2&&oi(e,((i={}).handle=pi,i))},pi=function(t,e,n,a){for(var i,o=e.actor,r=0;r<20;r++){var s=pt(o.position.x-o.hot_spot.x+at(Yn(o).width),o.position.y-o.hot_spot.y+at(Yn(o).height/2));Dd(s)}bd(o),zn(o,dn("SD_ENDLEVEL",2)),oi(e,((i={}).handle=li,i))},li=function(t,e,n,a){},_i=function(t,e){if(t&&e){var n=[],a=[],i=t.actor,o=e.actor;return n[0]=o.position.x-o.hot_spot.x,n[1]=o.position.y-o.hot_spot.y,n[2]=n[0]+Yn(o).width,n[3]=n[1]+Yn(o).height,a[0]=i.position.x-i.hot_spot.x+5,a[1]=i.position.y-i.hot_spot.y,a[2]=a[0]+Yn(i).width-10,a[3]=a[1]+Yn(i).height/2,e.attacking(e)&&ot(n,a)&&qn(i,o)}},di=0,ui=0,fi=function(t){var e,n={};switch(R("player_create(%d)"),t){case 0:n.name="Surge";break;case 1:n.name="Neon";break;case 2:n.name="Charge";break;default:n.name="Unknown"}for(n.type=t,n.actor=Un(),n.disable_movement=!1,n.in_locked_area=!1,n.at_some_border=!1,n.attacking=vi,n.bounce=xi,n.spin=n.spin_dash=n.braking=n.flying=n.climbing=n.landing=n.spring=!1,n.is_fire_jumping=!1,n.getting_hit=n.dying=n.dead=n.blinking=!1,n.on_moveable_platform=!1,n.lock_accel=0,n.flight_timer=n.blink_timer=n.death_timer=0,n.disable_jump_for=0,n.glasses=Un(),n.got_glasses=!0,n.shield=Un(),n.shield_type=0,n.invincible=!1,n.invtimer=0,n.invstar=[],e=0;e<5;e++)n.invstar[e]=Un(),n.invstar[e]=zn(n.invstar[e],dn("SD_INVSTAR",0));switch(n.got_speedshoes=!1,n.speedshoes_timer=0,n.disable_wall=0,n.entering_loop=!1,n.at_loopfloortop=!1,n.bring_to_back=!1,n.type){case 0:n.actor.acceleration=250,n.actor.maxspeed=700,n.actor.jump_strength=450,n.actor.input=Ee(),n.actor=zn(n.actor,dn(Ii(0),0));break;case 1:n.actor.acceleration=200,n.actor.maxspeed=600,n.actor.jump_strength=360,n.actor.input=Ee(),n.actor=zn(n.actor,dn(Ii(1),0));break;case 2:n.actor.acceleration=200,n.actor.maxspeed=600,n.actor.jump_strength=360,n.actor.input=Ee(),n.actor=zn(n.actor,dn(Ii(2),0))}return me=1,ge=0,R("player_create() ok"),n},hi=function(t,e,n){var a=t.actor;return t.blinking&&(t.blink_timer+=Z(),a.visible=J()%250<125,t.blink_timer>=4&&(t.getting_hit=t.blinking=!1,a.visible=!0)),t.disable_movement?t.spin?t.actor=zn(t.actor,dn(Ii(t.type),3)):t.spring&&(t.actor=zn(t.actor,dn(Ii(t.type),13))):Wn(a,mi(t,e,n,Sd())),t},gi=function(t,e){if(t){var n=t.actor;if(n){var a,i,o=n.hot_spot,r=n.position,s=pt(0,0),c=pt(0,0),p=[],l=n.angle;if(t.invincible){var _=dn("SD_INVSTAR",0).frame_count;for(t.invtimer+=Z(),a=0;a<5;a++)p[a]=720*J()*.001+72*(a+1),c.x=30*Math.cos(p[a]*v/180),c.y=(J()+400*a)%2e3/40,c=ut(c,l),t.invstar[a].position.x=n.position.x+c.x,t.invstar[a].position.y=n.position.y-c.y+5,$n(t.invstar[a],at(_))}for(t.got_glasses&&Oi(t),0!=t.shield_type&&Ti(t),t.type,a=0;a<5&&t.invincible;a++)p[a]%360>=180&&Hn(t.invstar[a],e);for(i=n.angle,n.angle=n.is_jumping||t.spin?i:st(i),Hn(n,e),n.angle=i,t.got_glasses&&Hn(t.glasses,e),0!=t.shield_type&&Hn(t.shield,e),a=0;a<5&&t.invincible;a++)p[a]%360<180&&Hn(t.invstar[a],e);switch(t.type){case 0:case 2:default:break;case 1:n.is_jumping&&n.animation==dn(Ii(1),3)&&(n.position=pt(r.x,r.y),n.angle=l,n.hot_spot=o,0!=t.shield_type&&(t.shield.angle=0,t.shield.hot_spot=s))}}}},mi=function(t,e,n,a){var i,o,r,s,c,p,l,_,d,u,f,h,g,b,y,x,k,S,j,E,M,I,O,D,T=t.actor,L=Ii(t.type),R=Z(),A=480,N=0,C=1,P=T.maxspeed,G=pt(0,0),U=!1,B=t.actor.animation==dn(L,1),H=!1,X=!1,Y=!1,z=null,F=Yn(T).width,V=Yn(T).height,q=!(Math.abs(T.angle)<m||Math.abs(T.angle-v/2)<m||Math.abs(T.angle-v)<m||Math.abs(T.angle-3*v/2)<m),Q=-2,K=0,J=0,tt=0,et=T.position;switch(t.type){case 0:q?(K=1,J=.8,tt=.5):(K=.7,J=.5,tt=.4);break;case 1:case 2:q?(K=1,J=.7,tt=.25):(K=.7,J=.5,tt=.25)}if(g=lt(et,ut(pt(0,-V*K+Q),-T.angle)),k=lt(et,ut(pt(0,2),-T.angle)),j=lt(et,ut(pt(-F*tt+Q,-V*J),-T.angle)),y=lt(et,ut(pt(F*tt-Q,-V*J),-T.angle)),E=lt(et,ut(pt(-F*tt+Q,-V*K+Q),-T.angle)),b=lt(et,ut(pt(F*tt-Q,-V*K+Q),-T.angle)),S=lt(et,ut(pt(-F*tt+Q,2),-T.angle)),x=lt(et,ut(pt(F*tt-Q,2),-T.angle)),1==t.type&&T.carrying&&Math.abs(T.angle)<m){var nt=Yn(T.carrying).height,rt=T.speed.y>5?.7*nt:0;S.y+=rt,x.y+=rt,k.y+=rt,j.y+=nt*J+at(nt)-.5*nt,y.y=j.y}M=8&t.disable_wall,I=2&t.disable_wall,O=4&t.disable_wall,D=1&t.disable_wall,Nn=M,Cn=I,Pn=O,Gn=D,Zn(!(4&t.disable_wall));var st=Kn(T,2,g,b,y,x,k,S,j,E,n,s,_,p,d,c,u,l,f);if(s=st.up,c=st.down,l=st.left,p=st.right,f=st.upleft,_=st.upright,u=st.downleft,d=st.downright,Zn(!0),t.dying)return T.speed.x=0,T.speed.y=Math.min(A,T.speed.y+a*R),T.mirror=null,T.angle=0,T.visible=!0,t.blinking=!1,t.death_timer+=R,t.dead=t.death_timer>=2.5,T=zn(T,dn(L,8)),pt(0,T.speed.y*R+.5*a*R*R);if(t.dead)return pt(0,0);var ct=Jn(T,Q,s,_,p,d,c,u,l,f);switch(s=ct.up,_=ct.upright,p=ct.right,l=ct.left,f=ct.upleft,c=ct.down,u=ct.downleft,d=ct.downright,t.type){case 0:T.carry_offset=pt(T.mirror&w?7:-9,-40);break;case 1:case 2:T.carry_offset=pt(T.mirror&w?7:-7,-42)}if(null!=T.carried_by){var ht,gt=null,mt=0,bt=0,yt=T.carried_by;for(ht=0;ht<e.length;ht++)if(e[ht]==t){bt=ht;break}for(ht=0;ht<e.length;ht++)if(e[ht].actor==yt){gt=e[ht],mt=ht,t.disable_wall=gt.disable_wall,t.entering_loop=gt.entering_loop,t.at_loopfloortop=gt.at_loopfloortop,t.bring_to_back=gt.bring_to_back;break}if(gt&&(1==gt.type&&!gt.flying||gt.getting_hit||gt.dying||gt.dead))T.position=pt(T.carried_by.position.x,T.carried_by.position.y),T.carried_by.carrying=null,T.carried_by=null;else{if(!(c&&0==c.brick_ref.angle&&parseInt(yt.speed.y,10)>=5||t.getting_hit||t.dying||t.dead)){var xt=bt<mt?dt(yt.speed,R):pt(0,0);return T.speed=pt(0,0),T.mirror=yt.mirror,T.angle=0,(T=zn(T,dn(L,25))).position=_t(lt(yt.position,xt),T.carry_offset),pt(0,0)}T.position=pt(T.carried_by.position.x,T.carried_by.position.y),T.carried_by.carrying=null,T.carried_by=null}}if(t.entering_loop=!1,t.got_speedshoes&&(t.speedshoes_timer>23?t.got_speedshoes=!1:(P*=1.5,t.speedshoes_timer+=R)),Li(t)&&T.is_jumping&&(t.disable_wall&=-5),t.spring&&(c&&parseInt(T.speed.y,10)>=0||t.flying||t.climbing)&&(t.spring=!1),i=(p&&Ie(T.input,3)||l&&Ie(T.input,4))&&c,t.on_moveable_platform=ft(Od(c,T))>m,(r=c&&(T.angle>0&&T.angle<v/2&&T.speed.x>0||T.angle>3*v/2&&T.angle<2*v&&T.speed.x<0))&&(f||_)||Math.abs(T.angle)<m||Math.abs(T.angle-v)<m){if(p&&p.brick_ref.angle%90==0&&(T.speed.x>m||y.x>p.x)&&(!r||r&&90!=p.brick_ref.angle)&&(T.speed.x=0,T.position.x=p.x+(et.x-y.x),!T.is_jumping&&!t.flying&&!t.climbing&&Math.abs(T.speed.y)<m&&(z=dn(L,i?14:0)),r))return pt(-5,0);if(l&&l.brick_ref.angle%90==0&&(T.speed.x<-1e-4||j.x<l.x+l.brick_ref.image.width)&&(!r||r&&270!=l.brick_ref.angle)&&(T.speed.x=0,T.position.x=l.x+l.brick_ref.image.width+(et.x-j.x),!T.is_jumping&&!t.flying&&!t.climbing&&Math.abs(T.speed.y)<m&&(z=dn(L,i?14:0)),r))return pt(5,0);T.position.x<=T.hot_spot.x&&(t.spin=!1,X=!0,T.position.x<T.hot_spot.x&&(T.speed.x=0,T.position.x=T.hot_spot.x,c&&(i=!0,z=dn(L,1)))),T.position.x>=hd().x-(Yn(T).width-T.hot_spot.x)&&(t.spin=!1,H=!0,T.position.x>hd().x-(Yn(T).width-T.hot_spot.x)&&(T.speed.x=0,T.position.x=hd().x-(Yn(T).width-T.hot_spot.x),c&&(i=!0,z=dn(L,1))))}if(!t.climbing){if(c){var vt,wt,kt=c.brick_ref.angle;if(U=!0,T.ignore_horizontal=!1,t.is_fire_jumping=!1,T.is_jumping=!1,c.brick_ref&&3==c.brick_ref.behavior&&0==c.state&&(c.state=2),Math.abs(T.speed.x)<m){if(kt%180==0&&(t.spin=!1),Ie(T.input,2))t.spin_dash||(z=dn(L,4)),Oe(T.input,5)&&(z=dn(L,6),t.spin_dash=!0,W(qe("charge")));else if(!i)if(Ie(T.input,1))B&&t.at_some_border||(z=dn(L,5));else if(Li(t))z=dn(L,0);else{var St=lt(et,ut(pt(-8,0),-T.angle)),jt=lt(et,ut(pt(5,0),-T.angle)),Et=pt(0,0),Mt=Kn(T,2,Et,Et,Et,jt,Et,St,Et,Et,n,null,null,null,void 0,null,void 0,null,null);Mt.downleft&&Mt.downright||t.on_moveable_platform?Ie(T.input,4)&&(X||t.at_some_border)||Ie(T.input,3)&&(H||t.at_some_border)?(T.mirror=X?w:0,z=dn(L,1)):z=dn(L,0):z=dn(L,10)}if(t.spin_dash){var It,Ot,Dt,Tt,Lt=T.mirror&w?1:-1;for(It=0;It<3;It++)at(128),Tt=tn(1,1),rn(Tt,255,255,255),Ot=pt(Lt*(7+at(7)),2),Dt=pt(Lt*(50+at(200)),-at(200)),Id(Tt,lt(T.position,Ot),Dt,!0);(De(T.input,2)||_d())&&(t.spin=!0,t.spin_dash=!1,(!(T.mirror&w)||l||X)&&(T.mirror&w||p||H)||(T.speed.x=(T.mirror&w?-1:1)*P*1.35),W(qe("release")),t.disable_jump_for=.05)}}else if(Ie(T.input,2)&&(t.spin||W(qe("roll")),t.spin=!0),t.spin||t.braking){if(t.spin)z=dn(L,3);else if(t.braking){var Rt,At,Nt,Ct=T.mirror&w?1:-1;at(128),Nt=tn(1,1),Rt=pt(Ct*(10-at(21)),0),At=pt(Ct*(50+at(200)),-at(200)),Id(Nt,lt(T.position,Rt),At,!0),z=dn(L,7),Math.abs(T.speed.x)<10&&(t.braking=!1)}}else{var Pt=.75*P,Gt=.35*P;Math.abs(T.speed.x)<Pt?!i&&T.speed.y>=0&&(z=dn(L,1),T=function(t,e){return t.animation_speed_factor=Math.max(0,e),t}(T,.5+Math.abs(T.speed.x)/Pt*1.5)):z=dn(L,2),Math.abs(T.speed.x)>=Gt&&(Ie(T.input,3)&&T.speed.x<0||Ie(T.input,4)&&T.speed.x>0)&&(W(qe("brake")),t.braking=!0)}if(t.disable_jump_for=Math.max(t.disable_jump_for-R,0),Math.abs(T.speed.x)<m&&(t.disable_jump_for=0),vt=!t.spin_dash,Ie(T.input,5)&&t.disable_jump_for<=0&&!Ie(T.input,2)&&!s&&!t.landing&&vt&&!T.is_jumping&&(W(qe("jump")),T.angle=0,T.is_jumping=!0,t.is_fire_jumping=!0,Y=!0,t.spin=!1,z=dn(L,3),0==kt?T.speed.y=1*-T.jump_strength:kt>0&&kt<90?kt>45?(T.speed.x=Math.min(T.speed.x,-.7*T.jump_strength*1),T.speed.y=-.7*T.jump_strength*1):(T.speed.x*=T.speed.x>0?.5:1,T.speed.y=1*-T.jump_strength):90==kt?(Wn(T,pt(-40,0)),T.speed.x=Math.min(T.speed.x,1*-T.jump_strength),T.speed.y=-T.jump_strength/2*1):kt>90&&kt<180?(Wn(T,pt(0,40)),T.speed.x=Math.min(T.speed.x,-.7*T.jump_strength*1),T.speed.y=1*T.jump_strength):180==kt?(Wn(T,pt(0,40)),T.speed.x*=-1,T.speed.y=1*T.jump_strength):kt>180&&kt<270?(Wn(T,pt(0,40)),T.speed.x=Math.max(T.speed.x,.7*T.jump_strength*1),T.speed.y=1*T.jump_strength):270==kt?(Wn(T,pt(40,0)),T.speed.x=Math.max(T.speed.x,1*T.jump_strength),T.speed.y=-T.jump_strength/2*1):kt>270&&kt<360&&(kt<315?(T.speed.x=Math.max(T.speed.x,.7*T.jump_strength*1),T.speed.y=-.7*T.jump_strength*1):(T.speed.x*=T.speed.x<0?.5:1,T.speed.y=1*-T.jump_strength))),!T.is_jumping){var Ut;kt>0&&kt<90?(Ut=.8*Math.min(1,Math.tan(kt*v/180)),Math.abs(T.speed.y)>m?T.speed.x=U&&kt<=45?T.speed.x:Math.max(-1.2*P,-1*Ut*T.speed.y):(wt=(T.mirror&w?2:1)*Ut,t.braking&&kt<45?wt*=8*(T.speed.x<0?-.5:1):Math.abs(T.speed.x)<5&&(wt*=25*Math.sin(kt*v/180),t.lock_accel=2),T.speed.x=Math.max(T.speed.x-700*wt*R,-1.2*P))):kt>270&&kt<360&&(Ut=.8*Math.min(1,-Math.tan(kt*v/180)),Math.abs(T.speed.y)>m?T.speed.x=U&&kt>=315?T.speed.x:Math.min(1.2*P,1*Ut*T.speed.y):(wt=(T.mirror&w?1:2)*Ut,t.braking&&kt>315?wt*=8*(T.speed.x>0?-.5:1):Math.abs(T.speed.x)<5&&(wt*=25*-Math.sin(kt*v/180),t.lock_accel=1),T.speed.x=Math.min(T.speed.x+700*wt*R,1.2*P)))}kt%90==0&&(t.lock_accel=0),u&&d&&Math.abs(T.speed.x)<40&&u.brick_ref.angle>270&&u.brick_ref.angle<360&&d.brick_ref.angle>0&&d.brick_ref.angle<90&&(Ie(T.input,4)||Ie(T.input,3)||(T.speed.x=0))}else t.braking=!1,t.lock_accel=0,t.spin_dash&&(t.spin_dash=!1,z=dn(L,1)),T.animation!=dn(L,0)&&T.animation!=dn(L,10)&&T.animation!=dn(L,5)||(z=dn(L,1)),(t.spring||B||T.speed.y<0)&&(t.spin=!1),Li(t)||(T.angle=0);if(c||t.is_fire_jumping&&T.speed.y<.88*-T.jump_strength&&De(T.input,5)&&(T.speed.y*=.7),1==t.type&&t.flying?(C=t.flight_timer<10?.15:.8,A*=.3):C=1,G.y=Math.abs(T.speed.y)>m?T.speed.y*R+a*C*.5*(R*R):0,2==t.type&&t.flying||(T.speed.y=Math.min(T.speed.y+a*C*R,A)),o=s&&s.brick_ref.angle%90!=0&&Math.abs(T.angle)<m,s&&(s.brick_ref.angle%90==0||o)&&T.speed.y<-1e-4&&(T.position.y=s.y+s.brick_ref.image.height+(et.y-g.y),T.speed.y=10,1==s.brick_ref.behavior&&Math.sin(s.brick_ref.behavior_arg[3]*s.value[0])>0))return T.speed.y=100,lt(G,dt(Od(s,T),R));if((h=c)&&!T.is_jumping){var Bt=h.brick_ref.angle;if(T.speed.y=G.y=0,T.angle=Bt*v/180,0==Bt){var Ht=Od(c,T);et.y=h.y,N=0,Ht.y>m?G.y+=Ht.y*R:T.position.y=et.y+Q+1}else if(Bt>0&&Bt<90)et.y=parseInt(h.y+h.brick_ref.image.height-(T.position.x-h.x)*Math.tan(T.angle),10),T.speed.x<0&&(et.y+=2),T.position.y=et.y+Q,T.mirror&w||(N=.2);else if(90==Bt){if(Math.abs(T.speed.x)>5){var Xt=d?d.brick_ref.angle:-1;d&&Xt>=Bt&&Xt<Bt+90?t.flying||(T.position.x=h.x+Q):(T.angle=0,T.is_jumping=!0,t.spin||t.flying||(z=dn(L,1)),Li(t)||(t.flying||Wn(T,pt(-13,0)),T.speed=pt(0,-.9*Math.abs(T.speed.x))))}else T.angle=0,t.flying||Wn(T,pt(-10,0)),T.is_jumping=!0,T.ignore_horizontal=!1;T.mirror&w||(N=1.5)}else Bt>90&&Bt<180?(Math.abs(T.speed.x)>5?(et.y=h.y-(T.position.x-h.x)*Math.tan(T.angle),T.position.y=et.y-Q):(T.angle=0,Wn(T,pt(0,30)),T.is_jumping=!0),N=1.5):180==Bt?(Math.abs(T.speed.x)>5?(et.y=h.y+h.brick_ref.image.height,T.position.y=et.y-Q,(T.speed.x>0&&!d||T.speed.x<0&&!u)&&(Wn(T,pt(0,-30)),T.is_jumping=!0,T.speed.x*=-1,T.mirror=T.speed.x<0?w:0,T.angle=0)):(T.angle=0,Wn(T,pt(0,40)),T.is_jumping=!0,T.speed.x=0),N=1.2):Bt>180&&Bt<270?(Math.abs(T.speed.x)>5?(et.y=h.y+h.brick_ref.image.height-(T.position.x-h.x)*Math.tan(T.angle),T.position.y=et.y-Q):(T.angle=0,Wn(T,pt(0,30)),T.is_jumping=!0),N=1.5):270==Bt?(Math.abs(T.speed.x)>5?(Xt=u?u.brick_ref.angle:-1,u&&Xt>Bt-90&&Xt<=Bt?t.flying||(T.position.x=h.x+h.brick_ref.image.width-Q):(T.angle=0,T.is_jumping=!0,t.spin||t.flying||(z=dn(L,1)),Li(t)||(t.flying||Wn(T,pt(13,0)),T.speed=pt(0,-.9*Math.abs(T.speed.x))))):(T.angle=0,t.flying||Wn(T,pt(10,0)),T.is_jumping=!0,T.ignore_horizontal=!1),T.mirror&w&&(N=1.5)):Bt>270&&Bt<360&&(et.y=h.y-(T.position.x-h.x)*Math.tan(T.angle),T.speed.x>0&&(et.y+=2),T.position.y=et.y+Q,T.mirror&w&&(N=.2))}if(G.x=Math.abs(T.speed.x)>m?T.speed.x*R+(1-N)*T.acceleration*.5*(R*R):0,!Ie(T.input,4)||Ie(T.input,3)||t.spin||t.braking||t.landing||t.getting_hit||1==t.lock_accel||X)if(!Ie(T.input,3)||Ie(T.input,4)||t.spin||t.braking||t.landing||t.getting_hit||2==t.lock_accel||H){if(c){var Wt,Yt=0,$t=c.brick_ref.angle;Wt=t.spin?.65:t.braking?4.5:t.landing?.6:1,$t%90==0?Yt=90==$t?-1:270==$t?1:T.speed.x>m?-1:-T.speed.x>m?1:0:($t>90&&$t<180||$t>180&&$t<270)&&(Yt=T.speed.x>m?-1:-T.speed.x>m?1:0),T.speed.x+=Yt*Wt*T.acceleration*R}}else T.ignore_horizontal||!(T.is_jumping||t.spring||B)&&Ie(T.input,2)||(T.mirror=!1,N=T.speed.x<0?-1:N,T.speed.x<=1.1*P&&(T.speed.x=Math.min(T.speed.x+(1-N)*T.acceleration*R,P)));else T.ignore_horizontal||!(T.is_jumping||t.spring||B)&&Ie(T.input,2)||(T.mirror=w,N=T.speed.x>0?-1:N,T.speed.x>=1.1*-P&&(T.speed.x=Math.max(T.speed.x-(1-N)*T.acceleration*R,-P)))}switch(t.spring&&(z=dn(L,T.speed.y<=0?13:1),T.speed.y>0&&(t.spring=!1,T.is_jumping=!1)),t.getting_hit&&(c?t.getting_hit=!1:z=dn(L,11)),t.type){case 0:break;case 1:if(t.flight_timer+=R,c&&90!=c.brick_ref.angle&&270!=c.brick_ref.angle&&(t.flying=!1,t.flight_timer=0),(T.is_jumping&&T.speed.y>-T.jump_strength/3&&!Y&&!t.getting_hit||t.flying)&&Oe(T.input,5)&&!t.getting_hit&&t.flight_timer<10&&(t.flying||(t.flight_timer=0),T.speed.y=.1*-Sd(),t.flying=!0,T.is_jumping=!1,t.is_fire_jumping=!1),t.flying)if(z=dn(L,T.carrying?16:20),T.speed.x=it(T.speed.x,-T.maxspeed/2,T.maxspeed/2),t.flight_timer>=10){var zt=qe("tired of flying");$(zt)||W(zt),z=dn(L,19)}else{var Ft,Vt;for(Li(t)&&(T.angle=0),Ft=qe("flying"),$(Ft)||W(Ft),Vt=0;Vt<e.length&&null==T.carrying;Vt++)if(e[Vt]!=t&&parseInt(T.speed.y,10)<=0){var qt=[e[Vt].actor.position.x+.3*Yn(e[Vt].actor).width,e[Vt].actor.position.y,e[Vt].actor.position.x+.7*Yn(e[Vt].actor).width,e[Vt].actor.position.y+.2*Yn(e[Vt].actor).height],Qt=[T.position.x+.3*Yn(T).width,T.position.y+.7*Yn(T).height,T.position.x+.7*Yn(T).width,T.position.y+Yn(T).height],Kt=ot(qt,Qt),Zt=!(null!=e[Vt].actor.carried_by||e[Vt].dying||e[Vt].dead||e[Vt].climbing||e[Vt].landing||e[Vt].getting_hit);Kt&&Zt&&!c&&(T.carrying=e[Vt].actor,e[Vt].actor.carried_by=T,e[Vt].spin=e[Vt].spin_dash=e[Vt].braking=e[Vt].flying=e[Vt].spring=e[Vt].on_moveable_platform=!1,W(qe("touch the wall")))}}else T.animation==dn(L,T.carrying?16:20)&&(z=dn(L,1));break;case 2:if((T.is_jumping&&T.speed.y>-.7*T.jump_strength||t.flying)&&Oe(T.input,5)&&!c&&!t.getting_hit&&(T.speed.y=50,t.flying=!0,T.is_jumping=!1,t.is_fire_jumping=!1,T.speed.x=T.mirror&w?Math.min(-100,T.speed.x):Math.max(100,T.speed.x)),t.flying){var Jt=Ie(T.input,4)&&T.speed.x>0||Ie(T.input,3)&&T.speed.x<0,te=c&&Math.abs(c.brick_ref.angle*v/180-0)<m;if(Jt+=T.animation==dn(L,21)&&!Fn(T),te||T.animation==dn(L,19)||t.landing||(T.mirror&w?(z=dn(L,Jt?21:20),T.speed.x=Math.max(T.speed.x-.5*T.acceleration*R,-P/2)):(z=dn(L,Jt?21:20),T.speed.x=Math.min(T.speed.x+.5*T.acceleration*R,P/2))),te)t.landing=!0,T.is_jumping=!1,z=dn(L,19),T.speed.y=0,G.y=0,t.climbing=!1;else if(De(T.input,5))t.flying=!1,z=dn(L,18);else{var ee,ne=[l,u,p,d,c];for(ee=0;ee<ne.length;ee++)(h=ne[ee])&&h.brick_ref.angle%90!=0&&(t.flying=!1,t.landing=!1)}te||s||(l&&l.brick_ref.angle%90==0||p&&p.brick_ref.angle%90==0)&&(t.climbing=!0,t.flying=!1,W(qe("touch the ground")))}if(t.landing&&(Math.abs(T.speed.x)<m||!c)&&(t.flying=t.landing=!1),t.climbing){var ae=pt(0,0);if(T.speed.x=G.x=0,l&&!p&&(T.mirror|=w),p&&!l&&(T.mirror&=-2),ae=lt(ae,dt(Od(l,T),R)),((ae=lt(ae,dt(Od(p,T),R))).y<=0&&!s||ae.y>=0&&!c||!l&&p)&&(G=lt(G,ae)),l||p)if(Oe(T.input,5)){var ie=dn(L,17),oe=dn(L,22);T.animation!=ie&&T.animation!=oe||(t.climbing=!1,T.is_jumping=!0,t.is_fire_jumping=!0,T.speed.x=.7*(T.mirror&w?1:-1)*T.jump_strength,T.speed.y=-.5*T.jump_strength,l&&!p&&(T.mirror&=-2),!l&&p&&(T.mirror|=w),z=dn(L,3),W(qe("jump")))}else Ie(T.input,1)?s||(G.y=.1*-P*R,z=dn(L,17)):Ie(T.input,2)?c?t.climbing=!1:(G.y=.1*P*R,z=dn(L,17)):z=dn(L,22);else(h=T.mirror&w?u:d)?(z=dn(L,23),T.ignore_horizontal=!0,G=lt(G,dt(Od(h,T),R)),Fn(T)&&(t.climbing=!1,T.ignore_horizontal=!1,T.speed=pt((T.mirror&w?-1:1)*P*.15,-Sd()/12.5),G.x=5*(T.mirror&w?-1:1))):(t.climbing=!1,T.is_jumping=!0,z=dn(L,3))}}return t.at_some_border=!1,z&&(T=zn(T,z)),Math.abs(T.speed.x)<4&&(t.braking=!1,(!Ie(T.input,3)&&!Ie(T.input,4)||Ie(T.input,3)&&Ie(T.input,4)||t.spin||t.landing)&&(G.x=0,T.speed.x=0)),G.x+=Od(c,T).x*R,G.x=T.position.x<=T.hot_spot.x&&T.speed.x<0?0:G.x,G.x=T.position.x>=hd().x-(Yn(T).width-T.hot_spot.x)&&T.speed.x>0?0:G.x,G},bi=function(t){var e,n,a=t.actor,i=!1;if(!t.blinking&&!t.dying&&!t.invincible)if(Di(t),0!=t.shield_type)i=!0,t.shield_type=0,W(qe("death"));else if(ge>0){for(i=!0,n=0;n<Math.min(wi(),15);n++)(e=Ed(hs,a.position)).is_moving=!0,e.actor.speed.x=e.actor.maxspeed*(at(100)-50)/100,e.actor.speed.y=-e.actor.jump_strength+at(e.actor.jump_strength);ji(0),W(qe("ringless"))}else yi(t);i&&(t.getting_hit=!0,t.flying=t.landing=t.climbing=t.spring=!1,t.is_fire_jumping=!1,t.spin_dash=t.spin=!1,t.blinking=!0,t.blink_timer=0,a.speed.x=a.mirror&w?200:-200,a.speed.y=-.75*a.jump_strength,Wn(a,pt(0,-5)))},yi=function(t){t.dying||(Di(t),t.shield_type=0,t.invincible=!1,t.got_speedshoes=!1,t.dying=!0,t.death_timer=0,t.spring=!1,t.actor.speed.y=1.2*-t.actor.jump_strength,t.flying=t.climbing=t.landing=!1,t.is_fire_jumping=!1,t.spin=t.spin_dash=!1,t.blinking=!1,W(qe("death")))},xi=function(t){Te(t.actor.input,5),t.spring=!1,t.actor.speed.y=-t.actor.jump_strength,t.actor.is_jumping=!0,t.is_fire_jumping=!1,t.flying=!1},vi=function(t){var e=dn(Ii(t.type),3);return t.spin||t.spin_dash||t.actor.animation==e||2==t.type&&(t.landing||t.flying)},wi=function(){return ge},ki=function(){return di},Si=function(){return ui},ji=function(t){ge=it(t,0,9999),t/100>=me&&(me+=1,Ei(ki()+1),gd(qe("1up")))},Ei=function(t){di=t},Mi=function(t){ui=t},Ii=function(t){switch(t){case 0:return"SD_SONIC";case 1:return"SD_TAILS";case 2:return"SD_KNUCKLES";default:return"null"}},Oi=function(t){if(t&&t.actor){var e=0,n=t.actor.mirror&w,a=!0,i=st(t.actor.angle),o=pt(0,0),r=_t(t.actor.position,ut(pt(0,t.actor.hot_spot.y),-i)),s=t.actor.animation;switch(t.type){case 0:if(s==dn(Ii(0),0))o=pt(3,24),e=1;else if(s==dn(Ii(0),1))switch(parseInt(t.actor.animation_frame,10)){case 0:e=2,o=pt(5,23);break;case 1:e=2,o=pt(4,25);break;case 2:e=1,o=pt(7,25);break;case 3:case 4:e=1,o=pt(5,23);break;case 5:e=1,o=pt(4,24);break;case 6:e=2,o=pt(6,24);break;case 7:e=2,o=pt(6,23)}else if(s==dn(Ii(0),2))e=1,o=pt(8,26);else if(s==dn(Ii(0),5))e=3,o=0==parseInt(t.actor.animation_frame,10)?pt(0,19):pt(-1,21);else if(s==dn(Ii(0),7))e=1,o=parseInt(t.actor.animation_frame,10)<2?pt(8,26):pt(10,28);else if(s==dn(Ii(0),10))switch(e=1,parseInt(t.actor.animation_frame,10)){case 0:o=pt(1,22);break;case 1:o=pt(-1,23);break;case 2:o=pt(1,23)}else s==dn(Ii(0),11)?(e=3,o=pt(-4,30)):s==dn(Ii(0),12)?(e=3,o=pt(1,19)):s==dn(Ii(0),13)?(e=3,o=pt(4,13)):s==dn(Ii(0),14)?(e=1,o=pt(12,31)):s==dn(Ii(0),15)?(e=0,o=pt(3,23)):s==dn(Ii(0),25)?(e=0,o=pt(3,22)):a=!1;break;case 1:if(s==dn(Ii(1),0))o=pt(5,34),e=1;else if(s==dn(Ii(1),1))switch(e=2,parseInt(t.actor.animation_frame,10)){case 0:o=pt(2,33);break;case 1:case 5:o=pt(3,33);break;case 2:o=pt(8,33);break;case 3:case 7:o=pt(3,32);break;case 4:o=pt(1,33);break;case 6:o=pt(7,33)}else if(s==dn(Ii(1),2))e=2,o=0==parseInt(t.actor.animation_frame,10)?pt(7,35):pt(6,34);else if(s==dn(Ii(1),4))e=1,o=pt(9,44);else if(s==dn(Ii(1),5))e=1,o=pt(7,32);else if(s==dn(Ii(1),7))e=1,o=0==parseInt(t.actor.animation_frame,10)?pt(2,33):pt(4,33);else if(s==dn(Ii(1),10))switch(e=4,parseInt(t.actor.animation_frame,10)){case 0:o=pt(5,33);break;case 1:o=pt(6,33)}else if(s==dn(Ii(1),11))e=1,o=pt(1,33);else if(s==dn(Ii(1),12))e=1,o=pt(6,28);else if(s==dn(Ii(1),13))e=3,o=pt(2,17);else if(s==dn(Ii(1),14))e=1,o=pt(9,35);else if(s==dn(Ii(1),15))switch(e=4,parseInt(t.actor.animation_frame,10)){case 0:case 8:case 9:case 10:o=pt(5,34);break;default:o=pt(5,33)}else s==dn(Ii(1),16)?(e=1,o=pt(8,37)):s==dn(Ii(1),19)?(e=1,o=0==parseInt(t.actor.animation_frame,10)?pt(9,39):pt(9,40)):s==dn(Ii(1),20)?(e=1,o=pt(8,39)):s==dn(Ii(1),25)?(e=1,o=pt(0,23)):a=!1;break;case 2:if(s==dn(Ii(2),0))e=1,o=pt(1,24);else if(s==dn(Ii(2),1))switch(parseInt(t.actor.animation_frame,10)){case 0:e=1,o=pt(5,29);break;case 1:e=2,o=pt(5,29);break;case 2:e=2,o=pt(8,29);break;case 3:e=2,o=pt(9,28);break;case 4:e=1,o=pt(6,28);break;case 5:e=1,o=pt(6,29);break;case 6:e=1,o=pt(5,28);break;case 7:e=1,o=pt(4,27)}else if(s==dn(Ii(2),2))e=1,o=pt(7,29);else if(s==dn(Ii(2),4))e=1,o=0==parseInt(t.actor.animation_frame,10)?pt(0,31):pt(0,40);else if(s==dn(Ii(2),5))e=1,o=0==parseInt(t.actor.animation_frame,10)?pt(0,21):pt(-1,21);else if(s==dn(Ii(2),7))e=0,o=pt(-2,27);else if(s==dn(Ii(2),10))switch(e=1,parseInt(t.actor.animation_frame,10)){case 0:o=pt(9,30);break;case 1:o=pt(8,27)}else if(s==dn(Ii(2),11))e=1,o=pt(-3,27);else if(s==dn(Ii(2),12))e=1,o=pt(5,24);else if(s==dn(Ii(2),13))e=3,o=pt(-1,16);else if(s==dn(Ii(2),14))switch(parseInt(t.actor.animation_frame,10)){case 0:e=1,o=pt(5,29);break;case 1:e=2,o=pt(5,29);break;case 2:e=2,o=pt(8,29);break;case 3:e=2,o=pt(9,28);break;case 4:e=1,o=pt(6,28);break;case 5:e=1,o=pt(6,29);break;case 6:e=1,o=pt(5,28);break;case 7:e=1,o=pt(4,27)}else if(s==dn(Ii(2),15))e=0,o=pt(1,23);else if(s==dn(Ii(2),16))switch(e=1,parseInt(t.actor.animation_frame,10)){case 0:o=pt(6,23);break;case 1:o=pt(5,20);break;case 2:o=pt(0,22)}else if(s==dn(Ii(2),17))switch(e=3,parseInt(t.actor.animation_frame,10)){case 0:o=pt(-1,22);break;case 1:o=pt(-2,20);break;case 2:o=pt(0,21);break;case 3:o=pt(-1,24);break;case 4:o=pt(0,23);break;case 5:o=pt(0,22)}else if(s==dn(Ii(2),18))e=1,o=0==parseInt(t.actor.animation_frame,10)?pt(6,23):pt(5,20);else if(s==dn(Ii(2),19))e=1,o=pt(8,44);else if(s==dn(Ii(2),20))e=1,o=pt(8,39);else if(s==dn(Ii(2),21))switch(e=4,parseInt(t.actor.animation_frame,10)){case 0:o=pt(-8,41);break;case 1:o=pt(0,43);break;case 2:o=pt(10,41)}else if(s==dn(Ii(2),22))e=3,o=pt(0,22);else if(s==dn(Ii(2),23))switch(parseInt(t.actor.animation_frame,10)){case 0:e=3,o=pt(7,17);break;case 1:e=3,o=pt(11,15);break;case 2:e=0,o=pt(12,13)}else s==dn(Ii(2),25)?(e=0,o=pt(0,23)):a=!1}return o.x*=n?-1:1,t.glasses=zn(t.glasses,dn("SD_GLASSES",e)),t.glasses.position=lt(r,ut(o,-i)),t.glasses.angle=i,t.glasses.mirror=t.actor.mirror,t.glasses.visible=a&&t.actor.visible,t}},Di=function(t){},Ti=function(t){var e=t.shield,n=t.actor,a=pt(0,0);switch(t.shield_type){case 1:a=pt(0,-22),e.position=lt(n.position,ut(a,-st(n.angle))),e=zn(e,dn("SD_SHIELD",0));break;case 2:a=pt(0,-22),e.position=lt(n.position,ut(a,-st(n.angle))),e=zn(e,dn("SD_FIRESHIELD",0));break;case 3:a=pt(0,-22),e.position=lt(n.position,ut(a,-st(n.angle))),e=zn(e,dn("SD_THUNDERSHIELD",0));break;case 4:a=pt(0,-22),e.position=lt(n.position,ut(a,-st(n.angle))),e=zn(e,dn("SD_WATERSHIELD",0));break;case 5:a=pt(0,-22),e.position=lt(n.position,ut(a,-st(n.angle))),e=zn(e,dn("SD_ACIDSHIELD",0));break;case 6:a=pt(0,-22),e.position=lt(n.position,ut(a,-st(n.angle))),e=zn(e,dn("SD_WINDSHIELD",0))}},Li=function(t){return 0!==t.disable_wall},Ri=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Un(),e.is_disappearing=!1,zn(t.actor,dn("SD_BLUERING",0))},Ai=function(t){Bn(t.actor)},Ni=function(t,e,n,a,i,o){var r;for(r=0;r<n;r++){var s=e[r];s&&!s.dying&&Vn(s.actor,t.actor)&&(t.state=fs,ji(wi()+50),yd(5e3),W(qe("big ring")),xd("$BONUSMSG_TITLE","$BONUSMSG_TEXT"),ku(wu,Su(wu)+1))}},Ci=function(t,e){Hn(t.actor,e)},Pi=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Un(),e.is_disappearing=!1,zn(t.actor,dn("SD_BLUERING",0))},Gi=function(t,e,n,a,i,o){var r=dd(),s=t,c=t.actor;c.visible=r.got_glasses||_d(),s.is_disappearing?Fn(c)&&(t.state=fs):!r.dying&&r.got_glasses&&Vn(c,r.actor)&&(zn(c,dn("SD_BLUERING",1)),ji(wi()+5),W(qe("blue ring")),s.is_disappearing=!0)},Ui=function(t,e){Hn(t.actor,e)},Bi=function(t){Bn(t.actor)},Hi=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Un(),e.getting_hit=!1,zn(t.actor,dn("SD_BUMPER",0))},Xi=function(t,e,n,a,i,o){var r,s=t,c=t.actor;for(r=0;r<n;r++){var p=e[r];p&&!p.dying&&qn(p.actor,c)&&(s.getting_hit||(s.getting_hit=!0,zn(c,dn("SD_BUMPER",1)),W(qe("bumper")),$i(t,p)))}s.getting_hit&&actor_animation_finished(c)&&(s.getting_hit=!1,zn(c,dn("SD_BUMPER",0)))},Wi=function(t,e){Hn(t.actor,e)},Yi=function(t){Bn(t.actor)},$i=function(t,e){var n,a,i,o=t.actor;(n=e.actor_speed).x=n.x<0?Math.min(-300,n.x):Math.max(300,n.x),a=dt(ht(_t(o.position,e.actor_position)),v2d_magnitude(n)),i=dt(a,1),e.actor_speed=dt(lt(n,dt(i,-1e4)),1/10001),o.speed=dt(lt(n,i),1/10001),e.flying=!1,e.landing=!1,e.climbing=!1,e.spring=!1},zi=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Un(),e.is_active=!1,zn(t.actor,dn("SD_CHECKPOINT",0))},Fi=function(t,e,n,a,i,o){var r,s=t,c=t.actor;if(s.is_active)Fn(c)&&zn(c,dn("SD_CHECKPOINT",2));else for(r=0;r<n;r++){var p=e[r];if(p&&!p.dying&&qn(p.actor,c)){s.is_active=!0,W(qe("checkpoint")),md(c.position),zn(c,dn("SD_CHECKPOINT",1));break}}},Vi=function(t,e){Hn(t.actor,e)},qi=function(t){Bn(t.actor)},Qi=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Un(),zn(t.actor,dn("SD_ITEMBOX",10))},Ki=function(t,e,n,a,i,o){},Zi=function(t,e){Hn(t.actor,e)},Ji=function(t){Bn(t.actor)},to=function(t,e){var n={},a=n;return n.init=eo,n.release=io,n.update=no,n.render=ao,a.sprite_name=t,a.player_is_vulnerable=e,n},eo=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Un(),zn(t.actor,dn(e.sprite_name,0))},no=function(t,e,n,a,i,o){var r,s=t,c=t.actor;for(r=0;r<n;r++){var p=e[r];p&&(p.dying||p.blinking||p.invincible||!Vn(c,p.actor)||s.player_is_vulnerable(p)&&p.hit(p))}c.visible=_d()},ao=function(t,e){Hn(t.actor,e)},io=function(t){Bn(t.actor)},oo=function(t){return!0},ro=function(t){return 2!=t.shield_type},so=function(t,e){t.actor_speed=e},co=function(t){t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Un(),zn(t.actor,dn("SD_DANGPOWER",0))},po=function(t,e,n,a,i,o){var r,s=Z(),c=t.actor,p=dt(c.speed,s);for(r=0;r<n;r++){var l=e[r];l&&!l.dying&&Vn(c,l.actor)&&(l.hit(l),t.state=fs)}c.position=lt(c.position,p)},lo=function(t,e){Hn(t.actor,e)},_o=function(t){Bn(t.actor)},uo=function(t,e){var n={},a=n;return n.init=fo,n.release=mo,n.update=ho,n.render=go,a.authorized_player_type=t,a.is_vertical_door=e,n},fo=function(t){var e,n,a=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Un(),n=parseInt(a.authorized_player_type,10),e=a.is_vertical_door?"SD_DNADOOR":"SD_HORIZONTALDNADOOR",zn(t.actor,dn(e,n))},ho=function(t,e,n,a,i,o){var r,s,c={},p=t.actor,l=!1,_=!1,d=Z(),u=[],f=[];for(t.obstacle=!0,s=0;s<n;s++){var h=e[s];h&&(h.dying||h.actor_carrying||h.actor_carried_by||!bo(h,t)||(h.type==c.authorized_player_type?(t.obstacle=!1,_=qn(p,h.actor)):l=!0))}if(l&&(t.obstacle=!0),t.obstacle?p.alpha=Math.min(1,p.alpha+2*d):_&&(p.alpha=Math.max(.4,p.alpha-2*d)),_)for(u[0]=p.position.x-p.hot_spot.x-5,u[1]=p.position.y-p.hot_spot.y-5,u[2]=u[0]+Yn(p).width+10,u[3]=u[1]+Yn(p).height+10,r=i;null!=r;r=r.next)r.data.type==t.type&&(f[0]=r.data.actor_position.x-r.data.actor_hot_spot.x-5,f[1]=r.data.actor_position.y-r.data.actor_hot_spot.y-5,f[2]=f[0]+Yn(r.data.actor).width+10,f[3]=f[1]+Yn(r.data.actor).height+10,ot(u,f)&&(r.data.actor_alpha<p.alpha?p.alpha=r.data.actor_alpha:r.data.actor_alpha=p.alpha))},go=function(t,e){Hn(t.actor,e)},mo=function(t){Bn(t.actor)},bo=function(t,e){var n=[],a=[],i=t.actor,o=e.actor;return n[0]=i.position.x-i.hot_spot.x,n[1]=i.position.y-i.hot_spot.y,n[2]=n[0]+Yn(i).width,n[3]=n[1]+Yn(i).height,a[0]=o.position.x-o.hot_spot.x,a[1]=o.position.y-o.hot_spot.y-3,a[2]=a[0]+Yn(o).width,a[3]=a[1]+Yn(o).height+3,ot(n,a)},yo=function(t){var e=t;t.obstacle=!0,t.bring_to_back=!0,t.preserve=!0,t.actor=Un(),e.is_closed=!0,zn(t.actor,dn("SD_DOOR",0))},xo=function(t,e,n,a,i,o){var r=t,s=t.actor,c=Z();r.is_closed?s.position.y=parseInt(Math.min(s.position.y+2e3*c,s.spawn_point.y),10):s.position.y=parseInt(Math.max(s.position.y-2e3*c,s.spawn_point.y-.8*Yn(s).height),10)},vo=function(t,e){Hn(t.actor,e)},wo=function(t){Bn(t.actor)},ko=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Un(),e.who=null,zn(t.actor,dn("SD_ENDSIGN",0))},So=function(t,e,n,a,i,o){var r,s=t,c=t.actor;if(null==s.who)for(r=0;r<n;r++){var p=e[r];p&&!p.dying&&qn(p.actor,c)&&(s.who=p,W(qe("end sign")),zn(c,dn("SD_ENDSIGN",1)),bd(t.actor))}else if(Fn(c)){var l=2+s.who.type;zn(c,dn("SD_ENDSIGN",l))}},jo=function(t,e){Hn(t.actor,e)},Eo=function(t){Bn(t.actor)},Mo=function(t){t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Un(),zn(t.actor,dn("SD_EXPLOSION",at(2)))},Io=function(t,e,n,a,i,o){Fn(t.actor)&&(t.state=fs)},Oo=function(t,e){Hn(t.actor,e)},Do=function(t){Bn(t.actor)},To=function(t){t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=actor.create(),zn(t.actor,dn("SD_GLASSES",4)),t.actor.hot_spot.y*=.5},Lo=function(t,e,n,a,i,o){var r=t.actor,s=Z();r.angle+=Math.sign(r.speed.x)*(6*v*s),r.position=lt(r.position,function(t,e){var n=Z(),a=pt(0,0);return a.x=t.speed.x*n,a.y=t.speed.y*n+.5*e*n*n,t.speed.y+=e*n,a}(r,Sd()))},Ro=function(t,e){Hn(t.actor,e)},Ao=function(t){Bn(t.actor)},No=function(t,e){sa(t.font,e)},Co=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Un(),e.elapsed_time=0,e.font=ra(0),sa(e.font,"0"),zn(t.actor,dn("SD_RING",0)),t.actor.visible=!1},Po=function(t,e,n,a,i,o){var r=t,s=Z();r.elapsed_time+=s,r.elapsed_time<.5?t.actor.position.y-=100*s:r.elapsed_time>2&&(t.state=fs),r.font.position=t.actor.position},Go=function(t,e){_a(t.font,e)},Uo=function(t){var e=t;Bn(t.actor),e.font},Bo=function(t,e,n,a){var i,o,r=y,s=null;for(i=e;i;i=i.next)i.data&&i.data.type==n&&(o=_t(i.data.actor.position,t.actor.position),ft(o)<r&&(s=i.data,r=ft(o)));return a&&(a.dist=r),s},Ho=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Un(),zn(t.actor,dn("SD_GOAL",0))},Xo=function(t,e,n,a,i,o){var r,s=Bo(t,i,vs,null);r=null!=s?s.actor.position.x>t.actor.position.x?0:1:0,zn(t.actor,dn("SD_GOAL",r))},Wo=function(t,e){Hn(t.actor,e)},Yo=function(t){Bn(t.actor)},$o=function(t,e){zn(t.actor,dn("SD_ICON",e))},zo=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Un(),e.elapsed_time=0,$o(t,0)},Fo=function(t,e,n,a,i,o){var r=t,s=t.actor,c=Z();if(r.elapsed_time+=c,r.elapsed_time<1)s.position.y-=40*c;else if(r.elapsed_time>=2.5){var p,l,_,d=parseInt(s.position.x-s.hot_spot.x,10),u=parseInt(s.position.y-s.hot_spot.y,10),f=Yn(s);for(p=0;p<f.h;p++)for(l=0;l<f.w;l++)_=tn(1,1),rn(_,255,255,255),Id(_,pt(d+l,u+p),pt(l-f.width/2+(at(f.width)-f.width/2),p-at(f.height/2)),!1);t.state=fs}},Vo=function(t,e){Hn(t.actor,e)},qo=function(t){Bn(t.actor)},Qo=function(t,e){fd(100),Ei(ki()+1),gd(qe("1up"))},Ko=function(t,e){fd(100),ji(wi()+10),W(qe("ring"))},Zo=function(t,e){fd(100),e.invincible=!0,e.invtimer=0,P(C("data/music/invincible.mp4"),0)},Jo=function(t,e){fd(100),e.got_speedshoes=!0,e.speedshoes_timer=0,P(C("data/music/speed.mp4"),0)},tr=function(t,e){fd(100),e.got_glasses=!0},er=function(t,e){fd(100),e.shield_type=1,W(qe("shield"))},nr=function(t,e){fd(100),e.shield_type=2,W(qe("fire shield"))},ar=function(t,e){fd(100),e.shield_type=3,W(qe("thunder shield"))},ir=function(t,e){fd(100),e.shield_type=4,W(qe("water shield"))},or=function(t,e){fd(100),e.shield_type=5,W(qe("acid shield"))},rr=function(t,e){fd(100),e.shield_type=6,audio.sound_play(qe("wind shield"))},sr=function(t,e){player_hit(e)},cr=function(t,e){fd(100)},pr=function(t,e){var n={},a=n;return n.init=lr,n.release=ur,n.update=_r,n.render=dr,a.on_destroy=t,a.anim_id=e,n},lr=function(t){var e=t;t.obstacle=!0,t.bring_to_back=!1,t.preserve=!0,t.actor=Un(),zn(t.actor,dn("SD_ITEMBOX",e.anim_id))},_r=function(t,e,n,a,i,o){var r,s=t.actor,c=t;for(r=0;r<n;r++){var p=e[r];if(p&&!(p.actor.is_jumping&&p.actor.speed.y<-10)&&t.state===us&&fr(t,p)&&vi(p)){console.log("ITEM BOX HIT");var l=Ed(ms,lt(s.position,pt(0,-5)));l.change_animation(l,c.anim_id),Ed(bs,lt(s.position,pt(0,-20))),Ed(gs,s.position),W(qe("destroy")),p.actor.is_jumping&&p.bounce(p),c.on_destroy(t,p),t.state=fs}}c.anim_id=c.anim_id<e.length?ud():c.anim_id,zn(t.actor,dn("SD_ITEMBOX",c.anim_id))},dr=function(t,e){Hn(t.actor,e)},ur=function(t){Bn(t.actor)},fr=function(t,e){var n,a=t.actor.position;return n=Vn(t.actor,e.actor),t.actor.position=a,n},hr=function(t,e){var n={},a=n;return n.init=gr,n.release=mr,n.update=br,n.render=yr,a.on_collision=t,a.sprite_name=e,n},gr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Un(),t.actor=zn(t.actor,dn(e.sprite_name,0))},mr=function(t){},br=function(t,e,n,a,i,o){var r,s=t,c=t.actor;for(c.visible=!1,r=0;r<n;r++){var p=e[r];p&&Vn(c,p.actor)&&(p.at_loopfloortop=xr(t,i,p),s.on_collision(p))}},yr=function(t,e){Hn(t.actor,e)},xr=function(t,e,n){var a=Bo(t,e,ws,null);return null!=a&&Vn(n.actor,a.actor)},vr=function(t){t.disable_wall|=8,t.entering_loop=!0,t.bring_to_back=!1},wr=function(t){if(!t.flying){var e=t.actor.speed.x>0;t.disable_wall&=-11,t.disable_wall|=e?2:8,t.bring_to_back=e}},kr=function(t){t.disable_wall|=2,t.entering_loop=!0,t.bring_to_back=!0},Sr=function(t){t.entering_loop||(t.disable_wall=0,t.bring_to_back=!1)},jr=function(t){t.at_loopfloortop||t.flying||(t.disable_wall|=4,t.entering_loop=!0,t.bring_to_back=!0)},Er=function(t){t.at_loopfloortop||t.entering_loop||t.flying||(t.disable_wall&=-5,t.bring_to_back=!1)},Mr=function(t){if(!t.flying)if(4&t.disable_wall){var e=t.actor.speed.x>0;t.disable_wall&=-11,t.disable_wall|=e?2:8,t.bring_to_back=!0}else t.disable_wall&=-11,t.bring_to_back=!0},Ir=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Un(),t.actor.maxspeed=220+at(140),t.actor.jump_strength=1.2*(350+at(50)),t.actor.input=Se(),e.is_disappearing=!1,e.is_moving=!1,e.life_time=0,zn(t.actor,dn("SD_RING",0))},Or=function(t){},Dr=function(t,e,n,a,i,o){var r,s=Z(),c=t,p=t.actor;for(r=0;r<n;r++){var l=e[r];if(l&&(!c.is_moving||c.is_moving&&!l.getting_hit&&c.life_time>=.5)&&!c.is_disappearing&&!l.dying&&Vn(p,l.actor)){ji(wi()+1),c.is_disappearing=!0,W(qe("ring"));break}}if(c.is_disappearing)zn(p,dn("SD_RING",1)),Fn(p)&&(t.state=fs);else if(c.is_moving){if(Te(p.input,5),t.preserve=!1,c.life_time+=s,c.life_time>5){var _=240+at(20);p.visible=parseInt((J(),10))<_/2,c.life_time>8&&(t.state=fs)}Wn(p,ta(p,a,Sd()))}},Tr=function(t,e){Hn(t.actor,e)},Lr=function(t,e,n){var a={},i=a;return a.init=Rr,a.release=Ar,a.update=Nr,a.render=Cr,i.collision=t,i.anim_id=e,i.cycle_length=n,a},Rr=function(t){var e=t;t.obstacle=!0,t.bring_to_back=!0,t.preserve=!0,t.actor=Un(),e.timer=0,e.hidden=!1,zn(t.actor,dn("SD_SPIKES",e.anim_id))},Ar=function(t){Bn(t.actor)},Nr=function(t,e,n,a,i,o){var r,s=t,c=Z();if(s.timer+=c,s.timer>=.5*s.cycle_length&&(s.timer=0,s.hidden=!s.hidden,W(qe(s.hidden?"spikes disappearing":"spikes appearing"))),t.obstacle=!s.hidden,t.actor.visible=!s.hidden,!s.hidden)for(r=0;r<n;r++){var p=e[r];if(p&&!p.dying&&!p.blinking&&!p.invincible&&s.collision(t,p)){var l=qe("spikes hit");$(l)||W(l),bi(p)}}},Cr=function(t,e){Hn(t.actor,e)},Pr=function(t,e){var n=[],a=t.actor;return n[0]=a.position.x-a.hot_spot.x,n[1]=a.position.y-a.hot_spot.y,n[2]=n[0]+Yn(a).width,n[3]=n[1]+Yn(a).height,ot(n,e)},Gr=function(t,e){var n,a=[],i=t.actor;return a[0]=i.position.x-i.hot_spot.x+5,a[1]=i.position.y-i.hot_spot.y-5,a[2]=a[0]+Yn(i).width-10,a[3]=a[1]+10,n=e.actor.position.y-e.actor.hot_spot.y+Yn(e.actor).height,Pr(e,a)&&n<i.position.y-i.hot_spot.y+Yn(i).height/2},Ur=function(t,e){var n=[],a=t.actor;return n[0]=a.position.x-a.hot_spot.x+5,n[1]=a.position.y-a.hot_spot.y+Yn(a).height-5,n[2]=n[0]+Yn(a).width-10,n[3]=n[1]+10,Pr(e,n)},Br=function(t,e){var n=[],a=t.actor;return n[0]=a.position.x-a.hot_spot.x+Yn(a).width-5,n[1]=a.position.y-a.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+Yn(a).height-10,Pr(e,n)},Hr=function(t,e){var n=[],a=t.actor;return n[0]=a.position.x-a.hot_spot.x-5,n[1]=a.position.y-a.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+Yn(a).height-10,Pr(e,n)},Xr=function(t,e,n){var a={};return a.init=Wr,a.release=Yr,a.update=$r,a.render=zr,a.on_bump=t,a.sprite_name=e,a.strength=n,a},Wr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Un(),e.is_bumping=!1,e.bang_timer=0,zn(t.actor,dn(e.sprite_name,0))},Yr=function(t){},$r=function(t,e,n,a,i,o){var r,s=t,c=Z();for(s.bang_timer+=c,r=0;r<n;r++){var p=e[r];p&&!p.dying&&qn(p.actor,t.actor)&&s.on_bump(t,p)}s.is_bumping&&Fn(t.actor)&&(zn(t.actor,dn(s.sprite_name,0)),s.is_bumping=!1)},zr=function(t,e){Hn(t.actor,e)},Fr=function(t,e){e.actor.speed.y>=1&&!e.actor.carrying&&!e.actor.carried_by&&qr(t,e)},Vr=function(t,e){qr(t,e)},qr=function(t,e){var n=t;t.is_bumping=!0,function(t,e){var n=Z(),a=[],i=[];a[0]=e.x*t.actor.speed.x>=0,a[1]=e.y*t.actor.speed.y>=0,i[0]=e.x*t.actor.speed.x<=0&&Math.abs(e.x)>m,i[1]=e.y*t.actor.speed.y<=0&&Math.abs(e.y)>m,Math.abs(e.y)>m&&(t.spring=!0),t.flying=!1,t.climbing=!1,t.landing=!1,t.getting_hit=!1,t.is_fire_jumping=!1,(Math.abs(e.x)>Math.abs(t.actor.speed.x)&&a[0]||i[0])&&(t.actor.speed.x=e.x),(Math.abs(e.y)>Math.abs(t.actor.speed.y)&&a[1]||i[1])&&(t.actor.speed.y=e.y,t.actor.position.y+=t.actor.speed.y*n)}(e,t.strength),zn(n.actor,dn(t.sprite_name,1)),t.strength.x>m?e.actor.mirror&=-2:t.strength.x<-1e-4&&(e.actor.mirror|=w),t.bang_timer>.2&&(W(qe("spring")),t.bang_timer=0)},Qr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Un(),e.is_disabled=!1,e.is_active=!1,e.timer=0,zn(t.actor,dn("SD_TELEPORTER",0))},Kr=function(t,e,n,a,i,o){var r,s=t,c=t.actor,p=Z(),l=0;if(s.is_active){if(s.timer+=p,s.timer>=3){var _=s.who;for(Re(_.actor.input),pu(_.actor),r=0;r<n;r++){var d=e[r];if(d!=_){var u=lt(c.position,pt(40*l++-20,-30));ts(d,u)}}s.is_active=!1,s.is_disabled=!0}zn(c,dn("SD_TELEPORTER",1))}else zn(c,dn("SD_TELEPORTER",0))},Zr=function(t,e){Hn(t.actor,e)},Jr=function(t){Bn(t.actor)},ts=function(t,e){t&&(t.actor.position=e,t.actor.speed=pt(0,0),t.actor.is_jumping=!1,t.flying=!1,t.climbing=!1,t.getting_hit=!1,t.spring=!1,t.actor.angle=0,t.disable_wall=0,t.entering_loop=!1,t.at_loopfloortop=!1,t.bring_to_back=!1)},es=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Un(),e.is_pressed=!1,e.partner=null,zn(t.actor,dn("SD_SWITCH",0))},ns=function(t){Bn(t.actor)},as=function(t,e,n,a,i,o){var r,s,c=t,p={},l={};c.partner=null,r=Bo(t,i,ys,p),s=Bo(t,i,xs,l),null!=r&&p.dist<l.dist&&(c.partner=r),null!=s&&l.dist<p.dist&&(c.partner=s),null==c.partner?os(t,r,e,n,rs,ss):c.partner==r?os(t,r,e,n,cs,ps):c.partner==s&&os(t,s,e,n,ls,_s)},is=function(t,e){Hn(t.actor,e)},os=function(t,e,n,a,i,o){var r,s=!0,c=t,p=t.actor;for(r=0;r<a;r++){var l=n[r];ds(t,l)&&(s=!1,c.is_pressed||(i(e,l),W(qe("switch")),zn(p,dn("SD_SWITCH",1)),c.is_pressed=!0))}s&&c.is_pressed&&(o(e),zn(p,dn("SD_SWITCH",0)),c.is_pressed=!1)},rs=function(t,e){},ss=function(t){},cs=function(t,e){!function(t){t.is_closed=!1,W(qe("open door"))}(t)},ps=function(t){!function(t){t.is_closed=!0,W(qe("close door"))}(t)},ls=function(t,e){!function(t,e){var n=t,a=t.actor;n.is_active||n.is_disabled||(n.is_active=!0,n.who=e,Le(e.actor.input),pu(a),W(qe("teleporter")))}(t,e)},_s=function(t){},ds=function(t,e){if(!t)return!1;if(!e)return!1;var n=[],a=[];return n[0]=t.actor.position.x-t.actor.hot_spot.x,n[1]=t.actor.position.y-t.actor.hot_spot.y,n[2]=n[0]+Yn(t.actor).width,n[3]=n[1]+Yn(t.actor).height,a[0]=e.actor.position.x-e.actor.hot_spot.x+.3*Yn(e.actor).width,a[1]=e.actor.position.y-e.actor.hot_spot.y+.5*Yn(e.actor).height,a[2]=a[0]+.4*Yn(e.actor).width,a[3]=a[1]+.5*Yn(e.actor).height,!e.dying&&!e.climbing&&!e.flying&&ot(n,a)},us=0,fs=1,hs=0,gs=9,ms=10,bs=12,ys=26,xs=27,vs=31,ws=35,ks=function(t){var e=null;switch(t){case hs:e=function(){var t={};return t.init=Ir,t.release=Or,t.update=Dr,t.render=Tr,t}();break;case 1:e=pr(Qo,0);break;case 2:e=pr(Ko,3);break;case 3:e=pr(Zo,4);break;case 4:e=pr(Jo,5);break;case 5:e=pr(tr,6);break;case 6:e=pr(er,7);break;case 42:e=pr(nr,11);break;case 78:e=pr(ar,12);break;case 79:e=pr(ir,13);break;case 80:e=pr(or,14);break;case 81:e=pr(rr,15);break;case 7:e=pr(sr,8);break;case 8:e=pr(cr,9);break;case gs:e=function(){var t={};return t.init=Qi,t.release=Ji,t.update=Ki,t.render=Zi,t}();break;case ms:e=function(){var t={};return t.init=zo,t.release=qo,t.update=Fo,t.render=Vo,t.change_animation=$o,t}();break;case 11:e=function(){var t={};return t.init=To,t.release=Ao,t.update=Lo,t.render=Ro,t}();break;case bs:e=function(){var t={};return t.init=Mo,t.release=Do,t.update=Io,t.render=Oo,t}();break;case 13:e=function(){var t={};return t.init=Co,t.release=Uo,t.update=Po,t.render=Go,t.set_text=No,t}();break;case 15:e=function(){var t={};return t.init=Ka,t.release=Za,t.update=Ja,t.render=ti,t}();break;case 16:e=hr(vr,"SD_LOOPRIGHT");break;case 17:e=hr(wr,"SD_LOOPMIDDLE");break;case 18:e=hr(kr,"SD_LOOPLEFT");break;case 19:e=hr(Sr,"SD_LOOPNONE");break;case 33:e=hr(jr,"SD_LOOPFLOOR");break;case 34:e=hr(Er,"SD_LOOPFLOORNONE");break;case ws:e=hr(Mr,"SD_LOOPFLOORTOP");break;case 20:e=Xr(Fr,"SD_YELLOWSPRING",pt(0,-500));break;case 54:e=Xr(Vr,"SD_BYELLOWSPRING",pt(0,500));break;case 50:e=Xr(Vr,"SD_TRYELLOWSPRING",pt(400,-600));break;case 48:e=Xr(Vr,"SD_RYELLOWSPRING",pt(600,0));break;case 52:e=Xr(Vr,"SD_BRYELLOWSPRING",pt(400,600));break;case 53:e=Xr(Vr,"SD_BLYELLOWSPRING",pt(-400,600));break;case 49:e=Xr(Vr,"SD_LYELLOWSPRING",pt(-600,0));break;case 51:e=Xr(Vr,"SD_TLYELLOWSPRING",pt(-400,-600));break;case 21:e=Xr(Fr,"SD_REDSPRING",pt(0,-750));break;case 47:e=Xr(Vr,"SD_BREDSPRING",pt(0,750));break;case 43:e=Xr(Vr,"SD_TRREDSPRING",pt(800,-1e3));break;case 22:e=Xr(Vr,"SD_RREDSPRING",pt(1200,0));break;case 45:e=Xr(Vr,"SD_BRREDSPRING",pt(800,1e3));break;case 46:e=Xr(Vr,"SD_BLREDSPRING",pt(-800,1e3));break;case 23:e=Xr(Vr,"SD_LREDSPRING",pt(-1200,0));break;case 44:e=Xr(Vr,"SD_TLREDSPRING",pt(-800,-1e3));break;case 55:e=Xr(Fr,"SD_BLUESPRING",pt(0,-1500));break;case 62:e=Xr(Vr,"SD_BBLUESPRING",pt(0,1500));break;case 58:e=Xr(Vr,"SD_TRBLUESPRING",pt(1800,-1500));break;case 56:e=Xr(Vr,"SD_RBLUESPRING",pt(2e3,0));break;case 60:e=Xr(Vr,"SD_BRBLUESPRING",pt(1800,1500));break;case 61:e=Xr(Vr,"SD_BLBLUESPRING",pt(-1800,1500));break;case 57:e=Xr(Vr,"SD_LBLUESPRING",pt(-2e3,0));break;case 59:e=Xr(Vr,"SD_TLBLUESPRING",pt(-1800,-1500));break;case 24:e=function(){var t={};return t.init=Pi,t.release=Bi,t.update=Gi,t.render=Ui,t}();break;case 25:e=function(){var t={};return t.init=es,t.release=ns,t.update=as,t.render=is,t}();break;case ys:Y_.length>1&&(e=function(){var t={};return t.init=yo,t.release=wo,t.update=xo,t.render=vo,t}());break;case xs:e=function(){var t={};return t.init=Qr,t.release=Jr,t.update=Kr,t.render=Zr,t}();break;case 28:e=function(){var t={};return t.init=Ri,t.release=Ai,t.update=Ni,t.render=Ci,t}();break;case 29:e=function(){var t={};return t.init=zi,t.release=qi,t.update=Fi,t.render=Vi,t}();break;case 30:e=function(){var t={};return t.init=Ho,t.release=Yo,t.update=Xo,t.render=Wo,t}();break;case vs:e=function(){var t={};return t.init=ko,t.release=Eo,t.update=So,t.render=jo,t}();break;case 32:e=function(){var t={},e=t;return t.init=ei,t.release=ni,t.update=ai,t.render=ii,e.state=null,t}();break;case 36:e=function(){var t={};return t.init=Hi,t.release=Yi,t.update=Xi,t.render=Wi,t}();break;case 37:e=to("SD_DANGER",oo);break;case 75:e=to("SD_VERTICALDANGER",oo);break;case 76:e=to("SD_FIREDANGER",ro);break;case 77:e=to("SD_VERTICALFIREDANGER",ro);break;case 38:e=Lr(Gr,0,y);break;case 63:e=Lr(Ur,2,y);break;case 64:e=Lr(Br,1,y);break;case 65:e=Lr(Hr,3,y);break;case 66:e=Lr(Gr,0,5);break;case 67:e=Lr(Ur,2,5);break;case 68:e=Lr(Br,1,5);break;case 69:e=Lr(Hr,3,5);break;case 39:e=uo(0,!0);break;case 70:e=uo(1,!0);break;case 71:e=uo(2,!0);break;case 72:e=uo(0,!1);break;case 73:e=uo(1,!1);break;case 74:e=uo(2,!1);break;case 40:case 41:e=function(){var t={};return t.init=co,t.release=_o,t.update=po,t.render=lo,t.dangerouspower_set_speed=so,t}()}return null!=e&&(e.type=t,e.state=us,e.init(e)),e},Ss=function(t,e,n,a,i,o){t.update(t,e,n,a,i,o)},js=function(t,e){t.render(t,e)},Es=function(t){},Ms=function(t){},Is=function(t,e,n,a,i,o){},Os=function(t,e){var n=t.get_object_instance(t).actor,a=n.position;n.position=pt(parseInt(n.position.x,10),parseInt(n.position.y,10)),Hn(n,e),n.position=a},Ds=function(t){return t.object},Ts=function(t){return t.reference_to_current_state},Ls=function t(e,n){return null!=e?e.name?e:t(e.next,n):null},Rs=function(t){var e=t.decorated_machine;return e.get_object_instance(e)},As=function(t){var e=t.decorated_machine;e.init(e)},Ns=function(t){},Cs=function(t,e,n,a,i,o){var r,s=t.decorated_machine,c=t,p=t.get_object_instance(t),l=Z();r=dt(c.speed,l),p.actor.position=lt(p.actor.position,r),s.update(s,e,n,a,i,o)},Ps=function(t,e){var n=t.decorated_machine;n.render(n,e)},Gs=function(t){var e=t.decorated_machine;e&&e.init(e)},Us=function(t){},Bs=function(t,e,n,a,i,o){var r,s=t.decorated_machine,c=t,p=t.get_object_instance(t);for(r=0;r<n;r++){var l=e[r];l&&qn(p.actor,l.actor)&&(vi(l)||l.invincible?(l.actor.is_jumping&&xi(l),fd(c.score),Ed(bs,lt(p.actor.position,pt(0,-15))),Dd(p.actor.position),W(qe("destroy")),p.state=Zl):l.hit(l))}s&&s.update(s,e,n,a,i,o)},Hs=function(t,e){var n=t.decorated_machine;n.render(n,e)},Xs=function(t){var e=t.decorated_machine;e.init(e)},Ws=function(t){},Ys=function(t,e,n,a,i,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t).actor,p=Z(),l=null,_=null,d=null,u=null,f=null,h=null,g=null,m=null,b=.001*J(),y=c.position;c.position.x+=-s.amplitude_x*s.angularspeed_x*Math.sin(s.initialphase_x+s.angularspeed_x*b)*p,c.position.y+=s.amplitude_y*s.angularspeed_y*Math.cos(s.initialphase_y+s.angularspeed_y*b)*p;var x=Qn(c,0,0,a,l,_,d,u,f,h,g,m);l=x.up,_=x.upright,d=x.right,u=x.downright,f=x.down,h=x.downleft,g=x.left,m=x.upleft;var v=Jn(c,0,l,_,d,u,f,h,g,m);l=v.up,_=v.upright,d=v.right,u=v.downright,f=v.down,h=v.downleft,g=v.left,m=v.upleft,null!=d&&c.position.x>y.x&&(c.position.x=c.hot_spot.x-Yn(c).width+d.x),null!=g&&c.position.x<y.x&&(c.position.x=c.hot_spot.x+g.x+Dn(g).width),null!=f&&c.position.y>y.y&&(c.position.y=c.hot_spot.y-Yn(c).height+f.y),null!=l&&c.position.y<y.y&&(c.position.y=c.hot_spot.y+l.y+Dn(l).height),r.update(r,e,n,a,i,o)},$s=function(t,e){var n=t.decorated_machine;n.render(n,e)},zs=function(t){var e=t.decorated_machine;e.init(e)},Fs=function(t){},Vs=function(t,e,n,a,i,o){var r=t.decorated_machine,s=t.get_object_instance(t).actor;Wn(s,ta(s,a,Sd())),r.update(r,e,n,a,i,o)},qs=function(t,e){var n=t.decorated_machine;n.render(n,e)},Qs=function(t,e){var n={};return n.init=Ks,n.release=Zs,n.update=Js,n.render=tc,n.get_object_instance=Rs,n.decorated_machine=t,n.look_strategy=e,n},Ks=function(t){var e=t.decorated_machine;e.init(e)},Zs=function(t){},Js=function(t,e,n,a,i,o){var r=t.decorated_machine,s=t;e[0]&&s.look_strategy(s,e[0]),r.update(r,e,n,a,i,o)},tc=function(t,e){var n=t.decorated_machine;n.render(n,e)},ec=function(t){var e=t;e.get_object_instance(e).actor.mirror&=-2},nc=function(t){var e=t;e.get_object_instance(e).actor.mirror|=w},ac=function(t){var e=t,n=e.get_object_instance(e),a=Kl(n);a&&(n.actor.position.x<a.actor.position.x?n.actor.mirror&=-2:n.actor.mirror|=w)},ic=function(t){var e=t,n=e.get_object_instance(e);n.actor.position.x>t.old_x?n.actor.mirror&=-2:n.actor.mirror|=w,t.old_x=n.actor.position.x},oc=function(t){var e=t.decorated_machine;e.init(e)},rc=function(t){},sc=function(t,e,n,a,i,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t),p=Kl(c);if(p){var l=_t(p.actor.position,c.actor.position);if(ft(l)>=5){var _=Z(),d=ht(l),u=dt(d,s.speed*_);c.actor.position=lt(c.actor.position,u)}}r.update(r,e,n,a,i,o)},cc=function(t,e){var n=t.decorated_machine;n.render(n,e)},pc=function(t){var e=t.decorated_machine;uc(t),e.init(e)},lc=function(t){},_c=function(t,e,n,a,i,o){uc(t)},dc=function(t,e){var n=t.decorated_machine;n.render(n,e)},uc=function(t){var e=t,n=t.get_object_instance(t);zn(n.actor,e.anim)},fc=function(t){var e=t.decorated_machine;e.init(e)},hc=function(t){},gc=function(t,e,n,a,i,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t).actor,p=Z(),l=null,_=null,d=null,u=null,f=null,h=null,g=null,m=null;c.position.x+=s.direction*s.speed*p;var b=Qn(c,2,-2,a,l,_,d,u,f,h,g,m);l=b.up,_=b.upright,d=b.right,u=b.downright,f=b.down,h=b.downleft,g=b.left,m=b.upleft;var y=Jn(c,-2,l,_,d,u,f,h,g,m);l=y.up,_=y.upright,d=y.right,u=y.downright,f=y.down,h=y.downleft,g=y.left,m=y.upleft,null!=d&&s.direction>0&&(c.position.x=c.hot_spot.x-Yn(c).width+d.x,s.direction=-1),null!=g&&s.direction<0&&(c.position.x=c.hot_spot.x+g.x+Dn(g).width,s.direction=1),null!=f&&(null==u&&null!=h?s.direction=-1:null==h&&null!=u&&(s.direction=1)),r.update(r,e,n,a,i,o)},mc=function(t,e){var n=t.decorated_machine;n.render(n,e)},bc={},yc=[{command:"set_animation",action:function(t,e,n){var a,i,o,r;return 2==e?(a=t,i=n[0],o=n[1],(r={}).init=pc,r.release=lc,r.update=_c,r.render=dc,r.get_object_instance=Rs,r.decorated_machine=a,r.anim=dn(i,o),t=r):A("Object script error - set_animation expects two parameters: sprite_name, animation_id"),t}},{command:"set_obstacle",action:function(t,e,n){1==e?t=objectdecorator_setobstacle_new(t,n[0],0):2==e?t=objectdecorator_setobstacle_new(t,n[0],n[1]):A("Object script error - set_obstacle expects at least one and at most two parameters: is_obstacle (TRUE or FALSE) [, angle]")}},{command:"set_alpha",action:function(t,e,n){1==e?t=objectdecorator_setalpha_new(t,n[0]):A("Object script error - set_alpha expects one parameter: alpha (0.0 (transparent) <= alpha <= 1.0 (opaque))")}},{command:"hide",action:function(t,e,n){0==e?t=objectdecorator_setalpha_new(t,0):A("Object script error - hide expects no parameters")}},{command:"show",action:function(t,e,n){0==e?t=objectdecorator_setalpha_new(t,1):A("Object script error - show expects no parameters")}},{command:"enemy",action:function(t,e,n){return 1==e?t=function(t,e){var n={};return n.init=Gs,n.release=Us,n.update=Bs,n.render=Hs,n.get_object_instance=Rs,n.decorated_machine=t,n.score=e,n}(t,n):A("Object script error - enemy expects one parameter: score"),t}},{command:"lock_camera",action:function(t,e,n){4==e?t=objectdecorator_lockcamera_new(t,n[0],n[1],n[2],n[3]):A("Object script error - lock_camera expects four parameters: x1, y1, x2, y2")}},{command:"move_player",action:function(t,e,n){2==e?t=objectdecorator_moveplayer_new(t,n[0],n[1]):A("Object script error - move_player expects two parameters: speed_x, speed_y")}},{command:"hit_player",action:function(t,e,n){0==e?t=objectdecorator_hitplayer_new(t):A("Object script error - hit_player expects no parameters")}},{command:"burn_player",action:function(t,e,n){0==e?t=objectdecorator_burnplayer_new(t):A("Object script error - burn_player expects no parameters")}},{command:"shock_player",action:function(t,e,n){0==e?t=objectdecorator_shockplayer_new(t):A("Object script error - shock_player expects no parameters")}},{command:"acid_player",action:function(t,e,n){0==e?t=objectdecorator_acidplayer_new(t):A("Object script error - acid_player expects no parameters")}},{command:"add_rings",action:function(t,e,n){1==e?t=objectdecorator_addrings_new(t,n[0]):A("Object script error - add_rings expects one parameter: number_of_rings")}},{command:"add_to_score",action:function(t,e,n){1==e?t=objectdecorator_addtoscore_new(t,n[0]):A("Object script error - add_to_score expects one parameter: score")}},{command:"set_player_animation",action:function(t,e,n){2==e?t=objectdecorator_setplayeranimation_new(t,n[0],n[1]):A("Object script error - set_player_animation expects two parameters: sprite_name, animation_id")}},{command:"enable_player_movement",action:function(t,e,n){0==e?t=objectdecorator_enableplayermovement_new(t):A("Object script error - enable_player_movement expects no parameters")}},{command:"disable_player_movement",action:function(t,e,n){0==e?t=objectdecorator_disableplayermovement_new(t):A("Object script error - disable_player_movement expects no parameters")}},{command:"set_player_xspeed",action:function(t,e,n){1==e?t=objectdecorator_setplayerxspeed_new(t,n[0]):A("Object script error - set_player_xspeed expects one parameter: speed")}},{command:"set_player_yspeed",action:function(t,e,n){1==e?t=objectdecorator_setplayeryspeed_new(t,n[0]):A("Object script error - set_player_yspeed expects one parameter: speed")}},{command:"set_player_position",action:function(t,e,n){2==e?t=objectdecorator_setplayerposition_new(t,n[0],n[1]):A("Object script error - set_player_position expects two parameters: xpos, ypos")}},{command:"bounce_player",action:function(t,e,n){0==e?t=objectdecorator_bounceplayer_new(t):A("Object script error - bounce_player expects no parameters")}},{command:"observe_player",action:function(t,e,n){1==e?t=objectdecorator_observeplayer_new(t,n[0]):A("Object script error - observe_player expects one parameter: player_name")}},{command:"observe_current_player",action:function(t,e,n){0==e?t=objectdecorator_observecurrentplayer_new(t):A("Object script error - observe_current_player expects no parameters")}},{command:"observe_active_player",action:function(t,e,n){0==e?t=objectdecorator_observeactiveplayer_new(t):A("Object script error - observe_active_player expects no parameters")}},{command:"observe_all_players",action:kc},{command:"observe_next_player",action:kc},{command:"attach_to_player",action:function(t,e,n){0==e?t=objectdecorator_attachtoplayer_new(t,0,0):1==e?t=objectdecorator_attachtoplayer_new(t,n[0],0):2==e?t=objectdecorator_attachtoplayer_new(t,n[0],n[1]):A("Object script error - attach_to_player expects at most two parameters: [offset_x [, offset_y]]")}},{command:"springfy_player",action:function(t,e,n){0==e?t=objectdecorator_springfyplayer_new(t):A("Object script error - springfy_player expects no parameters")}},{command:"roll_player",action:function(t,e,n){0==e?t=objectdecorator_rollplayer_new(t):A("Object script error - roll_player expects no parameters")}},{command:"walk",action:function(t,e,n){var a,i,o;return 1==e?(a=t,i=n,(o={}).init=fc,o.release=hc,o.update=gc,o.render=mc,o.get_object_instance=Rs,o.decorated_machine=a,o.speed=i,o.direction=-1,t=o):A("Object script error - walk expects one parameter: speed"),t}},{command:"gravity",action:function(t,e,n){var a,i,o;return 0==e?(a=t,o=i={},i.init=zs,i.release=Fs,i.update=Vs,i.render=qs,i.get_object_instance=Rs,o.decorated_machine=a,t=i):A("Object script error - gravity expects no parameters"),t}},{command:"jump",action:function(t,e,n){1==e?t=objectdecorator_jump_new(t,n[0]):A("Object script error - jump expects one parameter: jump_strength")}},{command:"move",action:Sc},{command:"bullet_trajectory",action:Sc},{command:"elliptical_trajectory",action:function(t,e,n){var a,i,o,r,s,c,p,l;return e>=4&&e<=6?(a=t,i=n[0],o=n[1],r=n[2],s=n[3],c=n[4],p=n[5],(l={}).init=Xs,l.release=Ws,l.update=Ys,l.render=$s,l.get_object_instance=Rs,l.decorated_machine=a,l.amplitude_x=i,l.amplitude_y=o,l.angularspeed_x=r*(2*v),l.angularspeed_y=s*(2*v),l.initialphase_x=c*v/180,l.initialphase_y=p*v/180,t=l):A("Object script error - elliptical_trajectory expects at least four and at most six parameters: amplitude_x, amplitude_y, angularspeed_x, angularspeed_y [, initialphase_x [, initialphase_y]]"),t}},{command:"mosquito_movement",action:function(t,e,n){var a,i,o;return 1==e?(a=t,i=n,(o={}).init=oc,o.release=rc,o.update=sc,o.render=cc,o.get_object_instance=Rs,o.decorated_machine=a,o.speed=i,t=o):A("Object script error - mosquito_movement expects one parameter: speed"),t}},{command:"look_left",action:function(t,e,n){0==e?t=Qs(t,ec):A("Object script error - look_left expects no parameters")}},{command:"look_right",action:function(t,e,n){0==e?t=Qs(t,nc):A("Object script error - look_right expects no parameters")}},{command:"look_at_player",action:function(t,e,n){return 0==e?t=Qs(t,ac):A("Object script error - look_at_player expects no parameters"),t}},{command:"look_at_walking_direction",action:function(t,e,n){return 0==e?t=Qs(t,ic):A("Object script error - look_at_walking_direction expects no parameters"),t}},{command:"create_item",action:function(t,e,n){3==e?t=objectdecorator_createitem_new(t,n[0],n[1],n[2]):A("Object script error - create_item expects three parameters: item_id, offset_x, offset_y")}},{command:"change_closest_object_state",action:function(t,e,n){2==e?t=objectdecorator_changeclosestobjectstate_new(t,n[0],n[1]):A("Object script error - change_closest_object_state expects two parameters: object_name, new_state_name")}},{command:"create_child",action:function(t,e,n){3==e?t=objectdecorator_createchild_new(t,n[0],n[1],n[2],""):4==e?t=objectdecorator_createchild_new(t,n[0],n[1],n[2],n[3]):A("Object script error - create_child expects three or four parameters: object_name, offset_x, offset_y [, child_name]")}},{command:"change_child_state",action:function(t,e,n){2==e?t=objectdecorator_changechildstate_new(t,n[0],n[1]):A("Object script error - change_child_state expects two parameters: child_name, new_state_name")}},{command:"change_parent_state",action:function(t,e,n){1==e?t=objectdecorator_changeparentstate_new(t,n[0]):A("Object script error - change_parent_state expects one parameter: new_state_name")}},{command:"destroy",action:function(t,e,n){0==e?t=objectdecorator_destroy_new(t):A("Object script error - destroy expects no parameters")}},{command:"change_state",action:function(t,e,n){1==e?t=objectdecorator_ontimeout_new(t,0,n[0]):A("Object script error - change_state expects one parameter: new_state_name")}},{command:"on_timeout",action:function(t,e,n){2==e?t=objectdecorator_ontimeout_new(t,n[0],n[1]):A("Object script error - on_timeout expects two parameters: timeout (in seconds), new_state_name")}},{command:"on_collision",action:function(t,e,n){2==e?t=objectdecorator_oncollision_new(t,n[0],n[1]):A("Object script error - on_collision expects two parameters: object_name, new_state_name")}},{command:"on_animation_finished",action:function(t,e,n){1==e?t=objectdecorator_onanimationfinished_new(t,n[0]):A("Object script error - on_animation_finished expects one parameter: new_state_name")}},{command:"on_random_event",action:function(t,e,n){2==e?t=objectdecorator_onrandomevent_new(t,n[0],n[1]):A("Object script error - on_random_event expects two parameters: probability (0.0 <= probability <= 1.0), new_state_name")}},{command:"on_player_collision",action:function(t,e,n){1==e?t=objectdecorator_onplayercollision_new(t,n[0]):A("Object script error - on_player_collision expects one parameter: new_state_name")}},{command:"on_player_attack",action:function(t,e,n){1==e?t=objectdecorator_onplayerattack_new(t,n[0]):A("Object script error - on_player_attack expects one parameter: new_state_name")}},{command:"on_player_rect_collision",action:function(t,e,n){5==e?t=objectdecorator_onplayerrectcollision_new(t,n[0],n[1],n[2],n[3],n[4]):A("Object script error - on_player_rect_collision expects five parameters: offset_x1, offset_y1, offset_x2, offset_y2, new_state_name")}},{command:"on_no_shield",action:function(t,e,n){1==e?t=objectdecorator_onnoshield_new(t,n[0]):A("Object script error - on_no_shield expects one parameter: new_state_name")}},{command:"on_shield",action:function(t,e,n){1==e?t=objectdecorator_onshield_new(t,n[0]):A("Object script error - on_shield expects one parameter: new_state_name")}},{command:"on_fire_shield",action:function(t,e,n){1==e?t=objectdecorator_onfireshield_new(t,n[0]):A("Object script error - on_fire_shield expects one parameter: new_state_name")}},{command:"on_thunder_shield",action:function(t,e,n){1==e?t=objectdecorator_onthundershield_new(t,n[0]):A("Object script error - on_thunder_shield expects one parameter: new_state_name")}},{command:"on_water_shield",action:function(t,e,n){1==e?t=objectdecorator_onwatershield_new(t,n[0]):A("Object script error - on_water_shield expects one parameter: new_state_name")}},{command:"on_acid_shield",action:function(t,e,n){1==e?t=objectdecorator_onacidshield_new(t,n[0]):A("Object script error - on_acid_shield expects one parameter: new_state_name")}},{command:"on_wind_shield",action:function(t,e,n){1==e?t=objectdecorator_onwindshield_new(t,n[0]):A("Object script error - on_wind_shield expects one parameter: new_state_name")}},{command:"on_brick_collision",action:function(t,e,n){1==e?t=objectdecorator_onbrickcollision_new(t,n[0]):A("Object script error - on_brick_collision expects one parameter: new_state_name")}},{command:"on_floor_collision",action:function(t,e,n){1==e?t=objectdecorator_onfloorcollision_new(t,n[0]):A("Object script error - on_floor_collision expects one parameter: new_state_name")}},{command:"on_ceiling_collision",action:function(t,e,n){1==e?t=objectdecorator_onceilingcollision_new(t,n[0]):A("Object script error - on_ceiling_collision expects one parameter: new_state_name")}},{command:"on_left_wall_collision",action:function(t,e,n){1==e?t=objectdecorator_onleftwallcollision_new(t,n[0]):A("Object script error - on_left_wall_collision expects one parameter: new_state_name")}},{command:"on_right_wall_collision",action:function(t,e,n){1==e?t=objectdecorator_onrightwallcollision_new(t,n[0]):A("Object script error - on_right_wall_collision expects one parameter: new_state_name")}},{command:"show_dialog_box",action:function(t,e,n){2==e?t=objectdecorator_showdialogbox_new(t,n[0],n[1]):A("Object script error - show_dialog_box expects two parameters: title, message")}},{command:"hide_dialog_box",action:function(t,e,n){0==e?t=objectdecorator_hidedialogbox_new(t):A("Object script error - hide_dialog_box expects no parameters")}},{command:"clear_level",action:function(t,e,n){0==e?t=objectdecorator_clearlevel_new(t):A("Object script error - clear_level expects no parameters")}},{command:"play_sample",action:function(t,e,n){1==e?t=objectdecorator_playsample_new(t,n[0],1,0,1,0):2==e?t=objectdecorator_playsample_new(t,n[0],n[1],0,1,0):3==e?t=objectdecorator_playsample_new(t,n[0],n[1],n[2],1,0):4==e?t=objectdecorator_playsample_new(t,n[0],n[1],n[2],n[3],0):5==e?t=objectdecorator_playsample_new(t,n[0],n[1],n[2],n[3],n[4]):A("Object script error - play_sample expects at least one and at most five parameters: sound_name [, volume [, pan [, frequency [, loops]]]]")}},{command:"play_music",action:function(t,e,n){1==e?t=objectdecorator_playmusic_new(t,n[0],0):2==e?t=objectdecorator_playmusic_new(t,n[0],n[1]):A("Object script error - play_music expects at least one and at most two parameters: music_name [, loops]")}},{command:"play_level_music",action:function(t,e,n){0==e?t=objectdecorator_playlevelmusic_new(t):A("Object script error - play_level_music expects no parameters")}},{command:"set_music_volume",action:function(t,e,n){1==e?t=objectdecorator_setmusicvolume_new(t,n[0]):A("Object script error - set_music_volume expects one parameter: volume")}},{command:null,action:null}],xc=function(t,e){return function(t,e){var n,a,i,o=e;if(0===o.state){var r=t.state.name;for(o.state,o.vm.state_list=(a=o.vm,i=t.state.list,null==Ls(a.state_list,i)&&(a.state_list=function(t,e,n){var a,i,o,r={};return r.name=e,r.data=(a=n,(o=i={}).init=Es,o.release=Ms,o.update=Is,o.render=Os,o.get_object_instance=Ds,o.basic=!0,i.object=a,o),r.next=t,r}(a.state_list,i,a.owner)),a.state_list),o.vm=function(t,e){var n=Ls(t.state_list,e);return null!=n?t.reference_to_current_state=n.data:R('Object script error: can\'t find state "%s".'),t}(o.vm,r),n=Ts(o.vm),be=0,function(t,e){be<1024?(bc[be]={},bc[be].stmt=t,bc[be].machine=e,be++):R("Object script error: you may write %d commands or less per state")}(t.state.list,n);be-- >0;)n=vc(bc[be].stmt,bc[be].machine);n&&n.init(n)}return o.vm.reference_to_current_state=n,t.destroy_if_far_from_play_area&&(o.preserve=!1),t.always_active&&(o.always_active=!0),t.hide_unless_in_editor_mode&&(o.hide_unless_in_editor_mode=!0),o}(e,t)};function vc(t,e){var n,a,i,o,r=t;for(a=r.length,n=0;n<a;n++)o=(i=r[n])[1]&&void 0!==i[1]?i[1].length?i[1].length:1:0,e=wc(e,i[0],o,i[1]);return e}function wc(t,e,n,a){for(var i=0,o=yc[i++];null!=o.command&&null!=o.action;)o.command==e&&(t=o.action(t,n,a)),o=yc[i++];return t}function kc(t,e,n){0==e?t=objectdecorator_observeallplayers_new(t):A("Object script error - observe_all_players expects no parameters")}function Sc(t,e,n){var a,i,o,r;return 2==e?(a=t,i=n[0],o=n[1],(r={}).init=As,r.release=Ns,r.update=Cs,r.render=Ps,r.get_object_instance=Rs,r.decorated_machine=a,r.speed=pt(i,o),t=r):A("Object script error - bullet_trajectory expects two parameters: speed_x, speed_y"),t}var jc,Ec,Mc,Ic,Oc,Dc,Tc,Lc,Rc,Ac,Nc,Cc,Pc,Gc,Uc,Bc,Hc,Xc,Wc,Yc,$c,zc,Fc,Vc,qc,Qc,Kc,Zc,Jc,tp,ep,np,ap,ip,op,rp,sp,cp,pp,lp,_p,dp,up,fp,hp,gp,mp,bp,yp,xp,vp,wp,kp,Sp,jp,Ep,Mp,Ip,Op,Dp,Tp,Lp,Rp,Ap,Np,Cp,Pp,Gp,Up,Bp,Hp,Xp,Wp,Yp,$p,zp,Fp,Vp,qp,Qp,Kp,Zp,Jp,tl,el,nl,al,il,ol,rl,sl,cl,pl,ll,_l,dl,ul,fl,hl,gl,ml,bl,yl,xl,vl,wl,kl,Sl,jl,El,Ml,Il,Ol,Dl,Tl,Ll,Rl,Al,Nl,Cl,Pl,Gl,Ul,Bl,Hl,Xl,Wl,Yl,$l,zl,Fl=[],Vl=function(t){return Jl(t)},ql=function(t,e,n,a,i,o){if(t){var r=Ts(t.vm);r.update(r,e,n,a,i,o)}},Ql=function(t,e){if(t){var n=Ts(t.vm);(!t.hide_unless_in_editor_mode||t.hide_unless_in_editor_mode&&_d())&&n.render(n,e)}},Kl=function(t){return null!=t.observed_player?t.observed_player:dd()},Zl=1,Jl=function(t){var e,n={},a={};return n.name=t,n.state=0,n.actor=Un(),n.actor.input=Se(),n.actor=zn(n.actor,dn("SD_QUESTIONMARK",0)),n.preserve=!0,n.obstacle=!1,n.obstacle_angle=0,n.always_active=!1,n.hide_unless_in_editor_mode=!1,n.vm=((e={}).owner=n,e.state_list=null,e.reference_to_current_state=null,e),n.created_from_editor=!0,n.parent=null,n.children=e_(),n.observed_player=null,a.in_object_name=t,a.out_object_block=null,a.out_object_block=t_(jc,a),null!=a.out_object_block?n=xc(n,a.out_object_block):R("Object '%s' does not exist"),n},t_=function(t,e){var n=t[e.in_object_name];return n?(e.in_object_name,n):(R("Object script error: unknown keyword '%s'"),0)},e_=function(){return null},n_=[],a_=function(){return Ec},i_=function(t){return Ec>0?(t=it(t,0,Ec-1),n_[t]):null},o_=function t(e){return null!=e&&(e.next=t(e.next),e=null,e=null),e},r_=!1,s_=[38,40,39,37,78,66,17,123],c_=[87,83,68,65,90,89,71,80],p_={},l_={},__=0,d_=0,u_=[hs,1,2,3,4,5,7,6,42,78,79,80,81,16,17,18,19,20,54,48,49,50,51,52,53,21,47,22,23,43,44,45,46,55,62,56,57,58,59,60,61,24,25,ys,xs,28,29,30,vs,32,33,34,ws,36,37,75,76,77,38,63,64,65,66,67,68,69,39,70,71,72,73,74,-1],f_=0,h_=function(){return r_},g_=function(){console.log("SAVE");var t=od();rd(t),W(qe("level saved"))},m_=function(){var t,e=Z();t=Ie(Tc,7)?3750:750,(Ie(Tc,1)||Ie(Lc,1))&&(p_.y-=t*e),(Ie(Tc,2)||Ie(Lc,2))&&(p_.y+=t*e),(Ie(Tc,4)||Ie(Lc,4))&&(p_.x-=t*e),(Ie(Tc,3)||Ie(Lc,3))&&(p_.x+=t*e),p_.x=parseInt(Math.max(p_.x,240),10),p_.y=parseInt(Math.max(p_.y,135.5),10),qa(p_)},b_=function(t){switch(t){case 1:return"brick";case 2:return"built-in item";case 3:return"object";case 4:return"group"}return"unknown"},y_=function(t,e){switch(t){case 1:Mn(e);break;case 2:ks(e)}return""},x_=function t(){__=0,d_=0,4==(Rc=1==Rc?2:2==Rc?3:3==Rc?4:4==Rc?1:Rc)&&0==a_()&&t()},v_=function t(){__=0,d_=0,4==(Rc=2==Rc?1:3==Rc?2:4==Rc?3:1==Rc?4:Rc)&&0==a_()&&t()},w_=function t(){var e;switch(Rc){case 1:e=In(),null==Mn(__=(__+1)%e)&&t();break;case 2:__=u_[d_=(d_+1)%(e=Cc)];break;case 3:__=(__+1)%(e=Gc);break;case 4:e=a_(),__=(__+1)%e}},k_=function t(){var e;switch(Rc){case 1:e=In(),null==Mn(__=(__-1+e)%e)&&t();break;case 2:__=u_[d_=(d_-1+(e=Cc))%e];break;case 3:__=(__-1+(e=Gc))%e;break;case 4:e=a_(),__=(__-1+e)%e}},S_=function(t){var e;for(e=0;e<Cc;e++)if(t==u_[e])return e;return-1},j_=function t(e,n,a){var i=null,o=pt(0,0);switch(e){case 1:null!=Mn(n)&&(i=Mn(n).image);break;case 2:var r=ks(n);null!=r&&(i=Yn(r.actor),(o=r.actor.hot_spot).y-=2);break;case 3:var s=Vl(M_(n));null!=s&&(i=Yn(s.actor),(o=s.actor.hot_spot).y-=2);break;case 4:var c;for(c=i_(n);c;c=c.next)t(EDITORGRP_ENTITY_TO_EDT(c.entity.type),c.entity.id,lt(a,c.entity.position))}null!=i&&nn(i.data,Tt(),i.sx,i.sy,parseInt(a.x-o.x,10),parseInt(a.y-o.y,10),i.swidth,i.sheight)},E_=function(t){var e;for(e=0;e<Gc;e++)if(t==Pc[e])return e;return-1},M_=function(t){return null},I_=function(){f_=!1},O_=function(){},D_=function(){Oe(Lc,7)&&(f_=!f_)},T_=function(t){var e=_t(p_,pt(240,135.5)),n=parseInt(e.x%1,10),a=parseInt(e.y%1,10),i=-n+1*parseInt(t.x/1,10),o=-a+1*parseInt(t.y/1,10);return lt(e,pt(i,o))},L_=function(t,e,n,a){var i={};return i.type=t?1:2,i.obj_type=e,i.obj_id=n,i.obj_position=a,i},R_=function(t,e,n){var a={};return a.type=t?3:4,a.obj_position=e,a.obj_old_position=n,a},A_=function(){Bc=C_(Bc),Uc=null,Hc=null},N_=function t(e){console.log("REGISTER",e);var n,a=!1;if(4!=e.obj_type){var i,o,r;for((r={}).action=e,r.in_group=a,r.in_group&&(r.group_key=n),null!=(i=Hc)&&(i.next=C_(i.next)),o=Uc;null!=o.next;)o=o.next;o.next=r,r.prev=o,r.next=null,Hc=r}else{var s,c=48879;for(a=!0,n=c++,s=i_(e.obj_id);s;s=s.next){var p=s.entity,l=EDITORGRP_ENTITY_TO_EDT(p.type);t(L_(!0,l,p.id,lt(p.position,e.obj_position)))}a=!1}},C_=function(t){var e,n;for(e=t;null!=e;)n=e.next,e=null,e=n;return null},P_=function t(){var e,n;Hc!=Bc&&(e=Hc,Hc=Hc.prev,e.in_group&&e.prev&&e.prev.in_group&&e.group_key==e.prev.group_key&&t(),(n=e.action).type=1==n.type?2:2==n.type?1:3==n.type?4:4==n.type?3:n.type,U_(n))},G_=function t(){var e,n;null!=Hc.next&&((e=Hc=Hc.next).in_group&&e.next&&e.next.in_group&&e.group_key==e.next.group_key&&t(),n=e.action,U_(n))},U_=function t(e){if(console.log("COMMIT",e),1==e.type)switch(e.obj_type){case 1:jd(e.obj_id,e.obj_position);break;case 2:Ed(e.obj_id,e.obj_position);break;case 3:Md(M_(e.obj_id),e.obj_position);break;case 4:var n;for(n=i_(e.obj_id);n;n=n.next){var a=n.entity,i=EDITORGRP_ENTITY_TO_EDT(a.type);t(L_(!0,i,a.id,lt(a.position,e.obj_position)))}}else if(2==e.type)switch(e.obj_type){case 1:var o,r=Mn(e.obj_id);for(o=Xc;o;o=o.next)o.data.brick_ref==r&&ft(_t(pt(o.data.x,o.data.y),e.obj_position))<m&&(o.data.state=1);break;case 2:var s,c=e.obj_id;for(s=item_list;s;s=s.next)s.data.type==c&&ft(_t(s.data.actor.position,e.obj_position))<m&&(s.data.state=IS_DEAD);break;case 3:var p,l=e.obj_id;for(p=enemy_list;p;p=p.next)E_(p.data.name)==l&&ft(_t(p.data.actor.position,e.obj_position))<m&&(p.data.state=ES_DEAD)}else 3==e.type?(md(e.obj_position),Ad()):4==e.type&&(md(e.obj_old_position),Ad())},B_=function(t,e){W_(t,e,!0),Hn(t.actor,e),W_(t,e,!1)},H_=function(t){return 1==t.state},X_=function(t,e){var n;for(n=0;n<e.length&&1!=t.state;n++)if(e[n]&&qn(t.actor,e[n].actor))return!(!e[n].attacking(e[n])&&!e[n].invincible&&(e[n].hit(e[n]),1));return!1},W_=function(t,e,n){var a=t.actor,i=.001*J();if(3===t.type){var o,r=pt(0,0);if(un(dn("SD_INVSTAR",0),1),1!=t.state)for(o=0;o<5;o++)r.x=a.position.x+20*Math.cos(2*v*i+2*o*v/5),r.y=a.position.y+20*Math.sin(v*i+2*o*v/5)}},Y_=[0,1,2],$_=gt,z_="data/levels/blue_ocean_1.json",F_=null,V_=[],q_=[],Q_=[],K_=[],Z_={position:{x:0,y:0}},J_=[],td=[],ed=[],nd=[],ad=[],id=function(t){z_=t,R("level_setfile('%s')")},od=function(){return z_},rd=function(t){var e,n,a,i,o,r={name:Wc,act:Vc,theme:$c,bgtheme:zc,grouptheme:Fc,spawn_point:Jc,music:Yc,boss:null,bricklist:[],itemlist:[],enemylist:[],dialogbox:[]};_u()&&(r.boss={id:sp.type,x:sp.actor.spawn_point.x,y:sp.actor.spawn_point.y,rx:sp.rect_x,ry:sp.rect_y,rw:sp.rect_w,rh:sp.rect_h});var s=[];for(a=F_;a;a=a.next)s.push({id:Cd(a.data),xpos:a.data.sx,ypos:a.data.sy});r.bricklist=s;var c=[];for(i=V_;i;i=i.next)i.data&&c.push({id:i.data.type,xpos:i.data.actor.spawn_point.x,ypos:i.data.actor.spawn_point.y});r.itemlist=c;var p=[];for(o=q_;o;o=o.next)o.data&&o.data.created_from_editor&&p.push({id:o.data.name,xpos:o.data.actor.spawn_point.x,ypos:o.data.actor.spawn_point.y});r.enemylist=p;var l=[];for(e=0,n=ad.length;e<n;e++)l.push({xpos:ad[e].rect_x,ypos:ad[e].rect_y,width:ad[e].rect_w,height:ad[e].rect_h,title:ad[e].title,message:ad[e].message});r.dialogbox=l;var _=t.split("/");_=_[_.length-1],console.log("saveFile",t,r),R("level_save() ok")},sd=function(){var t;$_=gt,R("level_init()"),F_=null,V_=[],K_=[],qc=800,Qc=Kc=0,Zc=0,Rp=0,up=!1,np=!1,ap="",fp=hp=gp=0,td=xp=vp=0,mp=bp=!1,yp=!1,ip=null,Wd(),R("editor_init()"),Xc=Ld(),r_=!1,Cc=u_.length,Rc=1,__=0,Mc=Lt(),Ic=Rt(),Pc=Fl.name,Oc=en("data/images/editorbg.png"),Tc=je(s_),Lc=je(c_),Dc=function(){var t,e={type:4,enabled:!0};for(e.dx=e.dy=e.x=e.y=0,e.state=[],e.oldstate=[],e.howlong=[],t=0;t<9;t++)e.state[t]=e.oldstate[t]=!1,e.howlong[t]=0;return Ne(e),e}(),Ac=ra(8),Nc=ra(8),function(){var t;for(Ec=0,t=0;t<501;t++)n_[t]=null}(),I_(),R("editor_init() ok"),du(z_).then((function(){for(R("Creating players..."),t=0;t<Y_.length;t++){var e=fi(Y_[t]);e.hit=bi,e.kill=yi,e.set_rings=ji,e.get_rings=wi,e.got_glasses=!1,K_.push(e)}for(Qd(),op=K_[rp=0],za.is_locked=!1,za.speed=0,za.region_topleft_speed=0,za.region_bottomright_speed=0,za.position=za.dest=pt(0,0),za.region_topleft.x=za.dest_region_topleft.x=240,za.region_topleft.y=za.dest_region_topleft.y=135.5,za.region_bottomright.x=za.dest_region_bottomright.x=hd().x-240,za.region_bottomright.y=za.dest_region_bottomright.y=hd().y-135.5,qa(op.actor.position),pu(op.actor),ji(0),cp=!1,pp=!1,R("Loading hud..."),(lp=Un()).position=pt(16,7),lp=zn(lp,dn("SD_MAINGUI",0)),(_p=Un()).position=pt(16,248),_p=zn(_p,dn("SD_LIFEGUI",0)),(dp=ra(0)).position=lt(_p.position,pt(32,11)),t=0;t<3;t++)J_[t]=ra(2),J_[t].position=lt(lp.position,pt(42,16*t+2));for((jp=Un()).position=pt(0,-240),jp=zn(jp,dn("SD_LEVELOP",0)),(Ep=Un()).position=pt(260,250),Ep=zn(Ep,dn("SD_LEVELACT",Vc-1)),(Mp=ra(3)).position=pt(330,50),sa(Mp,"%s",Wc.toUpperCase()),la(Mp,180),wp=ra(4),kp=ra(7),Sp=Un(),t=0;t<3;t++)ed[t]=ra(2),nd[t]=Un();Ip=!1,Op=0,(Dp=Un()).position.y=mt,Dp=zn(Dp,dn("SD_DIALOGBOX",0)),Tp=ra(8),Lp=ra(8)}))},cd=function(){var t,e;Zc+=Z();var n,a,i,o,r,s,c,p=!1,l=!1,_=!1,d=Z();if(ru(),iu(),ou(),h_())!function(){Xc||(Xc=Ld());var t,e,n,a,i,o=un(dn("SD_ARROW",0),0),r=pa(Ac).x,s=pa(Ac).y,c=_t(p_,pt(240,135.5));if(Ie(Tc,7)&&Oe(Tc,8)&&g_(),Ie(Tc,8))return R("editor_disable()"),A_(),r_=!1,Pt(Mc,Ic,At()),void R("editor_disable() ok");if(Ie(Tc,7)?((Oe(Tc,5)||Oe(Dc,2))&&x_(),(Oe(Tc,6)||Oe(Dc,1))&&v_()):((Oe(Tc,5)||Oe(Dc,2))&&w_(),(Oe(Tc,6)||Oe(Dc,1))&&k_()),l_.x=it(Ae(Dc).x,0,gt-o.width),l_.y=it(Ae(Dc).y,0,mt-o.height),Oe(Dc,5)&&Ie(Tc,7)){var p=T_(l_),l=R_(!0,p,spawn_point);U_(l),N_(l)}if(Oe(Dc,5)&&!Ie(Tc,7)){var _=L_(!0,Rc,__,T_(l_));U_(_),N_(_)}if(t=Oe(Dc,7),e=Oe(Dc,6),t||e)switch(console.log(t,e,Rc,1),Rc){case 1:for(n=Xc;n;n=n.next){var d=[n.data.x,n.data.y,n.data.x+n.data.brick_ref.image.width,n.data.y+n.data.brick_ref.image.height],u=[l_.x+c.x,l_.y+c.y,l_.x+c.x+1,l_.y+c.y+1];if(ot(d,u)){if(!t){var f=L_(!1,1,Rd(n.data),pt(n.data.x,n.data.y));U_(f),N_(f);break}__=Rd(n.data)}}break;case 2:for(a=item_list;a;a=a.next){var h=[a.data.actor.position.x-a.data.actor.hot_spot.x,a.data.actor.position.y-a.data.actor.hot_spot.y,a.data.actor.position.x-a.data.actor.hot_spot.x+Yn(a.data.actor).width,a.data.actor.position.y-a.data.actor.hot_spot.y+Yn(a.data.actor).height],g=[l_.x+c.x,l_.y+c.y,l_.x+c.x+1,l_.y+c.y+1];if(ot(h,g)){if(!t){var m=L_(!1,2,a.data.type,a.data.actor.position);U_(m),N_(m);break}var b=S_(a.data.type);b>=0&&(d_=b,__=u_[b])}}break;case 3:for(i=enemy_list;i;i=i.next){var y=[i.data.actor.position.x-i.data.actor.hot_spot.x,i.data.actor.position.y-i.data.actor.hot_spot.y,i.data.actor.position.x-i.data.actor.hot_spot.x+Yn(i.data.actor).width,i.data.actor.position.y-i.data.actor.hot_spot.y+Yn(i.data.actor).height],x=[l_.x+c.x,l_.y+c.y,l_.x+c.x+1,l_.y+c.y+1],v=E_(i.data.name);if(v>=0&&ot(y,x)){if(!t){var w=L_(!1,3,v,i.data.actor.position);U_(w),N_(w);break}__=v}}}Ie(Tc,7)&&(Oe(Lc,5)?P_():Oe(Lc,6)&&G_()),D_(),m_(),sa(Ac,"%d,%d",parseInt(T_(l_).x,10),parseInt(T_(l_).y,10)),Ac.position.x=it(parseInt(l_.x,10),10,gt-r*ca(Ac).length-10),Ac.position.y=it(parseInt(l_.y-3*s,10),10,261),Nc.position=pt(10,10),3!=Rc?sa(Nc,"<color=ffff00>%s %d</color>\n%s",b_(Rc),__,y_(Rc,__)):sa(Nc,'<color=ffff00>%s "%s"</color>\n%s',b_(Rc),M_(__),y_(Rc,__))}();else{for(_=Zc<5,t=0;t<K_.length&&!_;t++)K_[t]&&(_=K_[t].dead);if(op&&op.actor&&Oe(op.actor.input,8)&&!_){console.log("QUIT");var u=[];return tp.pause(),u[0]=He("CBOX_QUIT_QUESTION"),u[1]=He("CBOX_QUIT_OPTION1"),u[2]=He("CBOX_QUIT_OPTION2"),wa(u[0],u[1],u[2]),void $e(Bh(Ah))}if(1==(e=ka())?np=!0:2==e&&P(tp,!0),np)return Et()?(ze(),void vu()):void jt(on(0,0,0),1);if(Oe(Tc,9))return R("editor_enable()"),(Bc={}).in_group=!1,Bc.prev=null,Bc.next=null,Uc=Bc,Hc=Bc,r_=!0,p_.x=parseInt(Va().x,10),p_.y=parseInt(Va().y,10),l_=pt(240,135.5),Mc=Lt(),Ic=Rt(),Pt(3,!1,At()),void R("editor_enable() ok");for(l=Zc<5,t=0;t<K_.length&&!l;t++)l=K_[t].dying||K_[t].dead;if(op&&Oe(op.actor.input,7)&&!l)return op.spin_dash=op.braking=!1,null==N||N.is_paused||(N.is_paused=!0,N.pause()),void $e(Bh(Ih));lp=zn(lp,dn("SD_MAINGUI",wi()>0?0:1)),_p=zn(_p,dn("SD_LIFEGUI",rp)),dp=sa(dp,"%d",ki()),sa(J_[0],"%d",Si());var f=parseInt(Zc%60,10);if(f<10&&(f="0"+f),sa(J_[1],"%s",parseInt(Zc/60,10)+":"+f),sa(J_[2],"%d",wi()),jp&&(Zc<5?Zc<1.5?(jp.position.y+=360*d,jp.position.y>-2&&(jp.position.y=-2),Mp.position.x-=320*d,Mp.position.x<140&&(Mp.position.x=140),Ep.position.y-=200*d,Ep.position.y<200&&(Ep.position.y=200)):Zc>3.5&&(jp.position.x-=320*d):(jp.visible=!1,Mp.visible=!1,Ep.visible=!1)),up){var h=0,g=J(),b=qe("ring count"),y=qe("cash"),x=qe("glasses");if(g>=fp+2e3){for(t=0;t<K_.length;t++)K_[t]&&(K_[t].actor.speed.x=0);for(wp.position.x=Math.min(wp.position.x+800*d,30),kp.position.x=Math.min(kp.position.x+700*d,12),Sp.position.x=Math.max(Sp.position.x-700*d,250),t=0;t<3;t++)nd[t].position.x=Math.min(nd[t].position.x+(400-50*t)*d,50),ed[t].position.x=Math.max(ed[t].position.x-(400-50*t)*d,230);h=vp-(td+xp),sa(ed[0],"%d",parseInt(td,10)),sa(ed[1],"%d",parseInt(xp,10)),sa(ed[2],"%d",parseInt(h,10)),yp||(G(),W(qe("goal")),yp=!0)}if(g>=fp+6e3&&!mp)if(td=Math.max(0,td-400*d),xp=Math.max(0,xp-2e3*d),td>0||xp>0)b&&g>=gp&&(gp=g+100,W(b));else for(mp=!0,hp=g+4e3,W(y),t=0;t<K_.length;t++)if(K_[t].got_glasses){W(x);break}mp&&g>=hp&&(bp=!0)}for(Vd(),Fd(),p=!1,t=0;t<K_.length;t++)K_[t].dying&&(p=!0);for(r=nu(),n=tu(),a=null,Ea(ip),s=V_;s;s=s.next)if(s.data&&s.data.actor){var k=s.data.actor.position.x,S=s.data.actor.position.y,j=Yn(s.data.actor).width,E=Yn(s.data.actor).height;if(lu(k,S,j,E,$_)){if(Ss(s.data,K_,3,n,V_,q_),s.data.obstacle){var M=void 0,I=void 0,O=lt(s.data.actor.hot_spot,pt(0,-1)),D=Yn(s.data.actor),T=Kd(D.width,D.height-1,_t(s.data.actor.position,O),0);T.brick_ref.zindex=s.data.bring_to_back?.4:.5,(M={}).next=a,M.data=T,a=M,(I={}).next=n,I.data=T,n=I}}else s.data.preserve||(s.data.state=fs)}for(c=q_;c;c=c.next)if(c.data){var L=c.data.actor.position.x,A=c.data.actor.position.y,C=Yn(c.data.actor).width,H=Yn(c.data.actor).height;if(lu(L,A,C,H,$_)||c.data.always_active){if(op&&op.actor&&op.actor.input.enabled&&(p||up||ql(c.data,K_,K_.length,n,r,q_)),c.data.obstacle){var X=void 0,Y=void 0,$=lt(c.data.actor.hot_spot,pt(0,-1)),z=Yn(c.data.actor),F=Kd(z.width,z.height-1,_t(c.data.actor.position,$),c.data.obstacle_angle);(X={}).next=a,X.data=F,a=X,(Y={}).next=n,Y.data=F,n=Y}}else c.data.preserve?lu(c.data.actor.spawn_point.x,c.data.actor.spawn_point.y,C,H,$_)||(c.data.actor.position=pt(c.data.actor.spawn_point.x,c.data.actor.spawn_point.y)):c.data.state=fs}if(_u()&&op&&op.actor){var V,q=op.actor,Q=[q.position.x,q.position.y,q.position.x+1,q.position.y+1],K=[sp.rect_x,sp.rect_y,sp.rect_x+sp.rect_w,sp.rect_y+sp.rect_h];if(p||function(t,e,n){var a=t.actor,i=null,o=null,r=null,s=null,c=null,p=null,l=null,_=null,d=[],u=Qn(a,2,-2,n,i,o,r,s,c,p,l,_);i=u.up,o=u.upright,r=u.right,s=u.downright,c=u.down,p=u.downleft,l=u.left,_=u.upleft;var f=Jn(a,-2,i,o,r,s,c,p,l,_);if(i=f.up,o=f.upright,r=f.right,s=f.downright,c=f.down,p=f.downleft,l=f.left,_=f.upleft,d[0]=i,d[1]=o,d[2]=r,d[3]=s,d[4]=c,d[5]=p,d[6]=l,d[7]=_,wd())switch(t.hp<=0&&1!=t.state&&(kd(),t.state=1),t.type){case 0:!function(t,e,n,a){var i=dd(),o=.001*J(),r=t.actor,s=t.value[0],c=t.value[1];if(1==t.state){if(t.bring_to_front=!0,zn(r,dn("SD_SIMPLEBOSS",2)),r.position.y+=100*Z(),o>=c+.15){var p=pt(r.position.x-r.hot_spot.x+at(Yn(r).width),r.position.y-r.hot_spot.y+at(Yn(r).height));Ed(bs,p),r.position.y<=r.spawn_point.y+406.5&&W(qe("boss hit")),c=o}}else r.maxspeed=200-100/t.initial_hp*t.hp,r.acceleration=r.maxspeed,r.position.x<r.spawn_point.x-200&&(t.direction=1),r.position.x>r.spawn_point.x&&(t.direction=3),1==t.direction?Te(r.input,3):3==t.direction&&Te(r.input,4),r.position.y=r.spawn_point.y+20*Math.cos(v*o),r.mirror=1==t.direction?0:w,Wn(r,ea(r)),o>=s+2/t.initial_hp*t.hp&&(Md([0,3][parseInt(at(2),10)],r.position).actor.speed.y=-150-at(50),s=o),X_(t,e)&&r.animation==dn("SD_SIMPLEBOSS",0)&&(zn(r,dn("SD_SIMPLEBOSS",1)),W(qe("boss hit")),i.actor.speed.x*=-1,i.actor.speed.y=100,t.hp--),Fn(r)&&zn(r,dn("SD_SIMPLEBOSS",0)),t.value[0]=s,t.value[1]=c}(t,e);break;case 1:!function(t,e,n,a){var i,o=dd(),r=t.actor,s=.001*J(),c=Z(),p=t.value[0],l=t.value[1],_=t.value[2];switch(t.state){case 0:if(t.direction=o.actor.position.x<r.position.x?3:1,r.position.y=r.spawn_point.y+30*Math.cos(v*s),Fn(r)&&actor.change_animation(r,dn("SD_MECHASHADOW",0)),s>=p+5){var d,u=pt(o.actor.position.x-r.position.x,o.actor.position.y-r.position.y);u=dt(ht(u),200),(d=Ed(40,r.position)).dangerouspower_set_speed(d,u),W(qe("big shot")),p=s}if(s>=l+15){var f=t.rect_x+t.rect_w/2;t.direction=r.position.x>f?3:1,zn(r,dn("SD_MECHASHADOW",2)),t.state=2,l=s}break;case 2:var h=t.rect_x+100,g=t.rect_x+t.rect_w-100,m=g-h+(r.position.x-h),b=3==t.direction?-1:1;r.position.x+=200*b*c,r.position.y=r.spawn_point.y-100*Math.sin(v/(g-h)*m),Fn(r)&&zn(r,dn("SD_MECHASHADOW",2)),(-1==b&&r.position.x<=h||1==b&&r.position.x>=g)&&(zn(r,dn("SD_MECHASHADOW",0)),t.state=0);break;case 1:if(t.bring_to_front=!0,zn(r,dn("SD_MECHASHADOW",4)),r.position.y+=100*Z(),s>=_+.15){var y=pt(r.position.x-r.hot_spot.x+at(Yn(r).width),r.position.y-r.hot_spot.y+at(Yn(r).height));Ed(bs,y),r.position.y<=r.spawn_point.y+406.5&&W(qe("boss hit")),_=s}}i=r.animation==dn("SD_MECHASHADOW",1)||r.animation==dn("SD_MECHASHADOW",3),X_(t,e)&&!i&&1!=t.state&&(r.animation=dn("SD_MECHASHADOW",2==t.state?3:1),W(qe("boss hit")),t.hp--,o.actor.speed.x*=-.5,o.actor.speed.y=o.actor.jump_strength),r.mirror=1==t.direction?0:w}(t,e);break;case 2:!function(t,e,n,a){var i=dd(),o=.001*J(),r=t.actor,s=t.value[0],c=t.value[1],p=t.value[2];if(1==t.state){if(t.bring_to_front=!0,zn(r,dn("SD_SIMPLEBOSS",2)),r.position.y+=100*Z(),o>=c+.15){var l=pt(r.position.x-r.hot_spot.x+at(Yn(r).width),r.position.y-r.hot_spot.y+at(Yn(r).height));Ed(bs,l),r.position.y<=r.spawn_point.y+406.5&&W(qe("boss hit")),c=o}}else r.maxspeed=200-100/t.initial_hp*t.hp,r.acceleration=r.maxspeed,r.position.x<r.spawn_point.x-200&&(t.direction=1),r.position.x>r.spawn_point.x&&(t.direction=3),1==t.direction?Te(r.input,3):3==t.direction&&Te(r.input,4),r.position.y=r.spawn_point.y+20*Math.cos(v*o),r.mirror=1==t.direction?0:w,Wn(r,ea(r)),o>=s+2/t.initial_hp*t.hp&&(Md(["9","6"][parseInt(at(2),10)],r.position).actor.speed.y=-150-at(50),s=o),o>=p+3/t.initial_hp*t.hp&&(Ed(41,r.position).actor.speed.y=100,W(qe("fire")),p=o),X_(t,e)&&r.animation==dn("SD_SIMPLEBOSS",0)&&(zn(r,dn("SD_SIMPLEBOSS",1)),W(qe("boss hit")),i.actor.speed.x*=-1,i.actor.speed.y=100,t.hp--),Fn(r)&&zn(r,dn("SD_SIMPLEBOSS",0)),t.value[0]=s,t.value[1]=c,t.value[2]=p}(t,e);break;case 3:!function(t,e,n,a){var i,o=dd(),r=t.actor,s=.001*J(),c=Z(),p=t.value[0],l=t.value[1],_=t.value[2],d=t.value[3];switch(t.state){case 0:if(t.direction=o.actor.position.x<r.position.x?3:1,r.position.y=r.spawn_point.y+30*Math.cos(v*s),Fn(r)&&zn(r,dn("SD_MECHASHADOW",0)),s>=p+4){var u,f=pt(o.actor.position.x-r.position.x,o.actor.position.y-r.position.y);f=dt(ht(f),200),(u=Ed(40,r.position)).dangerouspower_set_speed(u,f),W(qe("big shot")),p=s}if(s>=l+8){var h=t.rect_x+t.rect_w/2;t.direction=r.position.x>h?3:1,zn(r,dn("SD_MECHASHADOW",2)),t.state=2,l=s}break;case 2:var g=t.rect_x+100,m=t.rect_x+t.rect_w-100,b=m-g+(r.position.x-g),y=3==t.direction?-1:1;r.position.x+=200*y*c,r.position.y=r.spawn_point.y-100*Math.sin(v/(m-g)*b),s>=d+.2&&(Ed(41,r.position).actor.speed.y=-200,W(qe("fire")),d=s),Fn(r)&&zn(r,dn("SD_MECHASHADOW",2)),(-1==y&&r.position.x<=g||1==y&&r.position.x>=m)&&(zn(r,dn("SD_MECHASHADOW",0)),t.state=0);break;case 1:if(t.bring_to_front=!0,zn(r,dn("SD_MECHASHADOW",4)),r.position.y+=100*Z(),s>=_+.15){var x=pt(r.position.x-r.hot_spot.x+at(Yn(r).width),r.position.y-r.hot_spot.y+at(Yn(r).height));Ed(bs,x),r.position.y<=r.spawn_point.y+406.5&&W(qe("boss hit")),_=s}}i=r.animation==dn("SD_MECHASHADOW",1)||r.animation==dn("SD_MECHASHADOW",3),X_(t,e)&&!i&&1!=t.state&&(r.animation=dn("SD_MECHASHADOW",2==t.state?3:1),W(qe("boss hit")),t.hp--,o.actor.speed.x*=-.5,o.actor.speed.y=o.actor.jump_strength),r.mirror=1==t.direction?0:w,t.value[0]=p,t.value[1]=l,t.value[2]=_,t.value[3]=d}(t,e)}}(sp,K_,F_),!H_(sp)&&ot(Q,K)&&(cp=!0,pp=!0),!H_(sp))for(t=0;t<K_.length;t++)(K_[t]!=op||op.actor.carrying)&&((V=K_[t].actor).position.x>sp.rect_x-30&&V.position.x<sp.rect_x&&(V.position.x=sp.rect_x-30,V.speed.x=0),V.position.x>sp.rect_x+sp.rect_w&&V.position.x<sp.rect_x+sp.rect_w+30&&(V.position.x=sp.rect_x+sp.rect_w+30,V.speed.x=0));(H_(sp)||op.dying)&&(cp=!1,tp&&(U(B()-.5*d),B()<m&&(G(),U(1),ep=!0)))}for(t=0;t<K_.length;t++)Le(K_[t].actor.input);for(op&&op.actor&&Zc>=3.5&&Re(op.actor.input),t=0;t<K_.length;t++){var tt=K_[t].actor.position.x,et=K_[t].actor.position.y,nt=Yn(K_[t].actor).width,rt=Yn(K_[t].actor).height,st=K_[t].actor.hot_spot.y;if(t!=rp&&(K_[t].getting_hit&&qd(t),K_[t].dying&&(qd(t),Z_!=K_[t].actor&&Fa(K_[t].actor.position,0))),K_[t].dead){if(!(ki()>1))return ze(),void $e(Bh(Oh));if(Et())return Ei(ki()-1),void Pd();jt(on(0,0,0),1)}if(bp){if(Et())return void ze();jt(on(0,0,0),1)}(lu(tt,et,nt,rt,$_/4)||K_[t].dying)&&(!p||K_[t].dying||K_[t].getting_hit)&&hi(K_[t],K_,n),K_[t].actor.position.y<st&&!K_[t].dying?(K_[t].actor.position.y=st,K_[t].actor.speed.y=0):K_[t].actor.position.y>Kc-(rt-st)&&lu(tt,et,nt,rt,$_/4)&&yi(K_[t])}if(p||up||(Zc+=Z()/1e3,op&&Oe(op.actor.input,6)&&(!(Math.abs(op.actor.speed.y)<m)||op.on_moveable_platform||cp||op.disable_movement||op.in_locked_area?W(qe("deny")):qd((rp+1)%3))),_u()&&cp){var ct=op.actor;ct&&(ct.position.x<sp.rect_x?(ct.position.x=sp.rect_x,ct.speed.x=Math.max(0,ct.speed.x)):ct.position.x>sp.rect_x+sp.rect_w&&(ct.position.x=sp.rect_x+sp.rect_w,ct.speed.x=Math.min(ct.speed.x,0)),ct.position.y=it(ct.position.y,sp.rect_y,sp.rect_y+sp.rect_h))}for(Yd(n),i=n;i;i=i.next){if(i.data&&2==i.data.brick_ref.behavior){var ut=i.data.brick_ref.image.width,bt=i.data.brick_ref.image.height,yt=[i.data.x,i.data.y,i.data.x+ut,i.data.y+bt],xt=[i.data.x,i.data.y,i.data.x+ut,i.data.y+bt];for(t=0;t<K_.length;t++)if(K_[t]&&(yt[0]=K_[t].actor.position.x-K_[t].actor.hot_spot.x-3,yt[1]=K_[t].actor.position.y-K_[t].actor.hot_spot.y-3,yt[2]=yt[0]+Yn(K_[t].actor).width+6,yt[3]=yt[1]+Yn(K_[t].actor).height+6,(K_[t].spin_dash||K_[t].spin||2==K_[t].type)&&ot(yt,xt))){var vt,wt,kt=void 0,St=void 0;for(wt=Math.max(i.data.brick_ref.behavior_arg[0],1),vt=Math.max(i.data.brick_ref.behavior_arg[1],1),kt=0;kt<wt;kt++)for(St=0;St<vt;St++){var Mt=pt(i.data.x+kt*ut/wt,i.data.y+St*bt/vt),It=pt(.3*-K_[t].actor.speed.x,-100-at(50)),Ot=tn(ut/wt,bt/vt);Math.abs(It.x)>m&&(It.x+=(It.x>0?1:-1)*at(50)),Id(Ot,Mt,It,!1)}W(qe("break")),i.data.state=1}}if(i.data&&3==i.data.brick_ref.behavior&&2==i.data.state){var Dt=i.data;if(Dt.value[1]+=Z(),Dt.value[1]>=1){var Tt,Nt,Ct=void 0,Gt=void 0,Ut=0!=parseInt(Dt.brick_ref.behavior_arg[2],10),Bt=Dt.brick_ref.image;for(Tt=Math.max(Dt.brick_ref.behavior_arg[0],1),Nt=Math.max(Dt.brick_ref.behavior_arg[1],1),Ct=0;Ct<Tt;Ct++)for(Gt=0;Gt<Nt;Gt++){var Ht=pt(Dt.x+Ct*Bt.width/Tt,Dt.y+Gt*Bt.height/Nt),Xt=pt(0,20+20*Gt+20*(Ut?Ct:Tt-Ct)),Wt=tn(Bt.width/Tt,Bt.height/Nt);Id(Wt,Ht,Xt,!1)}W(qe("break")),Dt.state=1}}cu(i.data)}for(i=a;i;i=o)o=i.next,su(i.data),i=null;if(a=null,eu(n),au(r),op&&op.actor&&pu(op.actor),up)Fa(lt(Z_.position,pt(0,-90)),.17);else if(cp){var Yt=[sp.rect_x+240,sp.rect_x+sp.rect_w-240],$t=pt(it(Z_.position.x,Yt[0],Yt[1]),Z_.position.y);Fa(lt($t,pt(0,-90)),.17)}else p||Fa(Z_.position,.1);!function(){var t,e=Z();Qa(),t=_t(za.dest,za.position),ft(t)>10&&(t=ht(t),za.position.x+=t.x*za.speed*e,za.position.y+=t.y*za.speed*e),t=_t(za.dest_region_topleft,za.region_topleft),ft(t)>10&&(t=ht(t),za.region_topleft.x+=t.x*za.region_topleft_speed*e,za.region_topleft.y+=t.y*za.region_topleft_speed*e),t=_t(za.dest_region_bottomright,za.region_bottomright),ft(t)>10&&(t=ht(t),za.region_bottomright.x+=t.x*za.region_bottomright_speed*e,za.region_bottomright.y+=t.y*za.region_bottomright_speed*e)}()}zd()},pd=function(){if(It(),h_())return e=_t(p_,pt(240,135.5)),Oc.width,Oc.height,function(){if(f_){var t,e,n,a,i=_t(p_,pt(240,135.5));for(n=tn(1,1),a=on(0,128,160),rn(n,0,0,0),t=0;t<n.height;t++)an(0,Tt(),n.width-1,t,a);for(t=0;t<n.width;t++)an(0,Tt(),t,n.height-1,a);for(t=0;t<=480;t++)for(e=0;e<=271;e++)_t(T_(pt(t*n.width,e*n.height)),i);sn(n)}}(),Td(),j_(Rc,__,_t(T_(l_),e)),t=un(dn("SD_ARROW",0),0),nn(t.data,Tt(),t.sx,t.sy,parseInt(l_.x,10),parseInt(l_.y,10),t.width,t.height),_a(Ac,pt(240,135.5)),void _a(Nc,pt(240,135.5));var t,e;Ma(ip,Va()),Gd(),Ia(ip,Va()),Bd()},ld=function(){var t;for(R("level_release()"),sn(ap),Nd(),t=0;t<K_.length;t++)K_[t];for(R("editor_release()"),O_(),function(){var t;for(t=0;t<Ec;t++)n_[t]=o_(n_[t]);Ec=0}(),Me(Lc),Me(Tc),Me(Dc),r_=!1,Rc=2,__=0,R("editor_release() ok"),Bn(_p),Bn(lp),t=0;t<K_.length;t++)J_[t];for(Bn(jp),Bn(Ep),Bn(Sp),t=0;t<3;t++)ed[t],Bn(nd[t]);Bn(Dp),R("level_release() ok")},_d=function(){return h_()},dd=function(){return op},ud=function(){return rp},fd=function(t){var e;t=Math.max(0,t),Mi(Si()+t),(e=Ed(13,lt(op.actor.position,pt(-9,0)))).set_text(e,t)},hd=function(){return pt(Qc,Kc)},gd=function(t){tp&&G(),W(t)},md=function(t){Jc=pt(t.x,t.y)},bd=function(t){var e;if(!up){for(up=!0,fp=J(),td=10*wi(),vp+=td,e=0;e<K_.length;e++)K_[e]&&K_[e].got_glasses&&yd(5e3);for(Mi(Si()+vp),e=0;e<K_.length;e++)K_[e]&&(Le(K_[e].actor.input),K_[e].spin_dash=!1);for(pu(t),vd(),(wp=sa(wp,"TEAM SONIC")).position=pt(-500,20),(kp=sa(kp,"GOT THROUGH")).position=pt(-500,46),(Sp=zn(Sp,dn("SD_LEVELACT",Vc-1))).position=pt(820,25),e=0;e<3;e++)nd[e].position=pt(-500,120+20*e),ed[e].position=pt(820,120+20*e);nd[0]=zn(nd[0],dn("SD_RINGBONUS",0)),nd[1]=zn(nd[1],dn("SD_SECRETBONUS",0)),nd[2]=zn(nd[2],dn("SD_TOTAL",0))}},yd=function(t){xp+=t,vp+=t},xd=function(t,e){(!Ip||ca(Tp)||ca(Lp))&&(Ip=!0,Op=J(),sa(Tp,t),sa(Lp,e),la(Lp,260))},vd=function(){Ip=!1},wd=function(){return pp},kd=function(){var t,e;for(t=q_;t;t=t.next)(e=t.data)&&(e.state=1)},Sd=function(){return qc},jd=function(t,e){var n,a;for((a={}).data={},a.data.brick_ref=Mn(t),a.data.animation_frame=0,a.data.x=a.data.sx=parseInt(e.x,10),a.data.y=a.data.sy=parseInt(e.y,10),a.data.enabled=!0,a.data.state=0,a.data.value=[],n=0;n<3;n++)a.data.value[n]=0;return Jd(a),a.data},Ed=function(t,e){var n={};return n.data=ks(t),n.data&&(n.data.actor.spawn_point=pt(e.x,e.y),n.data.actor.position=pt(e.x,e.y)),n.next=V_,V_=n,n.data},Md=function(t,e){var n,a=pt(e.x,e.y);return(n={}).data=Vl(t),n.data.actor.spawn_point=pt(a.x,a.y),n.data.actor.position=pt(a.x,a.y),n.next=q_,q_=n,n.data},Id=function(t,e,n,a){var i,o;h_()?sn(t):((i={}).image=t,i.position=e,i.speed=n,i.destroy_on_brick=a,(o={}).data=i,o.next=Q_,Q_=o)},Od=function(t,e){var n,a,i,o,r,s;return t?(n=t.value[0],1===t.brick_ref.behavior?(a=t.brick_ref.behavior_arg[0],i=t.brick_ref.behavior_arg[1],o=t.brick_ref.behavior_arg[2]*(2*v),r=t.brick_ref.behavior_arg[3]*(2*v),s=t.brick_ref.behavior_arg[4]*v/180,pt(-a*o*Math.sin(o*n+s),i*r*Math.cos(r*n+s))):pt(0,0)):pt(0,0)},Dd=function(t){return Ed(15,t)},Td=function(){Gd()},Ld=function(){return F_},Rd=function(t){return Cd(t)},Ad=function(){Qd()},Nd=function(){var t,e,n,a,i,o;for(R("level_unload()"),tp.pause(),R("releasing brick list..."),t=F_;t;t=e)e=t.next,t.data=null,t=null;for(F_=null,R("releasing item list..."),n=V_;n;n=a)a=n.next,n.data,n=null;for(V_=null,R("releasing enemy list..."),i=q_;i;i=o)o=i.next,i.data,i=null;q_=null,_u()&&(R("releasing the boss..."),function(t){Bn(t.actor)}(sp),sp=null),R("unloading the brickset..."),R("unloading the background..."),R("level_unload() ok")},Cd=function(t){var e;for(e=0;e<In();e++)if(t.brick_ref==Mn(e))return e;return-1},Pd=function(){var t=Jc;ld(),sd(),Jc=t},Gd=function(){var t,e,n,a,i={};for(e=t=tu();e;e=e.next)e.data&&e.data.brick_ref.zindex<.5&&(e.data=On(e.data),i=Dn(e.data),Tt().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,e.data.x-(parseInt(Va().x,10)-240),e.data.y-(parseInt(Va().y,10)-135.5),1*i.width,1*i.height));for(Ud(!0),e=t;e;e=e.next)if(e.data){var o=e.data.brick_ref;Math.abs(o.zindex-.5)<m&&1!=o.property&&(e.data=On(e.data),i=Dn(e.data),Tt().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,e.data.x-(parseInt(Va().x,10)-240),e.data.y-(parseInt(Va().y,10)-135.5),1*i.width,1*i.height))}for(n=V_;n;n=n.next)n.data&&n.data.bring_to_back&&js(n.data,Va());for(e=t;e;e=e.next)if(e.data){var r=e.data.brick_ref;Math.abs(r.zindex-.5)<m&&1==r.property&&(e.data=On(e.data),i=Dn(e.data),Tt().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,e.data.x-(parseInt(Va().x,10)-240),e.data.y-(parseInt(Va().y,10)-135.5),1*i.width,1*i.height))}for(_u()&&!sp.bring_to_front&&B_(sp,Va()),a=q_;a;a=a.next)Ql(a.data,Va());for(Ud(!1),_u()&&sp.bring_to_front&&B_(sp,Va()),n=V_;n;n=n.next)n.data&&js(n.data,Va());for($d(),e=t;e;e=e.next)e.data&&e.data.brick_ref.zindex>.5&&(e.data=On(e.data),i=Dn(e.data),Tt().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,e.data.x-(parseInt(Va().x,10)-240),e.data.y-(parseInt(Va().y,10)-135.5),1*i.width,1*i.height));eu(t)},Ud=function(t){if(op){var e;for(e=K_.length-1;e>=0;e--)K_[e]!=op&&!!K_[e].bring_to_back==t&&gi(K_[e],Va());!!op.bring_to_back==t&&gi(op,Va())}},Bd=function(){var t,e=pt(240,135.5);if(up)for(Hn(Sp,e),_a(wp,e),_a(kp,e),t=0;t<3;t++)Hn(nd[t],e),_a(ed[t],e);else{for(Hn(lp,e),Hn(_p,e),_a(dp,e),t=0;t<3;t++)_a(J_[t],e);Hd()}Zc<2.5&&It("rgb(0,0,0)"),Hn(jp,e),Hn(Ep,e),_a(Mp,e),Xd(e)},Hd=function(){var t,e=[],n=[],a=0,i=.001*J();for(t=0;t<10;t++)n[t]=!0;if(op){switch(op.got_glasses&&(e[a++]=un(dn("SD_ICON",6),0)),op.shield_type){case 1:e[a++]=un(dn("SD_ICON",7),0);break;case 2:e[a++]=un(dn("SD_ICON",11),0);break;case 3:e[a++]=un(dn("SD_ICON",12),0);break;case 4:e[a++]=un(dn("SD_ICON",13),0);break;case 5:e[a++]=un(dn("SD_ICON",14),0);break;case 6:e[a++]=un(dn("SD_ICON",15),0)}if(op.invincible&&(e[a++]=un(dn("SD_ICON",4),0),op.invtimer>=17.25)){var o=(23-op.invtimer)/5.75;n[a-1]=Math.sin(.5*v*i/(o+.1))>=0}if(op.got_speedshoes&&(e[a++]=un(dn("SD_ICON",5),0),op.speedshoes_timer>=17.25)){var r=(23-op.speedshoes_timer)/5.75;n[a-1]=Math.sin(.5*v*i/(r+.1))>=0}}for(t=0;t<a;t++)n[t]&&nn(e[t].data,Tt(),e[t].sx,e[t].sy,gt-(e[t].width+5)*(t+1),5,e[t].swidth,e[t].sheight)},Xd=function(t){Hn(Dp,t),_a(Tp,t),_a(Lp,t)},Wd=function(){Q_=null},Yd=function(t){var e,n,a,i,o,r=Z(),s=qc,c=null;for(a=Q_;a;a=i)if(o=a.data){if(n=lu(o.position.x,o.position.y,o.position.x+o.image.width,o.position.y+o.image.height,$_),e=!1,o.destroy_on_brick&&n&&o.speed.y>0){var p=[o.position.x,o.position.y,o.position.x+o.image.width,o.position.y+o.image.height],l=void 0;for(l=t;l&&!e;l=l.next){var _=l.data;if(_&&1==_.brick_ref.property&&0==_.brick_ref.angle){var d=[_.x,_.y,_.x+_.brick_ref.image.width,_.y+_.brick_ref.image.height];ot(p,d)&&(e=!0)}}}!n||e?c?c.next=i:Q_=i:(o.position.x+=o.speed.x*r,o.position.y+=o.speed.y*r+.5*s*(r*r),o.speed.y+=s*r,c=a)}},$d=function(){var t,e,n,a,i,o,r=pt(Va().x-240,Va().y-135.5);for(t=Q_;t;t=t.next)(e=t.data)&&(n=e.image,a=Tt(),i=parseInt(e.position.x-r.x,10),o=parseInt(e.position.y-r.y,10),a.putImageData(n,i,o))},zd=function(){null==tp||up||ep||H()||P(tp,!0)},Fd=function(){if(Dp){var t=Z(),e=J();if(Ip){if(e>=Op+7e3)return void(Ip=!1);Dp.position.x=(gt-Yn(Dp).width)/2,Dp.position.y=Math.max(Dp.position.y-100*t,mt-1.3*Yn(Dp).height)}else Dp.position.y=Math.min(Dp.position.y+100*t,mt);Tp.position=lt(Dp.position,pt(2,10)),Lp.position=lt(Dp.position,pt(2,23))}},Vd=function(){if(op&&op.actor){var t,e=[],n=[];if(!(Zc<2))for(e[0]=op.actor.position.x,e[1]=op.actor.position.y,e[2]=e[0]+Yn(op.actor).width,e[3]=e[1]+Yn(op.actor).height,t=0;t<Rp;t++)if(!ad[t].disabled&&(n[0]=ad[t].rect_x,n[1]=ad[t].rect_y,n[2]=n[0]+ad[t].rect_w,n[3]=n[1]+ad[t].rect_h,ot(e,n))){ad[t].disabled=!0,xd(ad[t].title,ad[t].message);break}}},qd=function(t){op.spin_dash=op.braking=!1,K_[rp=t]&&(op=K_[rp],pu(op.actor),Re(op.actor.input))},Qd=function(){var t,e;for(t=0;t<K_.length;t++)e=parseInt(Jc.x,10)<=Qc/2?2-t:t,K_[t].actor.mirror=parseInt(Jc.x,10)<=Qc/2?0:w,K_[t].actor.spawn_point.x=K_[t].actor.position.x=Jc.x+15*e,K_[t].actor.spawn_point.y=K_[t].actor.position.y=Jc.y},Kd=function(t,e,n,a){var i,o={},r={data:null};for(r.image=tn(t,e),r.angle=a,r.property=1,r.behavior=0,r.zindex=.5,r.behavior_arg=[],i=0;i<5;i++)r.behavior_arg[i]=0;for(o.brick_ref=r,o.animation_frame=0,o.enabled=!0,o.x=o.sx=parseInt(n.x,10),o.y=o.sy=parseInt(n.y,10),o.value=[],i=0;i<3;i++)o.value[i]=0;return o},Zd=function(t,e){var n=t.brick_ref,a=e.brick_ref;if(!n||!a)return!1;if(n.zindex<a.zindex)return-1;if(n.zindex>a.zindex)return 1;if(n.property!=a.property){var i=[0,100,50];return i[n.property]-i[a.property]}return n.angle%180!=0&&a.angle%180==0?-1:n.angle%180==0&&a.angle%180!=0?1:t.sy-e.sy},Jd=function(t){var e;if(F_)if(Zd(t.data,F_.data)>=0)t.next=F_,F_=t;else{for(e=F_;e.next&&Zd(e.next.data,t.data)>0;)e=e.next;t.next=e.next,e.next=t}else t.next=null,F_=t},tu=function(){var t,e,n,a,i,o,r=[];for(t=F_;t;t=t.next)t.data&&t.data.brick_ref&&t.data.brick_ref.image&&(n=Math.min(t.data.x,t.data.sx),a=Math.min(t.data.y,t.data.sy),i=t.data.brick_ref.image.width,o=t.data.brick_ref.image.height,(lu(n,a,i,o,2*$_)||1==t.data.brick_ref.behavior)&&((e={}).data=t.data,e.next=r,r=e));return r},eu=function(t){for(var e;t;)e=t.next,t=null,t=e},nu=function(){var t,e,n,a,i,o,r,s=null;for(t=V_;t;t=t.next)t.data&&(r=Yn(t.data.actor))&&(n=parseInt(t.data.actor.position.x,10),a=parseInt(t.data.actor.position.y,10),i=r.width,o=r.height,lu(n,a,i,o,$_)&&((e={}).data=t.data,e.next=s,s=e));return s},au=function(t){for(var e;t;)e=t.next,t=null,t=e},iu=function(){var t,e;if(V_)for(V_.data&&V_.data.state==fs&&(e=V_.next,V_.data,V_=e),t=V_;t&&t.next;t=t.next)t.next&&t.next.data&&t.next.data.state==fs&&(e=t.next,t.next=e.next,e.data,e=null)},ou=function(){var t,e;if(q_)for(q_&&q_.data&&q_.data.state==Zl&&(e=q_.next,q_.data,q_=null,q_=e),t=q_;t&&t.next;t=t.next)t&&t.next&&t.next.data&&t.next.data.state==Zl&&(e=t.next,t.next=e.next,e.data,e=null)},ru=function(){var t,e;if(F_)for(F_.data&&1==F_.data.state&&(e=F_.next,F_.data=null,F_=null,F_=e),t=F_;t&&t.next;t=t.next)1==t.next.data.state&&(e=t.next,t.next=e.next,e.data=null,e=null)},su=function(t){sn(t.brick_ref.image),t.brick_ref=null,t=null},cu=function(t){var e,n,a,i,o,r;t&&(t.value[0]+=Z(),e=t.value[0],1===t.brick_ref.behavior)&&(n=t.brick_ref.behavior_arg[0],a=t.brick_ref.behavior_arg[1],i=t.brick_ref.behavior_arg[2]*(2*v),o=t.brick_ref.behavior_arg[3]*(2*v),r=t.brick_ref.behavior_arg[4]*v/180,t.x=t.sx+Math.round(n*Math.cos(i*e+r)),t.y=t.sy+Math.round(a*Math.sin(o*e+r)))},pu=function(t){Z_={position:{x:t.position.x,y:t.position.y}}},lu=function(t,e,n,a,i){var o=Va(),r=[t,e,t+n,e+a],s=[o.x-240-i,o.y-135.5-i,o.x+240+i,o.y+135.5+i];return ot(r,s)},_u=function(){return null!=sp},du=function(t){return Wc="Untitled",Yc="",$c="",zc="",Fc="",Jc=pt(0,0),Rp=0,sp=null,Vc=1,new Promise((function(e,n){R('level_load("%s")'),D(t).then(uu).then((function(){tp=C(Yc),function(){var t,e,n;for(t=e=-99999999,n=F_;n;n=n.next)n.data&&n.data.brick_ref&&"BRK_NONE"!=n.data.brick_ref.property&&(t=Math.max(t,n.data.sx+Dn(n.data).width),e=Math.max(e,n.data.sy+Dn(n.data).height));Qc=Math.max(t,gt),Kc=Math.max(e,mt)}(),R("level_load() ok"),e()}))}))},uu=function(t){var e;for($c=t.theme,zc=t.bgtheme,Fc=t.grouptheme,Yc=t.music,Wc=t.name,t.author,t.version,t.requires,Vc=t.act,Jc=t.spawn_point,t.readonly,t.boss&&(sp=function(t,e,n,a,i,o){var r,s,c={};for(c.type=t,c.state=0,c.rect_x=n,c.rect_y=a,c.rect_w=i,c.rect_h=o,c.value=[],r=0;r<10;r++)c.value[r]=0;switch(c.bring_to_front=!1,c.actor=s=Un(),s.spawn_point=pt(e.x,e.y),s.position=pt(e.x,e.y),s.input=Se(),t){case 0:case 2:zn(s,dn("SD_SIMPLEBOSS",0)),c.initial_hp=c.hp=3,c.direction=3,s.maxspeed=100,s.acceleration=100;break;case 1:case 3:zn(s,dn("SD_MECHASHADOW",0)),c.initial_hp=c.hp=10,c.direction=3,s.maxspeed=100,s.acceleration=100}return c}(t.boss.id,pt(t.boss.x,t.boss.y),t.boss.rx,t.boss.ry,t.boss.rw,t.boss.rh),console.log("BOSS",sp)),e=0;e<t.dialogbox.length;e++){var n={disabled:!1};n.rect_x=t.dialogbox[e].xpos,n.rect_y=t.dialogbox[e].ypos,n.rect_w=t.dialogbox[e].width,n.rect_h=t.dialogbox[e].height,n.title=Xe(t.dialogbox[e].title),n.message=Xe(t.dialogbox[e].message),ad.push(n),Rp=ad.length}for(e=0;e<t.enemylist.length;e++)Md(t.enemylist[e].id,pt(t.enemylist[e].xpos,t.enemylist[e].ypos));return new Promise((function(n,a){var i;(i=t.theme,new Promise((function(t,e){R("brickdata_load('%s')"),D(i).then(Tn).then((function(t){En=t})).then(t)}))).then((function(a){for(var i=0;i<t.bricklist.length;i++)jd(t.bricklist[i].id,pt(t.bricklist[i].xpos,t.bricklist[i].ypos));Sa(t.bgtheme).then((function(a){for(ip=a,e=0;e<t.itemlist.length;e++)V_[e]=Ed(t.itemlist[e].id,pt(t.itemlist[e].xpos,t.itemlist[e].ypos));n()}))}))}))},fu=function(t){return new Promise((function(e,n){var a={};R("load_quest('%s')"),a.file=t,a.name="",a.author="",a.version="",a.description="",a.image=null,a.level_count=0,a.show_ending=!1,D(t).then(hu).then((function(t){t&&(a=t),R("load_quest() ok!"),e(a)}))}))},hu=function(t){return new Promise((function(e,n){var a={};a.name=t.name||"",a.author=t.author||"Open Sonic",a.version=t.version||"0",a.description=t.description||"",a.show_ending=t.show_ending||!1,a.level_count=t.levels?t.levels.length:0,a.level_path=t.levels||[],function(t){return new Promise((function(e,n){var a=t||"data/images/null.png";en(a=""+a).then((function(t){e(t)}))}))}(t.image).then((function(t){a.image=t,e(a)}))}))},gu={TOTALTIME:0,BIGRINGS:0,GLASSES:0},mu=function(){var t;for(Cp=!1,t=0;t<3;t++)gu[t]=0},bu=function(){return 0==Ap.level_count?(R("Quest '%s' has no levels.",Ap.file),void game_quit()):Np<Ap.level_count&&!Cp?(id(Ap.level_path[Np]),$e(Bh(Mh)),void Np++):(ze(),void(Cp?$e(Bh(Lh)):Ap.show_ending?$e(Bh(Th)):$e(Bh(Rh))))},yu=function(){},xu=function(){},vu=function(){Cp=!0},wu=0,ku=function(t,e){var n=it(parseInt(t,10),0,2);gu[n]=e},Su=function(t){var e=it(parseInt(t,10),0,2);return gu[e]},ju=[],Eu=function(){Pp=0,ju[0]=ra(7),ju[0].position=pt(-50,112),sa(ju[0],"GAME"),ju[1]=ra(7),ju[1].position=pt(298,112),sa(ju[1],"OVER")},Mu=function(){var t=Z();if((Pp+=t)>5){if(Et())return vu(),void ze();jt(on(0,0,0),2)}ju[0].position.x+=200*t,ju[0].position.x>80&&(ju[0].position.x=80),ju[1].position.x-=200*t,ju[1].position.x<168&&(ju[1].position.x=168)},Iu=function(){It();var t=pt(240,135.5);_a(ju[0],t),_a(ju[1],t)},Ou=function(){sn(void 0),ju[1],ju[0],vu()},Du=function(){Gp=0,Sa("data/themes/intro.bg.json").then((function(t){Up=t,St(on(0,0,0),1)}))},Tu=function(){if(Up&&(Gp+=Z(),Ea(Up),Gp>=3)){if(Et())return ze(),void $e(Bh(Lh));jt(on(0,0,0),1)}},Lu=function(){if(Up){var t=pt(240,135.5);Ma(Up,t),Ia(Up,t)}},Ru=function(){Up=null},Au=["data/languages/deutsch.json","data/languages/dutch.json","data/languages/english.json","data/languages/francais.json","data/languages/indonesian.json","data/languages/italiano.json","data/languages/polish.json","data/languages/ptbr.json"],Nu=1,Cu=[],Pu=[],Gu=function(){$p=0,Hp=!1,Vp=0,Fp=Ee(),Wp=ra(8),Cu[0]=ra(4),sa(Cu[0],"SELECT YOUR"),Cu[0].position.x=(gt-ca(Cu[0]).length*pa(Cu[0]).x)/2-140,Cu[0].position.y=10,Cu[1]=ra(4),sa(Cu[1],"LANGUAGE"),Cu[1].position.x=(gt-ca(Cu[1]).length*pa(Cu[1]).x)/2-120,Cu[1].position.y=Cu[0].position.y+pa(Cu[1]).y+10+10,Cu[2]=ra(8),sa(Cu[2],Xe("MENU_CQ_BACK")),Cu[2].position.x=10,Cu[2].position.y=mt-1.5*pa(Cu[2]).y,qp=Sa("data/themes/langselect.bg.json").then((function(t){qp=t,St(on(0,0,0),1)})),zp=Un(),zn(zp,dn("SD_TITLEFOOT",0)),Wu(),St(on(0,0,0),1)},Uu=function(){var t=Z();if(Vp+=t,Ea(qp),zp&&Pu.length&&(zp.position=pt(Pu[0][$p].position.x,Pu[0][$p].position.y),zp.position.x-=15,zp.position.x+=5*Math.cos(2*v*Vp)),!Hp&&!Mt()){if(Oe(Fp,2)&&($p=($p+1)%Xp,W(qe("choose"))),Oe(Fp,1)&&($p=(($p-1)%Xp+Xp)%Xp,W(qe("choose"))),Oe(Fp,5)||Oe(Fp,7)){if(!Yp)return;var e=Yp[$p].filepath;R('Loading language "%s", "%s"',Yp[$p].title),Be("data/languages/english.json"),Be(e),Xu(e),W(qe("select"))}Oe(Fp,8)&&(W(qe("return")),Hp=!0)}if(Bp=Math.floor(1+$p/8),Nu=Math.floor(1+Math.max(0,Xp-1)/8),sa(Wp,"page %d/%d",Bp,Nu),Wp.position.x=gt-ca(Wp).length*pa(Wp).x-10,Wp.position.y=mt-pa(Wp).y-3,!H()){var n=C("data/music/options.mp4");P(n,b)}if(Hp){if(Et())return void ze();jt(on(0,0,0),1)}},Bu=function(){var t,e=pt(240,135.5);for(It(),Ma(qp,e),Ia(qp,e),_a(Cu[0],e),_a(Cu[1],e),_a(Cu[2],e),Nu>1&&_a(Wp,e),t=8*(Bp-1);t<8*Bp;t++)Au[t]&&Pu.length>1&&_a(Pu[$p==t?1:0][t],e);Hn(zp,e)},Hu=function(){Yu(),qp=ja(),Bn(zp),Cu[0],Cu[1],Me(Fp)},Xu=function(t){var e;e=t,z.language=e,F()},Wu=function(){R("load_lang_list()"),O(Au).then((function(t){Xp=(Yp=t).length,Pu[0]=[],Pu[1]=[];for(var e=0;e<Xp;e++)Yp[e].filepath=Au[e],Pu[0][e]=ra(8),Pu[1][e]=ra(8),sa(Pu[0][e],Yp[e].LANG_LANGUAGE),sa(Pu[1][e],Yp[e].LANG_LANGUAGE),Pu[0][e].position=pt(25,75+e%8*20),Pu[1][e].position=pt(25,75+e%8*20)}))},Yu=function(){var t;for(R("unload_lang_list()"),t=0;t<Xp;t++)Pu[0][t],Pu[1][t];Pu[0]=null,Pu[1]=null,Yp=null,Xp=0},$u=["data/quests/default.json","data/quests/extra.json","data/quests/superbosses.json","data/quests/tutorial.json"],zu=3,Fu=[],Vu=[],qu=function(){var t,e;for(dl=!1,Qp=0,tl=.001*J(),el=!1,Zp=null,Kp=Ee(),Le(Kp),tf(),ml=C("data/music/title.mp4"),P(ml,!0),Jp=Sa("data/themes/menu.bg.json").then((function(t){Jp=t,St(on(0,0,0),1)})),rl=!0,sl=Un(),(sl=zn(sl,dn("SD_TITLESURGE",0))).position.x=(gt-Yn(sl).width)/2+5,sl.position.y=-15,cl=Un(),(cl=zn(cl,dn("SD_TITLEBG",0))).position.x=(gt-Yn(cl).width)/2,cl.position.y=sl.position.y+25,pl=Un(),(pl=zn(pl,dn("SD_TITLEGAMENAME",0))).position.x=(gt-Yn(pl).width)/2,pl.position.y=sl.position.y+Yn(sl).height-9,(ll=ra(8)).position=pt(3,259),sa(ll,"%s",g),(_l=ra(0)).position=pt(405,3),sa(_l,"V%d.%d.%d",1,1,1),al=0,ol=Un(),ol=zn(ol,dn("SD_TITLEFOOT",0)),(nl=[])[0]=He("MENU_1PGAME"),nl[1]=He("MENU_TUTORIAL"),nl[2]=He("MENU_CUSTOMQUESTS"),nl[3]=He("MENU_OPTIONS"),zu=nl.length,il=[],t=0;t<2;t++)for(e=0;e<zu;e++)il[e]||(il[e]=[]),il[e][t]=ra(t),il[e][t].position=pt(240-Yn(cl).width/5,pl.position.y+65+10*e),sa(il[e][t],nl[e]);Fu[0]=ra(8),Fu[0].position=pt(5,3),Fu[1]=ra(8),Fu[1].position=pt(5,258),(ul=ra(8)).position=pt(5,170),St(on(0,0,0),1.5)},Qu=function(){var t,e=.001*J();if(null!=Zp&&Et())return ze(),void $e(Zp);switch(e<=tl+2?Le(Kp):el||(Re(Kp),el=!0),Ea(Jp),Qp){case 0:rl&&Fn(sl)&&(rl=!1,sl=zn(sl,dn("SD_TITLESURGE",1)),Re(Kp)),pl.visible=!rl,ol.position.x=il[al][0].position.x-20+3*Math.cos(2*v*e),ol.position.y=il[al][0].position.y,Oe(Kp,1)&&(W(qe("choose")),al--),Oe(Kp,2)&&(W(qe("choose")),al++),al=(al%zu+zu)%zu,(Oe(Kp,5)||Oe(Kp,7))&&(W(qe("select")),Ju(al));break;case 1:for(Oe(Kp,8)&&(W(qe("return")),Qp=0),t=0;t<hl;t++)Vu[t].position=pt(30,20+t%14*10),Vu[t].visible=ef(t)==ef(fl);if(ol.position.x=10,ol.position.y=Vu[fl].position.y,Oe(Kp,1)&&(W(qe("choose")),fl--),Oe(Kp,2)&&(W(qe("choose")),fl++),fl=(fl%hl+hl)%hl,sa(Fu[0],Xe("MENU_CQ_SELECT"),ef(fl),nf()),sa(Fu[1],Xe("MENU_CQ_BACK")),sa(ul,Xe("MENU_CQ_INFO"),gl[fl].version,gl[fl].name,gl[fl].author,gl[fl].description),Oe(Kp,5)||Oe(Kp,7))return W(qe("select")),void af(gl[fl])}},Ku=function(){var t,e=pt(240,135.5);if(It(),!dl||!Et())switch(Ma(Jp,e),Ia(Jp,e),Qp){case 0:for(t=0;t<zu;t++)_a(il[t][t==al?1:0],e);Hn(ol,e),_a(ll,e),_a(_l,e),Hn(cl,e),rl&&It(),Hn(sl,e),Hn(pl,e);break;case 1:var n=gl[fl].image;for(_a(ul,e),nn(n,Tt(),0,0,gt-n.width-25,parseInt(Vu[0].position.y,10),n.width,n.height),_a(Fu[0],e),_a(Fu[1],e),t=0;t<hl;t++)_a(Vu[t],e);Hn(ol,e)}},Zu=function(){var t,e;for(ml.pause(),t=0;t<2;t++)for(e=0;e<zu;e++)il[e][t];Bn(cl),Bn(pl),Bn(sl),Bn(ol),Me(Kp)},Ju=function(t){var e=$u[0];switch(t){case 0:return void fu(e).then((function(t){af(t)}));case 1:return void fu("data/quests/tutorial.json").then((function(t){af(t)}));case 2:Qp=1,fl=0;break;case 3:return Zp=Bh(Ph),void jt(on(0,0,0),.5)}},tf=function(){var t;for(hl=$u.length,gl=[],t=0;t<hl;t++)!function(e){fu($u[t]).then((function(t){Vu[e]=ra(8),gl[e]=t,sa(Vu[e],t.name)}))}(t)},ef=function(t){return Math.floor(t/14+1)},nf=function(){return Math.floor(hl/14+(hl%14==0?0:1))},af=function(t){var e,n;Ap=e=t,Ei(5),Mi(0),R("Running quest %s, '%s'...",e.file,e.name),n=0,Np=Math.max(0,n),Zp=Bh(Dh),Le(Kp),jt(on(0,0,0),.5)},of=function t(e){var n;if(e)for(e.init(e),n=0;n<e.child_count;n++)t(e.child[n])},rf=function t(e){var n;if(e){for(n=0;n<e.child_count;n++)t(e.child[n]);e.update(e)}},sf=function t(e,n){var a;if(e){for(a=0;a<e.child_count;a++)t(e.child[a],n);e.render(e,n)}},cf=function t(e){var n,a=0;if(e){for(n=0;n<e.child_count;n++)a+=t(e.child[n]);return 1+a}return 0},pf=function(t,e,n,a){var i={};return i.init=t,i.release=e,i.update=n,i.render=a,i.font=null,i.data=null,i.parent=null,i.child_count=0,i.child=[],i},lf=function(t,e){t.child_count<10&&(t.child[t.child_count++]=e,e.parent=t)},_f=function(t){if(t.font=ra(8),sa(t.font,"LABEL"),null!=t.parent){var e,n,a=0,i=null!=t.parent.font?pa(t.parent.font):pt(12,12);for(e=0;e<t.parent.child_count&&t.parent.child[e]!=t;e++);for(n=0;n<e;n++)a+=cf(t.parent.child[n])-1;t.font.position={x:t.parent.font.position.x,y:t.parent.font.position.y},t.font.position.x+=3*i.x,t.font.position.y+=(1+a+e)*i.y*2}},df=function(t){t.font},uf=function(t,e){_a(t.font,e)},ff=function(){El=0,bl=!1,Sl=0,wl=Ee(),kl=null,yl=!0,xl=ra(4),sa(xl,Xe("OPTIONS_TITLE")),xl.position.x=140,xl.position.y=10,jl=Sa("data/themes/options.bg.json").then((function(t){jl=t})),vl=Un(),zn(vl,dn("SD_TITLEFOOT",0)),vl.position=pt(-50,-50),Ml=rh(),of(Ml)},hf=function(){var t=Z();if(Sl+=t,sa(xl,Xe("OPTIONS_TITLE")),yl&&(St(on(0,0,0),1),yl=!1),Ea(jl),bl||null!=kl||Mt()||(Oe(wl,2)&&(El=(El+1)%5,W(qe("choose"))),Oe(wl,1)&&(El=((El-1)%5+5)%5,W(qe("choose"))),Oe(wl,8)&&(W(qe("return")),bl=!0)),rf(Ml),bl)Mt()||G();else if(!H()&&Sl>=.2){var e=C("data/music/options.mp4");P(e,b)}if(bl){if(Et())return bf(),ze(),void $e(Bh(Lh));jt(on(0,0,0),1)}if(null!=kl){if(Et())return bf(),$e(kl),kl=null,void(yl=!0);jt(on(0,0,0),1)}},gf=function(){var t=pt(240,135.5);Ma(jl,t),Ia(jl,t),_a(xl,t),sf(Ml,t),Hn(vl,t)},mf=function(){Bn(vl),Me(wl)},bf=function(){var t,e,n;!function(t){z.video_resolution=t,F()}(Lt()),t=At(),z.fullscreen=t,F(),e=Rt(),z.smooth_graphics=e,F(),n=Nt(),z.show_fps=n,F()},yf=function(t,e){_f(t),t.data=e,sa(t.font,Xe(e))},xf=function(t){t.data=null,df(t)},vf=function(t){sa(t.font,Xe(t.data))},wf=function(t,e){uf(t,e)},kf=function(t,e,n){var a;_f(t),sa(t.font,Xe(e)),t.data={},(a=t.data).option_index=n,a.lang_key=e},Sf=function(t){t.data=null,df(t)},jf=function(t){var e=t.data;return El==e.option_index},Ef=function(t){var e=t.data;sa(t.font,Xe(e.lang_key)),jf(t)&&(sa(t.font,"<color=ffff00>%s</color>",Xe(e.lang_key)),vl.position=lt(t.font.position,pt(3*Math.cos(2*v*Sl)-20,0)))},Mf=function(t,e){uf(t,e)},If=function(t){_f(t),sa(t.font,""),t.font.position=pt(0,25)},Of=function(t){df(t)},Df=function(t){},Tf=function(t,e){uf(t,e)},Lf=function(t){yf(t,"OPTIONS_GRAPHICS")},Rf=function(t){xf(t)},Af=function(t){vf(t)},Nf=function(t,e){wf(t,e)},Cf=function(t){kf(t,"OPTIONS_FPS",0)},Pf=function(t){Sf(t)},Gf=function(t){Ef(t),function(t){return jf(t)}(t)&&(Mt()||((Oe(wl,5)||Oe(wl,7))&&(W(qe("select")),Ct(!Nt())),Oe(wl,3)&&Nt()&&(W(qe("select")),Ct(!1)),Oe(wl,4)&&(Nt()||(W(qe("select")),Ct(!0)))))},Uf=function(t,e){var n,a=[];Mf(t,e),(n=ra(8)).position=pt(175,t.font.position.y),a[0]=Xe("OPTIONS_YES"),a[1]=Xe("OPTIONS_NO"),Nt()?sa(n,"<color=ffff00>%s</color>  %s",a[0],a[1]):sa(n,"%s  <color=ffff00>%s</color>",a[0],a[1]),_a(n,e)},Bf=function(t){yf(t,"OPTIONS_GAME")},Hf=function(t){xf(t)},Xf=function(t){vf(t)},Wf=function(t,e){wf(t,e)},Yf=function(t){kf(t,"OPTIONS_LANGUAGE",1)},$f=function(t){Sf(t)},zf=function(t){Ef(t),function(t){return jf(t)}(t)&&(Mt()||(Oe(wl,5)||Oe(wl,7))&&(W(qe("select")),kl=Bh(Nh)))},Ff=function(t,e){Mf(t,e)},Vf=function(t){kf(t,"OPTIONS_STAGESELECT",2)},qf=function(t){Sf(t)},Qf=function(t){Ef(t),function(t){return jf(t)}(t)&&(Mt()||(Oe(wl,5)||Oe(wl,7))&&(W(qe("select")),kl=Bh(Gh)))},Kf=function(t,e){Mf(t,e)},Zf=function(t){kf(t,"OPTIONS_CREDITS",3)},Jf=function(t){Sf(t)},th=function(t){Ef(t),function(t){return jf(t)}(t)&&(Mt()||(Oe(wl,5)||Oe(wl,7))&&(W(qe("select")),kl=Bh(Ch)))},eh=function(t,e){Mf(t,e)},nh=function(t){kf(t,"OPTIONS_BACK",4)},ah=function(t){Sf(t)},ih=function(t){Ef(t),function(t){return jf(t)}(t)&&(Mt()||(Oe(wl,5)||Oe(wl,7))&&(W(qe("select")),bl=!0))},oh=function(t,e){Mf(t,e)},rh=function(){var t,e,n,a,i,o,r,s;return n=pf(Cf,Pf,Gf,Uf),e=pf(Lf,Rf,Af,Nf),lf(e,n),i=pf(Yf,$f,zf,Ff),o=pf(Zf,Jf,th,eh),r=pf(Vf,qf,Qf,Kf),a=pf(Bf,Hf,Xf,Wf),lf(a,i),lf(a,r),lf(a,o),s=pf(nh,ah,ih,oh),t=pf(If,Of,Df,Tf),lf(t,e),lf(t,a),lf(t,s),t},sh=function(){Il=Ee(),Ol=!1,Dl=!1,Tl=0},ch=function(){var t;if(Oe(Il,8))return He("CBOX_QUIT_QUESTION",t[0],sizeof(t[0])),He("CBOX_QUIT_OPTION1",t[1],sizeof(t[1])),He("CBOX_QUIT_OPTION2",t[2],sizeof(t[2])),wa(t[0],t[1],t[2]),void $e(Bh(Ah));if(1==ka()&&(Dl=!0),Dl)return Et()?(ze(),ze(),void vu()):void jt(image.rgb(0,0,0),1);if(Ol){if(Oe(Il,7))return audio.music_resume(),void ze()}else De(Il,7)&&(Ol=!0)},ph=function(){var t=un(dn("SD_PAUSE",0),0),e=1+.5*Math.abs(Math.cos(v/2*Tl));pt((gt-t.width)/2-(e-1)*t.width/2,(mt-t.height)/2-(e-1)*t.height/2),Dl||(Tl+=Z())},lh=function(){sn(void 0),Me(Il)},_h=function(){J(),Cl=!1,(Ll=ra(8)).position=pt(5,35),Rl=ra(4),sa(Rl,Xe("QUESTCLEARED_TITLE")),Rl.position=pt((parseInt(pa(Rl).x*ca(Rl)).length,10),5),Al=Un(),zn(Al,dn("SD_SONIC",24)),Al.position=pt(20,150),P(C("data/music/invincible.mp4"),0),Nl=Ee(),St(on(0,0,0),2)},dh=function(){var t=Si(),e=Su("QUESTVALUE_TOTALTIME")/3600,n=parseInt(Su("QUESTVALUE_TOTALTIME")/60%60,10),a=parseInt(Su("QUESTVALUE_TOTALTIME")%60,10),i=Su("QUESTVALUE_GLASSES"),o=Su("QUESTVALUE_BIGRINGS");if(J(),sa(Ll,Xe("QUESTCLEARED_TEXT"),"NO_QUEST_NAME",t,e,n,a,i,o,h,g),Oe(Nl,5)&&(Cl=!0),Cl){if(Et())return ze(),void $e(Bh(Lh));jt(on(0,0,0),2)}},uh=function(){var t=pt(240,135.5);It(),_a(Rl,t),_a(Ll,t),Hn(Al,t)},fh=function(){Me(Nl),Bn(Al)},hh=["data/levels/blue_ocean_1.json","data/levels/blue_ocean_2.json","data/levels/blue_ocean_3.json","data/levels/desert1.json","data/levels/exotic_1.json","data/levels/exotic_2.json","data/levels/exotic_3.json","data/levels/exotichell_1.json","data/levels/prototype.json","data/levels/superboss_1.json","data/levels/superboss_2.json","data/levels/template.json","data/levels/tutorial_1.json","data/levels/tutorial_2.json","data/levels/test.json"],gh=1,mh=[],bh=0,yh=0,xh=[],vh=function(){yh=0,Wl=0,$l=0,Xl=Ee(),Gl=ra(4),sa(Gl,Xe("STAGESELECT_TITLE")),Gl.position.x=(gt-ca(Gl).length*pa(Gl).x)/2-150,Gl.position.y=10,Ul=ra(8),sa(Ul,Xe("STAGESELECT_MSG")),Ul.position.x=10,Ul.position.y=mt-1.5*pa(Ul).y,Bl=ra(8),sa(Bl,Xe("STAGESELECT_PAGE"),0,0),Bl.position.x=gt-ca(Bl).length*pa(Bl).x-10,Bl.position.y=40,Sa("data/themes/levelselect.bg.json").then((function(t){Yl=t})),Hl=Un(),zn(Hl,dn("SD_TITLEFOOT",0)),jh(),St(on(0,0,0),1)},wh=function(){var t=Z();if(Wl+=t,Ea(Yl),xh.length){if(Hl.position=pt(xh[yh].position.x,xh[yh].position.y),Hl.position.x+=3*Math.cos(2*v*Wl)-20,Pl=Math.floor(yh/8+1),gh=Math.floor(bh/8+(bh%8==0?0:1)),sa(Bl,Xe("STAGESELECT_PAGE"),Pl,gh),Bl.position.x=gt-ca(Bl).length*pa(Bl).x-10,2==$l)Mt()||G();else if(!H()){var e=C("data/music/options.mp4");P(e,b)}switch($l){case 0:Mt()||(Oe(Xl,2)&&(yh=(yh+1)%bh,W(qe("choose"))),Oe(Xl,1)&&(yh=((yh-1)%bh+bh)%bh,W(qe("choose"))),(Oe(Xl,5)||Oe(Xl,7))&&(R('Loading level "%s", "%s"',mh[yh].name,mh[yh].filepath),id(mh[yh].filepath),W(qe("select")),$l=2),Oe(Xl,8)&&(W(qe("return")),$l=1));break;case 1:if(Et())return void ze();jt(on(0,0,0),1);break;case 2:if(Et())return Ei(5),Mi(0),$e(Bh(Mh)),void($l=3);jt(on(0,0,0),1);break;case 3:St(on(0,0,0),1),$l=0}}},kh=function(){var t,e=pt(240,135.5);for(Ma(Yl,e),Ia(Yl,e),_a(Gl,e),_a(Ul,e),gh>1&&_a(Bl,e),t=8*(Pl-1);t<8*Pl;t++)mh[t]&&(sa(xh[t],yh==t?"<color=ffff00>%s - %s %s</color>":"%s - %s %s",mh[t].name,Xe("STAGESELECT_ACT"),mh[t].act),_a(xh[t],e));Hn(Hl,e)},Sh=function(){Eh(),Yl=ja(),Bn(Hl),Me(Xl)},jh=function(){R("load_stage_list()"),O(hh).then((function(t){bh=(mh=t).length;for(var e=0;e<bh;e++)xh[e]=ra(8),xh[e].position=pt(25,60+e%8*20),mh[e].filepath=hh[e]}))},Eh=function(){},Mh=1,Ih=2,Oh=3,Dh=4,Th=5,Lh=6,Rh=7,Ah=8,Nh=9,Ch=10,Ph=11,Gh=12,Uh=[],Bh=function(t){return console.log("GET SCENE",t),Uh[t]},Hh=function(t,e,n,a){return{init:t,update:e,render:n,release:a}},Xh=function(){var t,e,n;e=function(e){var n;!function(t){var e,n;for(n=0;n<10;)n=(e=J())>q?e-q:0,q=e>=q?q:e;n=Math.min(n,16),Q=.001*n,a++,(i+=parseInt(n,10))>=1e3&&(o=a,a=0,i=0),q=J()}(),function(){var t,e,n=Z();for(e=ye;e;e=e.next){for(t=0;t<9;t++)e.data.oldstate[t]=e.data.state[t];for(t=0;t<9;t++)Ie(e.data,t)?e.data.howlong[t]+=n:e.data.howlong[t]=0;switch(e.data.type){case 1:e.data.state[1]=Wt.up,e.data.state[2]=Wt.down,e.data.state[4]=Wt.left,e.data.state[3]=Wt.right,e.data.state[5]=Wt.space,e.data.state[6]=Wt.lcontrol,e.data.state[7]=Wt.enter,e.data.state[8]=Wt.esc,e.data.state[9]=Wt.tilda;break;case 4:e.data.x=we.x,e.data.y=we.y,e.data.state[5]=ke.left,e.data.state[7]=ke.middle,e.data.state[6]=ke.right;break;case 2:for(t=0;t<9;t++)e.data.state[t]=!1;break;case 3:Ht&&!Xt&&(e.data.state[1]=joy[0].stick[0].axis[1].d1,e.data.state[2]=joy[0].stick[0].axis[1].d2,e.data.state[4]=joy[0].stick[0].axis[0].d1,e.data.state[3]=joy[0].stick[0].axis[0].d2,e.data.state[5]=joy[0].button[0].b,e.data.state[6]=joy[0].button[1].b,e.data.state[7]=joy[0].button[2].b,e.data.state[8]=joy[0].button[3].b);break;case 0:e.data.state[1]=Wt.up,e.data.state[2]=Wt.down,e.data.state[4]=Wt.left,e.data.state[3]=Wt.right,e.data.state[5]=Wt.space,e.data.state[6]=Wt.lcontrol,e.data.state[7]=Wt.enter,e.data.state[8]=Wt.esc,xe&&(e.data.state[1]=Yt.up(),e.data.state[2]=Yt.down(),e.data.state[4]=Yt.left(),e.data.state[3]=Yt.right(),e.data.state[5]=$t._pressed,e.data.state[8]=zt._pressed,e.data.state[6]=Ft._pressed),Vt&&(qt="undefined"!=typeof navigator&&(navigator.getGamepads()[0]||null)),qt&&(e.data.state[1]=qt.buttons[12].pressed,e.data.state[2]=qt.buttons[13].pressed,e.data.state[4]=qt.buttons[14].pressed,e.data.state[3]=qt.buttons[15].pressed,e.data.state[5]=qt.buttons[0].pressed,e.data.state[6]=qt.buttons[1].pressed,e.data.state[7]=qt.buttons[2].pressed,e.data.state[8]=qt.buttons[3].pressed)}}}(),(t=Fe())&&(t.update(),t==Fe()&&t.render()),_=!1,0!=l&&((u+=Z())<f?(n=parseInt(1.25*u/f*100,10),n=it(n,0,100),n=1==l?100-n:n,n/=100,Tt().fillStyle=d,Tt().globalAlpha=n,Tt().fillRect(0,0,r.width,r.height)):(2==l&&(Tt().fillStyle=d,Tt().fillRect(0,0,r.width,r.height)),l=0,f=u=0,d=0,_=!0)),Tt().globalAlpha=1,Nt()&&(Tt().font="14px Arial",Tt().fillStyle="white",Tt().fillText(o,450,20)),Yt&&Yt.render(Tt()),$t&&$t.render(Tt()),zt&&zt.render(Tt()),Ft&&Ft.render(Tt())},n=null,requestAnimationFrame((function t(a){var i=!1;if(null!=n){Math.min(a-n,100);i=!1===e()}n=a,i||requestAnimationFrame(t)}))},Wh=function(){R("preferences_init()"),function(){if(z.video_resolution="TINY",z.fullscreen=!1,z.smooth_graphics=!1,z.show_fps=!1,z.language="data/languages/english.json","undefined"!=typeof window)for(var t in z)z[t]=window.localStorage.getItem(t)?localStorage.getItem(t):z[t],"false"==z[t]&&(z[t]=!1);console.log("PREFERENCES",z)}()},Yh=function(t){var e,n,p,l;R("timer_init()"),a=0,i=0,o=0,Q=0,q=J(),zh(),e=t.video_resolution,n=t.smooth_graphics,p=t.fullscreen,t.color_depth,l=t.show_fps,Pt(e,n,p),Ct(l),(r=document.getElementById("canvas"))?(console.log("111111111"),s=r.getContext("2d"),vt=r.width/gt,wt=r.height/mt,s.scale(r.width/gt,r.height/mt)):(console.log("222222222"),r=document.createElement("canvas"),s=r.getContext("2d"),r.width=gt,r.height=mt,document.body.appendChild(r)),vt=gt/window.innerWidth,wt=vt,s.imageSmoothingEnabled=!1,s.mozImageSmoothingEnabled=!1,console.log("PIXEL RATIO",window.devicePixelRatio),console.log("VIDEO_SCREEN_W",gt),console.log("VIDEO_SCREEN_H",mt),console.log("CANVAS",r.width,r.height),console.log("WINDOW",window.innerWidth),console.log("SCALE",vt),c=s,It(),R("input_init()"),ye=null,Dt().addEventListener("contextmenu",(function(t){if(2===t.button)return t.preventDefault(),!1}),!1),Dt().addEventListener("mousemove",(function(t){we=function(t,e){var n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}}(Dt(),t)}),!1),Dt().addEventListener("mousedown",(function(t){switch(t.which){case 1:ke.left=!0;break;case 2:ke.middle=!0;break;case 3:ke.right=!0}}),!1),Dt().addEventListener("mouseup",(function(t){switch(t.which){case 1:ke.left=!1;break;case 2:ke.middle=!1;break;case 3:ke.right=!1}}),!1),Ht=!1,Xt=!1,Vt="undefined"!=typeof navigator&&"getGamepads"in navigator,console.log("canGamepad",Vt),(xe=function(){try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}}())&&(console.log("21111",Dt()),(Yt=new Bt({container:Dt(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX>=window.innerWidth/2||e.pageY<window.innerHeight/2)})),($t=new Bt({container:Dt(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX<window.innerWidth/2||e.pageY<window.innerHeight/2)})),(zt=new Bt({container:Dt(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX>window.innerWidth/2||e.pageY>window.innerHeight/2)})),(Ft=new Bt({container:Dt(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX<window.innerWidth/2||e.pageY>window.innerHeight/2)}))),Wt=Pe(ve),k.images={},k.images,k.samples={},E=k.samples,k.musics={},M=k.musics},$h=function(t,e){R("soundfactory: loading the samples table..."),D("data/config/samples.json").then((function(t){Qe(t)})),R("Loading objects scripts..."),jc=null,D("data/objects/enemies.json").then((function(t){jc=t})),function(){for(var t=0;t<256;t++)Uh[t]=null;Uh[Mh]=Hh(sd,cd,pd,ld),Uh[Ih]=Hh(sh,ch,ph,lh),Uh[Oh]=Hh(Eu,Mu,Iu,Ou),Uh[Dh]=Hh(mu,bu,yu,xu),Uh[Lh]=Hh(qu,Qu,Ku,Zu),Uh[0]=Hh(Du,Tu,Lu,Ru),Uh[Th]=Hh(Xa,Wa,Ya,$a),Uh[Rh]=Hh(_h,dh,uh,fh),Uh[Ah]=Hh(ba,ya,xa,va),Uh[Nh]=Hh(Gu,Uu,Bu,Hu),Uh[Ch]=Hh(Ca,Pa,Ga,Ua),Uh[Ph]=Hh(ff,hf,gf,mf),Uh[Gh]=Hh(vh,wh,kh,Sh)}(),function(t,e){R("Initializing the language module"),Be(Ge=t||Ge).then((function(t){console.log(t),R("lang_init() ok!"),e()}))}(t.language,(function(){!function(){Ye=0;for(var t=0;t<16;t++)We[t]=null}(),e()}))},zh=function(){return""};!function(t){Wh();var e=function(t){var e={};return e.video_resolution=z.video_resolution,e.smooth_graphics=z.smooth_graphics,e.fullscreen=z.fullscreen,e.show_fps=z.show_fps,e.language=z.language,e.video_resolution=t.video_resolution?t.video_resolution:e.video_resolution,e.smooth_graphics=t.smooth_graphics?t.smooth_graphics:e.smooth_graphics,e.fullscreen=t.fullscreen?t.fullscreen:e.fullscreen,e.show_fps=t.show_fps?t.show_fps:e.show_fps,e.color_depth=t.color_depth?t.color_depth:32,e.level=t.level?t.level:null,e.quest=t.quest?t.quest:null,e.language=t.language?t.language:e.language,e.video_resolution=V("video_resolution")?V("video_resolution"):e.video_resolution,e.smooth_graphics=V("smooth_graphics")?V("smooth_graphics"):e.smooth_graphics,e.fullscreen=V("fullscreen")?V("fullscreen"):e.fullscreen,e.show_fps=V("show_fps")?V("show_fps"):e.show_fps,e.color_depth=V("color_depth")?V("color_depth"):e.color_depth,e.level=V("level")?V("level"):e.level,e.quest=V("quest")?V("quest"):e.quest,e.language=V("language")?V("language"):e.language,e.level?(e.custom_level=!0,e.custom_level_path=e.level):e.custom_level=!1,e.quest?(e.custom_quest=!0,e.custom_quest_path=e.quest):e.custom_quest=!1,e}(t);console.log("COMMAND LINE",e),Yh(e),new Promise((function(t,e){var n;for(R("Loading sprites..."),k.sprites={},cn=k.sprites,n=0;n<pn.length;n++)pn[n]="data/sprites/"+pn[n]+".json";Ot("Loading...",0),O(pn).then((function(e){for(console.log("GOT ALL SPRITE JSON FILES"),n=0;n<e.length;n++)for(var a in e[n])e[n][a].name=a,_n.push(e[n][a]);xn(_n).then((function(){R("All sprites have been loaded!"),cn=S(),t()}))}))})).then((function(){!function(){var t,e,n,a=["ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","0123456789:","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_abcdefghijklmnopqrstuvwxyz{|}~"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_abcdefghijklmnopqrstuvwxyz{|}~"];for(R("font_init()"),t=0;t<a.length;t++)for(oa[t]={ch:[]},n="FT_FONT"+t,e=0;e<a[t].length;e++)oa[t].ch[a[t][e]]=un(dn(n,0),e);R("font_init() ok")}(),$h(e,(function(){Ei(5),Mi(0),function(t){t.custom_level?(id(t.custom_level_path),$e(Bh(Mh))):$e(Bh(0))}(e),Xh()}))}))}((zl={Xvideo_resolution:"TINY",Xsmooth_graphics:!1,Xfullscreen:!1,Xshow_fps:!0,Xcolor_depth:32,Xlevel:null},n(zl,"Xlevel","data/levels/blue_ocean_3.json"),n(zl,"Xquest",null),n(zl,"Xquest","data/quests/tutorial.json"),n(zl,"Xlanguage",null),n(zl,"Xlanguage","data/languages/italiano.json"),zl))})();