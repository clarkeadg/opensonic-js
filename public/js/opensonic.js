(()=>{"use strict";var t,e,n,a,i,r,o,c,s,u,l="Open Sonic",d="http://opensnc.sourceforge.net",p=1e-5,f=1<<30,_=1/0,h=999999999,m=Math.PI,g={sprites:{},images:{},samples:{},musics:{}},v=function(){return g.sprites},b=function(t,e){return g.samples[e]},y=function(t){return Promise.all(t.map(x))},x=function(t){return e=void 0,n=void 0,i=function(){var e,n,a;return function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(i){switch(i.label){case 0:e={},i.label=1;case 1:return i.trys.push([1,5,6,7]),[4,fetch("".concat("").concat(t))];case 2:return(n=i.sent()).ok?[4,n.json()]:[3,4];case 3:e=i.sent(),i.label=4;case 4:return[3,7];case 5:return a=i.sent(),console.log("err",a),[3,7];case 6:return[2,e];case 7:return[2]}}))},new((a=void 0)||(a=Promise))((function(t,r){function o(t){try{s(i.next(t))}catch(t){r(t)}}function c(t){try{s(i.throw(t))}catch(t){r(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof a?n:new a((function(t){t(n)}))).then(o,c)}s((i=i.apply(e,n||[])).next())}));var e,n,a,i},w=function(e,n){!function(t,e,n){t[e]=n}(t,e,n)},k=function(t){console.log(t)},E=function(t){console.log("FATAL ERROR",t)},S=null,M=function(t){k('music_load("'.concat(t,'")'));var n=new Audio;return n.src=t,function(t,n){!function(t,e,n){t[e]=n}(e,t,n)}(t,n),n},T=function(t,e){if(O()&&j(),null!=t){t.loop=!!e;try{t.play()}catch(t){}}S=t},j=function(){null!=S&&S.pause(),S=null},I=function(t){null!=S&&(t>1&&(t=1),t<0&&(t=0),S.volume=t)},D=function(){return null!=S?S.volume:0},O=function(){return null!=S&&!S.paused},R=function(t,e){e=""+e;var n=new Audio;n.src=e;var a=new Audio;a.src=e;var i=new Audio;i.src=e;var r=new Audio;return r.src=e,w(t,n),w(t+"2",a),w(t+"3",i),w(t+"4",r),n},A=function(t){L(t)},L=function(t){t&&t.play&&t.play()},N=function(t){return!!t&&!t.paused},C={video_resolution:"",fullscreen:!1,smooth_graphics:!1,show_fps:!1,language:""},G=function(){if("undefined"!=typeof window)for(var t in C)C[t],window.localStorage.setItem(t,C[t])},P=function(t){if("undefined"!=typeof window){var e=RegExp("[?&]"+t+"=([^&]*)").exec(window.location.search);return e&&decodeURIComponent(e[1].replace(/\+/g," "))}return null},U=0,B=0,Y=0,H=0,W=0,F=0,X=function(){return W},z=function(){var t=$();return t<F&&(F=t),t-F},$=function(){return Math.floor(Date.now())},Q=function(t){return" "==t},V=function(t){return void 0!==t&&t&&t.constructor===Array},K=function(t){return~~q(Math.random()*t,0,t)},q=function(t,e,n){return Math.min(Math.max(t,e),n)},J=function(t,e){return t[0]<e[2]&&t[2]>e[0]&&t[1]<e[3]&&t[3]>e[1]},Z=function(t,e){return et(t,e,t.length)},tt=function(t){return t>=0&&t<m/4-p?0:t>=m/4-p&&t<m/2-p?m/4:t>=m/2-p&&t<m/2+p?m/2:t>=m/2+p&&t<m-p?3*m/4:t>=m-p&&t<m+p?m:t>=m+p&&t<3*m/2-p?5*m/4:t>=3*m/2-p&&t<3*m/2+p?3*m/2:t>3*m/2+p&&t<=7*m/4+p?7*m/4:0},et=function(t,e,n){var a,i,r=t,o=e;for(a=0;a<n;a++)i=r[a],r[a]=o[a],o[a]=i;return[r[a],o[a]]},nt=function(t,e){return{x:t,y:e}},at=function(t,e){return{x:t.x+e.x,y:t.y+e.y}},it=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},rt=function(t,e){return{x:e*t.x,y:e*t.y}},ot=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},ct=function(t,e){var n=t.x,a=t.y;return{x:n*Math.cos(e)-a*Math.sin(e),y:a*Math.cos(e)+n*Math.sin(e)}},st=function(t){var e=ot(t);return e>p?nt(t.x/e,t.y/e):nt(0,0)},ut=480,lt=271,dt=!1,pt=!1,ft=!1,_t=1,ht=1,mt=function(){return nt(_t,ht)},gt=function(t,e){0==r&&(r=1,o=!1,c=t,s=0,u=e)},vt=function(t,e){0==r&&(r=2,o=!1,c=t,s=0,u=e)},bt=function(){return o},yt=function(){return 0!=r},xt=function(t){a.fillStyle=t||"rgb(0, 0, 0)",a.fillRect(0,0,n.width,n.height)},wt=function(t,e){xt();var n=Et();n.beginPath(),n.rect(130,115.5,210,20),n.fillStyle="black",n.fill(),n.lineWidth=1,n.strokeStyle="white",n.stroke(),e=e<1?0:e>202?202:202/e,n.beginPath(),n.rect(134,118.5,e,14),n.fillStyle="white",n.fill(),n.lineWidth=1,n.strokeStyle="black",n.stroke(),n.font="14px Arial",n.fillStyle="white",n.fillText(t,130,105.5)},kt=function(){return n},Et=function(){return a},St=function(){return i},Mt=function(){return dt},Tt=function(){return pt},jt=function(){return ft},It=function(t){ft=t},Dt=function(t,e,n){i=t,pt=n,dt=e};function Ot(t){return Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ot(t)}function Rt(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,(i=a.key,r=void 0,r=function(t,e){if("object"!==Ot(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,"string");if("object"!==Ot(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i),"symbol"===Ot(r)?r:String(r)),a)}var i,r}var At,Lt,Nt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._container=e.container||document.body,this._strokeStyle=e.strokeStyle||"cyan",this._mouseSupport=void 0!==e.mouseSupport&&e.mouseSupport,this._stationaryBase=e.stationaryBase||!1,this._baseX=this._stickX=e.baseX||0,this._baseY=this._stickY=e.baseY||0,this._limitStickTravel=e.limitStickTravel||!1,this._stickRadius=void 0!==e.stickRadius?e.stickRadius:100,this._pressed=!1,this._touchIdx=null;var n=function(t,e){return function(){return t.apply(e,arguments)}};this._$onTouchStart=n(this._onTouchStart,this),this._$onTouchEnd=n(this._onTouchEnd,this),this._$onTouchMove=n(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=n(this._onMouseDown,this),this._$onMouseUp=n(this._onMouseUp,this),this._$onMouseMove=n(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))}var e,n,a;return e=t,a=[{key:"touchScreenAvailable",value:function(){return"createTouch"in document}}],(n=[{key:"destroy",value:function(){this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))}},{key:"deltaX",value:function(){return this._stickX-this._baseX}},{key:"deltaY",value:function(){return this._stickY-this._baseY}},{key:"up",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(e>=0||Math.abs(t)>2*Math.abs(e))}},{key:"down",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(e<=0||Math.abs(t)>2*Math.abs(e))}},{key:"right",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(t<=0||Math.abs(e)>2*Math.abs(t))}},{key:"left",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(t>=0||Math.abs(e)>2*Math.abs(t))}},{key:"_onUp",value:function(){this._pressed=!1,0==this._stationaryBase&&(this._baseX=this._baseY=0,this._stickX=this._stickY=0)}},{key:"_onDown",value:function(t,e){this._pressed=!0;var n=mt();t*=n.x,e*=n.y,this._stationaryBase,this._stickX=t,this._stickY=e}},{key:"_onMove",value:function(t,e){var n=mt();t*=n.x,e*=n.y,!0===this._pressed&&(this._stickX=t,this._stickY=e)}},{key:"_onMouseUp",value:function(t){return this._onUp()}},{key:"_onMouseDown",value:function(t){t.preventDefault();var e=t.clientX,n=t.clientY;return this._onDown(e,n)}},{key:"_onMouseMove",value:function(t){var e=t.clientX,n=t.clientY;return this._onMove(e,n)}},{key:"_onTouchStart",value:function(t){if(null===this._touchIdx&&!1!==this.dispatchEvent("touchStartValidation",t)){this.dispatchEvent("touchStart",t),t.preventDefault();var e=t.changedTouches[0];this._touchIdx=e.identifier;var n=e.pageX,a=e.pageY;return this._onDown(n,a)}}},{key:"_onTouchEnd",value:function(t){if(null!==this._touchIdx){this.dispatchEvent("touchEnd",t);for(var e=t.changedTouches,n=0;n<e.length&&e[n].identifier!==this._touchIdx;n++);if(n!==e.length)return this._touchIdx=null,t.preventDefault(),this._onUp()}}},{key:"_onTouchMove",value:function(t){if(null!==this._touchIdx){for(var e=t.changedTouches,n=0;n<e.length&&e[n].identifier!==this._touchIdx;n++);if(n!==e.length){var a=e[n];t.preventDefault();var i=a.pageX,r=a.pageY;return this._onMove(i,r)}}}},{key:"render",value:function(t){t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=3,t.arc(this._baseX,this._baseY,20,0,2*Math.PI,!0),t.stroke(),t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=1,t.arc(this._baseX,this._baseY,30,0,2*Math.PI,!0),t.stroke(),this._pressed&&(t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=3,t.arc(this._stickX,this._stickY,20,0,2*Math.PI,!0),t.stroke())}}])&&Rt(e.prototype,n),a&&Rt(e,a),Object.defineProperty(e,"prototype",{writable:!1}),t}();(At=Nt.prototype).addEventListener=function(t,e){return void 0===this._events&&(this._events={}),this._events[t]=this._events[t]||[],this._events[t].push(e),e},At.removeEventListener=function(t,e){void 0===this._events&&(this._events={}),t in this._events!=0&&this._events[t].splice(this._events[t].indexOf(e),1)},At.dispatchEvent=function(t){if(void 0===this._events&&(this._events={}),void 0!==this._events[t])for(var e=this._events[t].slice(),n=0;n<e.length;n++){var a=e[n].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==a)return a}},function(t){t[t.IB_UP=1]="IB_UP",t[t.IB_DOWN=2]="IB_DOWN",t[t.IB_RIGHT=3]="IB_RIGHT",t[t.IB_LEFT=4]="IB_LEFT",t[t.IB_FIRE1=5]="IB_FIRE1",t[t.IB_FIRE2=6]="IB_FIRE2",t[t.IB_FIRE3=7]="IB_FIRE3",t[t.IB_FIRE4=8]="IB_FIRE4",t[t.IB_FIRE5=9]="IB_FIRE5"}(Lt||(Lt={}));var Ct,Gt=Lt.IB_UP,Pt=Lt.IB_DOWN,Ut=Lt.IB_LEFT,Bt=Lt.IB_RIGHT,Yt=Lt.IB_FIRE1,Ht=Lt.IB_FIRE2,Wt=Lt.IB_FIRE3,Ft=Lt.IB_FIRE4,Xt=Lt.IB_FIRE5;!function(t){t[t.IT_KEYBOARD=1]="IT_KEYBOARD",t[t.IT_MOUSE=2]="IT_MOUSE",t[t.IT_COMPUTER=3]="IT_COMPUTER",t[t.IT_JOYSTICK=4]="IT_JOYSTICK",t[t.IT_USER=5]="IT_USER"}(Ct||(Ct={}));var zt,$t,Qt,Vt,Kt,qt,Jt,Zt,te,ee,ne,ae,ie,re,oe=null,ce=!1,se=!1,ue=!1,le={37:"left",38:"up",39:"right",40:"down",17:"lcontrol",32:"space",13:"enter",27:"esc",192:"tilda"},de=null,pe=null,fe=null,_e=null,he=null,me=null,ge=null,ve=nt(0,0),be={left:!1,middle:!1,right:!1},ye=function(){for(var t={type:Ct.IT_COMPUTER,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},e=0;e<9;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return Oe(t),t},xe=function(t){for(var e={type:Ct.IT_KEYBOARD,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},n=0;n<9;n++)e.state[n]=e.oldstate[n]=!1,e.howlong[n]=0;if(t)for(e.keybmap=[],n=0;n<9;n++)e.keybmap[n]=t[n];else e.keybmap[Gt]=38,e.keybmap[Pt]=40,e.keybmap[Bt]=39,e.keybmap[Ut]=37,e.keybmap[Yt]=32,e.keybmap[Ht]=17,e.keybmap[Wt]=13,e.keybmap[Ft]=27,e.keybmap[Xt]=192;return Oe(e),e},we=function(){for(var t={type:Ct.IT_USER,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},e=0;e<9;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return t.keybmap=[],t.keybmap[Gt]=38,t.keybmap[Pt]=40,t.keybmap[Bt]=39,t.keybmap[Ut]=37,t.keybmap[Yt]=32,t.keybmap[Ht]=17,t.keybmap[Wt]=13,t.keybmap[Ft]=27,Oe(t),t},ke=function(t){Re(t),t=null},Ee=function(t,e){return!!e&&!!t.enabled&&t.state[e]},Se=function(t,e){return!!e&&!!t.enabled&&t.state[e]&&!t.oldstate[e]},Me=function(t,e){return!e||!!t.enabled&&!t.state[e]&&t.oldstate[e]},Te=function(t,e){t.state[e]=!0},je=function(t){t.enabled=!1},Ie=function(t){t.enabled=!0},De=function(t){return nt(t.x,t.y)},Oe=function(t){oe={data:t,next:oe}},Re=function(t){var e,n;if(oe.data==t)n=oe.next,oe=null,oe=n;else{for(e=oe;e.next&&e.next.data!=t;)e=e.next;e.next&&(n=e.next.next,e.next=null,e.next=n)}},Ae=function(t){var e=Object.create(null);function n(n){if(t.hasOwnProperty(n.keyCode)){var a="keydown"==n.type;e[t[n.keyCode]]=a,n.preventDefault()}}return addEventListener("keydown",n),addEventListener("keyup",n),e},Le=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},Ne=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Ce="data/languages/english.json",Ge={},Pe=function(t){return Le(void 0,void 0,void 0,(function(){var e;return Ne(this,(function(n){switch(n.label){case 0:return k('lang_loadfile("'.concat(t,'")...')),[4,x(t)];case 1:return e=n.sent(),Ge=e,[2]}}))}))},Ue=function(t){return Ge[t]||t},Be=function(t){return Ue(t)},Ye=[],He=0,We=function(t){Ye[He++]=t,t&&t.init()},Fe=function(){Ye[He-1].release(),Ye[He-1]=null,He--},Xe=function(){return Ye[He-1]},ze={},$e=function(t){var e=b(0,t);return N(e)&&(e=b(0,t+"2"),N(e)&&(e=b(0,t+"3"),N(e)&&(e=b(0,t+"4")))),e},Qe=function(){return t=void 0,e=void 0,a=function(){var t;return function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(e){switch(e.label){case 0:return k("soundfactory: loading the samples table..."),[4,x("data/config/samples.json")];case 1:return t=e.sent(),Ve(t),[2]}}))},new((n=void 0)||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}));var t,e,n,a},Ve=function(t){for(var e in t)ze[e]=Ke(e,t[e])},Ke=function(t,e){var n=qe();return n.data=R(t,e),n.data2=R(t,e),n},qe=function(){return{data:null,data2:null}},Je={},Ze=function(t,e){return Et().createImageData(t,e)},tn=function(t){return new Promise((function(e,n){if(Je[t])return e(Je[t]);var a=document.createElement("img");a.src=t,a.addEventListener("load",(function(){return Je[t]=a,e(a)}))}))},en=function(t,e,n,a,i,r,o,c){if(!t||!e)return!1;e.drawImage(t,n,a,o,c,i,r,o,c)},nn=function(t,e,n,a,i){e.fillStyle=i,e.fillRect(n,a,n+1,a+1)},an=function(t,e,n){return"rgb(".concat(t,", ").concat(e,", ").concat(n,")")},rn=function(t,e,n,a){for(var i=0;i<t.data.length;i+=4)t.data[i]=e,t.data[i+1]=n,t.data[i+2]=a},on=function(t){t&&(t=null)},cn=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},sn=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},un={},ln=["animal","bigring","bluering","bosses","bumber","charge","checkpointorb","chef","danger","dangpower","dnadoor","door","explosion","fireball","flyingboy","flyingeyes","font","glasses","goal","goldfish","hud","icon","itembox","joan","kleps","lady_bugsy","levelact","loop","menu","misc","nafder","neon","oranjection","ring","roboxer","shield","spikes","spring","surge","surpreyes","switch","teleporter"],dn=0,pn=[],fn=function(t,e){var n;return null!=(n=un[t])?n.animation_data[e]:null},_n=function(t,e){return t?t.frame_data[t.data[e]]:null},hn=function(t){return cn(void 0,void 0,void 0,(function(){return sn(this,(function(e){switch(e.label){case 0:return[4,mn(t)];case 1:return[2,e.sent()]}}))}))},mn=function(t){return cn(void 0,void 0,void 0,(function(){var e,n,a;return sn(this,(function(i){switch(i.label){case 0:return e=gn(),n=function(t){var e,n,a;for((t.frame_w>t.rect_w||t.frame_h>t.rect_h)&&(t.frame_w=Math.min(t.frame_w,t.rect_w),t.frame_h=Math.min(t.frame_h,t.rect_h)),(t.rect_w%t.frame_w>0||t.rect_h%t.frame_h>0)&&(t.rect_w=t.rect_w%t.frame_w>0?t.rect_w-t.rect_w%t.frame_w+t.frame_w:t.rect_w,t.rect_h=t.rect_h%t.frame_h>0?t.rect_h-t.rect_h%t.frame_h+t.frame_h:t.rect_h),a=t.rect_w/t.frame_w*(t.rect_h/t.frame_h),e=0;e<t.animation_count;e++)for(n=0;n<t.animation_data[e].frame_count;n++)t.animation_data[e].data[n]>=0&&t.animation_data[e].data[n]<a||(t.animation_data[e].data[n]=Math.min(t.animation_data[e].data[n],0,a-1));return t}(n=wn(e,t)),[4,vn(n)];case 1:return a=i.sent(),n=yn(a),En(t.name,n),dn++,wt("Loading...",dn/pn.length),[2,n]}}))}))},gn=function(){return{source_file:null,rect_x:0,rect_y:0,rect_w:0,rect_h:0,frame_w:0,frame_h:0,hot_spot:nt(0,0),frame_count:0,frame_data:[],animation_count:0,animation_data:[]}},vn=function(t){return cn(void 0,void 0,void 0,(function(){var e;return sn(this,(function(n){switch(n.label){case 0:return[4,tn(t.source_file)];case 1:return e=n.sent(),t.frame_count=t.rect_w/t.frame_w*(t.rect_h/t.frame_h),t.frame_data=[],[2,t=bn(t,e)]}}))}))},bn=function(t,e){for(var n=0,a=0,i=0;i<t.frame_count;i++){var r={data:e,sx:n+t.rect_x,sy:a+t.rect_y,swidth:t.frame_w,sheight:t.frame_h,x:0,y:0,width:t.frame_w,height:t.frame_h};t.frame_data[i]=r,(n+=t.frame_w)>=t.rect_w&&(n=0,a+=t.frame_h)}return t},yn=function(t){for(var e=0;e<t.animation_count;e++)t.animation_data[e].frame_data=t.frame_data,t.animation_data[e].hot_spot=t.hot_spot;return t},xn=function(t){return Promise.all(t.map(mn))},wn=function(t,e){if(t.source_file=""+e.source_file,t.rect_x=e.source_rect.xpos,t.rect_y=e.source_rect.ypos,t.rect_w=e.source_rect.width,t.rect_h=e.source_rect.height,t.frame_w=e.frame_size.width,t.frame_h=e.frame_size.height,e.hot_spot&&(t.hot_spot.x=e.hot_spot.xpos,t.hot_spot.y=e.hot_spot.ypos),e.animations){t.animation_count=e.animations.length;for(var n=0;n<t.animation_count;n++)t.animation_data[n]=kn(Sn(),e.animations[n]),0==t.animation_data[n].frame_count&&k("Animation error: invalid 'data' field. You must specify the frames of the animations")}return t},kn=function(t,e){return t.repeat=e.repeat,t.fps=e.fps,t.data=e.data,t.frame_count=e.data.length,t},En=function(t,e){!function(t,e,n){g.sprites[e]=n}(v(),t,e)},Sn=function(){return{repeat:!1,fps:8,frame_count:0,data:null,hot_spot:nt(0,0),frame_data:null}},Mn=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},Tn=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},jn=0,In=[],Dn=function(t){return In[t]},On=function(){return jn},Rn=function(t){var e=t.brick_ref.data;if(null!=e&&e.animation_data.length){e.animation_data[0].repeat;var n=e.animation_data[0].frame_count;t.animation_frame+=e.animation_data[0].fps*X(),t.animation_frame>e.animation_data[0].frame_count-1&&(t.animation_frame=0),n=~~t.animation_frame,t.brick_ref.image=e.frame_data[e.animation_data[0].data[n]]}},An=function(t){return t.brick_ref.image},Ln=function(t){return Mn(void 0,void 0,void 0,(function(){var e,n,a,i;return Tn(this,(function(r){switch(r.label){case 0:for(e=function(){for(var t={data:null,image:null,property:0,angle:0,behavior:0,zindex:.5,behavior_arg:[]},e=0;e<5;e++)t.behavior_arg[e]=0;return t}(),"OBSTACLE"==(n=t.type)?e.property=1:"PASSABLE"==n?e.property=0:"CLOUD"==n?e.property=2:k("Can't read brick attributes: unknown brick type ".concat(n)),"DEFAULT"==(n=V(t.behavior)?t.behavior[0]:t.behavior)?e.behavior=0:"CIRCULAR"==n?e.behavior=1:"BREAKABLE"==n?e.behavior=2:"FALL"==n?e.behavior=3:k("Can't read brick attributes: unknown brick type ".concat(n)),a=0;a<5;a++)e.behavior_arg[a]=t.behavior[1+a];return e.behavior_arg[e.behavior_arg.length-1]=0,e.angle=t.angle,t.zindex&&(e.zindex=t.zindex),[4,hn(t.sprite)];case 1:return i=r.sent(),e.data=i,e.image=i.frame_data[0],jn++,[2,e]}}))}))},Nn=void 0,Cn=!0,Gn=0,Pn=0,Un=0,Bn=0,Yn=function(){return{spawn_point:nt(0,0),position:nt(0,0),angle:0,speed:nt(0,0),maxspeed:0,acceleration:0,jump_strength:0,is_jumping:!1,ignore_horizontal:!1,input:null,animation:null,animation_frame:0,animation_speed_factor:1,mirror:0,visible:!0,alpha:1,hot_spot:nt(0,0),carried_by:null,carry_offset:nt(0,0),carrying:null}},Hn=function(t){t.input&&ke(t.input),t=null},Wn=function(t,e){if(e&&t&&t.visible&&t.animation){t.animation_frame+=t.animation.fps*t.animation_speed_factor*X(),t.animation_frame>t.animation.frame_count-1&&(t.animation.repeat?t.animation_frame=0:t.animation_frame=t.animation.frame_count-1);var n=zn(t);if(!n)return!1;t.mirror&&oa(Et(),t.position.x-(e.x-240));var a=t.position.x-(e.x-240),i=t.position.y-(e.y-135.5),r=t.mirror?t.angle:-t.angle;t.angle&&(Et().translate(a,i),Et().rotate(r),Et().translate(-a,-i)),Et().drawImage(n.data,n.sx,n.sy,n.swidth,n.sheight,~~(t.position.x-t.hot_spot.x-(e.x-240)),~~(t.position.y-t.hot_spot.y-(e.y-135.5)),1*n.width,1*n.height),t.angle&&(Et().translate(a,i),Et().rotate(-r),Et().translate(-a,-i)),t.mirror&&oa(Et(),t.position.x-(e.x-240))}},Fn=function(t,e,n,a){var i=nt(0,0);if(t.visible&&t.animation){isNaN(t.animation_frame)&&(t.animation_frame=0,t.animation.fps=1),t.animation_frame+=t.animation.fps*t.animation_speed_factor*X(),t.animation_frame>t.animation.frame_count-1&&(t.animation.repeat?t.animation_frame=0:t.animation_frame=t.animation.frame_count-1);var r=zn(t);if(!r)return!1;i.x=t.position.x%(n?r.width:h)-t.hot_spot.x-(e.x-240)-(n?r.width:0),i.y=t.position.y%(a?r.height:h)-t.hot_spot.y-(e.y-135.5)-(a?r.height:0);for(var o=n?ut/r.width+3:1,c=a?lt/r.height+3:1,s=0;s<o;s++)for(var u=0;u<c;u++)Et().drawImage(r.data,r.sx,r.sy,r.swidth,r.sheight,~~(i.x+s*r.width),~~(i.y+u*r.height),1*r.width,1*r.height)}},Xn=function(t,e){e||(e={x:0,y:0}),e.x=e.x||0,e.y=e.y||0,Math.abs(e.x)<p&&(e.x=0),t.position.x+=e.x*Math.cos(t.angle)+e.y*Math.sin(t.angle),t.position.y+=e.y*Math.cos(t.angle)-e.x*Math.sin(t.angle)},zn=function(t){return _n(t.animation,~~t.animation_frame)},$n=function(t,e){return t.animation_frame=q(e,0,t.animation.frame_count),t},Qn=function(t,e){return!(!t||!e)&&(t.animation!=e&&(t.animation=e,t.hot_spot=e.hot_spot,t.animation_frame=0,t.animation_speed_factor=1),t)},Vn=function(t){var e=t.animation_frame+t.animation.fps*t.animation_speed_factor*X();return!t.animation.repeat&&e>t.animation.frame_count-1},Kn=function(t,e){var n=0,a=[];if(a[0]=[nt(0,0),nt(0,0),nt(0,0),nt(0,0)],a[1]=[nt(0,0),nt(0,0),nt(0,0),nt(0,0)],a[0][0]=it(t.position,ct(t.hot_spot,-t.angle)),a[0][1]=at(a[0][0],ct(nt(zn(t).width,0),-t.angle)),a[0][2]=at(a[0][0],ct(nt(zn(t).width,zn(t).height),-t.angle)),a[0][3]=at(a[0][0],ct(nt(0,zn(t).height),-t.angle)),a[1][0]=it(e.position,ct(e.hot_spot,0)),a[1][1]=at(a[1][0],ct(nt(zn(e).width,0),0)),a[1][2]=at(a[1][0],ct(nt(zn(e).width,zn(e).height),0)),a[1][3]=at(a[1][0],ct(nt(0,zn(e).height),0)),(Math.abs(t.angle)<p||Math.abs(t.angle-m/2)<p||Math.abs(t.angle-m)<p||Math.abs(t.angle-3*m/2)<p)&&n++,(Math.abs(e.angle)<p||Math.abs(e.angle-m/2)<p||Math.abs(e.angle-m)<p||Math.abs(e.angle-3*m/2)<p)&&n++,n){for(var i=[],r=[],o=0;o<2;o++){i[o]=[];var c=Math.min(a[o][0].x,a[o][1].x),s=Math.min(a[o][0].y,a[o][1].y),u=Math.max(a[o][2].x,a[o][3].x),l=Math.max(a[o][2].y,a[o][3].y);i[o][0]=c,i[o][1]=s,i[o][2]=u,i[o][3]=l,c>u&&(r=Z(i[o][0],i[o][2]),i[o][0]=r[0],i[o][2]=r[1]),s>l&&(r=Z(i[o][1],i[o][3]),i[o][1]=r[0],i[o][3]=r[1])}return J(i[0],i[1])}var d=[],f=[Math.max(zn(t).width,zn(t).height),Math.max(zn(e).width,zn(e).height)];for(o=0;o<2;o++)d[o]=rt(at(a[o][0],a[o][2]),.5);return function(t,e,n,a){return ot(it(t,n))<=e+a}(d[0],f[0],d[1],f[1])},qn=function(t,e){return Math.abs(t.angle)<p&&Math.abs(e.angle)<p?!!Kn(t,e)&&(t.position.x-t.hot_spot.x,t.position.y-t.hot_spot.y,e.position.x-e.hot_spot.x,e.position.y-e.hot_spot.y,zn(t).data,zn(e).data,!0):!!function(t,e){var n=nt(0,0),a=nt(0,0),i=nt(0,0),r=nt(0,0),o=[],c=[];return o=ra(Nn,t,o),c=ra(Nn,e,c),n.x=Math.min(o[0].x,Math.min(o[1].x,Math.min(o[2].x,o[3].x))),n.y=Math.min(o[0].y,Math.min(o[1].y,Math.min(o[2].y,o[3].y))),a.x=Math.min(c[0].x,Math.min(c[1].x,Math.min(c[2].x,c[3].x))),a.y=Math.min(c[0].y,Math.min(c[1].y,Math.min(c[2].y,c[3].y))),i.x=Math.max(o[0].x,Math.max(o[1].x,Math.max(o[2].x,o[3].x)))-n.x,i.y=Math.max(o[0].y,Math.max(o[1].y,Math.max(o[2].y,o[3].y)))-n.y,r.x=Math.max(c[0].x,Math.max(c[1].x,Math.max(c[2].x,c[3].x)))-a.x,r.y=Math.max(c[0].y,Math.max(c[1].y,Math.max(c[2].y,c[3].y)))-a.y,n.x+i.x>=a.x&&n.x<=a.x+r.x&&n.y+i.y>=a.y&&n.y<=a.y+r.y}(t,e)},Jn=function(t,e,n,a,i,r,o,c,s,u,l,d){var p=zn(t).width,f=zn(t).height,_=t.position,h=at(_,ct(nt(0,-f+n),-t.angle)),m=at(_,ct(nt(0,-n),-t.angle)),g=at(_,ct(nt(-p/2+n,.5*-f),-t.angle)),v=at(_,ct(nt(p/2-n,.5*-f),-t.angle)),b=at(_,ct(nt(-p/2+n,-f+n),-t.angle)),y=at(_,ct(nt(p/2-n,-f+n),-t.angle)),x=at(_,ct(nt(-p/2+n,-n),-t.angle)),w=at(_,ct(nt(p/2-n,-n),-t.angle));return Zn(t,e,h,y,v,w,m,x,g,b,a,i,r,o,c,s,u,l,d)},Zn=function(t,e,n,a,i,r,o,c,s,u,l,d,p,f,_,h,m,g,v){var b=[n.x-e,n.y-e,n.x+e,n.y+e],y=[o.x-e,o.y-e,o.x+e,o.y+e],x=[s.x-e,s.y-e,s.x+e,s.y+e],w=[i.x-e,i.y-e,i.x+e,i.y+e],k=[u.x-e,u.y-e,u.x+e,u.y+e],E=[a.x-e,a.y-e,a.x+e,a.y+e],S=[c.x-e,c.y-e,c.x+e,c.y+e],M=[r.x-e,r.y-e,r.x+e,r.y+e];return l&&(n&&(d=ia(l,b)),o&&(h=ia(l,y)),s&&(g=ia(l,x)),i&&(f=ia(l,w)),u&&(v=ia(l,k)),a&&(p=ia(l,E)),c&&(m=ia(l,S)),r&&(_=ia(l,M))),{up:d,down:h,left:g,right:f,upleft:v,upright:p,downleft:m,downright:_}},ta=function(t){Cn=t},ea=function(t,e,n,a,i,r,o,c,s,u){var l,d=[n,a,i,s,u];for(l=0;l<d.length;l++){var p=d[l];p&&p.brick_ref&&2==p.brick_ref.property&&(p=null,d[l]=p)}if(o&&o.brick_ref&&2==o.brick_ref.property){var f=Math.min(15,o.brick_ref.image.height/3);t.speed.y>=0&&t.position.y<o.y+e+1+f||(c&&c==o&&(c=null),r&&r==o&&(r=null),o=null)}return{up:d[0],upright:d[1],right:d[2],left:d[3],upleft:d[4],downright:r,down:o,downleft:c}},na=function(t,e,n){var a,i,r,o,c,s,u,l,d,f,_,h=nt(0,0),g=X(),v=t.position,b=function(t,e,n,a,i,r,o,c,s,u){var l,d,f,_=zn(t).width,h=zn(t).height,g=!(Math.abs(t.angle)<p||Math.abs(t.angle-m/2)<p||Math.abs(t.angle-m)<p||Math.abs(t.angle-3*m/2)<p),v=t.position;return g?(l=1,d=.7,f=.25):(l=.7,d=.5,f=.25),{up:at(v,ct(nt(0,-h*l+e),-t.angle)),down:at(v,ct(nt(0,2),-t.angle)),left:at(v,ct(nt(-_*f+e,-h*d),-t.angle)),right:at(v,ct(nt(_*f-e,-h*d),-t.angle)),upleft:at(v,ct(nt(-_*f+e,-h*l+e),-t.angle)),upright:at(v,ct(nt(_*f-e,-h*l+e),-t.angle)),downleft:at(v,ct(nt(-_*f+e,2),-t.angle)),downright:at(v,ct(nt(_*f-e,2),-t.angle))}}(t,-2);b=function(t,e,n,a,i,r,o,c,s,u,l,d,p,f,_,h,m,g){return Zn(t,2,n,a,i,r,o,c,s,u,e,l,d,p,f,_,h,m,g)}(t,e,a=b.up,b.upright,i=b.right,b.downright,b.down,b.downleft,r=b.left,b.upleft,o,c,s,u,l,d,f,_),o=b.up,c=b.upright,s=b.right,u=b.downright,l=b.down,d=b.downleft,f=b.left,_=b.upleft;var y=ea(t,-2,o,c,s,u,l,d,f,_);return o=y.up,c=y.upright,s=y.right,f=y.left,_=y.upleft,l=y.down,d=y.downleft,u=y.downright,function(t,e){var n=X();if(null!=t.carried_by){var a=t.carried_by;e&&0==e.brick_ref.angle&&a.speed.y>=5?(t.position=nt(t.carried_by.position.x,t.carried_by.position.y),t.carried_by.carrying=null,t.carried_by=null):(t.speed=nt(0,0),t.mirror=a.mirror,t.angle=0,t.position=it(at(a.position,rt(a.speed,n)),t.carry_offset))}}(t,l),null!=t.carried_by?nt(0,0):(function(t,e,n,a,i,r){r&&r.brick_ref.angle%90==0&&(t.speed.x>p||a.x>r.x)&&(t.speed.x=0,t.position.x=r.x+(e.x-a.x)),i&&i.brick_ref.angle%90==0&&(t.speed.x<-1e-5||n.x<i.x+i.brick_ref.image.width)&&(t.speed.x=0,t.position.x=i.x+i.brick_ref.image.width+(e.x-n.x))}(t,v,r,i,f,s),l?(t.is_jumping=!1,t.ignore_horizontal=!1,function(t,e,n,a,i){var r=a.brick_ref.angle;!Ee(t.input,Yt)||Ee(t.input,Pt)||i||(t.angle=0,t.is_jumping=!0,0==r?t.speed.y=-t.jump_strength:r>0&&r<90?(t.speed.x=Math.min(t.speed.x,-.7*t.jump_strength),t.speed.y=-.7*t.jump_strength):90==r?(Xn(t,nt(-40,0)),t.speed.x=Math.min(t.speed.x,-t.jump_strength),t.speed.y=-t.jump_strength/2):r>90&&r<180?(Xn(t,nt(0,40)),t.speed.x=Math.min(t.speed.x,-.7*t.jump_strength),t.speed.y=t.jump_strength):180==r?(Xn(t,nt(0,40)),t.speed.x*=-1,t.speed.y=t.jump_strength):r>180&&r<270?(Xn(t,nt(0,40)),t.speed.x=Math.max(t.speed.x,.7*t.jump_strength),t.speed.y=t.jump_strength):270==r?(Xn(t,nt(40,0)),t.speed.x=Math.max(t.speed.x,t.jump_strength),t.speed.y=-t.jump_strength/2):r>270&&r<360&&(t.speed.x=Math.max(t.speed.x,.7*t.jump_strength),t.speed.y=-.7*t.jump_strength))}(t,0,0,l,o)):t.angle=0,h.y=Math.abs(t.speed.y)>p?t.speed.y*g+1*n*.5*(g*g):0,t.speed.y=Math.min(t.speed.y+1*n*g,480),function(t,e,n,a){a&&a.brick_ref.angle%90==0&&t.speed.y<-1e-5&&(t.position.y=a.y+a.brick_ref.image.height+(e.y-n.y),t.speed.y=10)}(t,v,a,o),function(t,e,n,a,i,r,o,c,s){var u;if(X(),c&&!t.is_jumping)if(u=c.brick_ref.angle,t.speed.y=a.y=0,t.angle=u*m/180,0==u)t.position.y=i.y+e;else if(u>0&&u<90)i.y=c.y+c.brick_ref.image.height-(t.position.x-c.x)*Math.tan(t.angle),t.position.y=i.y+e,t.mirror;else if(90==u){if(Math.abs(t.speed.x)>5){var l=s?s.brick_ref.angle:-1;s&&l>=u&&l<u+90?(i.y=c.x,t.position.x=i.y+e):(t.angle=0,Xn(t,nt(-13,0)),t.is_jumping=!0,t.speed=nt(0,-.7*Math.abs(t.speed.x)))}else t.angle=0,Xn(t,nt(-10,0)),t.is_jumping=!0,t.ignore_horizontal=!1;t.mirror}else u>90&&u<180?Math.abs(t.speed.x)>5?(i.y=c.y-(t.position.x-c.x)*Math.tan(t.angle),t.position.y=i.y-e):(t.angle=0,Xn(t,nt(0,30)),t.is_jumping=!0):180==u?t.speed.x>5&&!(1&t.mirror)||t.speed.x<-5&&1&t.mirror?(i.y=c.y+c.brick_ref.image.height,t.position.y=i.y-e):(t.angle=0,Xn(t,nt(0,40)),t.is_jumping=!0,t.speed.x=0):u>180&&u<270?Math.abs(t.speed.x)>5?(i.y=c.y+c.brick_ref.image.height-(t.position.x-c.x)*Math.tan(t.angle),t.position.y=i.y-e):(t.angle=0,Xn(t,nt(0,30)),t.is_jumping=!0):270==u?(Math.abs(t.speed.x)>5?(l=o?o.brick_ref.angle:-1,o&&l>u-90&&l<=u?(i.y=c.x+c.brick_ref.image.width,t.position.x=i.y-e):(t.angle=0,Xn(t,nt(13,0)),t.is_jumping=!0,t.speed=nt(0,-.7*Math.abs(t.speed.x)))):(t.angle=0,Xn(t,nt(10,0)),t.is_jumping=!0,t.ignore_horizontal=!1),t.mirror):u>270&&u<360&&(i.y=c.y-(t.position.x-c.x)*Math.tan(t.angle),t.position.y=i.y+e,t.mirror)}(t,-2,0,h,v,0,d,l,u),h.x=Math.abs(t.speed.x)>p?t.speed.x*g+1*t.acceleration*.5*(g*g):0,function(t,e,n){var a=X();if(Ee(t.input,Ut)&&!Ee(t.input,Bt))t.ignore_horizontal||Ee(t.input,Pt)||(t.speed.x=Math.max(t.speed.x-1*t.acceleration*a,-t.maxspeed),t.mirror=1);else if(Ee(t.input,Bt)&&!Ee(t.input,Ut))t.ignore_horizontal||Ee(t.input,Pt)||(t.speed.x=Math.min(t.speed.x+1*t.acceleration*a,t.maxspeed),t.mirror=0);else if(n){var i=0,r=n.brick_ref.angle;r%90==0?i=90==r&&1&t.mirror&&t.speed.x<0||270==r&&!(1&t.mirror)&&t.speed.x>0?t.speed.x>p?1:-t.speed.x>p?-1:0:t.speed.x>p?-1:-t.speed.x>p?1:0:(r>90&&r<180||r>180&&r<270)&&(i=t.speed.x>p?-1:-t.speed.x>p?1:0),t.speed.x+=1*i*t.acceleration*a}}(t,0,l),Math.abs(t.speed.x)<p&&(t.speed.x=h.x=0),h)},aa=function(t){var e=X(),n=nt(0,0);return t.input?(Ee(t.input,Bt)&&!Ee(t.input,Ut)&&(t.speed.x=Math.min(t.speed.x+t.acceleration*e,t.maxspeed)),Ee(t.input,Ut)&&!Ee(t.input,Bt)&&(t.speed.x=Math.max(t.speed.x-t.acceleration*e,-t.maxspeed)),!Ee(t.input,Ut)&&!Ee(t.input,Bt)&&Math.abs(t.speed.x)>p&&(t.speed.x>0?t.speed.x=Math.max(t.speed.x-t.acceleration*e,0):t.speed.x=Math.min(t.speed.x+t.acceleration*e,0)),Ee(t.input,Pt)&&!Ee(t.input,Gt)&&(t.speed.y=Math.min(t.speed.y+t.acceleration*e,t.maxspeed)),Ee(t.input,Gt)&&!Ee(t.input,Pt)&&(t.speed.y=Math.max(t.speed.y-t.acceleration*e,-t.maxspeed)),!Ee(t.input,Gt)&&!Ee(t.input,Pt)&&Math.abs(t.speed.y)>p&&(t.speed.y>0?t.speed.y=Math.max(t.speed.y-t.acceleration*e,0):t.speed.y=Math.min(t.speed.y+t.acceleration*e,0))):t.speed=nt(0,0),n.x=Math.abs(t.speed.x)>p?t.speed.x*e+.5*t.acceleration*e*e:0,n.y=0,t.speed.x=n.x,t.speed.y=n.y,n},ia=function(t,e){var n,a,i,r,o,c,s,u=null,l=!1;for(n=t;n&&!l;n=n.next)if(n.data){if(0==n.data.brick_ref.property||!n.data.enabled)continue;if(2==n.data.brick_ref.property&&u&&1==u.brick_ref.property)continue;if(1==n.data.brick_ref.behavior&&u&&1!=u.brick_ref.behavior&&n.data.y>=u.y)continue;if(Un&&0==n.data.brick_ref.angle)continue;if(Bn&&180==n.data.brick_ref.angle)continue;if(Pn&&n.data.brick_ref.angle>0&&n.data.brick_ref.angle<180)continue;if(Gn&&n.data.brick_ref.angle>180&&n.data.brick_ref.angle<360)continue;var d=[n.data.x,n.data.y,n.data.x+n.data.brick_ref.image.width,n.data.y+n.data.brick_ref.image.height];if(J(e,d))if(1!=n.data.brick_ref.behavior&&u&&1==u.brick_ref.behavior&&n.data.y<=u.y)u=n.data;else if(1==n.data.brick_ref.property&&u&&2==u.brick_ref.property)u=n.data;else if(2==n.data.brick_ref.property&&u&&2==u.brick_ref.property)n.data.y>u.y&&(u=n.data);else if(n.data.brick_ref.angle%90==0)u?Cn?u.brick_ref.angle%180!=0&&(u=n.data):u.brick_ref.angle%180==0&&(u=n.data):u=n.data;else for(a=n.data.brick_ref.angle,c=Math.tan(a*m/180),r=e[0];r<=e[2]&&!l;r++)for(o=e[1];o<=e[3]&&!l;o++){switch(i=!1,~~(a/90)%4){case 0:s=d[3]+c*(d[0]-r),i=d[0]<=r&&r<=d[2]&&s<=o&&o<=d[3];break;case 1:s=d[3]-c*(d[2]-r),i=d[0]<=r&&r<=d[2]&&d[1]<=o&&o<=s;break;case 2:s=d[3]-c*(d[0]-r),i=d[0]<=r&&r<=d[2]&&d[1]<=o&&o<=s;break;case 3:s=d[3]+c*(d[2]-r),i=d[0]<=r&&r<=d[2]&&s<=o&&o<=d[3]}i&&(u=n.data,l=!0)}}return u},ra=function(t,e,n){var a,i,r,o,c,s,u,l,d;return r=-e.angle,a=zn(e).width,i=zn(e).height,l=e.hot_spot,d=e.position,o=it(nt(0,0),l),c=it(nt(a,0),l),s=it(nt(a,i),l),u=it(nt(0,i),l),n[0]=at(d,ct(o,r)),n[1]=at(d,ct(c,r)),n[2]=at(d,ct(s,r)),n[3]=at(d,ct(u,r)),n},oa=function(t,e){return t.translate(e,0),t.scale(-1,1),t.translate(-e,0),t},ca=[],sa={},ua={},la=function(t){for(var e={type:q(t,0,9),text:null,width:0,visible:!0,hspace:1,vspace:1,value:[],position:nt(0,0)},n=0;n<5;n++)e.value[n]=0;return e},da=function(t){t.text&&(t.text=null)},pa=function(t,e){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];if(!t)return!1;for(var i=0;i<n.length;i++)n[i]=""+n[i];var r=(e=""+e).match(/\$[A-Z_\d]\w+/g);if(r)for(i=0;i<r.length;i++){var o=r[i].slice(1),c=Be(o);c&&(e=e.replace("$"+o,c))}if(r=e.match(/\%[s]+/g))for(i=0;i<r.length;i++)n[i]&&((o=n[i].match(/\$[A-Z_\d]\w+/g))&&(n[i]=o[0].slice(1)),e=e.replace("%s",Be(n[i])));if(r=e.match(/\%[d]+/g))for(i=0;i<r.length;i++)n[i]&&(e=e.replace("%d",""+n[i]));return t.text=""+e,t},fa=function(t){return t.text?t.text:""},_a=function(t){return ga(t)},ha=function(t,e){t.width=Math.max(0,e)},ma=function(t,e){var n,a,i,r,o,c=0,s=0,u=[],l=0,d=0;u[d++]={disabled:!0,r:0,g:0,b:0};var p=ga(t);if(n=p.x,a=p.y,t&&t.visible&&t.text)for(l=0;l<t.text.length;l++){if(i=t.text[l],o=!1,Q(t.text[l-1])){var f=void 0,_=!1,h=0,m=t.text.slice(l),g=(m=(m=m.replace("(","")).replace(")","")).split(" ")[0];for(f=0;f<g.length;f++)"<"==g[f]&&(_=!0),_||h++,">"==g[f]&&(_=!1);o=t.width>0&&c+(n+t.hspace)*h-t.hspace>t.width}if("<"==i){if("<color="==(_=t.text.slice(l,l+7))){l+=7;var v=t.text.slice(l,l+6),b={disabled:!1,r:ba(v.slice(0,2)),g:ba(v.slice(2,4)),b:ba(v.slice(4,6))};u[d++]=b,l+=7,i=t.text[l]}"</color"==_&&(l+=8,i=t.text[l],d>=2&&d--)}o&&(c=0,s+=a+t.vspace),"\n"!=i?(r=ca[t.type].ch[i])?(c+=r.width,Q(t.text[l-1]),va(i,Et(),r,~~t.position.x+c-(e.x-240),~~t.position.y+s-(e.y-135.5),u[d-1])):c+=n+t.hspace:(c=0,s+=a+t.vspace)}},ga=function(t){var e,n;if(t)for(e=0;e<256;e++)if(ca[t.type]&&null!=(n=ca[t.type].ch[e]))return nt(n.width,n.height);return nt(16,16)},va=function(t,e,n,a,i,r){var o,c;r&&!r.disabled?(o=ya(n.data),c=xa(t,n.data,o,r.r,r.g,r.b)):c=n.data,e.drawImage(c,n.sx,n.sy,n.swidth,n.sheight,a,i-2,1*n.width,1*n.height)},ba=function(t){var e=/^#?([a-f\d]{2})$/i.exec(t);return e?parseInt(e[1],16):null},ya=function(t){if(sa[t.src])return sa[t.src];var e=t.width,n=t.height,a=[],i=document.createElement("canvas");i.width=e,i.height=n;var r=i.getContext("2d");r.drawImage(t,0,0);for(var o=r.getImageData(0,0,e,n).data,c=0;c<4;c++){var s=document.createElement("canvas");s.width=e,s.height=n;var u=s.getContext("2d");u.drawImage(t,0,0);for(var l=u.getImageData(0,0,e,n),d=l.data,p=0,f=o.length;p<f;p+=4)d[p]=0===c?o[p]:0,d[p+1]=1===c?o[p+1]:0,d[p+2]=2===c?o[p+2]:0,d[p+3]=o[p+3];u.putImageData(l,0,0);var _=new Image;_.src=s.toDataURL(),a.push(_)}return sa[t.src]=a,a},xa=function(t,e,n,a,i,r){var o=t+"_"+a+"_"+i+"_"+r+"_"+e.src,c=ua[o];if(c)return c;var s=document.createElement("canvas");s.width=e.width,s.height=e.height;var u=s.getContext("2d");u.globalAlpha=1,u.globalCompositeOperation="copy",u.drawImage(n[3],0,0),u.globalCompositeOperation="lighter",a>0&&(u.globalAlpha=a/255,u.drawImage(n[0],0,0)),i>0&&(u.globalAlpha=i/255,u.drawImage(n[1],0,0)),r>0&&(u.globalAlpha=r/255,u.drawImage(n[2],0,0));var l=u.getImageData(0,0,s.width,s.height);u.putImageData(l,0,0);var d=new Image;return d.src=s.toDataURL(),wa(s)||(ua[o]=d),d},wa=function(t){for(var e=t.getContext("2d").getImageData(0,0,t.width,t.height),n=0;n<e.data.length;n+=4)if(0!==e.data[n+3])return!1;return!0},ka=[],Ea=[],Sa=0,Ma=-1,Ta=!1,ja=!1,Ia=function(){$t=_n(fn("SD_CONFIRMBOX",0),0),Qt=nt((ut-$t.width)/2,lt),Jt=we(),Kt=Yn(),Qn(Kt,fn("SD_TITLEFOOT",0)),Vt=la(8),pa(Vt,qt),ha(Vt,164);for(var t=0;t<Sa;t++)ka[t]=[],ka[t][0]=la(8),ka[t][1]=la(8),pa(ka[t][0],Ea[t]),pa(ka[t][1],"<color=ffff00>%s</color>",Ea[t]);Ma=0,Ta=!0,ja=!1},Da=function(){var t,e=X();if(Ta&&(Qt.y<=(lt-$t.height)/2?Ta=!1:Qt.y-=1355*e),ja){if(Qt.y>=lt)return ja=!1,void Fe();Qt.y+=1355*e}for(Kt.position=nt(Qt.x+Ma*$t.width/Sa+10,Qt.y+.75*$t.height-1),Vt.position=nt(Qt.x+10,Qt.y+10),t=0;t<Sa;t++)ka[t][0].position=nt(Qt.x+t*$t.width/Sa+25,Qt.y+.75*$t.height),ka[t][1].position=ka[t][0].position;Ta||ja||(Se(Jt,Ut)?(A($e("choose")),Ma=((Ma-1)%Sa+Sa)%Sa):Se(Jt,Bt)?(A($e("choose")),Ma=(Ma+1)%Sa):(Se(Jt,Yt)||Se(Jt,Wt))&&(A($e("select")),ja=!0))},Oa=function(){var t,e,n=nt(240,135.5);for(xt(),Et().drawImage($t.data,$t.sx,$t.sy,$t.swidth,$t.sheight,Qt.x,Qt.y,$t.swidth,$t.sheight),ma(Vt,n),t=0;t<Sa;t++)e=t==Ma?1:0,ma(ka[t][e],n);Wn(Kt,n)},Ra=function(){Hn(Kt),ke(Jt),da(Vt),on(void 0)},Aa=function(){if(-1!=Ma){var t=Ma+1;return Ma=-1,t}return 0},La=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},Na=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Ca=function(t){return La(void 0,void 0,void 0,(function(){var e,n;return Na(this,(function(a){switch(a.label){case 0:return k('background_load("'.concat(t,'")')),[4,x(t)];case 1:return e=a.sent(),[4,$a(e)];case 2:return[2,{data:n=a.sent(),length:n.length}]}}))}))},Ga=function(t){k("background_unload()");for(var e=0;e<t.length;e++)t.data[e]=Ha(t.data[e]);return null},Pa=function(t){if(!t)return!1;for(var e=0;e<t.length;e++){var n=t.data[e];n.strategy&&n.strategy.update&&n.strategy.update(n.strategy)}},Ua=function(t,e){Ya(t,e,!1)},Ba=function(t,e){Ya(t,e,!0)},Ya=function(t,e,n){if(t){var a,i,r=nt(240,135.5),o=it(e,r);for(a=0;a<t.length;a++)i=t.data[a],(!n&&i.zindex<=.5||n&&i.zindex>.5)&&(i.actor.position.x+=o.x*i.actor.speed.x,i.actor.position.y+=o.y*i.actor.speed.y,Fn(i.actor,r,i.repeat_x,i.repeat_y),i.actor.position.y-=o.y*i.actor.speed.y,i.actor.position.x-=o.x*i.actor.speed.x)}},Ha=function(t){return t.strategy=Wa(t.strategy),function(t){var e,n;if(null!=t.source_file&&(t.source_file=null),null!=t.frame_data&&(t.frame_data=null),null!=t.animation_data){for(e=0;e<t.animation_count;e++)t.animation_data[e]=(null!=(n=t.animation_data[e])&&(null!=n.data&&(n.data=null),n=null),null);t.animation_data=null}t=null}(t.data),Hn(t.actor),t=null,null},Wa=function(t){return null},Fa=function(t){},Xa=function(t){var e=t,n=t.background,a=X();n.actor.position.x+=e.speed_x*a,n.actor.position.y+=e.speed_y*a},za=function(t){var e,n,a,i=t,r=t.background,o=X();e=i.timer+=o,n=Math.sin(i.angularspeed_x*e+i.initialphase_x),a=Math.cos(i.angularspeed_y*e+i.initialphase_y),r.actor.position.x+=-i.angularspeed_x*i.amplitude_x*n*o,r.actor.position.y+=i.angularspeed_y*i.amplitude_y*a*o},$a=function(t){return La(void 0,void 0,void 0,(function(){return Na(this,(function(e){return[2,Promise.all(t.bg.map(Qa))]}))}))},Qa=function(t){return La(void 0,void 0,void 0,(function(){var e,n,a;return Na(this,(function(i){switch(i.label){case 0:switch((e={actor:Yn(),data:null,strategy:null,repeat_x:!1,repeat_y:!1,zindex:0}).actor.spawn_point.x=t.initial_position.xpos,e.actor.spawn_point.y=t.initial_position.ypos,e.actor.position=nt(e.actor.spawn_point.x,e.actor.spawn_point.y),e.actor.speed.x=t.scroll_speed.xspeed,e.actor.speed.y=t.scroll_speed.yspeed,t.behavior&&V(t.behavior)?t.behavior[0]:t.behavior){case"DEFAULT":e.strategy&&(e.strategy=Wa(e.strategy)),e.strategy={background:e,update:Fa};break;case"LINEAR":e.strategy&&(e.strategy=Wa(e.strategy)),e.strategy=function(t,e,n){var a={background:t,update:Xa},i=a;return i.speed_x=e,i.speed_y=n,a}(e,t.behavior[1],t.behavior[2]);break;case"CIRCULAR":e.strategy&&(e.strategy=Wa(e.strategy)),e.strategy=function(t,e,n,a,i,r,o){var c={background:t,update:za},s=c;return s.timer=0,s.amplitude_x=e,s.amplitude_y=n,s.angularspeed_x=2*m*a,s.angularspeed_y=2*m*i,s.initialphase_x=r*m/180,s.initialphase_y=o*m/180,c}(e,t.behavior[1],t.behavior[2],t.behavior[3],t.behavior[4],t.behavior[5],t.behavior[6])}return e.repeat_x=t.repeat_x,e.repeat_y=t.repeat_y,t.zindex&&(e.zindex=t.zindex),[4,hn(t.sprite)];case 1:return n=i.sent(),a=n,e.data=a,e.actor.animation=a,e.actor.animation.data=[0],[2,e]}}))}))},Va=["<color=ffff00>$CREDITS_ENGINE</color>\n\n","<color=ffff00>$CREDITS_ACTIVE</color>\n\n","Alexandre Martins:\n$CREDITS_ALEXANDRE\n\n","Di Rodrigues:\n$CREDITS_DI\n\n","Colin:\n$CREDITS_COLIN\n\n","Mateus Reis:\n$CREDITS_MATEUSREIS\n\n","Christopher Martinus:\n$CREDITS_CHRISTOPHER\n\n","Celdecea:\n$CREDITS_CELDECEA\n\n","Christian Zigotzky:\n$CREDITS_XENO\n\n","Joepotato28:\n$CREDITS_JOE\n\n","Arthur Blot:\n$CREDITS_ARTHURBLOT\n\n","Reimund Renner:\n$CREDITS_REIMUND\n\n","Szymon Weihs:\n$CREDITS_SZYMON\n\n","Tomires:\n$CREDITS_TOMIRES\n\n","Sascha de waal:\n$CREDITS_SSDW\n\n","Francesco Sciusco:\n$CREDITS_FRANCESCO\n\n","<color=ffff00>$CREDITS_THANKS</color>\n\n","SourceForge.net\n","allegro.cc\n","OpenGameArt.org\n","GagaGames.com.br\n","Rsonist88\n","PlayDeb.net\n\n","<color=ffff00>$CREDITS_RETIRED</color>\n\n","Neoblast:\n$CREDITS_NEOBLAST\n\n","Bastian von Halem:\n$CREDITS_BASTIAN\n\n","Lainz:\n$CREDITS_LAINZ\n\n","Jogait:\n$CREDITS_JOGAIT\n\n"],Ka=!1,qa=0,Ja=function(){return t=void 0,e=void 0,a=function(){var t,e,n,a,i,r,o,c;return function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(s){switch(s.label){case 0:for(Ka=!1,ae=we(),te=la(4),pa(te,Be("CREDITS_TITLE")),te.position.x=140,te.position.y=5,ne=la(8),pa(ne,Be("CREDITS_KEY")),ne.position.x=10,ne.position.y=lt-_a(ne).y-5,ee=la(8),o=0;o<Va.length;o++)if(t=Va[o],e=t.match(/\$[A-Z_\d]\w+/m)){for(n=0;n<e.length;n++)a=e[n].slice(1),(i=Be(a))&&(t=t.replace("$"+a,i));Va[o]=t}for(pa(ee,Va.join(""),"%s"),ha(ee,300),ee.position.x=10,ee.position.y=lt,qa=1,r=fa(ee),o=0;o<r.length;o++)"\n"==r[o]&&qa++;return qa+=10,Zt=Ze(ut,30),[4,Ca("data/themes/credits.bg.json")];case 1:return c=s.sent(),ie=c,gt(an(0,0,0),1),[2]}}))},new((n=void 0)||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}));var t,e,n,a},Za=function(){var t,e=X();if(Pa(ie),ee.position.y-=3*_a(ee).y*e,ee.position.y<-qa*(_a(ee).y+(t=ee,nt(t.hspace,t.vspace)).y)&&(ee.position.y=lt),Ka||yt()||(Se(ae,Wt)?(A($e("select")),Ka=!0):Se(ae,Ft)&&(A($e("return")),Ka=!0)),!O()){var n=M("data/music/options.mp4");T(n,!0)}if(Ka){if(bt())return void Fe();vt(an(0,0,0),1)}},ti=function(){xt();var t=nt(240,135.5);Ua(ie,t),Ba(ie,t),ma(ee,t),Et().fillRect(0,0,Zt.width,Zt.height),Et().fillRect(0,251,Zt.width,Zt.height),ma(te,t),ma(ne,t)},ei=function(){ie=Ga(ie),on(Zt),da(te),da(ee),da(ne),ke(ae)},ni=10,ai=0,ii=null,ri=null,oi=[],ci=function(){var t;for(ai=z(),(ii=la(8)).position=nt(5,35),ri=la(4),pa(ri,Be("ENDOFDEMO_TITLE")),ri.position=nt((ut-_a(ri).x*fa(ri).length)/2,5),t=0;t<ni;t++)oi[t]=Yn(),oi[t].spawn_point=oi[t].position=nt(ut*t/ni+15,215),Qn(oi[t],fn(t%2==1?"SD_BLUERING":"SD_RING",0));gt(an(0,0,0),2)},si=function(){var t,e=z(),n=Math.max(0,(3-(e-ai))/1e3);if(pa(ii,Be("ENDOFDEMO_TEXT"),l,d,n),e>=ai+3){if(bt())return Fe(),void We(Py(Oy));vt(an(0,0,0),2)}for(t=0;t<ni;t++)oi[t].position.y=oi[t].spawn_point.y+10*Math.sin(m*(.001*e)+2*m/ni*t)},ui=function(){var t,e=nt(240,135.5);for(xt(),t=0;t<ni;t++)Wn(oi[t],e);ma(ri,e),ma(ii,e)},li=function(){var t;for(t=0;t<ni;t++)Hn(oi[t]);da(ri),da(ii)},di={is_locked:!1,position:nt(0,0),dest:nt(0,0),speed:0,region_topleft:nt(0,0),region_bottomright:nt(0,0),dest_region_topleft:nt(0,0),dest_region_bottomright:nt(0,0),region_topleft_speed:0,region_bottomright_speed:0},pi=function(t,e){t.x<di.region_topleft.x&&(t.x=di.region_topleft.x),t.y<di.region_topleft.y&&(t.y=di.region_topleft.y),t.x>di.region_bottomright.x&&(t.x=di.region_bottomright.x),t.y>di.region_bottomright.y&&(t.y=di.region_bottomright.y),di.dest=t,e>p?di.speed=ot(it(di.position,di.dest))/e:di.position=di.dest,di.position.x=t.x,di.position.y=t.y},fi=function(){return nt(di.position.x,di.position.y)},_i=function(t){di.dest=di.position=t},hi=function(t,e,n,a){di.dest_region_topleft.x=Math.max(Math.min(t,n),240),di.dest_region_topleft.y=Math.max(Math.min(e,a),135.5),di.dest_region_bottomright.x=Math.min(Math.max(t,n),Gh().x-240),di.dest_region_bottomright.y=Math.min(Math.max(e,a),Gh().y-135.5),di.region_topleft_speed=ot(it(di.region_topleft,di.dest_region_topleft))/.25,di.region_bottomright_speed=ot(it(di.region_bottomright,di.dest_region_bottomright))/.25},mi=function(t){},gi=function(t){},vi=function(t,e,n,a,i,r){},bi=function(t,e){var n=t.get_object_instance(t).actor,a=n.position;n.position=nt(n.position.x,n.position.y),Wn(n,e),n.position=a},yi=function(t){return t.object},xi=function(t){return t.reference_to_current_state},wi=function(t,e){var n=Ei(t.state_list,e);return null!=n?t.reference_to_current_state=n.data:k("Object script error: can't find state ".concat(e)),t},ki=function(t){if(null!=t){var e=t.data;ki(t.next),e.release(e)}return null},Ei=function(t,e){return null!=t?t.name==e?Ei(t.next,e):t:null},Si=function(t){var e=t.decorated_machine;return e.get_object_instance(e)},Mi=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Yn(),t.actor.maxspeed=145+K(21),t.actor.input=ye(),e.is_running=!1,e.animal_id=K(12),Qn(t.actor,fn("SD_ANIMAL",0))},Ti=function(t){Hn(t.actor)},ji=function(t,e,n,a,i,r){var o,c,s,u,l=t,d=t.actor,f=2*l.animal_id+(l.is_running?1:0);Te(d.input,Yt),d.jump_strength=1.3*(200+K(50)),d.speed.x>p?(d.speed.x=d.maxspeed,d.mirror=0):d.speed.x<-1e-5&&(d.speed.x=-d.maxspeed,d.mirror=1),Qn(d,fn("SD_ANIMAL",f));var _=Jn(d,2,-2,a,o,null,u,null,c,null,s,null);o=_.up,_.upright,u=_.right,_.downright,c=_.down,_.downleft,s=_.left,_.upleft;var h=ea(d,-2,o,null,u,null,c,null,s,null);o=h.up,h.upright,u=h.right,h.downright,c=h.down,h.downleft,s=h.left,h.upleft,c&&!l.is_running&&(l.is_running=!0,d.speed.x=(K(2)?-1:1)*d.maxspeed),s&&!o&&(d.speed.x=d.maxspeed),u&&!o&&(d.speed.x=-d.maxspeed),!l.is_running&&(c&&o||s&&u)&&(t.state=Oc),Xn(d,na(d,a,Qh()))},Ii=function(t,e){Wn(t.actor,e)},Di=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Yn(),Li(t,Ni()),Qn(t.actor,fn("SD_ENDLEVEL",0))},Oi=function(t){Hn(t.actor),Li(t,null)},Ri=function(t,e,n,a,i,r){var o=t;o.state.handle(o.state,t,e,n)},Ai=function(t,e){Wn(t.actor,e)},Li=function(t,e){t.state=e},Ni=function(){var t={handle:Ci},e=t;return e.being_hit=!1,e.hit_count=0,t},Ci=function(t,e,n,a){for(var i,r,o=t,c=e.actor,s=0;s<a;s++){var u=n[s];Bi(e,u)&&!o.being_hit&&(o.being_hit=!0,Qn(c,fn("SD_ENDLEVEL",1)),A($e("boss hit")),as(u),u.actor.speed.x*=-.5,++o.hit_count>=3&&Li(e,(i=void 0,r=void 0,r=i={handle:Gi},i.handle=Gi,r.explode_timer=0,r.break_timer=0,i)))}Vn(c)&&o.being_hit&&(Qn(c,fn("SD_ENDLEVEL",0)),o.being_hit=!1)},Gi=function(t,e,n,a){var i=t,r=e.actor,o=X();if(i.explode_timer+=o,i.break_timer+=o,i.explode_timer>=.1){var c=nt(r.position.x-r.hot_spot.x+K(zn(r).width),r.position.y-r.hot_spot.y+K(zn(r).height/2));Kh(kc,c),A($e("explode")),i.explode_timer=0}i.break_timer>=2&&Li(e,{handle:Pi})},Pi=function(t,e,n,a){for(var i=e.actor,r=0;r<20;r++){var o=nt(i.position.x-i.hot_spot.x+K(zn(i).width),i.position.y-i.hot_spot.y+K(zn(i).height/2));tm(o)}Bh(i),Qn(i,fn("SD_ENDLEVEL",2)),Li(e,{handle:Ui})},Ui=function(t,e,n,a){},Bi=function(t,e){if(t&&e){var n=[],a=[],i=t.actor,r=e.actor;return n[0]=r.position.x-r.hot_spot.x,n[1]=r.position.y-r.hot_spot.y,n[2]=n[0]+zn(r).width,n[3]=n[1]+zn(r).height,a[0]=i.position.x-i.hot_spot.x+5,a[1]=i.position.y-i.hot_spot.y,a[2]=a[0]+zn(i).width-10,a[3]=a[1]+zn(i).height/2,is(e)&&J(n,a)&&qn(i,r)}},Yi=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Yn(),Qn(t.actor,fn("SD_BLUERING",0))},Hi=function(t){Hn(t.actor)},Wi=function(t,e,n,a,i,r){for(var o=0;o<n;o++){var c=e[o];c&&!c.dying&&Kn(c.actor,t.actor)&&(t.state=Oc,ss(rs()+50),Yh(5e3),A($e("big ring")),Hh("$BONUSMSG_TITLE","$BONUSMSG_TEXT"),Bg(Ig,Yg(Ig)+1))}},Fi=function(t,e){Wn(t.actor,e)},Xi=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Yn(),e.is_disappearing=!1,Qn(t.actor,fn("SD_BLUERING",0))},zi=function(t,e,n,a,i,r){var o=Lh(),c=t,s=t.actor;s.visible=o.got_glasses||Ah(),c.is_disappearing?Vn(s)&&(t.state=Oc):!o.dying&&o.got_glasses&&Kn(s,o.actor)&&(Qn(s,fn("SD_BLUERING",1)),ss(rs()+5),A($e("blue ring")),c.is_disappearing=!0)},$i=function(t,e){Wn(t.actor,e)},Qi=function(t){Hn(t.actor)},Vi=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Yn(),e.getting_hit=!1,Qn(t.actor,fn("SD_BUMPER",0))},Ki=function(t,e,n,a,i,r){for(var o=t,c=t.actor,s=0;s<n;s++){var u=e[s];u&&!u.dying&&qn(u.actor,c)&&(o.getting_hit||(o.getting_hit=!0,Qn(c,fn("SD_BUMPER",1)),A($e("bumper")),Zi(t,u)))}o.getting_hit&&Vn(c)&&(o.getting_hit=!1,Qn(c,fn("SD_BUMPER",0)))},qi=function(t,e){Wn(t.actor,e)},Ji=function(t){Hn(t.actor)},Zi=function(t,e){var n,a,i,r=t.actor;(n=e.actor.speed).x=n.x<0?Math.min(-300,n.x):Math.max(300,n.x),a=rt(st(it(r.position,e.actor.position)),ot(n)),i=rt(a,1),e.actor.speed=rt(at(n,rt(i,-1e4)),1/10001),r.speed=rt(at(n,i),1/10001),e.flying=!1,e.landing=!1,e.climbing=!1,e.spring=!1},tr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Yn(),e.is_active=!1,Qn(t.actor,fn("SD_CHECKPOINT",0))},er=function(t,e,n,a,i,r){var o=t,c=t.actor;if(o.is_active)Vn(c)&&Qn(c,fn("SD_CHECKPOINT",2));else for(var s=0;s<n;s++){var u=e[s];if(u&&!u.dying&&qn(u.actor,c)){o.is_active=!0,A($e("checkpoint")),Uh(c.position),Qn(c,fn("SD_CHECKPOINT",1));break}}},nr=function(t,e){Wn(t.actor,e)},ar=function(t){Hn(t.actor)},ir=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Yn(),Qn(t.actor,fn("SD_ITEMBOX",10))},rr=function(t,e,n,a,i,r){},or=function(t,e){Wn(t.actor,e)},cr=function(t){Hn(t.actor)},sr=function(t,e){var n={init:ur,release:pr,update:lr,render:dr},a=n;return n.init=ur,n.release=pr,n.update=lr,n.render=dr,a.sprite_name=t,a.player_is_vulnerable=e,n},ur=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Yn(),Qn(t.actor,fn(e.sprite_name,0))},lr=function(t,e,n,a,i,r){for(var o=t,c=t.actor,s=0;s<n;s++){var u=e[s];u&&(u.dying||u.blinking||u.invincible||!Kn(c,u.actor)||o.player_is_vulnerable(u)&&es(u))}c.visible=Ah()},dr=function(t,e){Wn(t.actor,e)},pr=function(t){Hn(t.actor)},fr=function(t){return!0},_r=function(t){return t.shield_type!=Wc},hr=function(t,e){t.actor.speed=e},mr=function(t){t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Yn(),Qn(t.actor,fn("SD_DANGPOWER",0))},gr=function(t,e,n,a,i,r){for(var o=X(),c=t.actor,s=rt(c.speed,o),u=0;u<n;u++){var l=e[u];l&&!l.dying&&Kn(c,l.actor)&&(es(l),t.state=Oc)}c.position=at(c.position,s)},vr=function(t,e){Wn(t.actor,e)},br=function(t){Hn(t.actor)},yr=function(t,e){var n={init:xr,release:Er,update:wr,render:kr},a=n;return a.authorized_player_type=t,a.is_vertical_door=e,n},xr=function(t){var e,n,a=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Yn(),n=a.authorized_player_type,e=a.is_vertical_door?"SD_DNADOOR":"SD_HORIZONTALDNADOOR",Qn(t.actor,fn(e,n))},wr=function(t,e,n,a,i,r){var o,c=t,s=t.actor,u=!1,l=!1,d=X(),p=[],f=[];t.obstacle=!0;for(var _=0;_<n;_++){var h=e[_];h&&(h.dying||h.actor.carrying||h.actor.carried_by||!Sr(h,t)||(h.type==c.authorized_player_type?(t.obstacle=!1,l=qn(s,h.actor)):u=!0))}if(u&&(t.obstacle=!0),t.obstacle?s.alpha=Math.min(1,s.alpha+2*d):l&&(s.alpha=Math.max(.4,s.alpha-2*d)),l)for(p[0]=s.position.x-s.hot_spot.x-5,p[1]=s.position.y-s.hot_spot.y-5,p[2]=p[0]+zn(s).width+10,p[3]=p[1]+zn(s).height+10,o=i;null!=o;o=o.next)o.data.type==t.type&&(f[0]=o.data.actor.position.x-o.data.actor.hot_spot.x-5,f[1]=o.data.actor.position.y-o.data.actor.hot_spot.y-5,f[2]=f[0]+zn(o.data.actor).width+10,f[3]=f[1]+zn(o.data.actor).height+10,J(p,f)&&(o.data.actor.alpha<s.alpha?s.alpha=o.data.actor.alpha:o.data.actor.alpha=s.alpha))},kr=function(t,e){Wn(t.actor,e)},Er=function(t){Hn(t.actor)},Sr=function(t,e){var n=[],a=[],i=t.actor,r=e.actor;return n[0]=i.position.x-i.hot_spot.x,n[1]=i.position.y-i.hot_spot.y,n[2]=n[0]+zn(i).width,n[3]=n[1]+zn(i).height,a[0]=r.position.x-r.hot_spot.x,a[1]=r.position.y-r.hot_spot.y-3,a[2]=a[0]+zn(r).width,a[3]=a[1]+zn(r).height+3,J(n,a)},Mr=function(t){var e=t;t.obstacle=!0,t.bring_to_back=!0,t.preserve=!0,t.actor=Yn(),e.is_closed=!0,Qn(t.actor,fn("SD_DOOR",0))},Tr=function(t,e,n,a,i,r){var o=t,c=t.actor,s=X();o.is_closed?c.position.y=Math.min(c.position.y+2e3*s,c.spawn_point.y):c.position.y=Math.max(c.position.y-2e3*s,c.spawn_point.y-.8*zn(c).height)},jr=function(t,e){Wn(t.actor,e)},Ir=function(t){Hn(t.actor)},Dr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Yn(),e.who=null,Qn(t.actor,fn("SD_ENDSIGN",0))},Or=function(t,e,n,a,i,r){var o=t,c=t.actor;if(null==o.who){var s=void 0;for(s=0;s<n;s++){var u=e[s];u&&!u.dying&&qn(u.actor,c)&&(o.who=u,A($e("end sign")),Qn(c,fn("SD_ENDSIGN",1)),Bh(t.actor))}}else if(Vn(c)){var l=2+o.who.type;Qn(c,fn("SD_ENDSIGN",l))}},Rr=function(t,e){Wn(t.actor,e)},Ar=function(t){Hn(t.actor)},Lr=function(t){t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Yn(),Qn(t.actor,fn("SD_EXPLOSION",K(2)))},Nr=function(t,e,n,a,i,r){Vn(t.actor)&&(t.state=Oc)},Cr=function(t,e){Wn(t.actor,e)},Gr=function(t){Hn(t.actor)},Pr=function(t){t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Yn(),Qn(t.actor,fn("SD_GLASSES",4)),t.actor.hot_spot.y*=.5},Ur=function(t,e,n,a,i,r){var o=t.actor,c=X();o.angle+=Math.sign(o.speed.x)*(6*m*c),o.position=at(o.position,function(t,e){var n=X(),a=nt(0,0);return a.x=t.speed.x*n,a.y=t.speed.y*n+.5*e*n*n,t.speed.y+=e*n,a}(o,Qh()))},Br=function(t,e){Wn(t.actor,e)},Yr=function(t){Hn(t.actor)},Hr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Yn(),e.elapsed_time=0,e.font=la(0),pa(e.font,"0"),Qn(t.actor,fn("SD_RING",0)),t.actor.visible=!1},Wr=function(t,e,n,a,i,r){var o=t,c=X();o.elapsed_time+=c,o.elapsed_time<.5?t.actor.position.y-=100*c:o.elapsed_time>2&&(t.state=Oc),o.font.position=t.actor.position},Fr=function(t,e){ma(t.font,e)},Xr=function(t){var e=t;Hn(t.actor),da(e.font)},zr=function(t,e,n,a){for(var i=_,r=null,o=null,c=e;c;c=c.next)c.data&&c.data.type==n&&(o=it(c.data.actor.position,t.actor.position),ot(o)<i&&(r=c.data,i=ot(o)));return a&&(a.dist=i),r},$r=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Yn(),Qn(t.actor,fn("SD_GOAL",0))},Qr=function(t,e,n,a,i,r){var o,c=zr(t,i,Mc,null);o=null!=c?c.actor.position.x>t.actor.position.x?0:1:0,Qn(t.actor,fn("SD_GOAL",o))},Vr=function(t,e){Wn(t.actor,e)},Kr=function(t){Hn(t.actor)},qr=function(t,e){Qn(t.actor,fn("SD_ICON",e))},Jr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Yn(),e.elapsed_time=0,qr(t,0)},Zr=function(t,e,n,a,i,r){var o=t,c=t.actor,s=X();if(o.elapsed_time+=s,o.elapsed_time<1)c.position.y-=40*s;else if(o.elapsed_time>=2.5){var u=void 0,l=void 0,d=c.position.x-c.hot_spot.x,p=c.position.y-c.hot_spot.y,f=zn(c),_=void 0;for(u=0;u<f.height;u++)for(l=0;l<f.width;l++)_=Ze(1,1),rn(_,255,255,255),Jh(_,nt(d+l,p+u),nt(l-f.width/2+(K(f.width)-f.width/2),u-K(f.height/2)),!1);t.state=Oc}},to=function(t,e){Wn(t.actor,e)},eo=function(t){Hn(t.actor)},no=function(t,e){Ch(100),us(os()+1),Ph($e("1up"))},ao=function(t,e){Ch(100),ss(rs()+10),A($e("ring"))},io=function(t,e){Ch(100),e.invincible=!0,e.invtimer=0,T(M("data/music/invincible.mp4"),!1)},ro=function(t,e){Ch(100),e.got_speedshoes=!0,e.speedshoes_timer=0,T(M("data/music/speed.mp4"),!1)},oo=function(t,e){Ch(100),e.got_glasses=!0},co=function(t,e){Ch(100),e.shield_type=Hc,A($e("shield"))},so=function(t,e){Ch(100),e.shield_type=Wc,A($e("fire shield"))},uo=function(t,e){Ch(100),e.shield_type=Fc,A($e("thunder shield"))},lo=function(t,e){Ch(100),e.shield_type=Xc,A($e("water shield"))},po=function(t,e){Ch(100),e.shield_type=zc,A($e("acid shield"))},fo=function(t,e){Ch(100),e.shield_type=$c,A($e("wind shield"))},_o=function(t,e){es(e)},ho=function(t,e){Ch(100)},mo=function(t,e){var n={init:go,release:yo,update:vo,render:bo},a=n;return a.on_destroy=t,a.anim_id=e,n},go=function(t){var e=t;t.obstacle=!0,t.bring_to_back=!1,t.preserve=!0,t.actor=Yn(),Qn(t.actor,fn("SD_ITEMBOX",e.anim_id))},vo=function(t,e,n,a,i,r){for(var o=t.actor,c=t,s=0;s<n;s++){var u=e[s];if(u&&!(u.actor.is_jumping&&u.actor.speed.y<-10)&&t.state===Dc&&xo(t,u)&&is(u)){var l=Kh(wc,at(o.position,nt(0,-5)));qr(l,c.anim_id),Kh(kc,at(o.position,nt(0,-20))),Kh(xc,o.position),A($e("destroy")),u.actor.is_jumping&&as(u),c.on_destroy(t,u),t.state=Oc}}c.anim_id=c.anim_id<e.length?Nh():c.anim_id,Qn(t.actor,fn("SD_ITEMBOX",c.anim_id))},bo=function(t,e){Wn(t.actor,e)},yo=function(t){Hn(t.actor)},xo=function(t,e){var n,a=t.actor.position;return n=Kn(t.actor,e.actor),t.actor.position=a,n},wo=function(t,e){var n={init:ko,release:Eo,update:So,render:Mo},a=n;return a.on_collision=t,a.sprite_name=e,n},ko=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Yn(),Qn(t.actor,fn(e.sprite_name,0))},Eo=function(t){Hn(t.actor)},So=function(t,e,n,a,i,r){var o=t,c=t.actor;c.visible=!1;for(var s=0;s<n;s++){var u=e[s];u&&Kn(c,u.actor)&&(u.at_loopfloortop=To(t,i,u),o.on_collision(u))}},Mo=function(t,e){Wn(t.actor,e)},To=function(t,e,n){var a=zr(t,e,Tc,null);return null!=a&&Kn(n.actor,a.actor)},jo=function(t){t.disable_wall|=Pc,t.entering_loop=!0,t.bring_to_back=!1},Io=function(t){if(!t.flying){var e=t.actor.speed.x>0;t.disable_wall&=~(Pc|Cc),t.disable_wall|=e?Cc:Pc,t.bring_to_back=e}},Do=function(t){t.disable_wall|=Cc,t.entering_loop=!0,t.bring_to_back=!0},Oo=function(t){t.entering_loop||(t.disable_wall=Nc,t.bring_to_back=!1)},Ro=function(t){t.at_loopfloortop||t.flying||(t.disable_wall|=Gc,t.entering_loop=!0,t.bring_to_back=!0)},Ao=function(t){t.at_loopfloortop||t.entering_loop||t.flying||(t.disable_wall&=~Gc,t.bring_to_back=!1)},Lo=function(t){if(!t.flying)if(t.disable_wall&Gc){var e=t.actor.speed.x>0;t.disable_wall&=~(Pc|Cc),t.disable_wall|=e?Cc:Pc,t.bring_to_back=!0}else t.disable_wall&=~(Pc|Cc),t.bring_to_back=!0},No=function(t){t.is_moving=!0,t.actor.speed.x=t.actor.maxspeed*(K(100)-50)/100,t.actor.speed.y=-t.actor.jump_strength+K(t.actor.jump_strength)},Co=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Yn(),t.actor.maxspeed=220+K(140),t.actor.jump_strength=1.2*(350+K(50)),t.actor.input=ye(),e.is_disappearing=!1,e.is_moving=!1,e.life_time=0,Qn(t.actor,fn("SD_RING",0))},Go=function(t){Hn(t.actor)},Po=function(t,e,n,a,i,r){for(var o=X(),c=t,s=t.actor,u=0;u<n;u++){var l=e[u];if(l&&(!c.is_moving||c.is_moving&&!l.getting_hit&&c.life_time>=.5)&&!c.is_disappearing&&!l.dying&&Kn(s,l.actor)){ss(rs()+1),c.is_disappearing=!0,A($e("ring"));break}}if(c.is_disappearing)Qn(s,fn("SD_RING",1)),Vn(s)&&(t.state=Oc);else if(c.is_moving){if(Te(s.input,Yt),t.preserve=!1,c.life_time+=o,c.life_time>5){var d=240+K(20);s.visible=z()%d<d/2,c.life_time>8&&(t.state=Oc)}Xn(s,na(s,a,Qh()))}},Uo=function(t,e){Wn(t.actor,e)},Bo=function(t,e,n){var a={init:Yo,release:Ho,update:Wo,render:Fo},i=a;return i.collision=t,i.anim_id=e,i.cycle_length=n,a},Yo=function(t){var e=t;t.obstacle=!0,t.bring_to_back=!0,t.preserve=!0,t.actor=Yn(),e.timer=0,e.hidden=!1,Qn(t.actor,fn("SD_SPIKES",e.anim_id))},Ho=function(t){Hn(t.actor)},Wo=function(t,e,n,a,i,r){var o=t,c=X();if(o.timer+=c,o.timer>=.5*o.cycle_length&&(o.timer=0,o.hidden=!o.hidden,A($e(o.hidden?"spikes disappearing":"spikes appearing"))),t.obstacle=!o.hidden,t.actor.visible=!o.hidden,!o.hidden)for(var s=0;s<n;s++){var u=e[s];if(u&&!u.dying&&!u.blinking&&!u.invincible&&o.collision(t,u)){var l=$e("spikes hit");N(l)||A(l),es(u)}}},Fo=function(t,e){Wn(t.actor,e)},Xo=function(t,e){var n=[],a=t.actor;return n[0]=a.position.x-a.hot_spot.x,n[1]=a.position.y-a.hot_spot.y,n[2]=n[0]+zn(a).width,n[3]=n[1]+zn(a).height,J(n,e)},zo=function(t,e){var n,a=[],i=t.actor;return a[0]=i.position.x-i.hot_spot.x+5,a[1]=i.position.y-i.hot_spot.y-5,a[2]=a[0]+zn(i).width-10,a[3]=a[1]+10,n=e.actor.position.y-e.actor.hot_spot.y+zn(e.actor).height,Xo(e,a)&&n<i.position.y-i.hot_spot.y+zn(i).height/2},$o=function(t,e){var n=[],a=t.actor;return n[0]=a.position.x-a.hot_spot.x+5,n[1]=a.position.y-a.hot_spot.y+zn(a).height-5,n[2]=n[0]+zn(a).width-10,n[3]=n[1]+10,Xo(e,n)},Qo=function(t,e){var n=[],a=t.actor;return n[0]=a.position.x-a.hot_spot.x+zn(a).width-5,n[1]=a.position.y-a.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+zn(a).height-10,Xo(e,n)},Vo=function(t,e){var n=[],a=t.actor;return n[0]=a.position.x-a.hot_spot.x-5,n[1]=a.position.y-a.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+zn(a).height-10,Xo(e,n)},Ko=function(t,e,n){var a={init:qo,release:Jo,update:Zo,render:tc},i=a;return i.on_bump=t,i.sprite_name=e,i.strength=n,a},qo=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Yn(),e.is_bumping=!1,e.bang_timer=0,Qn(t.actor,fn(e.sprite_name,0))},Jo=function(t){Hn(t.actor)},Zo=function(t,e,n,a,i,r){var o=t,c=X();o.bang_timer+=c;for(var s=0;s<n;s++){var u=e[s];u&&!u.dying&&qn(u.actor,t.actor)&&o.on_bump(t,u)}o.is_bumping&&Vn(t.actor)&&(Qn(t.actor,fn(o.sprite_name,0)),o.is_bumping=!1)},tc=function(t,e){Wn(t.actor,e)},ec=function(t,e){e.actor.speed.y>=1&&!e.actor.carrying&&!e.actor.carried_by&&ac(t,e)},nc=function(t,e){ac(t,e)},ac=function(t,e){var n=t;t.is_bumping=!0,function(t,e){var n=X(),a=[],i=[];a[0]=e.x*t.actor.speed.x>=0,a[1]=e.y*t.actor.speed.y>=0,i[0]=e.x*t.actor.speed.x<=0&&Math.abs(e.x)>p,i[1]=e.y*t.actor.speed.y<=0&&Math.abs(e.y)>p,Math.abs(e.y)>p&&(t.spring=!0),t.flying=!1,t.climbing=!1,t.landing=!1,t.getting_hit=!1,t.is_fire_jumping=!1,(Math.abs(e.x)>Math.abs(t.actor.speed.x)&&a[0]||i[0])&&(t.actor.speed.x=e.x),(Math.abs(e.y)>Math.abs(t.actor.speed.y)&&a[1]||i[1])&&(t.actor.speed.y=e.y,t.actor.position.y+=t.actor.speed.y*n)}(e,t.strength),Qn(n.actor,fn(t.sprite_name,1)),t.strength.x>p?e.actor.mirror&=-2:t.strength.x<-1e-5&&(e.actor.mirror|=1),t.bang_timer>.2&&(A($e("spring")),t.bang_timer=0)},ic=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Yn(),e.is_disabled=!1,e.is_active=!1,e.timer=0,Qn(t.actor,fn("SD_TELEPORTER",0))},rc=function(t,e,n,a,i,r){var o=t,c=t.actor,s=X(),u=0;if(o.is_active){if(o.timer+=s,o.timer>=3){var l=o.who;Ie(l.actor.input),Am(l.actor);for(var d=0;d<n;d++){var p=e[d];if(p!=l){var f=at(c.position,nt(40*u++-20,-30));sc(p,f)}}o.is_active=!1,o.is_disabled=!0}Qn(c,fn("SD_TELEPORTER",1))}else Qn(c,fn("SD_TELEPORTER",0))},oc=function(t,e){Wn(t.actor,e)},cc=function(t){Hn(t.actor)},sc=function(t,e){t&&(t.actor.position=e,t.actor.speed=nt(0,0),t.actor.is_jumping=!1,t.flying=!1,t.climbing=!1,t.getting_hit=!1,t.spring=!1,t.actor.angle=0,t.disable_wall=Nc,t.entering_loop=!1,t.at_loopfloortop=!1,t.bring_to_back=!1)},uc=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Yn(),e.is_pressed=!1,e.partner=null,Qn(t.actor,fn("SD_SWITCH",0))},lc=function(t){Hn(t.actor)},dc=function(t,e,n,a,i,r){var o,c,s=t,u={dist:0},l={dist:0};s.partner=null,o=zr(t,i,Ec,u),c=zr(t,i,Sc,l),null!=o&&u.dist<l.dist&&(s.partner=o),null!=c&&l.dist<u.dist&&(s.partner=c),null==s.partner?fc(t,o,e,n,_c,hc):s.partner==o?fc(t,o,e,n,mc,gc):s.partner==c&&fc(t,c,e,n,vc,bc)},pc=function(t,e){Wn(t.actor,e)},fc=function(t,e,n,a,i,r){for(var o=!0,c=t,s=t.actor,u=0;u<a;u++){var l=n[u];yc(t,l)&&(o=!1,c.is_pressed||(i(e,l),A($e("switch")),Qn(s,fn("SD_SWITCH",1)),c.is_pressed=!0))}o&&c.is_pressed&&(r(e),Qn(s,fn("SD_SWITCH",0)),c.is_pressed=!1)},_c=function(t,e){},hc=function(t){},mc=function(t,e){!function(t){t.is_closed=!1,A($e("open door"))}(t)},gc=function(t){!function(t){t.is_closed=!0,A($e("close door"))}(t)},vc=function(t,e){!function(t,e){var n=t,a=t.actor;n.is_active||n.is_disabled||(n.is_active=!0,n.who=e,je(e.actor.input),Am(a),A($e("teleporter")))}(t,e)},bc=function(t){},yc=function(t,e){if(!t)return!1;if(!e)return!1;var n=[],a=[];return n[0]=t.actor.position.x-t.actor.hot_spot.x,n[1]=t.actor.position.y-t.actor.hot_spot.y,n[2]=n[0]+zn(t.actor).width,n[3]=n[1]+zn(t.actor).height,a[0]=e.actor.position.x-e.actor.hot_spot.x+.3*zn(e.actor).width,a[1]=e.actor.position.y-e.actor.hot_spot.y+.5*zn(e.actor).height,a[2]=a[0]+.4*zn(e.actor).width,a[3]=a[1]+.5*zn(e.actor).height,!e.dying&&!e.climbing&&!e.flying&&J(n,a)},xc=9,wc=10,kc=12,Ec=26,Sc=27,Mc=31,Tc=35;!function(t){t[t.IS_IDLE=0]="IS_IDLE",t[t.IS_DEAD=1]="IS_DEAD"}(re||(re={}));var jc,Ic,Dc=re.IS_IDLE,Oc=re.IS_DEAD,Rc=function(t){var e=null;switch(t){case 0:e={init:Co,release:Go,update:Po,render:Uo};break;case 1:e=mo(no,0);break;case 2:e=mo(ao,3);break;case 3:e=mo(io,4);break;case 4:e=mo(ro,5);break;case 5:e=mo(oo,6);break;case 6:e=mo(co,7);break;case 42:e=mo(so,11);break;case 78:e=mo(uo,12);break;case 79:e=mo(lo,13);break;case 80:e=mo(po,14);break;case 81:e=mo(fo,15);break;case 7:e=mo(_o,8);break;case 8:e=mo(ho,9);break;case xc:e={init:ir,release:cr,update:rr,render:or};break;case wc:e={init:Jr,release:eo,update:Zr,render:to};break;case 11:e={init:Pr,release:Yr,update:Ur,render:Br};break;case kc:e={init:Lr,release:Gr,update:Nr,render:Cr};break;case 13:e={init:Hr,release:Xr,update:Wr,render:Fr};break;case 15:e={init:Mi,release:Ti,update:ji,render:Ii};break;case 16:e=wo(jo,"SD_LOOPRIGHT");break;case 17:e=wo(Io,"SD_LOOPMIDDLE");break;case 18:e=wo(Do,"SD_LOOPLEFT");break;case 19:e=wo(Oo,"SD_LOOPNONE");break;case 33:e=wo(Ro,"SD_LOOPFLOOR");break;case 34:e=wo(Ao,"SD_LOOPFLOORNONE");break;case Tc:e=wo(Lo,"SD_LOOPFLOORTOP");break;case 20:e=Ko(ec,"SD_YELLOWSPRING",nt(0,-500));break;case 54:e=Ko(nc,"SD_BYELLOWSPRING",nt(0,500));break;case 50:e=Ko(nc,"SD_TRYELLOWSPRING",nt(400,-600));break;case 48:e=Ko(nc,"SD_RYELLOWSPRING",nt(600,0));break;case 52:e=Ko(nc,"SD_BRYELLOWSPRING",nt(400,600));break;case 53:e=Ko(nc,"SD_BLYELLOWSPRING",nt(-400,600));break;case 49:e=Ko(nc,"SD_LYELLOWSPRING",nt(-600,0));break;case 51:e=Ko(nc,"SD_TLYELLOWSPRING",nt(-400,-600));break;case 21:e=Ko(ec,"SD_REDSPRING",nt(0,-750));break;case 47:e=Ko(nc,"SD_BREDSPRING",nt(0,750));break;case 43:e=Ko(nc,"SD_TRREDSPRING",nt(800,-1e3));break;case 22:e=Ko(nc,"SD_RREDSPRING",nt(1200,0));break;case 45:e=Ko(nc,"SD_BRREDSPRING",nt(800,1e3));break;case 46:e=Ko(nc,"SD_BLREDSPRING",nt(-800,1e3));break;case 23:e=Ko(nc,"SD_LREDSPRING",nt(-1200,0));break;case 44:e=Ko(nc,"SD_TLREDSPRING",nt(-800,-1e3));break;case 55:e=Ko(ec,"SD_BLUESPRING",nt(0,-1500));break;case 62:e=Ko(nc,"SD_BBLUESPRING",nt(0,1500));break;case 58:e=Ko(nc,"SD_TRBLUESPRING",nt(1800,-1500));break;case 56:e=Ko(nc,"SD_RBLUESPRING",nt(2e3,0));break;case 60:e=Ko(nc,"SD_BRBLUESPRING",nt(1800,1500));break;case 61:e=Ko(nc,"SD_BLBLUESPRING",nt(-1800,1500));break;case 57:e=Ko(nc,"SD_LBLUESPRING",nt(-2e3,0));break;case 59:e=Ko(nc,"SD_TLBLUESPRING",nt(-1800,-1500));break;case 24:e={init:Xi,release:Qi,update:zi,render:$i};break;case 25:e={init:uc,release:lc,update:dc,render:pc};break;case Ec:vh.length>1&&(e={init:Mr,release:Ir,update:Tr,render:jr});break;case Sc:e={init:ic,release:cc,update:rc,render:oc};break;case 28:e={init:Yi,release:Hi,update:Wi,render:Fi};break;case 29:e={init:tr,release:ar,update:er,render:nr};break;case 30:e={init:$r,release:Kr,update:Qr,render:Vr};break;case Mc:e={init:Dr,release:Ar,update:Or,render:Rr};break;case 32:e={init:Di,release:Oi,update:Ri,render:Ai,state:null};break;case 36:e={init:Vi,release:Ji,update:Ki,render:qi};break;case 37:e=sr("SD_DANGER",fr);break;case 75:e=sr("SD_VERTICALDANGER",fr);break;case 76:e=sr("SD_FIREDANGER",_r);break;case 77:e=sr("SD_VERTICALFIREDANGER",_r);break;case 38:e=Bo(zo,0,_);break;case 63:e=Bo($o,2,_);break;case 64:e=Bo(Qo,1,_);break;case 65:e=Bo(Vo,3,_);break;case 66:e=Bo(zo,0,5);break;case 67:e=Bo($o,2,5);break;case 68:e=Bo(Qo,1,5);break;case 69:e=Bo(Vo,3,5);break;case 39:e=yr(Uc,!0);break;case 70:e=yr(Bc,!0);break;case 71:e=yr(Yc,!0);break;case 72:e=yr(Uc,!1);break;case 73:e=yr(Bc,!1);break;case 74:e=yr(Yc,!1);break;case 40:case 41:e={init:mr,release:br,update:gr,render:vr}}return null!=e&&(e.type=t,e.state=Dc,e.init(e)),e},Ac=function(t,e,n,a,i,r){t.update(t,e,n,a,i,r)},Lc=function(t,e){t.render(t,e)},Nc=0,Cc=2,Gc=4,Pc=8,Uc=0,Bc=1,Yc=2,Hc=1,Wc=2,Fc=3,Xc=4,zc=5,$c=6,Qc=0,Vc=0,Kc=function(t){k("player_create(".concat(t,")"));for(var e={name:"Unknown",type:t,actor:Yn(),disable_movement:!1,in_locked_area:!1,at_some_border:!1,spin:!1,spin_dash:!1,braking:!1,flying:!1,climbing:!1,landing:!1,spring:!1,is_fire_jumping:!1,getting_hit:!1,dying:!1,dead:!1,blinking:!1,on_moveable_platform:!1,lock_accel:0,flight_timer:0,blink_timer:0,death_timer:0,disable_jump_for:0,glasses:Yn(),got_glasses:!1,shield:Yn(),shield_type:0,invincible:!1,invtimer:0,invstar:[],got_speedshoes:!1,speedshoes_timer:0,disable_wall:Nc,entering_loop:!1,at_loopfloortop:!1,bring_to_back:!1},n=0;n<5;n++)e.invstar[n]=Yn(),Qn(e.invstar[n],fn("SD_INVSTAR",0));switch(e.type){case Uc:e.name="Surge",e.actor.acceleration=250,e.actor.maxspeed=700,e.actor.jump_strength=450,e.actor.input=we(),Qn(e.actor,fn(ds(Uc),0));break;case Bc:e.name="Neon",e.actor.acceleration=200,e.actor.maxspeed=600,e.actor.jump_strength=360,e.actor.input=we(),Qn(e.actor,fn(ds(Bc),0));break;case Yc:e.name="Charge",e.actor.acceleration=200,e.actor.maxspeed=600,e.actor.jump_strength=360,e.actor.input=we(),Qn(e.actor,fn(ds(Yc),0))}return Ic=1,jc=0,k("player_create() ok"),e},qc=function(t){for(var e=0;e<t.invstar.length;e++)Hn(t.invstar[e]);Hn(t.glasses),Hn(t.actor)},Jc=function(t,e,n){var a=t.actor;return t.blinking&&(t.blink_timer+=X(),a.visible=z()%250<125,t.blink_timer>=4&&(t.getting_hit=t.blinking=!1,a.visible=!0)),t.disable_movement?t.spin?Qn(t.actor,fn(ds(t.type),3)):t.spring&&Qn(t.actor,fn(ds(t.type),13)):Xn(a,ts(t,e,n,Qh())),t},Zc=function(t,e){if(t){var n=t.actor;if(n){var a,i,r=n.hot_spot,o=n.position,c=nt(0,0),s=nt(0,0),u=[],l=n.angle;if(t.invincible){var d=fn("SD_INVSTAR",0).frame_count;for(t.invtimer+=X(),a=0;a<5;a++)u[a]=720*z()*.001+72*(a+1),s.x=30*Math.cos(u[a]*m/180),s.y=(z()+400*a)%2e3/40,s=ct(s,l),t.invstar[a].position.x=n.position.x+s.x,t.invstar[a].position.y=n.position.y-s.y+5,$n(t.invstar[a],K(d))}for(t.got_glasses&&ps(t),0!=t.shield_type&&_s(t),t.type,a=0;a<5&&t.invincible;a++)u[a]%360>=180&&Wn(t.invstar[a],e);for(i=n.angle,n.angle=n.is_jumping||t.spin?i:tt(i),Wn(n,e),n.angle=i,t.got_glasses&&Wn(t.glasses,e),0!=t.shield_type&&Wn(t.shield,e),a=0;a<5&&t.invincible;a++)u[a]%360<180&&Wn(t.invstar[a],e);switch(t.type){case Uc:break;case Bc:n.is_jumping&&n.animation==fn(ds(Bc),3)&&(n.position=nt(o.x,o.y),n.angle=l,n.hot_spot=r,0!=t.shield_type&&(t.shield.angle=0,t.shield.hot_spot=c))}}}},ts=function(t,e,n,a){var i,r,o,c,s,u,l,d,f,_,h,g,v,b,y,x,w,k,E,S,M,T,j,I,D=t.actor,O=ds(t.type),R=X(),L=480,C=0,G=1,P=D.maxspeed,U=nt(0,0),B=!1,Y=t.actor.animation==fn(O,1),H=!1,W=!1,F=!1,z=null,$=zn(D).width,Q=zn(D).height,V=!(Math.abs(D.angle)<p||Math.abs(D.angle-m/2)<p||Math.abs(D.angle-m)<p||Math.abs(D.angle-3*m/2)<p),Z=-2,tt=0,et=0,st=0,ut=D.position;switch(t.type){case Uc:V?(tt=1,et=.8,st=.5):(tt=.7,et=.5,st=.4);break;case Bc:case Yc:V?(tt=1,et=.7,st=.25):(tt=.7,et=.5,st=.25)}if(v=at(ut,ct(nt(0,-Q*tt+Z),-D.angle)),w=at(ut,ct(nt(0,2),-D.angle)),E=at(ut,ct(nt(-$*st+Z,-Q*et),-D.angle)),y=at(ut,ct(nt($*st-Z,-Q*et),-D.angle)),S=at(ut,ct(nt(-$*st+Z,-Q*tt+Z),-D.angle)),b=at(ut,ct(nt($*st-Z,-Q*tt+Z),-D.angle)),k=at(ut,ct(nt(-$*st+Z,2),-D.angle)),x=at(ut,ct(nt($*st-Z,2),-D.angle)),t.type==Bc&&D.carrying&&Math.abs(D.angle)<p){var lt=zn(D.carrying).height,dt=D.speed.y>5?.7*lt:0;k.y+=dt,x.y+=dt,w.y+=dt,E.y+=lt*et+K(lt)-.5*lt,y.y=E.y}M=t.disable_wall&Pc,T=t.disable_wall&Cc,j=t.disable_wall&Gc,I=1&t.disable_wall,Gn=M,Pn=T,Un=j,Bn=I,ta(!(t.disable_wall&Gc));var pt=Zn(D,2,v,b,y,x,w,k,E,S,n,c,d,u,f,s,_,l,h);if(c=pt.up,s=pt.down,l=pt.left,u=pt.right,h=pt.upleft,d=pt.upright,_=pt.downleft,f=pt.downright,ta(!0),t.dying)return D.speed.x=0,D.speed.y=Math.min(L,D.speed.y+a*R),D.mirror=null,D.angle=0,D.visible=!0,t.blinking=!1,t.death_timer+=R,t.dead=t.death_timer>=2.5,Qn(D,fn(O,8)),nt(0,D.speed.y*R+.5*a*R*R);if(t.dead)return nt(0,0);var ft=ea(D,Z,c,d,u,f,s,_,l,h);switch(c=ft.up,d=ft.upright,u=ft.right,l=ft.left,h=ft.upleft,s=ft.down,_=ft.downleft,f=ft.downright,t.type){case Uc:D.carry_offset=nt(1&D.mirror?7:-9,-40);break;case Bc:case Yc:D.carry_offset=nt(1&D.mirror?7:-7,-42)}if(null!=D.carried_by){var _t=null,ht=void 0,mt=0,gt=0,vt=D.carried_by;for(ht=0;ht<e.length;ht++)if(e[ht]==t){gt=ht;break}for(ht=0;ht<e.length;ht++)if(e[ht].actor==vt){_t=e[ht],mt=ht,t.disable_wall=_t.disable_wall,t.entering_loop=_t.entering_loop,t.at_loopfloortop=_t.at_loopfloortop,t.bring_to_back=_t.bring_to_back;break}if(_t&&(_t.type==Bc&&!_t.flying||_t.getting_hit||_t.dying||_t.dead))D.position=nt(D.carried_by.position.x,D.carried_by.position.y),D.carried_by.carrying=null,D.carried_by=null;else{if(!(s&&0==s.brick_ref.angle&&vt.speed.y>=5||t.getting_hit||t.dying||t.dead)){var bt=gt<mt?rt(vt.speed,R):nt(0,0);return D.speed=nt(0,0),D.mirror=vt.mirror,D.angle=0,Qn(D,fn(O,25)),D.position=it(at(vt.position,bt),D.carry_offset),nt(0,0)}D.position=nt(D.carried_by.position.x,D.carried_by.position.y),D.carried_by.carrying=null,D.carried_by=null}}if(t.entering_loop=!1,t.got_speedshoes&&(t.speedshoes_timer>23?t.got_speedshoes=!1:(P*=1.5,t.speedshoes_timer+=R)),hs(t)&&D.is_jumping&&(t.disable_wall&=~Gc),t.spring&&(s&&D.speed.y>=0||t.flying||t.climbing)&&(t.spring=!1),i=(u&&Ee(D.input,Bt)||l&&Ee(D.input,Ut))&&s,t.on_moveable_platform=ot(Zh(s,D))>p,(o=s&&(D.angle>0&&D.angle<m/2&&D.speed.x>0||D.angle>3*m/2&&D.angle<2*m&&D.speed.x<0))&&(h||d)||Math.abs(D.angle)<p||Math.abs(D.angle-m)<p){if(u&&u.brick_ref.angle%90==0&&(D.speed.x>p||y.x>u.x)&&(!o||o&&90!=u.brick_ref.angle)&&(D.speed.x=0,D.position.x=u.x+(ut.x-y.x),!D.is_jumping&&!t.flying&&!t.climbing&&Math.abs(D.speed.y)<p&&(z=fn(O,i?14:0)),o))return nt(-5,0);if(l&&l.brick_ref.angle%90==0&&(D.speed.x<-1e-5||E.x<l.x+l.brick_ref.image.width)&&(!o||o&&270!=l.brick_ref.angle)&&(D.speed.x=0,D.position.x=l.x+l.brick_ref.image.width+(ut.x-E.x),!D.is_jumping&&!t.flying&&!t.climbing&&Math.abs(D.speed.y)<p&&(z=fn(O,i?14:0)),o))return nt(5,0);D.position.x<=D.hot_spot.x&&(t.spin=!1,W=!0,D.position.x<D.hot_spot.x&&(D.speed.x=0,D.position.x=D.hot_spot.x,s&&(i=!0,z=fn(O,1)))),D.position.x>=Gh().x-(zn(D).width-D.hot_spot.x)&&(t.spin=!1,H=!0,D.position.x>Gh().x-(zn(D).width-D.hot_spot.x)&&(D.speed.x=0,D.position.x=Gh().x-(zn(D).width-D.hot_spot.x),s&&(i=!0,z=fn(O,1))))}if(!t.climbing){if(s){var yt,xt=s.brick_ref.angle,wt=void 0;if(B=!0,D.ignore_horizontal=!1,t.is_fire_jumping=!1,D.is_jumping=!1,s.brick_ref&&3==s.brick_ref.behavior&&0==s.state&&(s.state=2),Math.abs(D.speed.x)<p){if(xt%180==0&&(t.spin=!1),Ee(D.input,Pt))t.spin_dash||(z=fn(O,4)),Se(D.input,Yt)&&(z=fn(O,6),t.spin_dash=!0,A($e("charge")));else if(!i)if(Ee(D.input,Gt))Y&&t.at_some_border||(z=fn(O,5));else if(hs(t))z=fn(O,0);else{var kt=at(ut,ct(nt(-8,0),-D.angle)),Et=at(ut,ct(nt(5,0),-D.angle)),St=nt(0,0),Mt=Zn(D,2,St,St,St,Et,St,kt,St,St,n,null,null,null,void 0,null,void 0,null,null);Mt.downleft&&Mt.downright||t.on_moveable_platform?Ee(D.input,Ut)&&(W||t.at_some_border)||Ee(D.input,Bt)&&(H||t.at_some_border)?(D.mirror=W?1:0,z=fn(O,1)):z=fn(O,0):z=fn(O,10)}if(t.spin_dash){var Tt=void 0,jt=1&D.mirror?1:-1,It=void 0,Dt=void 0,Ot=void 0;for(Tt=0;Tt<3;Tt++)K(128),Ot=Ze(1,1),rn(Ot,255,255,255),It=nt(jt*(7+K(7)),2),Dt=nt(jt*(50+K(200)),-K(200)),Jh(Ot,at(D.position,It),Dt,!0);(Me(D.input,Pt)||Ah())&&(t.spin=!0,t.spin_dash=!1,(!(1&D.mirror)||l||W)&&(1&D.mirror||u||H)||(D.speed.x=(1&D.mirror?-1:1)*P*1.35),A($e("release")),t.disable_jump_for=.05)}}else if(Ee(D.input,Pt)&&(t.spin||A($e("roll")),t.spin=!0),t.spin||t.braking)t.spin?z=fn(O,3):t.braking&&(jt=1&D.mirror?1:-1,It=void 0,Dt=void 0,Ot=void 0,K(128),Ot=Ze(1,1),It=nt(jt*(10-K(21)),0),Dt=nt(jt*(50+K(200)),-K(200)),Jh(Ot,at(D.position,It),Dt,!0),z=fn(O,7),Math.abs(D.speed.x)<10&&(t.braking=!1));else{var Rt=.75*P,At=.35*P;Math.abs(D.speed.x)<Rt?!i&&D.speed.y>=0&&(z=fn(O,1),D=function(t,e){return t.animation_speed_factor=Math.max(0,e),t}(D,.5+Math.abs(D.speed.x)/Rt*1.5)):z=fn(O,2),Math.abs(D.speed.x)>=At&&(Ee(D.input,Bt)&&D.speed.x<0||Ee(D.input,Ut)&&D.speed.x>0)&&(A($e("brake")),t.braking=!0)}if(t.disable_jump_for=Math.max(t.disable_jump_for-R,0),Math.abs(D.speed.x)<p&&(t.disable_jump_for=0),yt=!t.spin_dash,Ee(D.input,Yt)&&t.disable_jump_for<=0&&!Ee(D.input,Pt)&&!c&&!t.landing&&yt&&!D.is_jumping&&(A($e("jump")),D.angle=0,D.is_jumping=!0,t.is_fire_jumping=!0,F=!0,t.spin=!1,z=fn(O,3),0==xt?D.speed.y=1*-D.jump_strength:xt>0&&xt<90?xt>45?(D.speed.x=Math.min(D.speed.x,-.7*D.jump_strength*1),D.speed.y=-.7*D.jump_strength*1):(D.speed.x*=D.speed.x>0?.5:1,D.speed.y=1*-D.jump_strength):90==xt?(Xn(D,nt(-40,0)),D.speed.x=Math.min(D.speed.x,1*-D.jump_strength),D.speed.y=-D.jump_strength/2*1):xt>90&&xt<180?(Xn(D,nt(0,40)),D.speed.x=Math.min(D.speed.x,-.7*D.jump_strength*1),D.speed.y=1*D.jump_strength):180==xt?(Xn(D,nt(0,40)),D.speed.x*=-1,D.speed.y=1*D.jump_strength):xt>180&&xt<270?(Xn(D,nt(0,40)),D.speed.x=Math.max(D.speed.x,.7*D.jump_strength*1),D.speed.y=1*D.jump_strength):270==xt?(Xn(D,nt(40,0)),D.speed.x=Math.max(D.speed.x,1*D.jump_strength),D.speed.y=-D.jump_strength/2*1):xt>270&&xt<360&&(xt<315?(D.speed.x=Math.max(D.speed.x,.7*D.jump_strength*1),D.speed.y=-.7*D.jump_strength*1):(D.speed.x*=D.speed.x<0?.5:1,D.speed.y=1*-D.jump_strength))),!D.is_jumping){var Lt=void 0;xt>0&&xt<90?(Lt=.8*Math.min(1,Math.tan(xt*m/180)),Math.abs(D.speed.y)>p?D.speed.x=B&&xt<=45?D.speed.x:Math.max(-1.2*P,-1*Lt*D.speed.y):(wt=(1&D.mirror?2:1)*Lt,t.braking&&xt<45?wt*=8*(D.speed.x<0?-.5:1):Math.abs(D.speed.x)<5&&(wt*=25*Math.sin(xt*m/180),t.lock_accel=2),D.speed.x=Math.max(D.speed.x-700*wt*R,-1.2*P))):xt>270&&xt<360&&(Lt=.8*Math.min(1,-Math.tan(xt*m/180)),Math.abs(D.speed.y)>p?D.speed.x=B&&xt>=315?D.speed.x:Math.min(1.2*P,1*Lt*D.speed.y):(wt=(1&D.mirror?1:2)*Lt,t.braking&&xt>315?wt*=8*(D.speed.x>0?-.5:1):Math.abs(D.speed.x)<5&&(wt*=25*-Math.sin(xt*m/180),t.lock_accel=1),D.speed.x=Math.min(D.speed.x+700*wt*R,1.2*P)))}xt%90==0&&(t.lock_accel=0),_&&f&&Math.abs(D.speed.x)<40&&_.brick_ref.angle>270&&_.brick_ref.angle<360&&f.brick_ref.angle>0&&f.brick_ref.angle<90&&(Ee(D.input,Ut)||Ee(D.input,Bt)||(D.speed.x=0))}else t.braking=!1,t.lock_accel=0,t.spin_dash&&(t.spin_dash=!1,z=fn(O,1)),D.animation!=fn(O,0)&&D.animation!=fn(O,10)&&D.animation!=fn(O,5)||(z=fn(O,1)),(t.spring||Y||D.speed.y<0)&&(t.spin=!1),hs(t)||(D.angle=0);if(s||t.is_fire_jumping&&D.speed.y<.88*-D.jump_strength&&Me(D.input,Yt)&&(D.speed.y*=.7),t.type==Bc&&t.flying?(G=t.flight_timer<10?.15:.8,L*=.3):G=1,U.y=Math.abs(D.speed.y)>p?D.speed.y*R+a*G*.5*(R*R):0,t.type==Yc&&t.flying||(D.speed.y=Math.min(D.speed.y+a*G*R,L)),r=c&&c.brick_ref.angle%90!=0&&Math.abs(D.angle)<p,c&&(c.brick_ref.angle%90==0||r)&&D.speed.y<-1e-5&&(D.position.y=c.y+c.brick_ref.image.height+(ut.y-v.y),D.speed.y=10,1==c.brick_ref.behavior&&Math.sin(c.brick_ref.behavior_arg[3]*c.value[0])>0))return D.speed.y=100,at(U,rt(Zh(c,D),R));if((g=s)&&!D.is_jumping)if(xt=g.brick_ref.angle,D.speed.y=U.y=0,D.angle=xt*m/180,0==xt){var Nt=Zh(s,D);ut.y=g.y,C=0,Nt.y>p?U.y+=Nt.y*R:D.position.y=ut.y+Z+1}else if(xt>0&&xt<90)ut.y=g.y+g.brick_ref.image.height-(D.position.x-g.x)*Math.tan(D.angle),D.speed.x<0&&(ut.y+=2),D.position.y=ut.y+Z,1&D.mirror||(C=.2);else if(90==xt){if(Math.abs(D.speed.x)>5){var Ct=f?f.brick_ref.angle:-1;f&&Ct>=xt&&Ct<xt+90?t.flying||(D.position.x=g.x+Z):(D.angle=0,D.is_jumping=!0,t.spin||t.flying||(z=fn(O,1)),hs(t)||(t.flying||Xn(D,nt(-13,0)),D.speed=nt(0,-.9*Math.abs(D.speed.x))))}else D.angle=0,t.flying||Xn(D,nt(-10,0)),D.is_jumping=!0,D.ignore_horizontal=!1;1&D.mirror||(C=1.5)}else xt>90&&xt<180?(Math.abs(D.speed.x)>5?(ut.y=g.y-(D.position.x-g.x)*Math.tan(D.angle),D.position.y=ut.y-Z):(D.angle=0,Xn(D,nt(0,30)),D.is_jumping=!0),C=1.5):180==xt?(Math.abs(D.speed.x)>5?(ut.y=g.y+g.brick_ref.image.height,D.position.y=ut.y-Z,(D.speed.x>0&&!f||D.speed.x<0&&!_)&&(Xn(D,nt(0,-30)),D.is_jumping=!0,D.speed.x*=-1,D.mirror=D.speed.x<0?1:0,D.angle=0)):(D.angle=0,Xn(D,nt(0,40)),D.is_jumping=!0,D.speed.x=0),C=1.2):xt>180&&xt<270?(Math.abs(D.speed.x)>5?(ut.y=g.y+g.brick_ref.image.height-(D.position.x-g.x)*Math.tan(D.angle),D.position.y=ut.y-Z):(D.angle=0,Xn(D,nt(0,30)),D.is_jumping=!0),C=1.5):270==xt?(Math.abs(D.speed.x)>5?(Ct=_?_.brick_ref.angle:-1,_&&Ct>xt-90&&Ct<=xt?t.flying||(D.position.x=g.x+g.brick_ref.image.width-Z):(D.angle=0,D.is_jumping=!0,t.spin||t.flying||(z=fn(O,1)),hs(t)||(t.flying||Xn(D,nt(13,0)),D.speed=nt(0,-.9*Math.abs(D.speed.x))))):(D.angle=0,t.flying||Xn(D,nt(10,0)),D.is_jumping=!0,D.ignore_horizontal=!1),1&D.mirror&&(C=1.5)):xt>270&&xt<360&&(ut.y=g.y-(D.position.x-g.x)*Math.tan(D.angle),D.speed.x>0&&(ut.y+=2),D.position.y=ut.y+Z,1&D.mirror&&(C=.2));if(U.x=Math.abs(D.speed.x)>p?D.speed.x*R+(1-C)*D.acceleration*.5*(R*R):0,!Ee(D.input,Ut)||Ee(D.input,Bt)||t.spin||t.braking||t.landing||t.getting_hit||1==t.lock_accel||W)if(!Ee(D.input,Bt)||Ee(D.input,Ut)||t.spin||t.braking||t.landing||t.getting_hit||2==t.lock_accel||H){if(s){var Ht=0;xt=s.brick_ref.angle,wt=0,wt=t.spin?.65:t.braking?4.5:t.landing?.6:1,xt%90==0?Ht=90==xt?-1:270==xt?1:D.speed.x>p?-1:-D.speed.x>p?1:0:(xt>90&&xt<180||xt>180&&xt<270)&&(Ht=D.speed.x>p?-1:-D.speed.x>p?1:0),D.speed.x+=Ht*wt*D.acceleration*R}}else D.ignore_horizontal||!(D.is_jumping||t.spring||Y)&&Ee(D.input,Pt)||(D.mirror=0,C=D.speed.x<0?-1:C,D.speed.x<=1.1*P&&(D.speed.x=Math.min(D.speed.x+(1-C)*D.acceleration*R,P)));else D.ignore_horizontal||!(D.is_jumping||t.spring||Y)&&Ee(D.input,Pt)||(D.mirror=1,C=D.speed.x>0?-1:C,D.speed.x>=1.1*-P&&(D.speed.x=Math.max(D.speed.x-(1-C)*D.acceleration*R,-P)))}switch(t.spring&&(z=fn(O,D.speed.y<=0?13:1),D.speed.y>0&&(t.spring=!1,D.is_jumping=!1)),t.getting_hit&&(s?t.getting_hit=!1:z=fn(O,11)),t.type){case Uc:break;case Bc:if(t.flight_timer+=R,s&&90!=s.brick_ref.angle&&270!=s.brick_ref.angle&&(t.flying=!1,t.flight_timer=0),(D.is_jumping&&D.speed.y>-D.jump_strength/3&&!F&&!t.getting_hit||t.flying)&&Se(D.input,Yt)&&!t.getting_hit&&t.flight_timer<10&&(t.flying||(t.flight_timer=0),D.speed.y=.1*-Qh(),t.flying=!0,D.is_jumping=!1,t.is_fire_jumping=!1),t.flying){if(z=fn(O,D.carrying?16:20),D.speed.x=q(D.speed.x,-D.maxspeed/2,D.maxspeed/2),t.flight_timer>=10){var Wt=$e("tired of flying");N(Wt)||A(Wt),z=fn(O,19)}else for(Wt=void 0,ht=void 0,hs(t)&&(D.angle=0),Wt=$e("flying"),N(Wt)||A(Wt),ht=0;ht<e.length&&null==D.carrying;ht++)if(e[ht]!=t&&D.speed.y<=0){var Ft=[e[ht].actor.position.x+.3*zn(e[ht].actor).width,e[ht].actor.position.y,e[ht].actor.position.x+.7*zn(e[ht].actor).width,e[ht].actor.position.y+.2*zn(e[ht].actor).height],Xt=[D.position.x+.3*zn(D).width,D.position.y+.7*zn(D).height,D.position.x+.7*zn(D).width,D.position.y+zn(D).height],zt=J(Ft,Xt),$t=!(null!=e[ht].actor.carried_by||e[ht].dying||e[ht].dead||e[ht].climbing||e[ht].landing||e[ht].getting_hit);zt&&$t&&!s&&(D.carrying=e[ht].actor,e[ht].actor.carried_by=D,e[ht].spin=e[ht].spin_dash=e[ht].braking=e[ht].flying=e[ht].spring=e[ht].on_moveable_platform=!1,A($e("touch the wall")))}}else D.animation==fn(O,D.carrying?16:20)&&(z=fn(O,1));break;case Yc:if((D.is_jumping&&D.speed.y>-.7*D.jump_strength||t.flying)&&Se(D.input,Yt)&&!s&&!t.getting_hit&&(D.speed.y=50,t.flying=!0,D.is_jumping=!1,t.is_fire_jumping=!1,D.speed.x=1&D.mirror?Math.min(-100,D.speed.x):Math.max(100,D.speed.x)),t.flying){var Qt=Ee(D.input,Ut)&&D.speed.x>0||Ee(D.input,Bt)&&D.speed.x,Vt=s&&Math.abs(s.brick_ref.angle*m/180-0)<p;if(Qt=D.animation==fn(O,21)&&!Vn(D),Vt||D.animation==fn(O,19)||t.landing||(1&D.mirror?(z=fn(O,Qt?21:20),D.speed.x=Math.max(D.speed.x-.5*D.acceleration*R,-P/2)):(z=fn(O,Qt?21:20),D.speed.x=Math.min(D.speed.x+.5*D.acceleration*R,P/2))),Vt)t.landing=!0,D.is_jumping=!1,z=fn(O,19),D.speed.y=0,U.y=0,t.climbing=!1;else if(Me(D.input,Yt))t.flying=!1,z=fn(O,18);else{var Kt=void 0,qt=[l,_,u,f,s];for(Kt=0;Kt<qt.length;Kt++)(g=qt[Kt])&&g.brick_ref.angle%90!=0&&(t.flying=!1,t.landing=!1)}Vt||c||(l&&l.brick_ref.angle%90==0||u&&u.brick_ref.angle%90==0)&&(t.climbing=!0,t.flying=!1,A($e("touch the ground")))}if(t.landing&&(Math.abs(D.speed.x)<p||!s)&&(t.flying=t.landing=!1),t.climbing){var Jt=nt(0,0);if(D.speed.x=U.x=0,l&&!u&&(D.mirror|=1),u&&!l&&(D.mirror&=-2),Jt=at(Jt,rt(Zh(l,D),R)),((Jt=at(Jt,rt(Zh(u,D),R))).y<=0&&!c||Jt.y>=0&&!s||!l&&u)&&(U=at(U,Jt)),l||u)if(Se(D.input,Yt)){var Zt=fn(O,17),te=fn(O,22);D.animation!=Zt&&D.animation!=te||(t.climbing=!1,D.is_jumping=!0,t.is_fire_jumping=!0,D.speed.x=.7*(1&D.mirror?1:-1)*D.jump_strength,D.speed.y=-.5*D.jump_strength,l&&!u&&(D.mirror&=-2),!l&&u&&(D.mirror|=1),z=fn(O,3),A($e("jump")))}else Ee(D.input,Gt)?c||(U.y=.1*-P*R,z=fn(O,17)):Ee(D.input,Pt)?s?t.climbing=!1:(U.y=.1*P*R,z=fn(O,17)):z=fn(O,22);else(g=1&D.mirror?_:f)?(z=fn(O,23),D.ignore_horizontal=!0,U=at(U,rt(Zh(g,D),R)),Vn(D)&&(t.climbing=!1,D.ignore_horizontal=!1,D.speed=nt((1&D.mirror?-1:1)*P*.15,-Qh()/12.5),U.x=5*(1&D.mirror?-1:1))):(t.climbing=!1,D.is_jumping=!0,z=fn(O,3))}}return t.at_some_border=!1,z&&Qn(D,z),Math.abs(D.speed.x)<4&&(t.braking=!1,(!Ee(D.input,Bt)&&!Ee(D.input,Ut)||Ee(D.input,Bt)&&Ee(D.input,Ut)||t.spin||t.landing)&&(U.x=0,D.speed.x=0)),U.x+=Zh(s,D).x*R,U.x=D.position.x<=D.hot_spot.x&&D.speed.x<0?0:U.x,U.x=D.position.x>=Gh().x-(zn(D).width-D.hot_spot.x)&&D.speed.x>0?0:U.x,U},es=function(t){var e,n,a=t.actor,i=!1;if(!t.blinking&&!t.dying&&!t.invincible)if(fs(t),0!=t.shield_type)i=!0,t.shield_type=0,A($e("death"));else if(jc>0){for(i=!0,n=0;n<Math.min(rs(),15);n++)e=Kh(0,a.position),No(e);ss(0),A($e("ringless"))}else ns(t);i&&(t.getting_hit=!0,t.flying=t.landing=t.climbing=t.spring=!1,t.is_fire_jumping=!1,t.spin_dash=t.spin=!1,t.blinking=!0,t.blink_timer=0,a.speed.x=1&a.mirror?200:-200,a.speed.y=-.75*a.jump_strength,Xn(a,nt(0,-5)))},ns=function(t){t.dying||(fs(t),t.shield_type=0,t.invincible=!1,t.got_speedshoes=!1,t.dying=!0,t.death_timer=0,t.spring=!1,t.actor.speed.y=1.2*-t.actor.jump_strength,t.flying=t.climbing=t.landing=!1,t.is_fire_jumping=!1,t.spin=t.spin_dash=!1,t.blinking=!1,A($e("death")))},as=function(t){Te(t.actor.input,Yt),t.spring=!1,t.actor.speed.y=-t.actor.jump_strength,t.actor.is_jumping=!0,t.is_fire_jumping=!1,t.flying=!1},is=function(t){var e=fn(ds(t.type),3);return t.spin||t.spin_dash||t.actor.animation==e||t.type==Yc&&(t.landing||t.flying)},rs=function(){return jc},os=function(){return Qc},cs=function(){return Vc},ss=function(t){jc=q(t,0,9999),t/100>=Ic&&(Ic+=1,us(os()+1),Ph($e("1up")))},us=function(t){Qc=t},ls=function(t){Vc=t},ds=function(t){switch(t){case Uc:return"SD_SONIC";case Bc:return"SD_TAILS";case Yc:return"SD_KNUCKLES";default:return"null"}},ps=function(t){if(t&&t.actor){var e=0,n=1&t.actor.mirror,a=!0,i=tt(t.actor.angle),r=nt(0,0),o=it(t.actor.position,ct(nt(0,t.actor.hot_spot.y),-i)),c=t.actor.animation;switch(t.type){case Uc:if(c==fn(ds(Uc),0))r=nt(3,24),e=1;else if(c==fn(ds(Uc),1))switch(~~t.actor.animation_frame){case 0:e=2,r=nt(5,23);break;case 1:e=2,r=nt(4,25);break;case 2:e=1,r=nt(7,25);break;case 3:case 4:e=1,r=nt(5,23);break;case 5:e=1,r=nt(4,24);break;case 6:e=2,r=nt(6,24);break;case 7:e=2,r=nt(6,23)}else if(c==fn(ds(Uc),2))e=1,r=nt(8,26);else if(c==fn(ds(Uc),5))e=3,r=0==~~t.actor.animation_frame?nt(0,19):nt(-1,21);else if(c==fn(ds(Uc),7))e=1,r=~~t.actor.animation_frame<2?nt(8,26):nt(10,28);else if(c==fn(ds(Uc),10))switch(e=1,~~t.actor.animation_frame){case 0:r=nt(1,22);break;case 1:r=nt(-1,23);break;case 2:r=nt(1,23)}else c==fn(ds(Uc),11)?(e=3,r=nt(-4,30)):c==fn(ds(Uc),12)?(e=3,r=nt(1,19)):c==fn(ds(Uc),13)?(e=3,r=nt(4,13)):c==fn(ds(Uc),14)?(e=1,r=nt(12,31)):c==fn(ds(Uc),15)?(e=0,r=nt(3,23)):c==fn(ds(Uc),25)?(e=0,r=nt(3,22)):a=!1;break;case Bc:if(c==fn(ds(Bc),0))r=nt(5,34),e=1;else if(c==fn(ds(Bc),1))switch(e=2,~~t.actor.animation_frame){case 0:r=nt(2,33);break;case 1:case 5:r=nt(3,33);break;case 2:r=nt(8,33);break;case 3:case 7:r=nt(3,32);break;case 4:r=nt(1,33);break;case 6:r=nt(7,33)}else if(c==fn(ds(Bc),2))e=2,r=0==~~t.actor.animation_frame?nt(7,35):nt(6,34);else if(c==fn(ds(Bc),4))e=1,r=nt(9,44);else if(c==fn(ds(Bc),5))e=1,r=nt(7,32);else if(c==fn(ds(Bc),7))e=1,r=0==~~t.actor.animation_frame?nt(2,33):nt(4,33);else if(c==fn(ds(Bc),10))switch(e=4,~~t.actor.animation_frame){case 0:r=nt(5,33);break;case 1:r=nt(6,33)}else if(c==fn(ds(Bc),11))e=1,r=nt(1,33);else if(c==fn(ds(Bc),12))e=1,r=nt(6,28);else if(c==fn(ds(Bc),13))e=3,r=nt(2,17);else if(c==fn(ds(Bc),14))e=1,r=nt(9,35);else if(c==fn(ds(Bc),15))switch(e=4,~~t.actor.animation_frame){case 0:case 8:case 9:case 10:r=nt(5,34);break;default:r=nt(5,33)}else c==fn(ds(Bc),16)?(e=1,r=nt(8,37)):c==fn(ds(Bc),19)?(e=1,r=0==~~t.actor.animation_frame?nt(9,39):nt(9,40)):c==fn(ds(Bc),20)?(e=1,r=nt(8,39)):c==fn(ds(Bc),25)?(e=1,r=nt(0,23)):a=!1;break;case Yc:if(c==fn(ds(Yc),0))e=1,r=nt(1,24);else if(c==fn(ds(Yc),1))switch(~~t.actor.animation_frame){case 0:e=1,r=nt(5,29);break;case 1:e=2,r=nt(5,29);break;case 2:e=2,r=nt(8,29);break;case 3:e=2,r=nt(9,28);break;case 4:e=1,r=nt(6,28);break;case 5:e=1,r=nt(6,29);break;case 6:e=1,r=nt(5,28);break;case 7:e=1,r=nt(4,27)}else if(c==fn(ds(Yc),2))e=1,r=nt(7,29);else if(c==fn(ds(Yc),4))e=1,r=0==~~t.actor.animation_frame?nt(0,31):nt(0,40);else if(c==fn(ds(Yc),5))e=1,r=0==~~t.actor.animation_frame?nt(0,21):nt(-1,21);else if(c==fn(ds(Yc),7))e=0,r=nt(-2,27);else if(c==fn(ds(Yc),10))switch(e=1,~~t.actor.animation_frame){case 0:r=nt(9,30);break;case 1:r=nt(8,27)}else if(c==fn(ds(Yc),11))e=1,r=nt(-3,27);else if(c==fn(ds(Yc),12))e=1,r=nt(5,24);else if(c==fn(ds(Yc),13))e=3,r=nt(-1,16);else if(c==fn(ds(Yc),14))switch(~~t.actor.animation_frame){case 0:e=1,r=nt(5,29);break;case 1:e=2,r=nt(5,29);break;case 2:e=2,r=nt(8,29);break;case 3:e=2,r=nt(9,28);break;case 4:e=1,r=nt(6,28);break;case 5:e=1,r=nt(6,29);break;case 6:e=1,r=nt(5,28);break;case 7:e=1,r=nt(4,27)}else if(c==fn(ds(Yc),15))e=0,r=nt(1,23);else if(c==fn(ds(Yc),16))switch(e=1,~~t.actor.animation_frame){case 0:r=nt(6,23);break;case 1:r=nt(5,20);break;case 2:r=nt(0,22)}else if(c==fn(ds(Yc),17))switch(e=3,~~t.actor.animation_frame){case 0:r=nt(-1,22);break;case 1:r=nt(-2,20);break;case 2:r=nt(0,21);break;case 3:r=nt(-1,24);break;case 4:r=nt(0,23);break;case 5:r=nt(0,22)}else if(c==fn(ds(Yc),18))e=1,r=0==~~t.actor.animation_frame?nt(6,23):nt(5,20);else if(c==fn(ds(Yc),19))e=1,r=nt(8,44);else if(c==fn(ds(Yc),20))e=1,r=nt(8,39);else if(c==fn(ds(Yc),21))switch(e=4,~~t.actor.animation_frame){case 0:r=nt(-8,41);break;case 1:r=nt(0,43);break;case 2:r=nt(10,41)}else if(c==fn(ds(Yc),22))e=3,r=nt(0,22);else if(c==fn(ds(Yc),23))switch(~~t.actor.animation_frame){case 0:e=3,r=nt(7,17);break;case 1:e=3,r=nt(11,15);break;case 2:e=0,r=nt(12,13)}else c==fn(ds(Yc),25)?(e=0,r=nt(0,23)):a=!1}return r.x*=n?-1:1,Qn(t.glasses,fn("SD_GLASSES",e)),t.glasses.position=at(o,ct(r,-i)),t.glasses.angle=i,t.glasses.mirror=t.actor.mirror,t.glasses.visible=a&&t.actor.visible,t}},fs=function(t){},_s=function(t){var e=t.shield,n=t.actor,a=nt(0,0);switch(t.shield_type){case Hc:a=nt(0,-22),e.position=at(n.position,ct(a,-tt(n.angle))),Qn(e,fn("SD_SHIELD",0));break;case Wc:a=nt(0,-22),e.position=at(n.position,ct(a,-tt(n.angle))),Qn(e,fn("SD_FIRESHIELD",0));break;case Fc:a=nt(0,-22),e.position=at(n.position,ct(a,-tt(n.angle))),Qn(e,fn("SD_THUNDERSHIELD",0));break;case Xc:a=nt(0,-22),e.position=at(n.position,ct(a,-tt(n.angle))),Qn(e,fn("SD_WATERSHIELD",0));break;case zc:a=nt(0,-22),e.position=at(n.position,ct(a,-tt(n.angle))),Qn(e,fn("SD_ACIDSHIELD",0));break;case $c:a=nt(0,-22),e.position=at(n.position,ct(a,-tt(n.angle))),Qn(e,fn("SD_WINDSHIELD",0))}},hs=function(t){return t.disable_wall!==Nc},ms=function(t){var e=t.decorated_machine;e.init(e)},gs=function(t){var e=t.decorated_machine;e.release(e)},vs=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t;ss(rs()+c.rings),o.update(o,e,n,a,i,r)},bs=function(t,e){var n=t.decorated_machine;n.render(n,e)},ys=function(t){var e=t.decorated_machine;e.init(e)},xs=function(t){var e=t.decorated_machine;e.release(e)},ws=function(t,e,n,a,i,r){var o=t.decorated_machine;Ch(t.score),o.update(o,e,n,a,i,r)},ks=function(t,e){var n=t.decorated_machine;n.render(n,e)},Es=function(t,e,n){var a={init:Ss,release:Ms,update:Ts,render:js,get_object_instance:Si},i=a;return i.decorated_machine=t,i.offset=nt(e,n),a},Ss=function(t){var e=t.decorated_machine;e.init(e)},Ms=function(t){var e=t.decorated_machine;e.release(e)},Ts=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t),u=Pp(s);s.actor.position=at(u.actor.position,c.offset),o.update(o,e,n,a,i,r)},js=function(t,e){var n=t.decorated_machine;n.render(n,e)},Is=function(t,e,n,a,i,r){return Ls(t,Ns(e,n,a,i,r))},Ds=function(t){var e=t.decorated_machine;e.init(e)},Os=function(t){var e=t.decorated_machine;e.release(e)},Rs=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t;c.strategy.update(c.strategy),o.update(o,e,n,a,i,r)},As=function(t,e){var n=t.decorated_machine;n.render(n,e)},Ls=function(t,e){var n={init:Ds,release:Os,update:Rs,render:As,get_object_instance:Si},a=n;return a.decorated_machine=t,a.strategy=e,n},Ns=function(t,e,n,a,i){return{update:Cs,sfx:$e(t),vol:Math.min(e,0,1),pan:Math.min(n,-1,1),freq:a,loop:i}},Cs=function(t){L(t.sfx)},Gs=function(t,e){return{update:Ps,mus:M(t),loop:e}},Ps=function(t){var e=t;T(e.mus,e.loop)},Us=function(t){$h()},Bs=function(t){I(t.vol)},Ys=function(t){var e=t.decorated_machine;e.init(e)},Hs=function(t){var e=t.decorated_machine;e.release(e)},Ws=function(t,e,n,a,i,r){var o=t.decorated_machine,c=Pp(t.get_object_instance(t));as(c),o.update(o,e,n,a,i,r)},Fs=function(t,e){var n=t.decorated_machine;n.render(n,e)},Xs=function(t){var e=t.decorated_machine;e.init(e)},zs=function(t){var e=t.decorated_machine;e.release(e)},$s=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t),u=X(),l=rt(c.speed,u);s.actor.position=at(s.actor.position,l),o.update(o,e,n,a,i,r)},Qs=function(t,e){var n=t.decorated_machine;n.render(n,e)},Vs=function(t){var e=t.decorated_machine;e.init(e)},Ks=function(t){var e=t.decorated_machine;e.release(e)},qs=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t),u=Zs(s,r,c.object_name,null);null!=u&&wi(u.vm,c.new_state_name),o.update(o,e,n,a,i,r)},Js=function(t,e){var n=t.decorated_machine;n.render(n,e)},Zs=function(t,e,n,a){var i,r,o=_,c=null;for(i=e;i;i=i.next)i.data.name==n&&(r=it(i.data.actor.position,t.actor.position),ot(r)<o&&(c=i.data,o=ot(r)));return a&&(a=o),c},tu=function(t,e,n,a,i){var r={init:eu,release:nu,update:au,render:iu,get_object_instance:Si},o=r;return o.decorated_machine=t,o.strategy=ru,o.offset=nt(n,a),o.object_name=e,o.child_name=i,o.new_state_name=null,r},eu=function(t){var e=t.decorated_machine;e.init(e)},nu=function(t){var e=t.decorated_machine;e.release(e)},au=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t;c.strategy(c),o.update(o,e,n,a,i,r)},iu=function(t,e){var n=t.decorated_machine;n.render(n,e)},ru=function(t){var e=t,n=e.get_object_instance(e),a=qh(t.object_name,at(n.actor.position,t.offset));null!=a&&Cp(n,t.child_name,a)},ou=function(t){var e=t,n=e.get_object_instance(e),a=Np(n,t.child_name);null!=a&&wi(a.vm,t.new_state_name)},cu=function(t){var e=t,n=e.get_object_instance(e),a=Lp(n);null!=a&&wi(a.vm,t.new_state_name)},su=function(t){var e=t.decorated_machine;e.init(e)},uu=function(t){var e=t.decorated_machine;e.release(e)},lu=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t.get_object_instance(t);Bh(c.actor),o.update(o,e,n,a,i,r)},du=function(t,e){var n=t.decorated_machine;n.render(n,e)},pu=function(t){var e=t.decorated_machine;e.init(e)},fu=function(t){var e=t.decorated_machine;e.release(e)},_u=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t);Kh(c.item_id,at(s.actor.position,c.offset)),o.update(o,e,n,a,i,r)},hu=function(t,e){var n=t.decorated_machine;n.render(n,e)},mu=function(t){var e=t.decorated_machine;e.init(e)},gu=function(t){var e=t.decorated_machine;e.release(e)},vu=function(t,e,n,a,i,r){var o=t.decorated_machine;t.get_object_instance(t).state=Tp,o.update(o,e,n,a,i,r)},bu=function(t,e){var n=t.decorated_machine;n.render(n,e)},yu=function(t,e,n,a){var i={init:xu,release:wu,update:ku,render:Eu,get_object_instance:Si},r=i;return r.decorated_machine=t,r.title=e,r.message=n,r.strategy=a,i},xu=function(t){var e=t.decorated_machine;e.init(e)},wu=function(t){var e=t.decorated_machine;e.release(e)},ku=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t;c.strategy(c),o.update(o,e,n,a,i,r)},Eu=function(t,e){var n=t.decorated_machine;n.render(n,e)},Su=function(t){Hh(t.title,t.message)},Mu=function(t){Wh()},Tu=function(t){var e=t.decorated_machine;e.init(e)},ju=function(t){var e=t.decorated_machine;e.release(e)},Iu=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t).actor,u=X(),l=null,d=null,p=null,f=null,_=null,h=null,m=null,g=null,v=.001*z(),b=s.position;s.position.x+=-c.amplitude_x*c.angularspeed_x*Math.sin(c.initialphase_x+c.angularspeed_x*v)*u,s.position.y+=c.amplitude_y*c.angularspeed_y*Math.cos(c.initialphase_y+c.angularspeed_y*v)*u;var y=Jn(s,0,0,a,l,d,p,f,_,h,m,g);l=y.up,d=y.upright,p=y.right,f=y.downright,_=y.down,h=y.downleft,m=y.left,g=y.upleft;var x=ea(s,0,l,d,p,f,_,h,m,g);l=x.up,d=x.upright,p=x.right,f=x.downright,_=x.down,h=x.downleft,m=x.left,g=x.upleft,null!=p&&s.position.x>b.x&&(s.position.x=s.hot_spot.x-zn(s).width+p.x),null!=m&&s.position.x<b.x&&(s.position.x=s.hot_spot.x+m.x+An(m).width),null!=_&&s.position.y>b.y&&(s.position.y=s.hot_spot.y-zn(s).height+_.y),null!=l&&s.position.y<b.y&&(s.position.y=s.hot_spot.y+l.y+An(l).height),o.update(o,e,n,a,i,r)},Du=function(t,e){var n=t.decorated_machine;n.render(n,e)},Ou=function(t){var e=t.decorated_machine;e.init(e)},Ru=function(t){var e=t.decorated_machine;e.release(e)},Au=function(t,e,n,a,i,r){for(var o=t.decorated_machine,c=t,s=t.get_object_instance(t),u=0;u<n;u++){var l=e[u];l&&qn(s.actor,l.actor)&&(is(l)||l.invincible?(l.actor.is_jumping&&as(l),Ch(c.score),Kh(kc,at(s.actor.position,nt(0,-15))),tm(s.actor.position),A($e("destroy")),s.state=Tp):es(l))}o&&o.update(o,e,n,a,i,r)},Lu=function(t,e){var n=t.decorated_machine;n.render(n,e)},Nu=function(t){var e=t.decorated_machine;e.init(e)},Cu=function(t){var e=t.decorated_machine;e.release(e)},Gu=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t.get_object_instance(t).actor;Xn(c,na(c,a,Qh())),o.update(o,e,n,a,i,r)},Pu=function(t,e){var n=t.decorated_machine;n.render(n,e)},Uu=function(t,e){var n={init:Bu,release:Yu,update:Hu,render:Wu,get_object_instance:Si},a=n;return a.decorated_machine=t,a.should_hit_the_player=e,n},Bu=function(t){var e=t.decorated_machine;e.init(e)},Yu=function(t){var e=t.decorated_machine;e.release(e)},Hu=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=Pp(t.get_object_instance(t));!s.invincible&&c.should_hit_the_player(s)&&es(s),o.update(o,e,n,a,i,r)},Wu=function(t,e){var n=t.decorated_machine;n.render(n,e)},Fu=function(t){return!0},Xu=function(t){return t.shield_type!=Wc&&t.shield_type!=Xc},zu=function(t){return t.shield_type!=Fc},$u=function(t){return t.shield_type!=zc},Qu=function(t){var e=t.decorated_machine;e.init(e)},Vu=function(t){var e=t.decorated_machine;e.release(e)},Ku=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t.get_object_instance(t).actor;Jn(c,2,-4,a,null,null,null,null,null,null,null,null),ea(c,-4,null,null,null,null,null,null,null,null),o.update(o,e,n,a,i,r)},qu=function(t,e){var n=t.decorated_machine;n.render(n,e)},Ju=function(t){var e=t.decorated_machine,n=t,a=Math.abs(n.x2-n.x1),i=Math.abs(n.y2-n.y1);n.cute_image=nl(a,i),n.has_locked_somebody=!1,e.init(e)},Zu=function(t){var e=t.decorated_machine;e.release(e)},tl=function(t,e,n,a,i,r){var o,c,s,u,l,d=t.decorated_machine,p=t,f=t.get_object_instance(t),_=Pp(f),h=f.actor;o=h.position.x+p.x1,c=h.position.y+p.y1,s=p.x2-p.x1,u=p.y2-p.y1;for(var m=0;m<n;m++)if(l=e[m].actor,e[m]!=_||null!=l.carrying)l.position.x>o-30&&l.position.x<o&&(l.position.x=o-30,l.speed.x=0),l.position.x>o+s&&l.position.x<o+s+30&&(l.position.x=o+s+30,l.speed.x=0);else{var g=[],v=[];g[0]=l.position.x,g[1]=l.position.y,g[2]=l.position.x+1,g[3]=l.position.y+1,v[0]=o,v[1]=c,v[2]=o+s,v[3]=c+u,J(g,v)&&(p.has_locked_somebody=!0,e[m].in_locked_area=!0,zh(o,c,o+s,c+u))}p.has_locked_somebody&&((l=_.actor).position.x<o&&(l.position.x=o,l.speed.x=Math.max(0,l.speed.x),_.at_some_border=!0),l.position.x>o+s&&(l.position.x=o+s,l.speed.x=Math.min(0,l.speed.x),_.at_some_border=!0),l.position.y=Math.min(l.position.y,c,c+u)),d.update(d,e,n,a,i,r)},el=function(t,e){var n=t.decorated_machine;n.render(n,e)},nl=function(t,e){var n=Ze(t,e);return an(255,0,0),n},al=function(t,e){var n={init:il,release:rl,update:ol,render:cl,get_object_instance:Si},a=n;return a.decorated_machine=t,a.look_strategy=e,n},il=function(t){var e=t.decorated_machine;e.init(e)},rl=function(t){var e=t.decorated_machine;e.release(e)},ol=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t;c.look_strategy(c),o.update(o,e,n,a,i,r)},cl=function(t,e){var n=t.decorated_machine;n.render(n,e)},sl=function(t){var e=t;e.get_object_instance(e).actor.mirror&=-2},ul=function(t){var e=t;e.get_object_instance(e).actor.mirror|=1},ll=function(t){var e=t,n=e.get_object_instance(e),a=Pp(n);a&&(n.actor.position.x<a.actor.position.x?n.actor.mirror&=-2:n.actor.mirror|=1)},dl=function(t){var e=t,n=e.get_object_instance(e);n.actor.position.x>t.old_x?n.actor.mirror&=-2:n.actor.mirror|=1,t.old_x=n.actor.position.x},pl=function(t){var e=t.decorated_machine;e.init(e)},fl=function(t){var e=t.decorated_machine;e.release(e)},_l=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t),u=Pp(s);if(u){var l=it(u.actor.position,s.actor.position);if(ot(l)>=5){var d=X(),p=st(l),f=rt(p,c.speed*d);s.actor.position=at(s.actor.position,f)}}o.update(o,e,n,a,i,r)},hl=function(t,e){var n=t.decorated_machine;n.render(n,e)},ml=function(t){var e=t.decorated_machine;e.init(e)},gl=function(t){var e=t.decorated_machine;e.release(e)},vl=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=X(),u=rt(c.speed,s),l=Pp(t.get_object_instance(t));l.actor.position=at(l.actor.position,u),o.update(o,e,n,a,i,r)},bl=function(t,e){var n=t.decorated_machine;n.render(n,e)},yl=function(t,e){var n={init:wl,release:kl,update:El,render:Sl,get_object_instance:Si},a=n;return a.decorated_machine=t,a.strategy=e,n},xl=function(t,e,n){return{player_name:t,object:e,run:n}},wl=function(t){var e=t.decorated_machine;e.init(e)},kl=function(t){var e=t.decorated_machine;e.release(e)},El=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t;c.strategy.run(c.strategy,e,n),o.update(o,e,n,a,i,r)},Sl=function(t,e){var n=t.decorated_machine;n.render(n,e)},Ml=function(t,e,n){Up(t.object,null)},Tl=function(t,e,n){Bp(t.object)},jl=function(t,e,n){Yp(t.object)},Il=function(t,e,n){for(var a=Pp(t.object),i=0;i<n;i++)if(e[i]==a){Up(t.object,e[(i+1)%n]);break}},Dl=function(t,e,n){return Ol(t,n,Cl(e))},Ol=function(t,e,n){var a={init:Rl,release:Al,update:Ll,render:Nl,get_object_instance:Si},i=a;return i.new_state_name=e,i.strategy=n,a},Rl=function(t){var e=t.decorated_machine;e.init(e)},Al=function(t){var e=t.decorated_machine;e.release(e)},Ll=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t);c.strategy.should_trigger_event(c.strategy,s,e,n,a,i,r)?wi(s.vm,c.new_state_name):o.update(o,e,n,a,i,r)},Nl=function(t,e){var n=t.decorated_machine;n.render(n,e)},Cl=function(t){var e={init:Gl,release:Pl,should_trigger_event:Ul},n=e;return n.timeout=t,n.timer=0,e},Gl=function(t){},Pl=function(t){},Ul=function(t,e,n,a,i,r,o){var c=t;return c.timer+=X(),c.timer>=c.timeout&&(c.timer=0,!0)},Bl=function(t){},Yl=function(t){},Hl=function(t,e,n,a,i,r,o){for(var c=t,s=o;null!=s;s=s.next)if(s.data.name==c.target_name&&qn(s.data.actor,e.actor))return!0;return!1},Wl=function(t){},Fl=function(t){},Xl=function(t,e,n,a,i,r,o){return Vn(e.actor)},zl=function(t){},$l=function(t){},Ql=function(t,e,n,a,i,r,o){return 1e5*t.probability>K(1e5)},Vl=function(t){},Kl=function(t){},ql=function(t,e,n,a,i,r,o){var c=Pp(e);return qn(e.actor,c.actor)},Jl=function(t){},Zl=function(t){},td=function(t,e,n,a,i,r,o){var c=Pp(e);return is(c)&&qn(e.actor,c.actor)},ed=function(t){},nd=function(t){},ad=function(t,e,n,a,i,r,o){var c=t,s=e.actor,u=Pp(e),l=u.actor,d=zn(l),p=[],f=[];return p[0]=s.position.x+c.x1,p[1]=s.position.y+c.y1,p[2]=s.position.x+c.x2,p[3]=s.position.y+c.y2,f[0]=l.position.x-l.hot_spot.x,f[1]=l.position.y-l.hot_spot.y,f[2]=l.position.x-l.hot_spot.x+d.width,f[3]=l.position.y-l.hot_spot.y+d.height,!u.dying&&J(p,f)},id=function(t){var e={init:rd,release:od,should_trigger_event:cd};return e.shield_type=t,e},rd=function(t){},od=function(t){},cd=function(t,e,n,a,i,r,o){var c=t;return Pp(e).shield_type==c.shield_type},sd=function(t){},ud=function(t){},ld=function(t,e,n,a,i,r,o){var c=e.actor;Jn(c,1,0,i,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined)},dd=function(t){},pd=function(t){},fd=function(t,e,n,a,i,r,o){var c=e.actor;Jn(c,1,0,i,void 0,void 0,void 0,undefined,undefined,undefined,void 0,void 0)},_d=function(t){},hd=function(t){},md=function(t,e,n,a,i,r,o){var c=e.actor;Jn(c,1,0,i,undefined,undefined,void 0,void 0,void 0,void 0,void 0,undefined)},gd=function(t){},vd=function(t){},bd=function(t,e,n,a,i,r,o){var c=e.actor;Jn(c,1,0,i,void 0,void 0,void 0,void 0,void 0,void 0,undefined,undefined)},yd=function(t){},xd=function(t){},wd=function(t,e,n,a,i,r,o){var c=e.actor;Jn(c,1,0,i,void 0,undefined,undefined,void 0,void 0,void 0,void 0,void 0)},kd=function(t,e){var n={init:Ed,release:Sd,update:Md,render:Td,get_object_instance:Si},a=n;return a.decorated_machine=t,a.update=e,n},Ed=function(t){var e=t.decorated_machine;e.init(e)},Sd=function(t){var e=t.decorated_machine;e.release(e)},Md=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=Pp(t.get_object_instance(t));c.update(s),o.update(o,e,n,a,i,r)},Td=function(t,e){var n=t.decorated_machine;n.render(n,e)},jd=function(t){t.spring=!0,t.spin=!1,t.flying=!1,t.climbing=!1,t.landing=!1,t.getting_hit=!1,t.is_fire_jumping=!1},Id=function(t){t.spin=!0,t.spring=!1,t.flying=!1,t.climbing=!1,t.landing=!1,t.getting_hit=!1,t.is_fire_jumping=!1},Dd=function(t,e){var n={init:Od,release:Rd,update:Ad,render:Ld,get_object_instance:Si},a=n;return a.decorated_machine=t,a.enable=e,n},Od=function(t){var e=t.decorated_machine;e.init(e)},Rd=function(t){var e=t.decorated_machine;e.release(e)},Ad=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t;Pp(t.get_object_instance(t)).disable_movement=!c.enable,o.update(o,e,n,a,i,r)},Ld=function(t,e){var n=t.decorated_machine;n.render(n,e)},Nd=function(t,e){var n={init:Cd,release:Gd,update:Pd,render:Ud,get_object_instance:Si},a=n;return a.decorated_machine=t,a.alpha=Math.min(e,0,1),n},Cd=function(t){var e=t.decorated_machine;e.init(e)},Gd=function(t){var e=t.decorated_machine;e.release(e)},Pd=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t;t.get_object_instance(t).actor.alpha=c.alpha,o.update(o,e,n,a,i,r)},Ud=function(t,e){var n=t.decorated_machine;n.render(n,e)},Bd=function(t){var e=t.decorated_machine;e.init(e)},Yd=function(t){var e=t.decorated_machine;e.release(e)},Hd=function(t,e,n,a,i,r){var o=t.decorated_machine;Fd(t),o.update(o,e,n,a,i,r)},Wd=function(t,e){var n=t.decorated_machine;n.render(n,e)},Fd=function(t){var e=t,n=t.get_object_instance(t);Qn(n.actor,e.anim)},Xd=function(t,e,n){var a={init:zd,release:$d,update:Qd,render:Vd,get_object_instance:Si},i=a;return i.decorated_machine=t,i.is_obstacle=e,i.angle=n,a},zd=function(t){var e=t.decorated_machine;e.init(e)},$d=function(t){var e=t.decorated_machine;e.release(e)},Qd=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t);s.obstacle=c.is_obstacle,s.obstacle_angle=c.angle,o.update(o,e,n,a,i,r)},Vd=function(t,e){var n=t.decorated_machine;n.render(n,e)},Kd=function(t){var e=t.decorated_machine;e.init(e)},qd=function(t){var e=t.decorated_machine;e.release(e)},Jd=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=Pp(t.get_object_instance(t));Qn(s.actor,c.anim),o.update(o,e,n,a,i,r)},Zd=function(t,e){var n=t.decorated_machine;n.render(n,e)},tp=function(t){var e=t.decorated_machine;e.init(e)},ep=function(t){var e=t.decorated_machine;e.release(e)},np=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t);Pp(s).actor.position=at(s.actor.position,c.offset),o.update(o,e,n,a,i,r)},ap=function(t,e){var n=t.decorated_machine;n.render(n,e)},ip=function(t){var e=t.decorated_machine;e.init(e)},rp=function(t){var e=t.decorated_machine;e.release(e)},op=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=Pp(t.get_object_instance(t));c.strategy(s,c.speed),o.update(o,e,n,a,i,r)},cp=function(t,e){var n=t.decorated_machine;n.render(n,e)},sp=function(t,e,n){var a={init:ip,release:rp,update:op,render:cp,get_object_instance:Si},i=a;return i.decorated_machine=t,i.speed=e,i.strategy=n,a},up=function(t,e){t.actor.speed.x=e},lp=function(t,e){t.actor.speed.y=e},dp=function(t){var e=t.decorated_machine;t.direction=0==K(2)?-1:1,e.init(e)},pp=function(t){var e=t.decorated_machine;e.release(e)},fp=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t).actor,u=X(),l=null,d=null,p=null,f=null,_=null,h=null,m=null,g=null;s.position.x+=c.direction*c.speed*u;var v=Jn(s,2,-2,a,l,d,p,f,_,h,m,g);l=v.up,d=v.upright,p=v.right,f=v.downright,_=v.down,h=v.downleft,m=v.left,g=v.upleft;var b=ea(s,-2,l,d,p,f,_,h,m,g);l=b.up,d=b.upright,p=b.right,f=b.downright,_=b.down,h=b.downleft,m=b.left,g=b.upleft,null!=p&&c.direction>0&&(s.position.x=s.hot_spot.x-zn(s).width+p.x,c.direction=-1),null!=m&&c.direction<0&&(s.position.x=s.hot_spot.x+m.x+An(m).width,c.direction=1),null!=_&&(null==f&&null!=h?c.direction=-1:null==h&&null!=f&&(c.direction=1)),o.update(o,e,n,a,i,r)},_p=function(t,e){var n=t.decorated_machine;n.render(n,e)},hp=0,mp=[],gp=[{command:"set_animation",action:function(t,e,n){var a,i,r,o,c;return 2==e?(a=t,i=n[0],r=+n[1],(c=o={init:Bd,release:Yd,update:Hd,render:Wd,get_object_instance:Si}).decorated_machine=a,c.anim=fn(i,r),t=o):E("Object script error - set_animation expects two parameters: sprite_name, animation_id"),t}},{command:"set_obstacle",action:function(t,e,n){return 1==e?t=Xd(t,+n[0],0):2==e?t=Xd(t,+n[0],+n[1]):E("Object script error - set_obstacle expects at least one and at most two parameters: is_obstacle (TRUE or FALSE) [, angle]"),t}},{command:"set_alpha",action:function(t,e,n){return 1==e?t=Nd(t,+n[0]):E("Object script error - set_alpha expects one parameter: alpha (0.0 (transparent) <= alpha <= 1.0 (opaque))"),t}},{command:"hide",action:function(t,e,n){return 0==e?t=Nd(t,0):E("Object script error - hide expects no parameters"),t}},{command:"show",action:function(t,e,n){return 0==e?t=Nd(t,1):E("Object script error - show expects no parameters"),t}},{command:"enemy",action:function(t,e,n){return 1==e?t=function(t,e){var n={init:Ou,release:Ru,update:Au,render:Lu,get_object_instance:Si},a=n;return a.decorated_machine=t,a.score=e,n}(t,+n):E("Object script error - enemy expects one parameter: score"),t}},{command:"lock_camera",action:function(t,e,n){var a,i,r,o,c,s,u;return 4==e?(a=t,i=+n[0],r=+n[1],o=+n[2],c=+n[3],(u=s={init:Ju,release:Zu,update:tl,render:el,get_object_instance:Si}).decorated_machine=a,u.x1=Math.min(i,o),u.y1=Math.min(r,c),u.x2=Math.max(i,o),u.y2=Math.max(r,c),t=s):E("Object script error - lock_camera expects four parameters: x1, y1, x2, y2"),t}},{command:"move_player",action:function(t,e,n){var a,i,r,o,c;return 2==e?(a=t,i=+n[0],r=+n[1],(c=o={init:ml,release:gl,update:vl,render:bl,get_object_instance:Si}).decorated_machine=a,c.speed=nt(i,r),t=o):E("Object script error - move_player expects two parameters: speed_x, speed_y"),t}},{command:"hit_player",action:function(t,e,n){return 0==e?t=Uu(t,Fu):E("Object script error - hit_player expects no parameters"),t}},{command:"burn_player",action:function(t,e,n){return 0==e?t=Uu(t,Xu):E("Object script error - burn_player expects no parameters"),t}},{command:"shock_player",action:function(t,e,n){return 0==e?t=Uu(t,zu):E("Object script error - shock_player expects no parameters"),t}},{command:"acid_player",action:function(t,e,n){return 0==e?t=Uu(t,$u):E("Object script error - acid_player expects no parameters"),t}},{command:"add_rings",action:function(t,e,n){return 1==e?t=function(t,e){var n={init:ms,release:gs,update:vs,render:bs,get_object_instance:Si},a=n;return a.decorated_machine=t,a.rings=e,n}(t,+n[0]):E("Object script error - add_rings expects one parameter: number_of_rings"),t}},{command:"add_to_score",action:function(t,e,n){return 1==e?t=function(t,e){var n={init:ys,release:xs,update:ws,render:ks,get_object_instance:Si},a=n;return a.decorated_machine=t,a.score=e,n}(t,+n[0]):E("Object script error - add_to_score expects one parameter: score"),t}},{command:"set_player_animation",action:function(t,e,n){var a,i,r,o,c;return 2==e?(a=t,i=n[0],r=+n[1],(c=o={init:Kd,release:qd,update:Jd,render:Zd,get_object_instance:Si}).decorated_machine=a,c.anim=fn(i,r),t=o):E("Object script error - set_player_animation expects two parameters: sprite_name, animation_id"),t}},{command:"enable_player_movement",action:function(t,e,n){return 0==e?t=Dd(t,!0):E("Object script error - enable_player_movement expects no parameters"),t}},{command:"disable_player_movement",action:function(t,e,n){0==e?t=Dd(t,!1):E("Object script error - disable_player_movement expects no parameters")}},{command:"set_player_xspeed",action:function(t,e,n){var a,i;return 1==e?(a=t,i=+n[0],t=sp(a,i,up)):E("Object script error - set_player_xspeed expects one parameter: speed"),t}},{command:"set_player_yspeed",action:function(t,e,n){var a,i;return 1==e?(a=t,i=+n[0],t=sp(a,i,lp)):E("Object script error - set_player_yspeed expects one parameter: speed"),t}},{command:"set_player_position",action:function(t,e,n){var a,i,r,o,c;return 2==e?(a=t,i=+n[0],r=+n[1],(c=o={init:tp,release:ep,update:np,render:ap,get_object_instance:Si}).decorated_machine=a,c.offset=nt(i,r),t=o):E("Object script error - set_player_position expects two parameters: xpos, ypos"),t}},{command:"bounce_player",action:function(t,e,n){var a;return 0==e?((a={init:Ys,release:Hs,update:Ws,render:Fs,get_object_instance:Si}).decorated_machine=t,t=a):E("Object script error - bounce_player expects no parameters"),t}},{command:"observe_player",action:function(t,e,n){var a,i,r;return 1==e?(a=t,i=n[0],r=a.get_object_instance(a),t=yl(a,xl(i,r,Ml))):E("Object script error - observe_player expects one parameter: player_name"),t}},{command:"observe_current_player",action:function(t,e,n){var a,i;return 0==e?(i=(a=t).get_object_instance(a),t=yl(a,xl("foo",i,Tl))):E("Object script error - observe_current_player expects no parameters"),t}},{command:"observe_active_player",action:function(t,e,n){var a,i;return 0==e?(i=(a=t).get_object_instance(a),t=yl(a,xl("bar",i,jl))):E("Object script error - observe_active_player expects no parameters"),t}},{command:"observe_all_players",action:wp},{command:"observe_next_player",action:wp},{command:"attach_to_player",action:function(t,e,n){return 0==e?t=Es(t,0,0):1==e?t=Es(t,+n[0],0):2==e?t=Es(t,+n[0],+n[1]):E("Object script error - attach_to_player expects at most two parameters: [offset_x [, offset_y]]"),t}},{command:"springfy_player",action:function(t,e,n){return 0==e?t=kd(t,jd):E("Object script error - springfy_player expects no parameters"),t}},{command:"roll_player",action:function(t,e,n){return 0==e?t=kd(t,Id):E("Object script error - roll_player expects no parameters"),t}},{command:"walk",action:function(t,e,n){var a,i,r;return 1==e?(a=+n,(r=i={init:dp,release:pp,update:fp,render:_p,get_object_instance:Si}).decorated_machine=t,r.speed=a,t=i):E("Object script error - walk expects one parameter: speed"),t}},{command:"gravity",action:function(t,e,n){var a;return 0==e?((a={init:Nu,release:Cu,update:Gu,render:Pu,get_object_instance:Si}).decorated_machine=t,t=a):E("Object script error - gravity expects no parameters"),t}},{command:"jump",action:function(t,e,n){var a,i,r,o;return 1==e?(a=t,i=+n[0],(o=r={init:Qu,release:Vu,update:Ku,render:qu,get_object_instance:Si}).decorated_machine=a,o.jump_strength=i,t=r):E("Object script error - jump expects one parameter: jump_strength"),t}},{command:"move",action:kp},{command:"bullet_trajectory",action:kp},{command:"elliptical_trajectory",action:function(t,e,n){var a,i,r,o,c,s,u,l,d;return e>=4&&e<=6?(a=t,i=+n[0],r=+n[1],o=+n[2],c=+n[3],s=+n[4],u=+n[5],(d=l={init:Tu,release:ju,update:Iu,render:Du,get_object_instance:Si}).decorated_machine=a,d.amplitude_x=i,d.amplitude_y=r,d.angularspeed_x=o*(2*m),d.angularspeed_y=c*(2*m),d.initialphase_x=s*m/180,d.initialphase_y=u*m/180,t=l):E("Object script error - elliptical_trajectory expects at least four and at most six parameters: amplitude_x, amplitude_y, angularspeed_x, angularspeed_y [, initialphase_x [, initialphase_y]]"),t}},{command:"mosquito_movement",action:function(t,e,n){var a,i,r;return 1==e?(a=+n,(r=i={init:pl,release:fl,update:_l,render:hl,get_object_instance:Si}).decorated_machine=t,r.speed=a,t=i):E("Object script error - mosquito_movement expects one parameter: speed"),t}},{command:"look_left",action:function(t,e,n){return 0==e?t=al(t,sl):E("Object script error - look_left expects no parameters"),t}},{command:"look_right",action:function(t,e,n){return 0==e?t=al(t,ul):E("Object script error - look_right expects no parameters"),t}},{command:"look_at_player",action:function(t,e,n){return 0==e?t=al(t,ll):E("Object script error - look_at_player expects no parameters"),t}},{command:"look_at_walking_direction",action:function(t,e,n){return 0==e?t=al(t,dl):E("Object script error - look_at_walking_direction expects no parameters"),t}},{command:"create_item",action:function(t,e,n){var a,i,r,o,c,s;return 3==e?(a=t,i=+n[0],r=+n[1],o=+n[2],(s=c={init:pu,release:fu,update:_u,render:hu,get_object_instance:Si}).decorated_machine=a,s.item_id=i,s.offset=nt(r,o),t=c):E("Object script error - create_item expects three parameters: item_id, offset_x, offset_y"),t}},{command:"change_closest_object_state",action:function(t,e,n){var a,i,r,o,c;return 2==e?(a=t,i=n[0],r=n[1],(c=o={init:Vs,release:Ks,update:qs,render:Js,get_object_instance:Si}).decorated_machine=a,c.object_name=i,c.new_state_name=r,t=o):E("Object script error - change_closest_object_state expects two parameters: object_name, new_state_name"),t}},{command:"create_child",action:function(t,e,n){return 3==e?t=tu(t,n[0],+n[1],+n[2],""):4==e?t=tu(t,n[0],+n[1],+n[2],n[3]):E("Object script error - create_child expects three or four parameters: object_name, offset_x, offset_y [, child_name]"),t}},{command:"change_child_state",action:function(t,e,n){var a,i,r,o,c;return 2==e?(a=t,i=n[0],r=n[1],(c=o={init:eu,release:nu,update:au,render:iu,get_object_instance:Si}).decorated_machine=a,c.strategy=ou,c.offset=nt(0,0),c.object_name=null,c.child_name=i,c.new_state_name=r,t=o):E("Object script error - change_child_state expects two parameters: child_name, new_state_name"),t}},{command:"change_parent_state",action:function(t,e,n){var a,i,r,o;return 1==e?(a=t,i=n[0],(o=r={init:eu,release:nu,update:au,render:iu,get_object_instance:Si}).decorated_machine=a,o.strategy=cu,o.offset=nt(0,0),o.object_name=null,o.child_name=null,o.new_state_name=i,t=r):E("Object script error - change_parent_state expects one parameter: new_state_name"),t}},{command:"destroy",action:function(t,e,n){var a;return 0==e?((a={init:mu,release:gu,update:vu,render:bu,get_object_instance:Si}).decorated_machine=t,t=a):E("Object script error - destroy expects no parameters"),t}},{command:"change_state",action:function(t,e,n){return 1==e?t=Dl(t,0,n[0]):E("Object script error - change_state expects one parameter: new_state_name"),t}},{command:"on_timeout",action:function(t,e,n){return 2==e?t=Dl(t,+n[0],n[1]):E("Object script error - on_timeout expects two parameters: timeout (in seconds), new_state_name"),t}},{command:"on_collision",action:function(t,e,n){var a,i,r;return 2==e?(a=t,i=n[0],r=n[1],t=Ol(a,r,function(t){var e={init:Bl,release:Yl,should_trigger_event:Hl};return e.target_name=t,e}(i))):E("Object script error - on_collision expects two parameters: object_name, new_state_name"),t}},{command:"on_animation_finished",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Ol(a,i,{init:Wl,release:Fl,should_trigger_event:Xl})):E("Object script error - on_animation_finished expects one parameter: new_state_name"),t}},{command:"on_random_event",action:function(t,e,n){var a,i,r;return 2==e?(a=t,i=+n[0],r=n[1],t=Ol(a,r,function(t){var e={init:zl,release:$l,should_trigger_event:Ql};return e.probability=Math.min(t,0,1),e}(i))):E("Object script error - on_random_event expects two parameters: probability (0.0 <= probability <= 1.0), new_state_name"),t}},{command:"on_player_collision",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Ol(a,i,{init:Vl,release:Kl,should_trigger_event:ql})):E("Object script error - on_player_collision expects one parameter: new_state_name"),t}},{command:"on_player_attack",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Ol(a,i,{init:Jl,release:Zl,should_trigger_event:td})):E("Object script error - on_player_attack expects one parameter: new_state_name"),t}},{command:"on_player_rect_collision",action:function(t,e,n){var a,i,r,o,c,s;return 5==e?(a=t,i=+n[0],r=+n[1],o=+n[2],c=+n[3],s=n[4],t=Ol(a,s,function(t,e,n,a){var i={init:ed,release:nd,should_trigger_event:ad},r=i;return r.x1=Math.min(t,n),r.y1=Math.min(e,a),r.x2=Math.max(t,n),r.y2=Math.max(e,a),i}(i,r,o,c))):E("Object script error - on_player_rect_collision expects five parameters: offset_x1, offset_y1, offset_x2, offset_y2, new_state_name"),t}},{command:"on_no_shield",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Ol(a,i,id(0))):E("Object script error - on_no_shield expects one parameter: new_state_name"),t}},{command:"on_shield",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Ol(a,i,id(Hc))):E("Object script error - on_shield expects one parameter: new_state_name"),t}},{command:"on_fire_shield",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Ol(a,i,id(Wc))):E("Object script error - on_fire_shield expects one parameter: new_state_name"),t}},{command:"on_thunder_shield",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Ol(a,i,id(Fc))):E("Object script error - on_thunder_shield expects one parameter: new_state_name"),t}},{command:"on_water_shield",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Ol(a,i,id(Xc))):E("Object script error - on_water_shield expects one parameter: new_state_name"),t}},{command:"on_acid_shield",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Ol(a,i,id(zc))):E("Object script error - on_acid_shield expects one parameter: new_state_name"),t}},{command:"on_wind_shield",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Ol(a,i,id($c))):E("Object script error - on_wind_shield expects one parameter: new_state_name"),t}},{command:"on_brick_collision",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Ol(a,i,{init:sd,release:ud,should_trigger_event:ld})):E("Object script error - on_brick_collision expects one parameter: new_state_name"),t}},{command:"on_floor_collision",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Ol(a,i,{init:dd,release:pd,should_trigger_event:fd})):E("Object script error - on_floor_collision expects one parameter: new_state_name"),t}},{command:"on_ceiling_collision",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Ol(a,i,{init:_d,release:hd,should_trigger_event:md})):E("Object script error - on_ceiling_collision expects one parameter: new_state_name"),t}},{command:"on_left_wall_collision",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Ol(a,i,{init:gd,release:vd,should_trigger_event:bd})):E("Object script error - on_left_wall_collision expects one parameter: new_state_name"),t}},{command:"on_right_wall_collision",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Ol(a,i,{init:yd,release:xd,should_trigger_event:wd})):E("Object script error - on_right_wall_collision expects one parameter: new_state_name"),t}},{command:"show_dialog_box",action:function(t,e,n){return 2==e?t=function(t,e,n){return yu(t,e,n,Su)}(t,n[0],n[1]):E("Object script error - show_dialog_box expects two parameters: title, message"),t}},{command:"hide_dialog_box",action:function(t,e,n){return 0==e?t=yu(t,"dead","beef",Mu):E("Object script error - hide_dialog_box expects no parameters"),t}},{command:"clear_level",action:function(t,e,n){var a;return 0==e?((a={init:su,release:uu,update:lu,render:du,get_object_instance:Si}).decorated_machine=t,t=a):E("Object script error - clear_level expects no parameters"),t}},{command:"play_sample",action:function(t,e,n){return 1==e?t=Is(t,n[0],1,0,1,!1):2==e?t=Is(t,n[0],+n[1],0,1,!1):3==e?t=Is(t,n[0],+n[1],+n[2],1,!1):4==e||5==e?t=Is(t,n[0],+n[1],+n[2],+n[3],!1):E("Object script error - play_sample expects at least one and at most five parameters: sound_name [, volume [, pan [, frequency [, loops]]]]"),t}},{command:"play_music",action:function(t,e,n){var a,i;return 1==e||2==e?(a=t,i=n[0],t=Ls(a,Gs(i,!1))):E("Object script error - play_music expects at least one and at most two parameters: music_name [, loops]"),t}},{command:"play_level_music",action:function(t,e,n){return 0==e?t=Ls(t,{update:Us,mus:null,loop:!0}):E("Object script error - play_level_music expects no parameters"),t}},{command:"set_music_volume",action:function(t,e,n){var a,i;return 1==e?(a=t,i=+n[0],t=Ls(a,function(t){return{update:Bs,vol:q(t,0,1)}}(i))):E("Object script error - set_music_volume expects one parameter: volume"),t}},{command:null,action:null}],vp=function(t,e){return function(t,e){var n,a,i,r=e;if(0===r.state){var o=t.state.name;for(r.state,r.vm.state_list=(a=r.vm,i=t.state.list[0][0],null==Ei(a.state_list,i)&&(a.state_list=function(t,e,n){var a,i;return{name:e,data:(a=n,i={init:mi,release:gi,update:vi,render:bi,get_object_instance:yi},i.object=a,i),next:t}}(a.state_list,i,a.owner)),a.state_list),r.vm=wi(r.vm,o),n=xi(r.vm),hp=0,function(t,e){hp<1024?(mp[hp]={stmt:t,machine:e},hp++):k("Object script error: you may write ".concat(1024," commands or less per state"))}(t.state.list,n);hp-- >0;)n=bp(mp[hp].stmt,mp[hp].machine);n&&n.init(n)}return r.vm.reference_to_current_state=n,t.destroy_if_far_from_play_area&&(r.preserve=!1),t.always_active&&(r.always_active=!0),t.hide_unless_in_editor_mode&&(r.hide_unless_in_editor_mode=!0),r}(e,t)};function bp(t,e){var n,a,i,r,o=t;for(a=o.length,n=0;n<a;n++)r=(i=o[n])[1]&&void 0!==i[1]?i[1].length?i[1].length:1:0,e=xp(e,i[0],r,i[1]);return e}function yp(t,e,n,a){return t(e,n,a)}function xp(t,e,n,a){for(var i=0,r=gp[i++];null!=r.command&&null!=r.action;)r.command==e&&(t=yp(r.action,t,n,a)),r=gp[i++];return t}function wp(t,e,n){var a,i;return 0==e?(i=(a=t).get_object_instance(a),t=yl(a,xl("boo",i,Il))):E("Object script error - observe_all_players expects no parameters"),t}function kp(t,e,n){var a,i,r,o,c;return 2==e?(a=t,i=+n[0],r=+n[1],(c=o={init:Xs,release:zs,update:$s,render:Qs,get_object_instance:Si}).decorated_machine=a,c.speed=nt(i,r),t=o):E("Object script error - bullet_trajectory expects two parameters: speed_x, speed_y"),t}var Ep;!function(t){t[t.ES_IDLE=0]="ES_IDLE",t[t.ES_DEAD=1]="ES_DEAD"}(Ep||(Ep={}));var Sp,Mp=Ep.ES_IDLE,Tp=Ep.ES_DEAD,jp=null,Ip=[],Dp=function(t){return Hp(t)},Op=function(t){if(!t)return null;for(var e=t.children;e;e=e.next)e.data.parent=null;var n;return Xp(t.children),null!=t.parent&&Gp(t.parent,t),(n=t.vm).state_list=ki(n.state_list),n.reference_to_current_state=null,n.owner=null,Hn(t.actor),null},Rp=function(t,e,n,a,i,r){if(t){var o=xi(t.vm);o.update(o,e,n,a,i,r)}},Ap=function(t,e){if(t){var n=xi(t.vm);(!t.hide_unless_in_editor_mode||t.hide_unless_in_editor_mode&&Ah())&&n.render(n,e)}},Lp=function(t){return t.parent},Np=function(t,e){return Qp(t.children,e)},Cp=function(t,e,n){t.children=zp(t.children,e,n),n.parent=t,n.created_from_editor=!1},Gp=function(t,e){t.children=$p(t.children,e)},Pp=function(t){return null!=t.observed_player?t.observed_player:Lh()},Up=function(t,e){t.observed_player=e},Bp=function(t){t.observed_player=Lh()},Yp=function(t){t.observed_player=null},Hp=function(t){var e={in_object_name:null,out_object_block:null},n={name:t,state:Mp,actor:Yn(),preserve:!0,obstacle:!1,obstacle_angle:0,always_active:!1,hide_unless_in_editor_mode:!1,vm:null,created_from_editor:!0,parent:null,children:Fp(),observed_player:null};return n.actor.input=ye(),Qn(n.actor,fn("SD_QUESTIONMARK",0)),n.vm={owner:n,state_list:null,reference_to_current_state:null},e.in_object_name=t,e.out_object_block=null,e.out_object_block=Wp(jp,e),null!=e.out_object_block?n=vp(n,e.out_object_block):k("Object ".concat(t," does not exist")),n},Wp=function(t,e){var n=t[e.in_object_name];return n?(e.in_object_name,n):(k("Object script error: unknown keyword ".concat(n)),0)},Fp=function(){return null},Xp=function(t){return null!=t&&(Xp(t.next),t.name=null,t=null),null},zp=function(t,e,n){return{name:e,data:n,next:t}},$p=function(t,e){var n,a;if(null!=t){if(t.data==e)return a=t.next,t.name=null,t=null,a;for(n=t;null!=n.next&&n.next.data!=e;)n=n.next;return null!=n.next&&(a=n.next.next,n.next.name=null,n.next=null,n.next=a),t}return null},Qp=function(t,e){for(var n=t;null!=n;){if(n.name==e)return n.data;n=n.next}return null};!function(t){t[t.EDITORGRP_ENTITY_BRICK=0]="EDITORGRP_ENTITY_BRICK",t[t.EDITORGRP_ENTITY_ITEM=1]="EDITORGRP_ENTITY_ITEM",t[t.EDITORGRP_ENTITY_ENEMY=2]="EDITORGRP_ENTITY_ENEMY"}(Sp||(Sp={}));var Vp,Kp,qp=Sp.EDITORGRP_ENTITY_BRICK,Jp=Sp.EDITORGRP_ENTITY_ITEM,Zp=(Sp.EDITORGRP_ENTITY_ENEMY,[]),tf=0,ef=function(){return tf},nf=function(t){return tf>0?(t=q(t,0,tf-1),Zp[t]):null},af=function(t){return null!=t&&(t.next=af(t.next),t=null,t=null),t};!function(t){t[t.EDT_BRICK=1]="EDT_BRICK",t[t.EDT_ITEM=2]="EDT_ITEM",t[t.EDT_ENEMY=3]="EDT_ENEMY",t[t.EDT_GROUP=4]="EDT_GROUP"}(Vp||(Vp={})),function(t){t[t.EDA_NEWOBJECT=1]="EDA_NEWOBJECT",t[t.EDA_DELETEOBJECT=2]="EDA_DELETEOBJECT",t[t.EDA_CHANGESPAWN=3]="EDA_CHANGESPAWN",t[t.EDA_RESTORESPAWN=4]="EDA_RESTORESPAWN"}(Kp||(Kp={}));var rf,of,cf,sf,uf,lf,df,pf,ff,_f,hf,mf,gf,vf,bf,yf,xf,wf,kf,Ef,Sf,Mf,Tf,jf,If,Df,Of,Rf,Af,Lf,Nf,Cf,Gf,Pf,Uf,Bf,Yf,Hf,Wf,Ff,Xf,zf,$f,Qf,Vf,Kf,qf,Jf,Zf,t_,e_,n_,a_,i_,r_,o_,c_,s_,u_,l_,d_,p_,f_,__,h_,m_,g_,v_,b_,y_,x_,w_,k_=Vp.EDT_BRICK,E_=Vp.EDT_ITEM,S_=Vp.EDT_ENEMY,M_=Vp.EDT_GROUP,T_=Kp.EDA_NEWOBJECT,j_=Kp.EDA_DELETEOBJECT,I_=Kp.EDA_CHANGESPAWN,D_=Kp.EDA_RESTORESPAWN,O_=function(t){return t==qp?k_:t==Jp?E_:S_},R_=!1,A_=[38,40,39,37,78,66,17,123],L_=[87,83,68,65,90,89,71,80],N_=0,C_=0,G_=[0,1,2,3,4,5,7,6,42,78,79,80,81,16,17,18,19,20,54,48,49,50,51,52,53,21,47,22,23,43,44,45,46,55,62,56,57,58,59,60,61,24,25,Ec,Sc,28,29,30,Mc,32,33,34,Tc,36,37,75,76,77,38,63,64,65,66,67,68,69,39,70,71,72,73,74,-1],P_=!1,U_=nt(0,0),B_=function(){return t=void 0,e=void 0,a=function(){var t;return function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(e){switch(e.label){case 0:return k("editor_init()"),wf=nm(),R_=!1,mf=G_.length,ff=k_,N_=0,rf=St(),of=Mt(),gf=Ip,[4,tn("data/images/editorbg.png")];case 1:return t=e.sent(),cf=t,uf=xe(A_),lf=xe(L_),sf=function(){for(var t={type:Ct.IT_MOUSE,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},e=0;e<9;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return Oe(t),t}(),_f=la(8),hf=la(8),df=fi(),function(){tf=0;for(var t=0;t<501;t++)Zp[t]=null}(),th(),k("editor_init() ok"),[2]}}))},new((n=void 0)||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}));var t,e,n,a},Y_=function(){return R_},H_=function(){var t=Th();jh(t),A($e("level saved"))},W_=function(){var t,e=X();t=Ee(uf,Wt)?3750:750,(Ee(uf,Gt)||Ee(lf,Gt))&&(df.y-=t*e),(Ee(uf,Pt)||Ee(lf,Pt))&&(df.y+=t*e),(Ee(uf,Ut)||Ee(lf,Ut))&&(df.x-=t*e),(Ee(uf,Bt)||Ee(lf,Bt))&&(df.x+=t*e),df.x=~~Math.max(df.x,240),df.y=~~Math.max(df.y,135.5),_i(df)},F_=function(t){switch(t){case k_:return"brick";case E_:return"built-in item";case S_:return"object";case M_:return"group"}return"unknown"},X_=function(t,e){switch(t){case k_:Dn(e);break;case E_:Rc(e)}return""},z_=function(){N_=0,C_=0,(ff=ff==k_?E_:ff==E_?S_:ff==S_?M_:ff==M_?k_:ff)==M_&&0==ef()&&z_()},$_=function(){N_=0,C_=0,(ff=ff==E_?k_:ff==S_?E_:ff==M_?S_:ff==k_?M_:ff)==M_&&0==ef()&&$_()},Q_=function(){var t;switch(ff){case k_:t=On(),null==Dn(N_=(N_+1)%t)&&Q_();break;case E_:N_=G_[C_=(C_+1)%(t=mf)];break;case S_:N_=(N_+1)%(t=vf);break;case M_:t=ef(),N_=(N_+1)%t}},V_=function(){var t;switch(ff){case k_:t=On(),null==Dn(N_=(N_-1+t)%t)&&V_();break;case E_:N_=G_[C_=(C_-1+(t=mf))%t];break;case S_:N_=(N_-1+(t=vf))%t;break;case M_:t=ef(),N_=(N_-1+t)%t}},K_=function(t){var e;for(e=0;e<mf;e++)if(t==G_[e])return e;return-1},q_=function(t,e,n){var a=null,i=nt(0,0);switch(t){case k_:null!=Dn(e)&&(a=Dn(e).image);break;case E_:null!=(o=Rc(e))&&(a=zn(o.actor),(i=o.actor.hot_spot).y-=2);break;case S_:var r=Dp(Z_(e));null!=r&&(a=zn(r.actor),(i=r.actor.hot_spot).y-=2,Op(r));break;case M_:var o=void 0;for(o=nf(e);o;o=o.next){var c=O_(o.entity.type);q_(c,o.entity.id,at(n,o.entity.position))}}null!=a&&en(a.data,Et(),a.sx,a.sy,~~n.x-i.x,~~n.y-i.y,a.swidth,a.sheight)},J_=function(t){var e;for(e=0;e<vf;e++)if(t==gf[e])return e;return-1},Z_=function(t){return t=q(t,0,NaN),gf[t]},th=function(){P_=!1},eh=function(){},nh=function(){Se(lf,Wt)&&(P_=!P_)},ah=function(t){var e=it(df,nt(240,135.5)),n=~~(e.x%1),a=~~(e.y%1),i=-n+t.x/1*1,r=-a+t.y/1*1;return at(e,nt(i,r))},ih=function(t,e,n,a){return{type:t?T_:j_,obj_type:e,obj_id:n,obj_position:a,obj_old_position:a}},rh=function(t,e,n){return{type:t?I_:D_,obj_type:null,obj_id:null,obj_position:e,obj_old_position:n}},oh=function(){yf=sh(yf),bf=null,xf=null},ch=function(t){var e,n=!1;if(t.obj_type!=M_){var a=void 0,i=void 0,r={action:t,in_group:n,group_key:null,prev:null,next:null};for(r.in_group&&(r.group_key=e),null!=(a=xf)&&(a.next=sh(a.next)),i=bf;null!=i.next;)i=i.next;i.next=r,r.prev=i,r.next=null,xf=r}else{var o=48879;for(i=void 0,n=!0,e=o++,i=nf(t.obj_id);i;i=i.next){var c,s=i.entity,u=O_(s.type);c=ih(!0,u,s.id,at(s.position,t.obj_position)),ch(c)}n=!1}},sh=function(t){var e,n;for(e=t;null!=e;)n=e.next,e=null,e=n;return null},uh=function(){var t,e;xf!=yf&&(t=xf,xf=xf.prev,t.in_group&&t.prev&&t.prev.in_group&&t.group_key==t.prev.group_key&&uh(),(e=t.action).type=e.type==T_?j_:e.type==j_?T_:e.type==I_?D_:e.type==D_?I_:e.type,dh(e))},lh=function(){var t,e;null!=xf.next&&((t=xf=xf.next).in_group&&t.next&&t.next.in_group&&t.group_key==t.next.group_key&&lh(),e=t.action,dh(e))},dh=function(t){if(t.type==T_)switch(t.obj_type){case k_:Vh(t.obj_id,t.obj_position);break;case E_:Kh(t.obj_id,t.obj_position);break;case S_:qh(Z_(t.obj_id),t.obj_position);break;case M_:var e=void 0;for(e=nf(t.obj_id);e;e=e.next){var n,a=e.entity,i=O_(a.type);n=ih(!0,i,a.id,at(a.position,t.obj_position)),dh(n)}}else if(t.type==j_)switch(t.obj_type){case k_:e=void 0;var r=Dn(t.obj_id);for(e=wf;e;e=e.next)e.data.brick_ref==r&&ot(it(nt(e.data.x,e.data.y),t.obj_position))<p&&(e.data.state=1);break;case E_:e=void 0;var o=t.obj_id;for(e=kf;e;e=e.next)e.data.type==o&&ot(it(e.data.actor.position,t.obj_position))<p&&(e.data.state=Oc);break;case S_:for(e=void 0,o=t.obj_id,e=Ef;e;e=e.next)J_(e.data.name)==o&&ot(it(e.data.actor.position,t.obj_position))<p&&(e.data.state=Tp)}else t.type==I_?(Uh(t.obj_position),im()):t.type==D_&&(Uh(t.obj_old_position),im())},ph=function(t,e){hh(t,e,!0),Wn(t.actor,e),hh(t,e,!1)},fh=function(t){return 1==t.state},_h=function(t,e){var n;for(n=0;n<e.length&&1!=t.state;n++)if(e[n]&&qn(t.actor,e[n].actor))return!(!is(e[n])&&!e[n].invincible&&(es(e[n]),1));return!1},hh=function(t,e,n){var a=t.actor,i=.001*z();if(3===t.type){var r=void 0,o=nt(0,0);if(_n(fn("SD_INVSTAR",0),1),1!=t.state)for(r=0;r<5;r++)o.x=a.position.x+20*Math.cos(2*m*i+2*r*m/5),o.y=a.position.y+20*Math.sin(m*i+2*r*m/5)}},mh=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},gh=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},vh=[0,1,2],bh=ut,yh="data/levels/blue_ocean_1.json",xh={position:nt(0,0)},wh=[],kh=[],Eh=[],Sh=[],Mh=function(t){yh=t,k("level_setfile('#{level}')")},Th=function(){return yh},jh=function(t){var e,n,a,i,r,o={name:Sf,act:Df,theme:Tf,bgtheme:jf,grouptheme:If,spawn_point:Uf,music:Mf,boss:null,bricklist:[],itemlist:[],enemylist:[],dialogbox:[]};if(Nm()){var c={id:Qf.type,x:Qf.actor.spawn_point.x,y:Qf.actor.spawn_point.y,rx:Qf.rect_x,ry:Qf.rect_y,rw:Qf.rect_w,rh:Qf.rect_h};o.boss=c}var s=[];for(a=Nf;a;a=a.next){var u={id:om(a.data),xpos:a.data.x,ypos:a.data.y};s.push(u)}o.bricklist=s;var l=[];for(i=Cf;i;i=i.next)if(i.data){var d={id:i.data.type,xpos:i.data.actor.spawn_point.x,ypos:i.data.actor.spawn_point.y};l.push(d)}o.itemlist=l;var p=[];for(r=Gf;r;r=r.next)if(r.data&&r.data.created_from_editor){var f={id:~~r.data.name,xpos:r.data.actor.spawn_point.x,ypos:r.data.actor.spawn_point.y};p.push(f)}o.enemylist=p;var _=[];for(e=0,n=Sh.length;e<n;e++){var h={xpos:Sh[e].rect_x,ypos:Sh[e].rect_y,width:Sh[e].rect_w,height:Sh[e].rect_h,title:Sh[e].title,message:Sh[e].message};_.push(h)}o.dialogbox=_;var m=t.split("/");m[m.length-1],k("level_save() ok")},Ih=function(){return mh(void 0,void 0,void 0,(function(){var t;return gh(this,(function(e){switch(e.label){case 0:return bh=ut,k("level_init()"),Nf=null,Cf=null,Xf=[],Of=800,Rf=Af=0,Lf=0,x_=0,t_=!1,Hf=!1,Wf=null,e_=n_=a_=0,c_=s_=u_=0,i_=r_=!1,o_=!1,Ff=null,fm(),B_(),[4,Cm(yh)];case 1:for(e.sent(),k("Creating players..."),t=0;t<vh.length;t++)Xf[t]=Kc(vh[t]);for(ym(),zf=Xf[$f=0],di.is_locked=!1,di.speed=0,di.region_topleft_speed=0,di.region_bottomright_speed=0,di.position=di.dest=nt(0,0),di.region_topleft.x=di.dest_region_topleft.x=240,di.region_topleft.y=di.dest_region_topleft.y=135.5,di.region_bottomright.x=di.dest_region_bottomright.x=Gh().x-240,di.region_bottomright.y=di.dest_region_bottomright.y=Gh().y-135.5,_i(nt(zf.actor.position.x,zf.actor.position.y)),Am(zf.actor),ss(0),Vf=!1,Kf=!1,k("Loading hud..."),(qf=Yn()).position=nt(16,7),Qn(qf,fn("SD_MAINGUI",0)),(Jf=Yn()).position=nt(16,248),Qn(Jf,fn("SD_LIFEGUI",0)),(Zf=la(0)).position=at(Jf.position,nt(32,11)),t=0;t<3;t++)wh[t]=la(2),wh[t].position=at(qf.position,nt(42,16*t+2));for((f_=Yn()).position=nt(0,-240),Qn(f_,fn("SD_LEVELOP",0)),(__=Yn()).position=nt(260,250),Qn(__,fn("SD_LEVELACT",Df-1)),(h_=la(3)).position=nt(330,50),pa(h_,"%s",Sf.toUpperCase()),ha(h_,180),l_=la(4),d_=la(7),p_=Yn(),t=0;t<3;t++)kh[t]=la(2),Eh[t]=Yn();return m_=!1,g_=0,(v_=Yn()).position.y=lt,Qn(v_,fn("SD_DIALOGBOX",0)),b_=la(8),y_=la(8),[2]}}))}))},Dh=function(){var t,e;Lf+=X();var n,a,i,r,o,c,s,u,l,d,_=!1,h=!1,g=!1,v=X();if(Dm(),jm(),Im(),Y_())!function(){wf||(wf=nm());var t,e,n=_n(fn("SD_ARROW",0),0),a=_a(_f).x,i=_a(_f).y,r=it(df,nt(240,135.5));if(Ee(uf,Wt)&&Se(uf,Ft)&&H_(),Ee(uf,Ft))return k("editor_disable()"),oh(),R_=!1,Dt(rf,of,Tt()),void k("editor_disable() ok");if(Ee(uf,Wt)?((Se(uf,Yt)||Se(sf,Pt))&&z_(),(Se(uf,Ht)||Se(sf,Gt))&&$_()):((Se(uf,Yt)||Se(sf,Pt))&&Q_(),(Se(uf,Ht)||Se(sf,Gt))&&V_()),pf.x=q(De(sf).x,0,ut-n.width),pf.y=q(De(sf).y,0,lt-n.height),Se(sf,Yt)&&Ee(uf,Wt)){var o=ah(pf),c=rh(!0,o,U_);dh(c),ch(c)}if(Se(sf,Yt)&&!Ee(uf,Wt)&&(c=ih(!0,ff,N_,ah(pf)),dh(c),ch(c)),t=Se(sf,Wt),e=Se(sf,Ht),t||e){var s=void 0,u=void 0,l=void 0;switch(ff){case k_:for(s=wf;s;s=s.next){var d=[s.data.x,s.data.y,s.data.x+s.data.brick_ref.image.width,s.data.y+s.data.brick_ref.image.height],p=[pf.x+r.x,pf.y+r.y,pf.x+r.x+1,pf.y+r.y+1];if(J(d,p)){if(!t){c=ih(!1,k_,am(s.data),nt(s.data.x,s.data.y)),dh(c),ch(c);break}N_=am(s.data)}}break;case E_:for(u=kf;u;u=u.next)if(d=[u.data.actor.position.x-u.data.actor.hot_spot.x,u.data.actor.position.y-u.data.actor.hot_spot.y,u.data.actor.position.x-u.data.actor.hot_spot.x+zn(u.data.actor).width,u.data.actor.position.y-u.data.actor.hot_spot.y+zn(u.data.actor).height],p=[pf.x+r.x,pf.y+r.y,pf.x+r.x+1,pf.y+r.y+1],J(d,p)){if(!t){c=ih(!1,E_,u.data.type,u.data.actor.position),dh(c),ch(c);break}var f=K_(u.data.type);f>=0&&(C_=f,N_=G_[f])}break;case S_:for(l=Ef;l;l=l.next){d=[l.data.actor.position.x-l.data.actor.hot_spot.x,l.data.actor.position.y-l.data.actor.hot_spot.y,l.data.actor.position.x-l.data.actor.hot_spot.x+zn(l.data.actor).width,l.data.actor.position.y-l.data.actor.hot_spot.y+zn(l.data.actor).height],p=[pf.x+r.x,pf.y+r.y,pf.x+r.x+1,pf.y+r.y+1];var _=J_(l.data.name);if(_>=0&&J(d,p)){if(!t){c=ih(!1,S_,_,l.data.actor.position),dh(c),ch(c);break}N_=_}}}}Ee(uf,Wt)&&(Se(lf,Yt)?uh():Se(lf,Ht)&&lh()),nh(),W_(),pa(_f,"%d,%d",ah(pf).x,ah(pf).y),_f.position.x=q(~~pf.x,10,ut-a*fa(_f).length-10),_f.position.y=q(~~pf.y-3*i,10,261),hf.position=nt(10,10),ff!=S_?pa(hf,"<color=ffff00>%s %d</color>\n%s",F_(ff),N_,X_(ff,N_)):pa(hf,'<color=ffff00>%s "%s"</color>\n%s',F_(ff),Z_(N_),X_(ff,N_))}();else{for(g=Lf<5,t=0;t<Xf.length&&!g;t++)Xf[t]&&(g=Xf[t].dead);if(zf&&zf.actor&&Se(zf.actor.input,Ft)&&!g){var b=[];return Bf.pause(),b[0]=Ue("CBOX_QUIT_QUESTION"),b[1]=Ue("CBOX_QUIT_OPTION1"),b[2]=Ue("CBOX_QUIT_OPTION2"),u=b[0],l=b[1],d=b[2],Ma=-1,qt=u,Ea[0]=l,d?(Ea[1]=d,Sa=2):Sa=1,void We(Py(Ry))}if(1==(e=Aa())?Hf=!0:2==e&&T(Bf,!0),Hf)return bt()?(Fe(),void Ug()):void vt(an(0,0,0),1);if(Se(uf,Xt))return k("editor_enable()"),bf=yf={action:null,in_group:!1,group_key:null,prev:null,next:null},xf=yf,R_=!0,df.x=~~fi().x,df.y=~~fi().y,pf=nt(240,135.5),rf=St(),of=Mt(),Dt(3,!1,Tt()),void k("editor_enable() ok");for(h=Lf<5,t=0;t<Xf.length&&!h;t++)h=Xf[t].dying||Xf[t].dead;if(zf&&Se(zf.actor.input,Wt)&&!h)return zf.spin_dash=zf.braking=!1,null==S||S.paused||S.pause(),void We(Py(My));Qn(qf,fn("SD_MAINGUI",rs()>0?0:1)),Qn(Jf,fn("SD_LIFEGUI",$f)),pa(Zf,"%d",os()),pa(wh[0],"%d",cs());var y=~~(Lf/60),x=~~(Lf%60),w=x<10?"0"+x:x;if(pa(wh[1],"%s",y+":"+w),pa(wh[2],"%d",rs()),f_&&(Lf<5?Lf<1.5?(f_.position.y+=360*v,f_.position.y>-2&&(f_.position.y=-2),h_.position.x-=320*v,h_.position.x<140&&(h_.position.x=140),__.position.y-=200*v,__.position.y<200&&(__.position.y=200)):Lf>3.5&&(f_.position.x-=320*v):(f_.visible=!1,h_.visible=!1,__.visible=!1)),t_){var E=0,M=z(),O=$e("ring count"),R=$e("cash"),L=$e("glasses");if(M>=e_+2e3){for(t=0;t<Xf.length;t++)Xf[t]&&(Xf[t].actor.speed.x=0);for(l_.position.x=Math.min(l_.position.x+800*v,30),d_.position.x=Math.min(d_.position.x+700*v,12),p_.position.x=Math.max(p_.position.x-700*v,250),t=0;t<3;t++)Eh[t].position.x=Math.min(Eh[t].position.x+(400-50*t)*v,50),kh[t].position.x=Math.max(kh[t].position.x-(400-50*t)*v,230);E=u_-(c_+s_),pa(kh[0],"%d",~~c_),pa(kh[1],"%d",~~s_),pa(kh[2],"%d",~~E),o_||(j(),A($e("goal")),o_=!0)}if(M>=e_+6e3&&!i_)if(c_=Math.max(0,c_-400*v),s_=Math.max(0,s_-2e3*v),c_>0||s_>0)O&&M>=a_&&(a_=M+100,A(O));else for(i_=!0,n_=M+4e3,A(R),t=0;t<Xf.length;t++)if(Xf[t].got_glasses){A(L);break}i_&&M>=n_&&(r_=!0)}for(vm(),gm(),_=!1,t=0;t<Xf.length;t++)Xf[t].dying&&(_=!0);for(o=Mm(),n=Em(),a=null,Pa(Ff),c=Cf;c;c=c.next)if(c.data&&c.data.actor){var N=c.data.actor.position.x,C=c.data.actor.position.y,G=zn(c.data.actor).width,P=zn(c.data.actor).height;if(Lm(N,C,G,P,bh)){if(Ac(c.data,Xf,3,n,Cf,Gf),c.data.obstacle){var U=1,B=at(c.data.actor.hot_spot,nt(0,-U)),Y=zn(c.data.actor);(H=xm(Y.width,Y.height-U,it(c.data.actor.position,B),0)).brick_ref.zindex=c.data.bring_to_back?.4:.5,a={next:a,data:H},n={next:n,data:H}}}else c.data.preserve||(c.data.state=Oc)}for(s=Gf;s;s=s.next)if(s.data)if(N=s.data.actor.position.x,C=s.data.actor.position.y,G=zn(s.data.actor).width,P=zn(s.data.actor).height,Lm(N,C,G,P,bh)||s.data.always_active){if(zf&&zf.actor&&zf.actor.input.enabled&&(_||t_||Rp(s.data,Xf,Xf.length,n,o,Gf)),s.data.obstacle){var H;U=1,B=at(s.data.actor.hot_spot,nt(0,-U)),Y=zn(s.data.actor),a={next:a,data:H=xm(Y.width,Y.height-U,it(s.data.actor.position,B),s.data.obstacle_angle)},n={next:n,data:H}}}else s.data.preserve?Lm(s.data.actor.spawn_point.x,s.data.actor.spawn_point.y,G,P,bh)||(s.data.actor.position=nt(s.data.actor.spawn_point.x,s.data.actor.spawn_point.y)):s.data.state=Tp;if(Nm()&&zf&&zf.actor){var W,F=[(W=zf.actor).position.x,W.position.y,W.position.x+1,W.position.y+1],$=[Qf.rect_x,Qf.rect_y,Qf.rect_x+Qf.rect_w,Qf.rect_y+Qf.rect_h];if(_||function(t,e,n){var a=t.actor,i=null,r=null,o=null,c=null,s=null,u=null,l=null,d=null,p=[],f=Jn(a,2,-2,n,i,r,o,c,s,u,l,d);i=f.up,r=f.upright,o=f.right,c=f.downright,s=f.down,u=f.downleft,l=f.left,d=f.upleft;var _=ea(a,-2,i,r,o,c,s,u,l,d);if(i=_.up,r=_.upright,o=_.right,c=_.downright,s=_.down,u=_.downleft,l=_.left,d=_.upleft,p[0]=i,p[1]=r,p[2]=o,p[3]=c,p[4]=s,p[5]=u,p[6]=l,p[7]=d,Fh())switch(t.hp<=0&&1!=t.state&&(Xh(),t.state=1),t.type){case 0:!function(t,e,n,a){var i=Lh(),r=.001*z(),o=t.actor,c=t.value[0],s=t.value[1];if(1==t.state){if(t.bring_to_front=!0,Qn(o,fn("SD_SIMPLEBOSS",2)),o.position.y+=100*X(),r>=s+.15){var u=nt(o.position.x-o.hot_spot.x+K(zn(o).width),o.position.y-o.hot_spot.y+K(zn(o).height));Kh(kc,u),o.position.y<=o.spawn_point.y+406.5&&A($e("boss hit")),s=r}}else o.maxspeed=200-100/t.initial_hp*t.hp,o.acceleration=o.maxspeed,o.position.x<o.spawn_point.x-200&&(t.direction=1),o.position.x>o.spawn_point.x&&(t.direction=3),1==t.direction?Te(o.input,Bt):3==t.direction&&Te(o.input,Ut),o.position.y=o.spawn_point.y+20*Math.cos(m*r),o.mirror=1==t.direction?0:1,Xn(o,aa(o)),r>=c+2/t.initial_hp*t.hp&&(qh(["0","3"][K(2)],o.position).actor.speed.y=-150-K(50),c=r),_h(t,e)&&o.animation==fn("SD_SIMPLEBOSS",0)&&(Qn(o,fn("SD_SIMPLEBOSS",1)),A($e("boss hit")),i.actor.speed.x*=-1,i.actor.speed.y=100,t.hp--),Vn(o)&&Qn(o,fn("SD_SIMPLEBOSS",0)),t.value[0]=c,t.value[1]=s}(t,e);break;case 1:!function(t,e,n,a){var i,r=Lh(),o=t.actor,c=.001*z(),s=X(),u=t.value[0],l=t.value[1],d=t.value[2];switch(t.state){case 0:if(t.direction=r.actor.position.x<o.position.x?3:1,o.position.y=o.spawn_point.y+30*Math.cos(m*c),Vn(o)&&Qn(o,fn("SD_MECHASHADOW",0)),c>=u+5){var p,f=nt(r.actor.position.x-o.position.x,r.actor.position.y-o.position.y);f=rt(st(f),200),p=Kh(40,o.position),hr(p,f),A($e("big shot")),u=c}if(c>=l+15){var _=t.rect_x+t.rect_w/2;t.direction=o.position.x>_?3:1,Qn(o,fn("SD_MECHASHADOW",2)),t.state=2,l=c}break;case 2:var h=t.rect_x+100,g=t.rect_x+t.rect_w-100,v=g-h+(o.position.x-h),b=3==t.direction?-1:1;o.position.x+=200*b*s,o.position.y=o.spawn_point.y-100*Math.sin(m/(g-h)*v),Vn(o)&&Qn(o,fn("SD_MECHASHADOW",2)),(-1==b&&o.position.x<=h||1==b&&o.position.x>=g)&&(Qn(o,fn("SD_MECHASHADOW",0)),t.state=0);break;case 1:if(t.bring_to_front=!0,Qn(o,fn("SD_MECHASHADOW",4)),o.position.y+=100*X(),c>=d+.15){var y=nt(o.position.x-o.hot_spot.x+K(zn(o).width),o.position.y-o.hot_spot.y+K(zn(o).height));Kh(kc,y),o.position.y<=o.spawn_point.y+406.5&&A($e("boss hit")),d=c}}i=o.animation==fn("SD_MECHASHADOW",1)||o.animation==fn("SD_MECHASHADOW",3),_h(t,e)&&!i&&1!=t.state&&(o.animation=fn("SD_MECHASHADOW",2==t.state?3:1),A($e("boss hit")),t.hp--,r.actor.speed.x*=-.5,r.actor.speed.y=r.actor.jump_strength),o.mirror=1==t.direction?0:1}(t,e);break;case 2:!function(t,e,n,a){var i=Lh(),r=.001*z(),o=t.actor,c=t.value[0],s=t.value[1],u=t.value[2];if(1==t.state){if(t.bring_to_front=!0,Qn(o,fn("SD_SIMPLEBOSS",2)),o.position.y+=100*X(),r>=s+.15){var l=nt(o.position.x-o.hot_spot.x+K(zn(o).width),o.position.y-o.hot_spot.y+K(zn(o).height));Kh(kc,l),o.position.y<=o.spawn_point.y+406.5&&A($e("boss hit")),s=r}}else o.maxspeed=200-100/t.initial_hp*t.hp,o.acceleration=o.maxspeed,o.position.x<o.spawn_point.x-200&&(t.direction=1),o.position.x>o.spawn_point.x&&(t.direction=3),1==t.direction?Te(o.input,Bt):3==t.direction&&Te(o.input,Ut),o.position.y=o.spawn_point.y+20*Math.cos(m*r),o.mirror=1==t.direction?0:1,Xn(o,aa(o)),r>=c+2/t.initial_hp*t.hp&&(qh(["9","6"][K(2)],o.position).actor.speed.y=-150-K(50),c=r),r>=u+3/t.initial_hp*t.hp&&(Kh(41,o.position).actor.speed.y=100,A($e("fire")),u=r),_h(t,e)&&o.animation==fn("SD_SIMPLEBOSS",0)&&(Qn(o,fn("SD_SIMPLEBOSS",1)),A($e("boss hit")),i.actor.speed.x*=-1,i.actor.speed.y=100,t.hp--),Vn(o)&&Qn(o,fn("SD_SIMPLEBOSS",0)),t.value[0]=c,t.value[1]=s,t.value[2]=u}(t,e);break;case 3:!function(t,e,n,a){var i,r=Lh(),o=t.actor,c=.001*z(),s=X(),u=t.value[0],l=t.value[1],d=t.value[2],p=t.value[3];switch(t.state){case 0:if(t.direction=r.actor.position.x<o.position.x?3:1,o.position.y=o.spawn_point.y+30*Math.cos(m*c),Vn(o)&&Qn(o,fn("SD_MECHASHADOW",0)),c>=u+4){var f,_=nt(r.actor.position.x-o.position.x,r.actor.position.y-o.position.y);_=rt(st(_),200),f=Kh(40,o.position),hr(f,_),A($e("big shot")),u=c}if(c>=l+8){var h=t.rect_x+t.rect_w/2;t.direction=o.position.x>h?3:1,Qn(o,fn("SD_MECHASHADOW",2)),t.state=2,l=c}break;case 2:var g=t.rect_x+100,v=t.rect_x+t.rect_w-100,b=v-g+(o.position.x-g),y=3==t.direction?-1:1;o.position.x+=200*y*s,o.position.y=o.spawn_point.y-100*Math.sin(m/(v-g)*b),c>=p+.2&&(Kh(41,o.position).actor.speed.y=-200,A($e("fire")),p=c),Vn(o)&&Qn(o,fn("SD_MECHASHADOW",2)),(-1==y&&o.position.x<=g||1==y&&o.position.x>=v)&&(Qn(o,fn("SD_MECHASHADOW",0)),t.state=0);break;case 1:if(t.bring_to_front=!0,Qn(o,fn("SD_MECHASHADOW",4)),o.position.y+=100*X(),c>=d+.15){var x=nt(o.position.x-o.hot_spot.x+K(zn(o).width),o.position.y-o.hot_spot.y+K(zn(o).height));Kh(kc,x),o.position.y<=o.spawn_point.y+406.5&&A($e("boss hit")),d=c}}i=o.animation==fn("SD_MECHASHADOW",1)||o.animation==fn("SD_MECHASHADOW",3),_h(t,e)&&!i&&1!=t.state&&(o.animation=fn("SD_MECHASHADOW",2==t.state?3:1),A($e("boss hit")),t.hp--,r.actor.speed.x*=-.5,r.actor.speed.y=r.actor.jump_strength),o.mirror=1==t.direction?0:1,t.value[0]=u,t.value[1]=l,t.value[2]=d,t.value[3]=p}(t,e)}}(Qf,Xf,Nf),!fh(Qf)&&J(F,$)&&(Vf=!0,Kf=!0),!fh(Qf)){var Q=void 0;for(t=0;t<Xf.length;t++)(Xf[t]!=zf||zf.actor.carrying)&&((Q=Xf[t].actor).position.x>Qf.rect_x-30&&Q.position.x<Qf.rect_x&&(Q.position.x=Qf.rect_x-30,Q.speed.x=0),Q.position.x>Qf.rect_x+Qf.rect_w&&Q.position.x<Qf.rect_x+Qf.rect_w+30&&(Q.position.x=Qf.rect_x+Qf.rect_w+30,Q.speed.x=0))}(fh(Qf)||zf.dying)&&(Vf=!1,Bf&&(I(D()-.5*v),D()<p&&(j(),I(1),Yf=!0)))}for(t=0;t<Xf.length;t++)je(Xf[t].actor.input);for(zf&&zf.actor&&Lf>=3.5&&Ie(zf.actor.input),t=0;t<Xf.length;t++){N=Xf[t].actor.position.x,C=Xf[t].actor.position.y,G=zn(Xf[t].actor).width,P=zn(Xf[t].actor).height;var V=Xf[t].actor.hot_spot.y;if(t!=$f&&(Xf[t].getting_hit&&bm(t),Xf[t].dying&&(bm(t),xh!=Xf[t].actor&&pi(Xf[t].actor.position,0))),Xf[t].dead){if(!(os()>1))return Fe(),void We(Py(Ty));if(bt())return us(os()-1),void cm();vt(an(0,0,0),1)}if(r_){if(bt())return void Fe();vt(an(0,0,0),1)}(Lm(N,C,G,P,bh/4)||Xf[t].dying)&&(!_||Xf[t].dying||Xf[t].getting_hit)&&Jc(Xf[t],Xf,n),Xf[t].actor.position.y<V&&!Xf[t].dying?(Xf[t].actor.position.y=V,Xf[t].actor.speed.y=0):Xf[t].actor.position.y>Af-(P-V)&&Lm(N,C,G,P,bh/4)&&ns(Xf[t])}for(_||t_||(Lf+=X()/1e3,zf&&Se(zf.actor.input,Ht)&&(!(Math.abs(zf.actor.speed.y)<p)||zf.on_moveable_platform||Vf||zf.disable_movement||zf.in_locked_area?A($e("deny")):bm(($f+1)%3))),Nm()&&Vf&&(W=zf.actor)&&(W.position.x<Qf.rect_x?(W.position.x=Qf.rect_x,W.speed.x=Math.max(0,W.speed.x)):W.position.x>Qf.rect_x+Qf.rect_w&&(W.position.x=Qf.rect_x+Qf.rect_w,W.speed.x=Math.min(W.speed.x,0)),W.position.y=q(W.position.y,Qf.rect_y,Qf.rect_y+Qf.rect_h)),_m(n),i=n;i;i=i.next){if(i.data&&2==i.data.brick_ref.behavior){var Z=i.data.brick_ref.image.width,tt=i.data.brick_ref.image.height,et=[i.data.x,i.data.y,i.data.x+Z,i.data.y+tt],ct=[i.data.x,i.data.y,i.data.x+Z,i.data.y+tt];for(t=0;t<Xf.length;t++)if(Xf[t]&&(et[0]=Xf[t].actor.position.x-Xf[t].actor.hot_spot.x-3,et[1]=Xf[t].actor.position.y-Xf[t].actor.hot_spot.y-3,et[2]=et[0]+zn(Xf[t].actor).width+6,et[3]=et[1]+zn(Xf[t].actor).height+6,(Xf[t].spin_dash||Xf[t].spin||Xf[t].type==Yc)&&J(et,ct))){var dt=void 0,pt=void 0,ft=void 0,_t=void 0;for(_t=Math.max(i.data.brick_ref.behavior_arg[0],1),ft=Math.max(i.data.brick_ref.behavior_arg[1],1),dt=0;dt<_t;dt++)for(pt=0;pt<ft;pt++){var ht=nt(i.data.x+dt*Z/_t,i.data.y+pt*tt/ft),mt=nt(.3*-Xf[t].actor.speed.x,-100-K(50)),gt=Ze(Z/_t,tt/ft);Math.abs(mt.x)>p&&(mt.x+=(mt.x>0?1:-1)*K(50)),Jh(gt,ht,mt,!1)}A($e("break")),i.data.state=1}}if(i.data&&3==i.data.brick_ref.behavior&&2==i.data.state){var yt=i.data;if(yt.value[1]+=X(),yt.value[1]>=1){dt=void 0,pt=void 0,_t=void 0,ft=void 0;var xt=0!=yt.brick_ref.behavior_arg[2];for(gt=yt.brick_ref.image,_t=Math.max(yt.brick_ref.behavior_arg[0],1),ft=Math.max(yt.brick_ref.behavior_arg[1],1),dt=0;dt<_t;dt++)for(pt=0;pt<ft;pt++){var wt=nt(yt.x+dt*gt.width/_t,yt.y+pt*gt.height/ft),kt=nt(0,20+20*pt+20*(xt?dt:_t-dt)),Et=Ze(gt.width/_t,gt.height/ft);Jh(Et,wt,kt,!1)}A($e("break")),yt.state=1}}Rm(i.data)}for(i=a;i;i=r)r=i.next,Om(i.data),i=null;if(a=null,Sm(n),Tm(o),zf&&zf.actor&&Am(zf.actor),t_)pi(at(xh.position,nt(0,-90)),.17);else if(Vf){var jt=[Qf.rect_x+240,Qf.rect_x+Qf.rect_w-240],It=nt(q(xh.position.x,jt[0],jt[1]),xh.position.y);pi(at(It,nt(0,-90)),.17)}else _||xh&&pi(xh.position,.1);!function(){var t,e=X();di.is_locked||hi(-f,-f,f,f),t=it(di.dest,di.position),ot(t)>10&&(t=st(t),di.position.x+=t.x*di.speed*e,di.position.y+=t.y*di.speed*e),t=it(di.dest_region_topleft,di.region_topleft),ot(t)>10&&(t=st(t),di.region_topleft.x+=t.x*di.region_topleft_speed*e,di.region_topleft.y+=t.y*di.region_topleft_speed*e),t=it(di.dest_region_bottomright,di.region_bottomright),ot(t)>10&&(t=st(t),di.region_bottomright.x+=t.x*di.region_bottomright_speed*e,di.region_bottomright.y+=t.y*di.region_bottomright_speed*e),di.position.x=q(di.position.x,di.region_topleft.x,di.region_bottomright.x),di.position.y=q(di.position.y,di.region_topleft.y,di.region_bottomright.y)}()}mm()},Oh=function(){if(xt(),Y_())return e=it(df,nt(240,135.5)),cf.width,cf.height,function(){if(P_){var t,e,n=void 0,a=void 0,i=it(df,nt(240,135.5));for(t=Ze(1,1),e=an(0,128,160),rn(t,0,0,0),n=0;n<t.height;n++)nn(0,Et(),t.width-1,n,e);for(n=0;n<t.width;n++)nn(0,Et(),n,t.height-1,e);for(n=0;n<=480;n++)for(a=0;a<=271;a++)it(ah(nt(n*t.width,a*t.height)),i);on(t)}}(),em(),q_(ff,N_,it(ah(pf),e)),t=_n(fn("SD_ARROW",0),0),en(t.data,Et(),t.sx,t.sy,~~pf.x,~~pf.y,t.width,t.height),ma(_f,nt(240,135.5)),void ma(hf,nt(240,135.5));var t,e;Ua(Ff,fi()),sm(),Ba(Ff,fi()),lm()},Rh=function(){var t;for(k("level_release()"),on(Wf),rm(),t=0;t<Xf.length;t++)qc(Xf[t]);for(k("editor_release()"),eh(),function(){for(var t=0;t<tf;t++)Zp[t]=af(Zp[t]);tf=0}(),ke(lf),ke(uf),ke(sf),da(hf),da(_f),R_=!1,ff=E_,N_=0,k("editor_release() ok"),Hn(Jf),Hn(qf),da(Zf),t=0;t<Xf.length;t++)da(wh[t]);for(Hn(f_),Hn(__),da(h_),da(l_),da(d_),Hn(p_),t=0;t<3;t++)da(kh[t]),Hn(Eh[t]);da(b_),da(y_),Hn(v_),k("level_release() ok")},Ah=function(){return Y_()},Lh=function(){return zf},Nh=function(){return $f},Ch=function(t){var e,n;t=Math.max(0,t),ls(cs()+t),e=Kh(13,at(zf.actor.position,nt(-9,0))),n=""+t,pa(e.font,n)},Gh=function(){return nt(Rf,Af)},Ph=function(t){Bf&&j(),A(t)},Uh=function(t){Uf=nt(t.x,t.y)},Bh=function(t){var e;if(!t_){for(t_=!0,e_=z(),c_=10*rs(),u_+=c_,e=0;e<Xf.length;e++)Xf[e]&&Xf[e].got_glasses&&Yh(5e3);for(ls(cs()+u_),e=0;e<Xf.length;e++)Xf[e]&&(je(Xf[e].actor.input),Xf[e].spin_dash=!1);for(Am(t),Wh(),pa(l_,"TEAM SONIC"),l_.position=nt(-500,20),pa(d_,"GOT THROUGH"),d_.position=nt(-500,46),Qn(p_,fn("SD_LEVELACT",Df-1)),p_.position=nt(820,25),e=0;e<3;e++)Eh[e].position=nt(-500,120+20*e),kh[e].position=nt(820,120+20*e);Qn(Eh[0],fn("SD_RINGBONUS",0)),Qn(Eh[1],fn("SD_SECRETBONUS",0)),Qn(Eh[2],fn("SD_TOTAL",0))}},Yh=function(t){s_+=t,u_+=t},Hh=function(t,e){(!m_||fa(b_)||fa(y_))&&(m_=!0,g_=z(),pa(b_,t),pa(y_,e),ha(y_,260))},Wh=function(){m_=!1},Fh=function(){return Kf},Xh=function(){var t,e;for(t=Gf;t;t=t.next)(e=t.data)&&(e.state=1)},zh=function(t,e,n,a){!function(t,e,n,a){di.is_locked=!0,hi(t,e,n,a)}(t+240,e+135.5,n-240,a-135.5)},$h=function(){null!=Bf&&j()},Qh=function(){return Of},Vh=function(t,e){for(var n={brick_ref:Dn(t),x:e.x,y:e.y,sx:e.x,sy:e.y,enabled:!0,state:0,value:[],animation_frame:0},a=0;a<3;a++)n.value[a]=0;var i={data:n,next:null};return km(i),i.data},Kh=function(t,e){var n={data:Rc(t),next:null};return n.data.actor.spawn_point=nt(e.x,e.y),n.data.actor.position=nt(e.x,e.y),n.next=Cf,Cf=n,n.data},qh=function(t,e){var n={data:Dp(t),next:null};return n.data.actor.spawn_point=e,n.data.actor.position=e,n.next=Gf,Gf=n,n.data},Jh=function(t,e,n,a){var i={data:{image:t,position:e,speed:n,destroy_on_brick:a},next:Pf};Y_()?on(t):Pf=i},Zh=function(t,e){var n,a,i,r,o,c;return t?(n=t.value[0],1===t.brick_ref.behavior?(a=t.brick_ref.behavior_arg[0],i=t.brick_ref.behavior_arg[1],r=t.brick_ref.behavior_arg[2]*(2*m),o=t.brick_ref.behavior_arg[3]*(2*m),c=t.brick_ref.behavior_arg[4]*m/180,nt(-a*r*Math.sin(r*n+c),i*o*Math.cos(o*n+c))):nt(0,0)):nt(0,0)},tm=function(t){return Kh(15,t)},em=function(){sm()},nm=function(){return Nf},am=function(t){return om(t)},im=function(){ym()},rm=function(){var t,e,n,a,i,r;for(k("level_unload()"),Bf.pause(),k("releasing brick list..."),t=Nf;t;t=e)e=t.next,t.data=null,t=null;for(Nf=null,k("releasing item list..."),n=Cf;n;n=a)a=n.next,n.data,n=null;for(Cf=null,k("releasing enemy list..."),i=Gf;i;i=r)r=i.next,Op(i.data),i=null;Gf=null,Nm()&&(k("releasing the boss..."),function(t){Hn(t.actor)}(Qf),Qf=null),k("unloading the brickset..."),k("unloading the background..."),k("level_unload() ok")},om=function(t){var e;for(e=0;e<On();e++)if(t.brick_ref==Dn(e))return e;return-1},cm=function(){var t=Uf;Rh(),Ih(),Uf=t},sm=function(){for(var t,e,n,a=null,i=t=Em();i;i=i.next)i.data&&(r=i.data.brick_ref).zindex<.5&&(Rn(i.data),a=An(i.data),Et().drawImage(a.data,a.sx,a.sy,a.swidth,a.sheight,i.data.x-(fi().x-240),i.data.y-(fi().y-135.5),1*a.width,1*a.height));for(um(!0),i=t;i;i=i.next)if(i.data){var r=i.data.brick_ref;Math.abs(r.zindex-.5)<p&&1!=r.property&&(Rn(i.data),a=An(i.data),Et().drawImage(a.data,a.sx,a.sy,a.swidth,a.sheight,i.data.x-(fi().x-240),i.data.y-(fi().y-135.5),1*a.width,1*a.height))}for(e=Cf;e;e=e.next)e.data&&e.data.bring_to_back&&Lc(e.data,fi());for(i=t;i;i=i.next)i.data&&(r=i.data.brick_ref,Math.abs(r.zindex-.5)<p&&1==r.property&&(Rn(i.data),a=An(i.data),Et().drawImage(a.data,a.sx,a.sy,a.swidth,a.sheight,i.data.x-(fi().x-240),i.data.y-(fi().y-135.5),1*a.width,1*a.height)));for(Nm()&&!Qf.bring_to_front&&ph(Qf,fi()),n=Gf;n;n=n.next)Ap(n.data,fi());for(um(!1),Nm()&&Qf.bring_to_front&&ph(Qf,fi()),e=Cf;e;e=e.next)e.data&&Lc(e.data,fi());for(hm(),i=t;i;i=i.next)i.data&&(r=i.data.brick_ref).zindex>.5&&(Rn(i.data),a=An(i.data),Et().drawImage(a.data,a.sx,a.sy,a.swidth,a.sheight,i.data.x-(fi().x-240),i.data.y-(fi().y-135.5),1*a.width,1*a.height));Sm(t)},um=function(t){if(zf){var e;for(e=Xf.length-1;e>=0;e--)Xf[e]!=zf&&!!Xf[e].bring_to_back==t&&Zc(Xf[e],fi());!!zf.bring_to_back==t&&Zc(zf,fi())}},lm=function(){var t,e=nt(240,135.5);if(t_)for(Wn(p_,e),ma(l_,e),ma(d_,e),t=0;t<3;t++)Wn(Eh[t],e),ma(kh[t],e);else{for(Wn(qf,e),Wn(Jf,e),ma(Zf,e),t=0;t<3;t++)ma(wh[t],e);dm()}Lf<2.5&&xt("rgb(0,0,0)"),Wn(f_,e),Wn(__,e),ma(h_,e),pm(e)},dm=function(){var t,e=[],n=[],a=0,i=.001*z();for(t=0;t<10;t++)n[t]=!0;if(zf){switch(zf.got_glasses&&(e[a++]=_n(fn("SD_ICON",6),0)),zf.shield_type){case Hc:e[a++]=_n(fn("SD_ICON",7),0);break;case Wc:e[a++]=_n(fn("SD_ICON",11),0);break;case Fc:e[a++]=_n(fn("SD_ICON",12),0);break;case Xc:e[a++]=_n(fn("SD_ICON",13),0);break;case zc:e[a++]=_n(fn("SD_ICON",14),0);break;case $c:e[a++]=_n(fn("SD_ICON",15),0)}if(zf.invincible&&(e[a++]=_n(fn("SD_ICON",4),0),zf.invtimer>=17.25)){var r=(23-zf.invtimer)/5.75;n[a-1]=Math.sin(.5*m*i/(r+.1))>=0}zf.got_speedshoes&&(e[a++]=_n(fn("SD_ICON",5),0),zf.speedshoes_timer>=17.25)&&(r=(23-zf.speedshoes_timer)/5.75,n[a-1]=Math.sin(.5*m*i/(r+.1))>=0)}for(t=0;t<a;t++)n[t]&&en(e[t].data,Et(),e[t].sx,e[t].sy,ut-(e[t].width+5)*(t+1),5,e[t].swidth,e[t].sheight)},pm=function(t){Wn(v_,t),ma(b_,t),ma(y_,t)},fm=function(){Pf=null},_m=function(t){var e,n,a,i,r=X(),o=Of,c=null;for(a=Pf;a;a=i){var s=a.data;if(s){if(n=Lm(s.position.x,s.position.y,s.position.x+s.image.width,s.position.y+s.image.height,bh),e=!1,s.destroy_on_brick&&n&&s.speed.y>0){var u=[s.position.x,s.position.y,s.position.x+s.image.width,s.position.y+s.image.height],l=void 0;for(l=t;l&&!e;l=l.next){var d=l.data;if(d&&1==d.brick_ref.property&&0==d.brick_ref.angle){var p=[d.x,d.y,d.x+d.brick_ref.image.width,d.y+d.brick_ref.image.height];J(u,p)&&(e=!0)}}}!n||e?c?c.next=i:Pf=i:(s.position.x+=s.speed.x*r,s.position.y+=s.speed.y*r+.5*o*(r*r),s.speed.y+=o*r,c=a)}}},hm=function(){for(var t,e,n,a,i=nt(fi().x-240,fi().y-135.5),r=Pf;r;r=r.next){var o=r.data;o&&(t=o.image,e=Et(),n=o.position.x-i.x,a=o.position.y-i.y,e.putImageData(t,n,a))}},mm=function(){null==Bf||t_||Yf||O()||T(Bf,!0)},gm=function(){if(v_){var t=X(),e=z();if(m_){if(e>=g_+7e3)return void(m_=!1);v_.position.x=(ut-zn(v_).width)/2,v_.position.y=Math.max(v_.position.y-100*t,lt-1.3*zn(v_).height)}else v_.position.y=Math.min(v_.position.y+100*t,lt);b_.position=at(v_.position,nt(2,10)),y_.position=at(v_.position,nt(2,23))}},vm=function(){if(zf&&zf.actor){var t,e=[],n=[];if(!(Lf<2))for(e[0]=zf.actor.position.x,e[1]=zf.actor.position.y,e[2]=e[0]+zn(zf.actor).width,e[3]=e[1]+zn(zf.actor).height,t=0;t<x_;t++)if(!Sh[t].disabled&&(n[0]=Sh[t].rect_x,n[1]=Sh[t].rect_y,n[2]=n[0]+Sh[t].rect_w,n[3]=n[1]+Sh[t].rect_h,J(e,n))){Sh[t].disabled=!0,Hh(Sh[t].title,Sh[t].message);break}}},bm=function(t){zf.spin_dash=zf.braking=!1,Xf[$f=t]&&(zf=Xf[$f],Am(zf.actor),Ie(zf.actor.input))},ym=function(){var t,e;for(t=0;t<Xf.length;t++)e=Uf.x<=Rf/2?2-t:t,Xf[t].actor.mirror=Uf.x<=Rf/2?0:1,Xf[t].actor.spawn_point.x=Xf[t].actor.position.x=Uf.x+15*e,Xf[t].actor.spawn_point.y=Xf[t].actor.position.y=Uf.y},xm=function(t,e,n,a){for(var i={data:null,image:{data:null,sx:0,sy:0,swidth:0,sheight:0,x:0,y:0,width:0,height:0},angle:a,property:1,behavior:0,zindex:.5,behavior_arg:[]},r=0;r<5;r++)i.behavior_arg[r]=0;return{brick_ref:i,x:n.x,y:n.y,sx:n.x,sy:n.y,enabled:!0,state:0,value:[],animation_frame:0}},wm=function(t,e){var n=t.brick_ref,a=e.brick_ref;if(!n||!a)return!1;if(n.zindex<a.zindex)return-1;if(n.zindex>a.zindex)return 1;if(n.property!=a.property){var i=[0,100,50];return i[n.property]-i[a.property]}return n.angle%180!=0&&a.angle%180==0?-1:n.angle%180==0&&a.angle%180!=0?1:t.sy-e.sy},km=function(t){var e;if(Nf)if(wm(t.data,Nf.data))t.next=Nf,Nf=t;else{for(e=Nf;e.next&&wm(e.next.data,t.data);)e=e.next;t.next=e.next,e.next=t}else t.next=null,Nf=t},Em=function(){for(var t,e,n,a,i=null,r=Nf;r;r=r.next)t=Math.min(r.data.x,r.data.sx),e=Math.min(r.data.y,r.data.sy),n=r.data.brick_ref.image.width,a=r.data.brick_ref.image.height,(Lm(t,e,n,a,2*bh)||1==r.data.brick_ref.behavior)&&(i={data:r.data,next:i});return i},Sm=function(t){for(var e;t;)e=t.next,t=null,t=e},Mm=function(){for(var t,e,n,a,i=null,r=Cf;r;r=r.next)if(r.data){var o=zn(r.data.actor);o&&(t=~~r.data.actor.position.x,e=~~r.data.actor.position.y,n=o.width,a=o.height,Lm(t,e,n,a,bh)&&(i={data:r.data,next:i}))}return i},Tm=function(t){for(var e;t;)e=t.next,t=null,t=e},jm=function(){var t,e;if(Cf)for(Cf.data&&Cf.data.state==Oc&&(e=Cf.next,Cf.data,Cf=e),t=Cf;t&&t.next;t=t.next)t.next&&t.next.data&&t.next.data.state==Oc&&(e=t.next,t.next=e.next,e.data,e=null)},Im=function(){var t,e;if(Gf)for(Gf&&Gf.data&&Gf.data.state==Tp&&(e=Gf.next,Op(Gf.data),Gf=null,Gf=e),t=Gf;t&&t.next;t=t.next)t&&t.next&&t.next.data&&t.next.data.state==Tp&&(e=t.next,t.next=e.next,Op(e.data),e=null)},Dm=function(){var t,e;if(Nf)for(Nf.data&&1==Nf.data.state&&(e=Nf.next,Nf.data=null,Nf=null,Nf=e),t=Nf;t&&t.next;t=t.next)1==t.next.data.state&&(e=t.next,t.next=e.next,e.data=null,e=null)},Om=function(t){t.brick_ref=null,t=null},Rm=function(t){var e,n,a,i,r,o;t&&(t.value[0]+=X(),e=t.value[0],1===t.brick_ref.behavior)&&(n=t.brick_ref.behavior_arg[0],a=t.brick_ref.behavior_arg[1],i=t.brick_ref.behavior_arg[2]*(2*m),r=t.brick_ref.behavior_arg[3]*(2*m),o=t.brick_ref.behavior_arg[4]*m/180,t.x=t.sx+Math.round(n*Math.cos(i*e+o)),t.y=t.sy+Math.round(a*Math.sin(r*e+o)))},Am=function(t){xh.position.x=t.position.x,xh.position.y=t.position.y},Lm=function(t,e,n,a,i){var r=fi(),o=[t,e,t+n,e+a],c=[r.x-240-i,r.y-135.5-i,r.x+240+i,r.y+135.5+i];return J(o,c)},Nm=function(){return null!=Qf},Cm=function(t){return mh(void 0,void 0,void 0,(function(){var e;return gh(this,(function(n){switch(n.label){case 0:return Sf="Untitled",Mf="",Tf="",jf="",If="",Uf=nt(0,0),x_=0,Qf=null,Df=1,k('level_load("'.concat(t,'")')),[4,x(t)];case 1:return e=n.sent(),[4,Gm(e)];case 2:return n.sent(),Bf=M(Mf),function(){for(var t=0,e=0,n=Nf;n;n=n.next)n.data&&n.data.brick_ref&&0!=n.data.brick_ref.property&&(t=Math.max(t,n.data.sx+An(n.data).width),e=Math.max(e,n.data.sy+An(n.data).height));Rf=Math.max(t,ut),Af=Math.max(e,lt)}(),k("level_load() ok"),[2]}}))}))},Gm=function(t){return mh(void 0,void 0,void 0,(function(){var e,n,a;return gh(this,(function(i){switch(i.label){case 0:for(Tf=t.theme,jf=t.bgtheme,If=t.grouptheme,Mf=t.music,Sf=t.name,t.author,t.version,t.requires,Df=t.act,Uf=t.spawn_point,t.readonly,t.boss&&(Qf=function(t,e,n,a,i,r){for(var o={type:t,state:0,direction:0,actor:Yn(),bring_to_front:!1,initial_hp:0,hp:0,value:[],rect_x:n,rect_y:a,rect_w:i,rect_h:r},c=0;c<10;c++)o.value[c]=0;var s=o.actor;switch(s.spawn_point=nt(e.x,e.y),s.position=nt(e.x,e.y),s.input=ye(),t){case 0:case 2:Qn(s,fn("SD_SIMPLEBOSS",0)),o.initial_hp=o.hp=3,o.direction=3,s.maxspeed=100,s.acceleration=100;break;case 1:case 3:Qn(s,fn("SD_MECHASHADOW",0)),o.initial_hp=o.hp=10,o.direction=3,s.maxspeed=100,s.acceleration=100}return o}(t.boss.id,nt(t.boss.x,t.boss.y),t.boss.rx,t.boss.ry,t.boss.rw,t.boss.rh)),a=0;a<t.dialogbox.length;a++)e={disabled:!1,rect_x:t.dialogbox[a].xpos,rect_y:t.dialogbox[a].ypos,rect_w:t.dialogbox[a].width,rect_h:t.dialogbox[a].height,title:Be(t.dialogbox[a].title),message:Be(t.dialogbox[a].message)},Sh.push(e),x_=Sh.length;for(a=0;a<t.enemylist.length;a++)qh(""+t.enemylist[a].id,nt(t.enemylist[a].xpos,t.enemylist[a].ypos));return[4,(r=t.theme,Mn(void 0,void 0,void 0,(function(){var t,e;return Tn(this,(function(n){switch(n.label){case 0:return k('brickdata_load("'.concat(r,'")')),[4,x(r)];case 1:return t=n.sent(),[4,(a=t,Promise.all(a.bricks.map(Ln)))];case 2:return e=n.sent(),In=e,[2]}var a}))})))];case 1:for(i.sent(),a=0;a<t.bricklist.length;a++)Vh(t.bricklist[a].id,nt(t.bricklist[a].xpos,t.bricklist[a].ypos));return[4,Ca(t.bgtheme)];case 2:for(n=i.sent(),Ff=n,a=0;a<t.itemlist.length;a++)Kh(t.itemlist[a].id,nt(t.itemlist[a].xpos,t.itemlist[a].ypos));return[2,Ff]}var r}))}))},Pm=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},Um=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Bm=function(t){return Pm(void 0,void 0,void 0,(function(){var e,n;return Um(this,(function(a){switch(a.label){case 0:return k('quest_load("'.concat(t,'")')),[4,x(t)];case 1:return e=a.sent(),[4,Hm(e)];case 2:return n=a.sent(),k("load_quest() ok!"),[2,n]}}))}))},Ym=function(t){return Pm(void 0,void 0,void 0,(function(){return Um(this,(function(e){switch(e.label){case 0:return[4,tn(""+(t||"data/images/null.png"))];case 1:return[2,e.sent()]}}))}))},Hm=function(t){return Pm(void 0,void 0,void 0,(function(){var e,n;return Um(this,(function(a){switch(a.label){case 0:return e={file:"",name:t.name||"",author:t.author||"Open Sonic",version:t.version||"0",description:t.description||"",show_ending:t.show_ending||!1,image:null,levels:t.levels||[],level_count:t.levels?t.levels.length:0,level_path:t.levels||[]},[4,Ym(t.image)];case 1:return n=a.sent(),e.image=n,[2,e]}}))}))};!function(t){t[t.QUESTVALUE_TOTALTIME=0]="QUESTVALUE_TOTALTIME",t[t.QUESTVALUE_BIGRINGS=1]="QUESTVALUE_BIGRINGS",t[t.QUESTVALUE_GLASSES=2]="QUESTVALUE_GLASSES"}(w_||(w_={}));var Wm,Fm,Xm,zm,$m,Qm,Vm,Km,qm,Jm,Zm,tg,eg,ng,ag,ig,rg,og,cg,sg,ug,lg,dg,pg,fg,_g,hg,mg,gg,vg,bg,yg,xg,wg,kg,Eg,Sg,Mg,Tg,jg=w_.QUESTVALUE_TOTALTIME,Ig=w_.QUESTVALUE_BIGRINGS,Dg=w_.QUESTVALUE_GLASSES,Og=null,Rg=0,Ag=!1,Lg=[],Ng=function(){var t;for(Ag=!1,t=0;t<3;t++)Lg[t]=0},Cg=function(){if(0!=Og.level_count)return Rg<Og.level_count&&!Ag?(Mh(Og.level_path[Rg]),We(Py(Sy)),void Rg++):(Fe(),void(Ag?We(Py(Dy)):Og.show_ending?We(Py(Iy)):We(Py(Oy))));k("Quest '%s' has no levels. ".concat(Og.file))},Gg=function(){},Pg=function(){},Ug=function(){Ag=!0},Bg=function(t,e){var n=q(t,0,2);Lg[n]=e},Yg=function(t){var e=q(t,0,2);return Lg[e]},Hg=[],Wg=0,Fg=function(){Wg=0,Hg[0]=la(7),Hg[0].position=nt(-50,112),pa(Hg[0],"GAME"),Hg[1]=la(7),Hg[1].position=nt(298,112),pa(Hg[1],"OVER")},Xg=function(){var t=X();if((Wg+=t)>5){if(bt())return Ug(),void Fe();vt(an(0,0,0),2)}Hg[0].position.x+=200*t,Hg[0].position.x>80&&(Hg[0].position.x=80),Hg[1].position.x-=200*t,Hg[1].position.x<168&&(Hg[1].position.x=168)},zg=function(){xt();var t=nt(240,135.5);ma(Hg[0],t),ma(Hg[1],t)},$g=function(){on(null),da(Hg[1]),da(Hg[0]),Ug()},Qg=0,Vg=null,Kg=function(){return t=void 0,e=void 0,a=function(){var t;return function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(e){switch(e.label){case 0:return Qg=0,[4,Ca("data/themes/intro.bg.json")];case 1:return t=e.sent(),Vg=t,gt(an(0,0,0),1),[2]}}))},new((n=void 0)||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}));var t,e,n,a},qg=function(){if(Vg&&(Qg+=X(),Pa(Vg),Qg>=3)){if(bt())return Fe(),void We(Py(Dy));vt(an(0,0,0),1)}},Jg=function(){if(Vg){var t=nt(240,135.5);Ua(Vg,t),Ba(Vg,t)}},Zg=function(){Vg=null},tv=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},ev=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},nv=["data/languages/deutsch.json","data/languages/dutch.json","data/languages/english.json","data/languages/francais.json","data/languages/indonesian.json","data/languages/italiano.json","data/languages/polish.json","data/languages/ptbr.json"],av=1,iv=1,rv=!1,ov=0,cv=[],sv=[],uv=[],lv=0,dv=0,pv=function(){return tv(void 0,void 0,void 0,(function(){var t;return ev(this,(function(e){switch(e.label){case 0:return lv=0,rv=!1,dv=0,Xm=we(),Wm=la(8),cv[0]=la(4),pa(cv[0],"SELECT YOUR"),cv[0].position.x=(ut-fa(cv[0]).length*_a(cv[0]).x)/2-140,cv[0].position.y=10,cv[1]=la(4),pa(cv[1],"LANGUAGE"),cv[1].position.x=(ut-fa(cv[1]).length*_a(cv[1]).x)/2-120,cv[1].position.y=cv[0].position.y+_a(cv[1]).y+10+10,cv[2]=la(8),pa(cv[2],Be("MENU_CQ_BACK")),cv[2].position.x=10,cv[2].position.y=lt-1.5*_a(cv[2]).y,[4,Ca("data/themes/langselect.bg.json")];case 1:return t=e.sent(),zm=t,Fm=Yn(),Qn(Fm,fn("SD_TITLEFOOT",0)),gv(),gt(an(0,0,0),1),[2]}}))}))},fv=function(){var t=X();if(dv+=t,Pa(zm),Fm&&sv.length&&(Fm.position=nt(sv[0][lv].position.x,sv[0][lv].position.y),Fm.position.x-=15,Fm.position.x+=5*Math.cos(2*m*dv)),!rv&&!yt()){if(Se(Xm,Pt)&&(lv=(lv+1)%ov,A($e("choose"))),Se(Xm,Gt)&&(lv=((lv-1)%ov+ov)%ov,A($e("choose"))),Se(Xm,Yt)||Se(Xm,Wt)){if(!uv)return;var e=uv[lv].filepath;k("Loading language ".concat(uv[lv].title," ").concat(e)),Pe("data/languages/english.json"),Pe(e),mv(e),A($e("select"))}Se(Xm,Ft)&&(A($e("return")),rv=!0)}if(av=Math.floor(1+lv/8),iv=Math.floor(1+Math.max(0,ov-1)/8),pa(Wm,"page %d/%d",av,iv),Wm.position.x=ut-fa(Wm).length*_a(Wm).x-10,Wm.position.y=lt-_a(Wm).y-3,!O()){var n=M("data/music/options.mp4");T(n,!0)}if(rv){if(bt())return void Fe();vt(an(0,0,0),1)}},_v=function(){var t,e=nt(240,135.5);for(xt(),Ua(zm,e),Ba(zm,e),ma(cv[0],e),ma(cv[1],e),ma(cv[2],e),iv>1&&ma(Wm,e),t=8*(av-1);t<8*av;t++)nv[t]&&sv.length>1&&ma(sv[lv==t?1:0][t],e);Wn(Fm,e)},hv=function(){vv(),zm=Ga(zm),Hn(Fm),da(cv[0]),da(cv[1]),da(Wm),ke(Xm)},mv=function(t){var e;e=t,C.language=e,G()},gv=function(){return tv(void 0,void 0,void 0,(function(){var t,e;return ev(this,(function(n){switch(n.label){case 0:return k("load_lang_list()"),[4,y(nv)];case 1:for(t=n.sent(),ov=(uv=t).length,sv[0]=[],sv[1]=[],e=0;e<ov;e++)uv[e].filepath=nv[e],sv[0][e]=la(8),sv[1][e]=la(8),pa(sv[0][e],uv[e].LANG_LANGUAGE),pa(sv[1][e],uv[e].LANG_LANGUAGE),sv[0][e].position=nt(25,75+e%8*20),sv[1][e].position=nt(25,75+e%8*20);return[2]}}))}))},vv=function(){var t;for(k("unload_lang_list()"),t=0;t<ov;t++)da(sv[0][t]),da(sv[1][t]);sv[0]=null,sv[1]=null,uv=null,ov=0},bv=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},yv=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},xv=["data/quests/default.json","data/quests/extra.json","data/quests/superbosses.json","data/quests/tutorial.json"],wv=3,kv=[],Ev=[],Sv=[],Mv=[],Tv=function(){return bv(void 0,void 0,void 0,(function(){var t,e,n;return yv(this,(function(a){switch(a.label){case 0:for(sg=!1,$m=0,qm=.001*z(),Jm=!1,Vm=null,Qm=we(),je(Qm),Rv(),pg=M("data/music/title.mp4"),T(pg,!0),ng=!0,ag=Yn(),Qn(ag,fn("SD_TITLESURGE",0)),ag.position.x=(ut-zn(ag).width)/2+5,ag.position.y=-15,ig=Yn(),Qn(ig,fn("SD_TITLEBG",0)),ig.position.x=(ut-zn(ig).width)/2,ig.position.y=ag.position.y+25,rg=Yn(),Qn(rg,fn("SD_TITLEGAMENAME",0)),rg.position.x=(ut-zn(rg).width)/2,rg.position.y=ag.position.y+zn(ag).height-9,(og=la(8)).position=nt(3,259),pa(og,"%s",d),(cg=la(0)).position=nt(405,3),pa(cg,"V%d.%d.%d",1,1,1),tg=0,eg=Yn(),Qn(eg,fn("SD_TITLEFOOT",0)),(Zm=[])[0]=Ue("MENU_1PGAME"),Zm[1]=Ue("MENU_TUTORIAL"),Zm[2]=Ue("MENU_CUSTOMQUESTS"),Zm[3]=Ue("MENU_OPTIONS"),wv=Zm.length,kv=[],t=0;t<2;t++)for(e=0;e<wv;e++)kv[e]||(kv[e]=[]),kv[e][t]=la(t),kv[e][t].position=nt(240-zn(ig).width/5,rg.position.y+65+10*e),pa(kv[e][t],Zm[e]);return Ev[0]=la(8),Ev[0].position=nt(5,3),Ev[1]=la(8),Ev[1].position=nt(5,258),(ug=la(8)).position=nt(5,170),[4,Ca("data/themes/menu.bg.json")];case 1:return n=a.sent(),Km=n,gt(an(0,0,0),1.5),[2]}}))}))},jv=function(){var t,e=.001*z();if(null!=Vm&&bt())return Fe(),void We(Vm);switch(e<=qm+2?je(Qm):Jm||(Ie(Qm),Jm=!0),Pa(Km),$m){case 0:ng&&Vn(ag)&&(ng=!1,Qn(ag,fn("SD_TITLESURGE",1)),Ie(Qm)),rg.visible=!ng,eg.position.x=kv[tg][0].position.x-20+3*Math.cos(2*m*e),eg.position.y=kv[tg][0].position.y,Se(Qm,Gt)&&(A($e("choose")),tg--),Se(Qm,Pt)&&(A($e("choose")),tg++),tg=(tg%wv+wv)%wv,(Se(Qm,Yt)||Se(Qm,Wt))&&(A($e("select")),Ov(tg));break;case 1:for(Se(Qm,Ft)&&(A($e("return")),$m=0),t=0;t<dg;t++)Sv[t].position=nt(30,20+t%14*10),Sv[t].visible=Av(t)==Av(lg);if(eg.position.x=10,eg.position.y=Sv[lg].position.y,Se(Qm,Gt)&&(A($e("choose")),lg--),Se(Qm,Pt)&&(A($e("choose")),lg++),lg=(lg%dg+dg)%dg,pa(Ev[0],Be("MENU_CQ_SELECT"),Av(lg),Lv()),pa(Ev[1],Be("MENU_CQ_BACK")),pa(ug,Be("MENU_CQ_INFO"),Mv[lg].version,Mv[lg].name,Mv[lg].author,Mv[lg].description),Se(Qm,Yt)||Se(Qm,Wt))return A($e("select")),void Nv(Mv[lg])}},Iv=function(){var t,e=nt(240,135.5);if(xt(),!sg||!bt())switch(Ua(Km,e),Ba(Km,e),$m){case 0:for(t=0;t<wv;t++)ma(kv[t][t==tg?1:0],e);Wn(eg,e),ma(og,e),ma(cg,e),Wn(ig,e),ng&&xt(),Wn(ag,e),Wn(rg,e);break;case 1:var n=Mv[lg].image;for(ma(ug,e),en(n,Et(),0,0,ut-n.width-25,Sv[0].position.y,n.width,n.height),ma(Ev[0],e),ma(Ev[1],e),t=0;t<dg;t++)ma(Sv[t],e);Wn(eg,e)}},Dv=function(){var t,e;for(pg.pause(),da(og),da(cg),t=0;t<2;t++)for(e=0;e<wv;e++)da(kv[e][t]);Hn(ig),Hn(rg),Hn(ag),Hn(eg),ke(Qm)},Ov=function(t){return bv(void 0,void 0,void 0,(function(){var e,n;return yv(this,(function(a){switch(a.label){case 0:switch(e=xv[0],t){case 0:return[3,1];case 1:return[3,3];case 2:return[3,5];case 3:return[3,6]}return[3,7];case 1:return[4,Bm(e)];case 2:case 4:return n=a.sent(),Nv(n),[2];case 3:return[4,Bm("data/quests/tutorial.json")];case 5:return $m=1,lg=0,[3,7];case 6:return Vm=Py(Ny),vt(an(0,0,0),.5),[2];case 7:return[2]}}))}))},Rv=function(){dg=xv.length,Mv=[];for(var t=function(t){var e;e=t,bv(void 0,void 0,void 0,(function(){var n;return yv(this,(function(a){switch(a.label){case 0:return[4,Bm(xv[t])];case 1:return n=a.sent(),Sv[e]=la(8),Mv[e]=n,pa(Sv[e],n.name),[2]}}))}))},e=0;e<dg;e++)t(e)},Av=function(t){return Math.floor(t/14+1)},Lv=function(){return Math.floor(dg/14+(dg%14==0?0:1))},Nv=function(t){var e,n;Og=e=t,us(5),ls(0),k("Running quest %s, '%s'... ".concat(e.file," ").concat(e.name)),n=0,Rg=Math.max(0,n),Vm=Py(jy),je(Qm),vt(an(0,0,0),.5)},Cv=function(t){if(t){t.init(t);for(var e=0;e<t.child_count;e++)Cv(t.child[e])}},Gv=function(t){if(t){for(var e=0;e<t.child_count;e++)Gv(t.child[e]);t.update(t)}},Pv=function(t,e){if(t){for(var n=0;n<t.child_count;n++)Pv(t.child[n],e);t.render(t,e)}},Uv=function(t){var e=0;if(t){for(var n=0;n<t.child_count;n++)e+=Uv(t.child[n]);return 1+e}return 0},Bv=function(t,e,n,a){return{font:null,init:t,release:e,update:n,render:a,data:null,parent:null,child:[],child_count:0}},Yv=function(t,e){t.child_count<10&&(t.child[t.child_count++]=e,e.parent=t)},Hv=function(t){if(t.font=la(8),pa(t.font,"LABEL"),null!=t.parent){var e=void 0,n=void 0,a=0,i=null!=t.parent.font?_a(t.parent.font):nt(12,12);for(e=0;e<t.parent.child_count&&t.parent.child[e]!=t;e++);for(n=0;n<e;n++)a+=Uv(t.parent.child[n])-1;t.font.position={x:t.parent.font.position.x,y:t.parent.font.position.y},t.font.position.x+=3*i.x,t.font.position.y+=(1+a+e)*i.y*2}},Wv=function(t){da(t.font)},Fv=function(t,e){ma(t.font,e)},Xv=function(){return t=void 0,e=void 0,a=function(){var t;return function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(e){switch(e.label){case 0:return xg=0,fg=!1,bg=0,gg=we(),vg=null,_g=!0,hg=la(4),pa(hg,Be("OPTIONS_TITLE")),hg.position.x=140,hg.position.y=10,[4,Ca("data/themes/options.bg.json")];case 1:return t=e.sent(),yg=t,mg=Yn(),Qn(mg,fn("SD_TITLEFOOT",0)),mg.position=nt(-50,-50),wg=Gb(),Cv(wg),[2]}}))},new((n=void 0)||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}));var t,e,n,a},zv=function(){var t=X();if(bg+=t,pa(hg,Be("OPTIONS_TITLE")),_g&&(gt(an(0,0,0),1),_g=!1),Pa(yg),fg||null!=vg||yt()||(Se(gg,Pt)&&(xg=(xg+1)%5,A($e("choose"))),Se(gg,Gt)&&(xg=((xg-1)%5+5)%5,A($e("choose"))),Se(gg,Ft)&&(A($e("return")),fg=!0)),Gv(wg),fg)yt()||j();else if(!O()&&bg>=.2){var e=M("data/music/options.mp4");T(e,!0)}if(fg){if(bt())return Vv(),Fe(),void We(Py(Dy));vt(an(0,0,0),1)}if(null!=vg){if(bt())return Vv(),We(vg),vg=null,void(_g=!0);vt(an(0,0,0),1)}},$v=function(){var t=nt(240,135.5);Ua(yg,t),Ba(yg,t),ma(hg,t),Pv(wg,t),Wn(mg,t)},Qv=function(){Hn(mg),da(hg),ke(gg)},Vv=function(){var t,e,n;t=Tt(),C.fullscreen=t,G(),e=Mt(),C.smooth_graphics=e,G(),n=jt(),C.show_fps=n,G()},Kv=function(t,e){Hv(t),t.data=e,pa(t.font,Be(e))},qv=function(t){t.data=null,Wv(t)},Jv=function(t){pa(t.font,Be(t.data))},Zv=function(t,e){Fv(t,e)},tb=function(t,e,n){var a;Hv(t),pa(t.font,Be(e)),t.data={},(a=t.data).option_index=n,a.lang_key=e},eb=function(t){t.data=null,Wv(t)},nb=function(t){var e=t.data;return xg==e.option_index},ab=function(t){var e=t.data;pa(t.font,Be(e.lang_key)),nb(t)&&(pa(t.font,"<color=ffff00>%s</color>",Be(e.lang_key)),mg.position=at(t.font.position,nt(3*Math.cos(2*m*bg)-20,0)))},ib=function(t,e){Fv(t,e)},rb=function(t){Hv(t),pa(t.font,""),t.font.position=nt(0,25)},ob=function(t){Wv(t)},cb=function(t){},sb=function(t,e){Fv(t,e)},ub=function(t){Kv(t,"OPTIONS_GRAPHICS")},lb=function(t){qv(t)},db=function(t){Jv(t)},pb=function(t,e){Zv(t,e)},fb=function(t){tb(t,"OPTIONS_FPS",0)},_b=function(t){eb(t)},hb=function(t){ab(t),function(t){return nb(t)}(t)&&(yt()||((Se(gg,Yt)||Se(gg,Wt))&&(A($e("select")),It(!jt())),Se(gg,Bt)&&jt()&&(A($e("select")),It(!1)),Se(gg,Ut)&&(jt()||(A($e("select")),It(!0)))))},mb=function(t,e){var n,a=[];ib(t,e),(n=la(8)).position=nt(175,t.font.position.y),a[0]=Be("OPTIONS_YES"),a[1]=Be("OPTIONS_NO"),jt()?pa(n,"<color=ffff00>%s</color>  %s",a[0],a[1]):pa(n,"%s  <color=ffff00>%s</color>",a[0],a[1]),ma(n,e),da(n)},gb=function(t){Kv(t,"OPTIONS_GAME")},vb=function(t){qv(t)},bb=function(t){Jv(t)},yb=function(t,e){Zv(t,e)},xb=function(t){tb(t,"OPTIONS_LANGUAGE",1)},wb=function(t){eb(t)},kb=function(t){ab(t),function(t){return nb(t)}(t)&&(yt()||(Se(gg,Yt)||Se(gg,Wt))&&(A($e("select")),vg=Py(Ay)))},Eb=function(t,e){ib(t,e)},Sb=function(t){tb(t,"OPTIONS_STAGESELECT",2)},Mb=function(t){eb(t)},Tb=function(t){ab(t),function(t){return nb(t)}(t)&&(yt()||(Se(gg,Yt)||Se(gg,Wt))&&(A($e("select")),vg=Py(Cy)))},jb=function(t,e){ib(t,e)},Ib=function(t){tb(t,"OPTIONS_CREDITS",3)},Db=function(t){eb(t)},Ob=function(t){ab(t),function(t){return nb(t)}(t)&&(yt()||(Se(gg,Yt)||Se(gg,Wt))&&(A($e("select")),vg=Py(Ly)))},Rb=function(t,e){ib(t,e)},Ab=function(t){tb(t,"OPTIONS_BACK",4)},Lb=function(t){eb(t)},Nb=function(t){ab(t),function(t){return nb(t)}(t)&&(yt()||(Se(gg,Yt)||Se(gg,Wt))&&(A($e("select")),fg=!0))},Cb=function(t,e){ib(t,e)},Gb=function(){var t,e,n,a,i,r,o,c;return n=Bv(fb,_b,hb,mb),e=Bv(ub,lb,db,pb),Yv(e,n),i=Bv(xb,wb,kb,Eb),r=Bv(Ib,Db,Ob,Rb),o=Bv(Sb,Mb,Tb,jb),a=Bv(gb,vb,bb,yb),Yv(a,i),Yv(a,o),Yv(a,r),c=Bv(Ab,Lb,Nb,Cb),t=Bv(rb,ob,cb,sb),Yv(t,e),Yv(t,a),Yv(t,c),t},Pb=null,Ub=!1,Bb=!1,Yb=0,Hb=function(){Pb=we(),Ub=!1,Bb=!1,Yb=0},Wb=function(){if(Se(Pb,Ft))return Ue("CBOX_QUIT_QUESTION"),Ue("CBOX_QUIT_OPTION1"),Ue("CBOX_QUIT_OPTION2"),void We(Py(Ry));if(1==Aa()&&(Bb=!0),Bb)return bt()?(Fe(),Fe(),void Ug()):void vt(an(0,0,0),1);if(Ub){if(Se(Pb,Wt))return null!=S&&S.paused&&S.play(),void Fe()}else Me(Pb,Wt)&&(Ub=!0)},Fb=function(){var t=_n(fn("SD_PAUSE",0),0),e=1+.5*Math.abs(Math.cos(m/2*Yb));nt((ut-t.width)/2-(e-1)*t.width/2,(lt-t.height)/2-(e-1)*t.height/2),Bb||(Yb+=X())},Xb=function(){on(null),ke(Pb)},zb=!1,$b=function(){z(),zb=!1,(kg=la(8)).position=nt(5,35),Eg=la(4),pa(Eg,Be("QUESTCLEARED_TITLE")),Eg.position=nt((ut-_a(Eg).x*fa(Eg).length)/2,5),Sg=Yn(),Qn(Sg,fn("SD_SONIC",24)),Sg.position=nt(20,150),T(M("data/music/invincible.mp4"),!1),Mg=we(),gt(an(0,0,0),2)},Qb=function(){var t=cs(),e=Yg(jg)/3600,n=Yg(jg)/60%60,a=Yg(jg)%60,i=Yg(Dg),r=Yg(Ig);if(z(),pa(kg,Be("QUESTCLEARED_TEXT"),"NO_QUEST_NAME",t,e,n,a,i,r,l,d),Se(Mg,Yt)&&(zb=!0),zb){if(bt())return Fe(),void We(Py(Dy));vt(an(0,0,0),2)}},Vb=function(){var t=nt(240,135.5);xt(),ma(Eg,t),ma(kg,t),Wn(Sg,t)},Kb=function(){ke(Mg),Hn(Sg),da(Eg),da(kg)},qb=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},Jb=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Zb=["data/levels/blue_ocean_1.json","data/levels/blue_ocean_2.json","data/levels/blue_ocean_3.json","data/levels/desert1.json","data/levels/exotic_1.json","data/levels/exotic_2.json","data/levels/exotic_3.json","data/levels/exotichell_1.json","data/levels/prototype.json","data/levels/superboss_1.json","data/levels/superboss_2.json","data/levels/template.json","data/levels/tutorial_1.json","data/levels/tutorial_2.json","data/levels/test.json"];!function(t){t[t.STAGESTATE_NORMAL=0]="STAGESTATE_NORMAL",t[t.STAGESTATE_QUIT=1]="STAGESTATE_QUIT",t[t.STAGESTATE_PLAY=2]="STAGESTATE_PLAY",t[t.STAGESTATE_FADEIN=3]="STAGESTATE_FADEIN"}(Tg||(Tg={}));var ty,ey,ny,ay,iy,ry,oy,cy,sy=Tg.STAGESTATE_NORMAL,uy=Tg.STAGESTATE_QUIT,ly=Tg.STAGESTATE_PLAY,dy=Tg.STAGESTATE_FADEIN,py=1,fy=1,_y=0,hy=[],my=0,gy=0,vy=[],by=function(){return qb(void 0,void 0,void 0,(function(){var t;return Jb(this,(function(e){switch(e.label){case 0:return gy=0,_y=0,oy=sy,iy=we(),ty=la(4),pa(ty,Be("STAGESELECT_TITLE")),ty.position.x=(ut-fa(ty).length*_a(ty).x)/2-150,ty.position.y=10,ey=la(8),pa(ey,Be("STAGESELECT_MSG")),ey.position.x=10,ey.position.y=lt-1.5*_a(ey).y,ny=la(8),pa(ny,Be("STAGESELECT_PAGE"),0,0),ny.position.x=ut-fa(ny).length*_a(ny).x-10,ny.position.y=40,[4,Ca("data/themes/levelselect.bg.json")];case 1:return t=e.sent(),ry=t,ay=Yn(),Qn(ay,fn("SD_TITLEFOOT",0)),ky(),gt(an(0,0,0),1),[2]}}))}))},yy=function(){var t=X();if(_y+=t,Pa(ry),vy.length){if(ay.position=nt(vy[gy].position.x,vy[gy].position.y),ay.position.x+=3*Math.cos(2*m*_y)-20,py=Math.floor(gy/8+1),fy=Math.floor(my/8+(my%8==0?0:1)),pa(ny,Be("STAGESELECT_PAGE"),py,fy),ny.position.x=ut-fa(ny).length*_a(ny).x-10,oy==ly)yt()||j();else if(!O()){var e=M("data/music/options.mp4");T(e,!0)}switch(oy){case sy:yt()||(Se(iy,Pt)&&(gy=(gy+1)%my,A($e("choose"))),Se(iy,Gt)&&(gy=((gy-1)%my+my)%my,A($e("choose"))),(Se(iy,Yt)||Se(iy,Wt))&&(k("Loading level ".concat(hy[gy].name," ").concat(hy[gy].filepath)),Mh(hy[gy].filepath),A($e("select")),oy=ly),Se(iy,Ft)&&(A($e("return")),oy=uy));break;case uy:if(bt())return void Fe();vt(an(0,0,0),1);break;case ly:if(bt())return us(5),ls(0),We(Py(Sy)),void(oy=dy);vt(an(0,0,0),1);break;case dy:gt(an(0,0,0),1),oy=sy}}},xy=function(){var t,e=nt(240,135.5);for(Ua(ry,e),Ba(ry,e),ma(ty,e),ma(ey,e),fy>1&&ma(ny,e),t=8*(py-1);t<8*py;t++)hy[t]&&(pa(vy[t],gy==t?"<color=ffff00>%s - %s %s</color>":"%s - %s %s",hy[t].name,Be("STAGESELECT_ACT"),hy[t].act),ma(vy[t],e));Wn(ay,e)},wy=function(){Ey(),ry=Ga(ry),Hn(ay),da(ty),da(ey),da(ny),ke(iy)},ky=function(){return qb(void 0,void 0,void 0,(function(){var t,e;return Jb(this,(function(n){switch(n.label){case 0:return k("load_stage_list()"),[4,y(Zb)];case 1:for(t=n.sent(),my=(hy=t).length,e=0;e<my;e++)vy[e]=la(8),vy[e].position=nt(25,60+e%8*20),hy[e].filepath=Zb[e];return[2]}}))}))},Ey=function(){},Sy=1,My=2,Ty=3,jy=4,Iy=5,Dy=6,Oy=7,Ry=8,Ay=9,Ly=10,Ny=11,Cy=12,Gy=[],Py=function(t){return Gy[t]},Uy=function(t,e,n,a){return{init:t,update:e,render:n,release:a}},By=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},Yy=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Hy=function(){var t,e;t=function(){!function(){var t=0,e=0;for(e=0;e<10;)e=(t=z())>H?t-H:0,H=t>=H?H:t;e=Math.min(e,16),W=.001*e,U++,(B+=e)>=1e3&&(Y=U,U=0,B=0),H=z()}(),function(){var t,e,n=X();for(e=oe;e;e=e.next){for(t=0;t<9;t++)e.data.oldstate[t]=e.data.state[t];for(t=0;t<9;t++)Ee(e.data,t)?e.data.howlong[t]+=n:e.data.howlong[t]=0;switch(e.data.type){case Ct.IT_KEYBOARD:e.data.state[Gt]=de.up,e.data.state[Pt]=de.down,e.data.state[Ut]=de.left,e.data.state[Bt]=de.right,e.data.state[Yt]=de.space,e.data.state[Ht]=de.lcontrol,e.data.state[Wt]=de.enter,e.data.state[Ft]=de.esc,e.data.state[Xt]=de.tilda;break;case Ct.IT_MOUSE:e.data.x=ve.x,e.data.y=ve.y,e.data.state[Yt]=be.left,e.data.state[Wt]=be.middle,e.data.state[Ht]=be.right;break;case Ct.IT_COMPUTER:for(t=0;t<9;t++)e.data.state[t]=!1;break;case Ct.IT_JOYSTICK:ce&&!se&&(e.data.state[Gt]=pe[0].stick[0].axis[1].d1,e.data.state[Pt]=pe[0].stick[0].axis[1].d2,e.data.state[Ut]=pe[0].stick[0].axis[0].d1,e.data.state[Bt]=pe[0].stick[0].axis[0].d2,e.data.state[Yt]=pe[0].button[0].b,e.data.state[Ht]=pe[0].button[1].b,e.data.state[Wt]=pe[0].button[2].b,e.data.state[Ft]=pe[0].button[3].b);break;case Ct.IT_USER:e.data.state[Gt]=de.up,e.data.state[Pt]=de.down,e.data.state[Ut]=de.left,e.data.state[Bt]=de.right,e.data.state[Yt]=de.space,e.data.state[Ht]=de.lcontrol,e.data.state[Wt]=de.enter,e.data.state[Ft]=de.esc,ue&&(e.data.state[Gt]=fe.up(),e.data.state[Pt]=fe.down(),e.data.state[Ut]=fe.left(),e.data.state[Bt]=fe.right(),e.data.state[Yt]=_e._pressed,e.data.state[Ft]=he._pressed,e.data.state[Ht]=me._pressed),zt&&(ge="undefined"==typeof navigator?null:navigator.getGamepads()[0]||null),ge&&(e.data.state[Gt]=ge.buttons[12].pressed,e.data.state[Pt]=ge.buttons[13].pressed,e.data.state[Ut]=ge.buttons[14].pressed,e.data.state[Bt]=ge.buttons[15].pressed,e.data.state[Yt]=ge.buttons[0].pressed,e.data.state[Ht]=ge.buttons[1].pressed,e.data.state[Wt]=ge.buttons[2].pressed,e.data.state[Ft]=ge.buttons[3].pressed)}}}();var t=Xe();t&&(t.update(),t==Xe()&&t.render()),function(){if(o=!1,0!=r)if((s+=X())<u){var t=void 0;t=q(t=1.25*s/u*100,0,100),t=1==r?100-t:t,t/=100,Et().fillStyle=c,Et().globalAlpha=t,Et().fillRect(0,0,n.width,n.height)}else 2==r&&(Et().fillStyle=c,Et().fillRect(0,0,n.width,n.height)),r=0,u=s=0,c=null,o=!0;Et().globalAlpha=1,jt()&&(Et().font="14px Arial",Et().fillStyle="white",Et().fillText(""+Y,450,20))}(),fe&&fe.render(Et()),_e&&_e.render(Et()),he&&he.render(Et()),me&&me.render(Et())},e=null,requestAnimationFrame((function n(a){var i=!1;if(null!=e){Math.min(a-e,100);i=!1===t()}e=a,i||requestAnimationFrame(n)}))},Wy=function(){k("preferences_init()"),function(){if(C.video_resolution="TINY",C.fullscreen=!1,C.smooth_graphics=!1,C.show_fps=!1,C.language="data/languages/english.json","undefined"!=typeof window)for(var t in C){var e=window.localStorage.getItem(t)?localStorage.getItem(t):C[t];"false"==e&&(e=!1),"true"==e&&(e=!0),C[t]=e}}()},Fy=function(i){k("timer_init()"),U=0,B=0,Y=0,W=0,H=z(),function(t,e,i,r,o,c){Dt(e,i,r),It(c);var s=document.getElementById("canvas");s?(a=(n=s).getContext("2d"),_t=n.width/ut,ht=n.height/lt,a.scale(n.width/ut,n.height/lt)):(s=document.createElement("canvas"),a=(n=s).getContext("2d"),n.width=ut,n.height=lt,document.body.appendChild(n)),_t=ut/window.innerWidth,ht=_t,a.imageSmoothingEnabled=!1,xt()}(zy(),i.video_resolution,i.smooth_graphics,i.fullscreen,i.color_depth,i.show_fps),k("input_init()"),oe=null,kt().addEventListener("contextmenu",(function(t){if(2===t.button)return t.preventDefault(),!1}),!1),kt().addEventListener("mousemove",(function(t){ve=function(t,e){var n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}}(kt(),t)}),!1),kt().addEventListener("mousedown",(function(t){switch(t.which){case 1:be.left=!0;break;case 2:be.middle=!0;break;case 3:be.right=!0}}),!1),kt().addEventListener("mouseup",(function(t){switch(t.which){case 1:be.left=!1;break;case 2:be.middle=!1;break;case 3:be.right=!1}}),!1),ce=!1,se=!1,zt="undefined"!=typeof navigator&&"getGamepads"in navigator,(ue=function(){try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}}())&&((fe=new Nt({container:kt(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX>=window.innerWidth/2||e.pageY<window.innerHeight/2)})),(_e=new Nt({container:kt(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX<window.innerWidth/2||e.pageY<window.innerHeight/2)})),(he=new Nt({container:kt(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX>window.innerWidth/2||e.pageY>window.innerHeight/2)})),(me=new Nt({container:kt(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX<window.innerWidth/2||e.pageY>window.innerHeight/2)}))),de=Ae(le),g.images={},g.images,g.samples={},t=g.samples,g.musics={},e=g.musics},Xy=function(t){return By(void 0,void 0,void 0,(function(){return Yy(this,(function(e){switch(e.label){case 0:return Qe(),n=void 0,a=void 0,r=function(){var t;return function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(e){switch(e.label){case 0:return k("Loading objects scripts..."),jp=null,[4,x("data/objects/enemies.json")];case 1:return t=e.sent(),jp=t,[2]}}))},new((i=void 0)||(i=Promise))((function(t,e){function o(t){try{s(r.next(t))}catch(t){e(t)}}function c(t){try{s(r.throw(t))}catch(t){e(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(t){t(n)}))).then(o,c)}s((r=r.apply(n,a||[])).next())})),function(){for(var t=0;t<256;t++)Gy[t]=null;Gy[Sy]=Uy(Ih,Dh,Oh,Rh),Gy[My]=Uy(Hb,Wb,Fb,Xb),Gy[Ty]=Uy(Fg,Xg,zg,$g),Gy[jy]=Uy(Ng,Cg,Gg,Pg),Gy[Dy]=Uy(Tv,jv,Iv,Dv),Gy[0]=Uy(Kg,qg,Jg,Zg),Gy[Iy]=Uy(ci,si,ui,li),Gy[Oy]=Uy($b,Qb,Vb,Kb),Gy[Ry]=Uy(Ia,Da,Oa,Ra),Gy[Ay]=Uy(pv,fv,_v,hv),Gy[Ly]=Uy(Ja,Za,ti,ei),Gy[Ny]=Uy(Xv,zv,$v,Qv),Gy[Cy]=Uy(by,yy,xy,wy)}(),[4,(o=t.language,Le(void 0,void 0,void 0,(function(){return Ne(this,(function(t){switch(t.label){case 0:return k("Initializing the language module"),[4,Pe(Ce=o||Ce)];case 1:return t.sent(),k("lang_init() ok!"),[2]}}))})))];case 1:return e.sent(),function(){He=0;for(var t=0;t<16;t++)Ye[t]=null}(),[2]}var n,a,i,r,o}))}))},zy=function(){return""};cy={},By(void 0,void 0,void 0,(function(){var t;return Yy(this,(function(e){switch(e.label){case 0:return t=function(t){var e={};return e.video_resolution=C.video_resolution,e.smooth_graphics=C.smooth_graphics,e.fullscreen=C.fullscreen,e.show_fps=C.show_fps,e.language=C.language,e.video_resolution=t.video_resolution?t.video_resolution:e.video_resolution,e.smooth_graphics=t.smooth_graphics?t.smooth_graphics:e.smooth_graphics,e.fullscreen=t.fullscreen?t.fullscreen:e.fullscreen,e.show_fps=t.show_fps?t.show_fps:e.show_fps,e.color_depth=t.color_depth?t.color_depth:32,e.level=t.level?t.level:null,e.quest=t.quest?t.quest:null,e.language=t.language?t.language:e.language,e.video_resolution=P("video_resolution")?+P("video_resolution"):e.video_resolution,e.smooth_graphics=!!P("smooth_graphics")||e.smooth_graphics,e.fullscreen=!!P("fullscreen")||e.fullscreen,e.show_fps=!!P("show_fps")||e.show_fps,e.color_depth=P("color_depth")?+P("color_depth"):e.color_depth,e.level=P("level")?P("level"):e.level,e.quest=P("quest")?P("quest"):e.quest,e.language=P("language")?P("language"):e.language,e}(cy),console.log("ENGINE OPTIONS",t),Wy(),Fy(t),[4,cn(void 0,void 0,void 0,(function(){var t,e,n,a;return sn(this,(function(i){switch(i.label){case 0:for(k("Loading sprites..."),g.sprites={},un=g.sprites,n=0;n<ln.length;n++)ln[n]="data/sprites/"+ln[n]+".json";return wt("Loading...",0),[4,y(ln)];case 1:for(t=i.sent(),e=t,n=0;n<e.length;n++)for(a in e[n])e[n][a].name=a,pn.push(e[n][a]);return[4,xn(pn)];case 2:return i.sent(),k("All sprites have been loaded!"),[2,un=v()]}}))}))];case 1:return e.sent(),function(){var t,e,n,a=["ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","0123456789:","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_abcdefghijklmnopqrstuvwxyz{|}~"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_abcdefghijklmnopqrstuvwxyz{|}~"];for(k("font_init()"),t=0;t<a.length;t++)for(ca[t]={ch:{}},n="FT_FONT"+t,e=0;e<a[t].length;e++)ca[t].ch[a[t][e]]=_n(fn(n,0),e);k("font_init() ok")}(),[4,Xy(t)];case 2:return e.sent(),us(5),ls(0),function(t){By(void 0,void 0,void 0,(function(){return Yy(this,(function(e){return t.level?(Mh(t.level),We(Py(Sy))):We(Py(0)),[2]}))}))}(t),Hy(),[2]}}))}))})();