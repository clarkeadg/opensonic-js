(()=>{"use strict";var t={386:(t,e)=>{e.eI=e.in=e.PI=e.KZ=e.JU=e._v=e.Ib=e.Ip=e.t3=e.t4=e.ve=e.b5=e.Nu=void 0,e.Nu="",e.b5="Open Sonic",e.ve=1,e.t4=1,e.t3=1,e.Ip="http://opensnc.sourceforge.net",e.Ib=1e-4,e._v=99999999,e.JU=1/0,e.KZ=999999999,e.PI=Math.PI,e.in=0,e.eI=!0}},e={};function n(a){var i=e[a];if(void 0!==i)return i.exports;var o=e[a]={exports:{}};return t[a](o,o.exports,n),o.exports}(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(e){var n=function(e,n){if("object"!==t(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var i=a.call(e,"string");if("object"!==t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===t(n)?n:String(n)}function a(t,n,a){return(n=e(n))in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t}var i,o,r,s,c,p,l,_,u,d,f,h,g=n(386),m={},b=function(){return m.sprites},y=function(t,e){return m.samples[e]},x={},v={},w={},k=function(t){return Promise.all(t.map(I))},I=function(t){return t=g.Nu+t,new Promise((function(e,n){if(w[t])e(w[t]);else{var a=new XMLHttpRequest;a.overrideMimeType("application/json"),a.open("GET",t,!0),a.onreadystatechange=function(){if(4===a.readyState){var n={};try{n=JSON.parse(a.responseText)}catch(e){console.log("error parsing json",t)}w[t]=n,e(n)}},a.send(null)}}))},S=function(t,e){!function(t,e,n){t[e]=n}(x,t,e)},j="undefined"==typeof arguments?void 0:arguments,E=function(t){if(j&&j.length>1)return console.log(j[0],j[1]);console.log(t)},M=function(t){if(j.length>1)return console.log("FATAL ERROR",j[0],j[1]);console.log("FATAL ERROR",t)},O=null,D=function(t){E("music_load('%s')");var e=new Audio;return e.src=t,function(t,e){!function(t,e,n){t[e]=n}(v,t,e)}(t,e),e},T=function(t,e){if(A()&&P(),null!=t){t.loop=!!e;try{t.play()}catch(t){}}O=t},P=function(){null!=O&&O.pause(),O=null},L=function(t){null!=O&&(t>1&&(t=1),t<0&&(t=0),O.volume=t)},R=function(){return null!=O?O.volume:0},A=function(){return null!=O&&!O.paused},N=function(t,e){e=g.Nu+e;var n=new Audio;n.src=e;var a=new Audio;a.src=e;var i=new Audio;i.src=e;var o=new Audio;return o.src=e,S(t,n),S(t+"2",a),S(t+"3",i),S(t+"4",o),n},C=function(t){G(t,1,0,1,0)},G=function(t,e,n,a,i){t&&t.play&&t.play()},U=function(t){return!!t&&!t.paused},B={video_resolution:null,fullscreen:null,smooth_graphics:null,show_fps:null,language:null},H=function(){if(console.log("SAVE PREFERENCES"),"undefined"!=typeof window)for(var t in B)console.log("SAVE PREVERFENCE",t,B),window.localStorage.setItem(t,B[t])},X=function(t){if("undefined"!=typeof window){var e=RegExp("[?&]"+t+"=([^&]*)").exec(window.location.search);return e&&decodeURIComponent(e[1].replace(/\+/g," "))}return null},W=0,Y=0,$=0,z=function(){return Y},F=function(){var t=V();return t<$&&($=t),t-$},V=function(){return Math.floor(Date.now())},q=function(t){return" "==t},Q=function(t){return void 0!==t&&t&&t.constructor===Array},K=function(t){return J(parseInt(Math.random(t)*t,10),1,t)},J=function(t,e,n){return Math.min(Math.max(t,e),n)},Z=function(t,e){return t[0]<e[2]&&t[2]>e[0]&&t[1]<e[3]&&t[3]>e[1]},tt=function(t,e){return nt(t,e,t.length)},et=function(t){return t>=0&&t<g.PI/4-g.Ib?0:t>=g.PI/4-g.Ib&&t<g.PI/2-g.Ib?g.PI/4:t>=g.PI/2-g.Ib&&t<g.PI/2+g.Ib?g.PI/2:t>=g.PI/2+g.Ib&&t<g.PI-g.Ib?3*g.PI/4:t>=g.PI-g.Ib&&t<g.PI+g.Ib?g.PI:t>=g.PI+g.Ib&&t<3*g.PI/2-g.Ib?5*g.PI/4:t>=3*g.PI/2-g.Ib&&t<3*g.PI/2+g.Ib?3*g.PI/2:t>3*g.PI/2+g.Ib&&t<=7*g.PI/4+g.Ib?7*g.PI/4:0},nt=function(t,e,n){var a,i,o=t,r=e;for(a=0;a<n;a++)i=o[a],o[a]=r[a],r[a]=i;return[o[a],r[a]]},at=function(t,e){return{x:t,y:e}},it=function(t,e){return{x:t.x+e.x,y:t.y+e.y}},ot=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},rt=function(t,e){return{x:e*t.x,y:e*t.y}},st=function(t,e){var n=t.x,a=t.y,i={};return i.x=n*Math.cos(e)-a*Math.sin(e),i.y=a*Math.cos(e)+n*Math.sin(e),i},ct=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},pt=function(t){var e=ct(t);return e>g.Ib?at(t.x/e,t.y/e):at(0,0)},lt=480,_t=271,ut=!1,dt=!1,ft=!1,ht=1,gt=1,mt=function(){return at(ht,gt)},bt=function(t,e){0==_&&(_=1,u=!1,d=t,f=0,h=e)},yt=function(t,e){0==_&&(_=2,u=!1,d=t,f=0,h=e)},xt=function(){return u},vt=function(){return 0!=_},wt=function(t){c.fillStyle=t||"rgb(0, 0, 0)",c.fillRect(0,0,s.width,s.height)},kt=function(t,e){wt();var n=St();n.beginPath(),n.rect(130,115.5,210,20),n.fillStyle="black",n.fill(),n.lineWidth=1,n.strokeStyle="white",n.stroke(),e=e<1?0:e>202?202:202/e,n.beginPath(),n.rect(134,118.5,e,14),n.fillStyle="white",n.fill(),n.lineWidth=1,n.strokeStyle="black",n.stroke(),n.font="14px Arial",n.fillStyle="white",n.fillText(t,130,105.5)},It=function(){return s},St=function(){return p},jt=function(){return l},Et=function(){return ut},Mt=function(){return dt},Ot=function(){return ft},Dt=function(t){ft=t},Tt=function(t,e,n){l=t,dt=n,ut=e};function Pt(t,n){for(var a=0;a<n.length;a++){var i=n[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,e(i.key),i)}}var Lt,Rt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._container=e.container||document.body,this._strokeStyle=e.strokeStyle||"cyan",this._mouseSupport=void 0!==e.mouseSupport&&e.mouseSupport,this._stationaryBase=e.stationaryBase||!1,this._baseX=this._stickX=e.baseX||0,this._baseY=this._stickY=e.baseY||0,this._limitStickTravel=e.limitStickTravel||!1,this._stickRadius=void 0!==e.stickRadius?e.stickRadius:100,this._pressed=!1,this._touchIdx=null;var n=function(t,e){return function(){return t.apply(e,arguments)}};this._$onTouchStart=n(this._onTouchStart,this),this._$onTouchEnd=n(this._onTouchEnd,this),this._$onTouchMove=n(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=n(this._onMouseDown,this),this._$onMouseUp=n(this._onMouseUp,this),this._$onMouseMove=n(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))}var e,n,a;return e=t,a=[{key:"touchScreenAvailable",value:function(){return"createTouch"in document}}],(n=[{key:"destroy",value:function(){this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))}},{key:"deltaX",value:function(){return this._stickX-this._baseX}},{key:"deltaY",value:function(){return this._stickY-this._baseY}},{key:"up",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(e>=0||Math.abs(t)>2*Math.abs(e))}},{key:"down",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(e<=0||Math.abs(t)>2*Math.abs(e))}},{key:"right",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(t<=0||Math.abs(e)>2*Math.abs(t))}},{key:"left",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(t>=0||Math.abs(e)>2*Math.abs(t))}},{key:"_onUp",value:function(){this._pressed=!1,0==this._stationaryBase&&(this._baseX=this._baseY=0,this._stickX=this._stickY=0)}},{key:"_onDown",value:function(t,e){this._pressed=!0;var n=mt();t*=n.x,e*=n.y,this._stationaryBase,this._stickX=t,this._stickY=e}},{key:"_onMove",value:function(t,e){var n=mt();t*=n.x,e*=n.y,!0===this._pressed&&(this._stickX=t,this._stickY=e)}},{key:"_onMouseUp",value:function(t){return this._onUp()}},{key:"_onMouseDown",value:function(t){t.preventDefault();var e=t.clientX,n=t.clientY;return this._onDown(e,n)}},{key:"_onMouseMove",value:function(t){var e=t.clientX,n=t.clientY;return this._onMove(e,n)}},{key:"_onTouchStart",value:function(t){if(null===this._touchIdx&&!1!==this.dispatchEvent("touchStartValidation",t)){this.dispatchEvent("touchStart",t),t.preventDefault();var e=t.changedTouches[0];this._touchIdx=e.identifier;var n=e.pageX,a=e.pageY;return this._onDown(n,a)}}},{key:"_onTouchEnd",value:function(t){if(null!==this._touchIdx){this.dispatchEvent("touchEnd",t);for(var e=t.changedTouches,n=0;n<e.length&&e[n].identifier!==this._touchIdx;n++);if(n!==e.length)return this._touchIdx=null,t.preventDefault(),this._onUp()}}},{key:"_onTouchMove",value:function(t){if(null!==this._touchIdx){for(var e=t.changedTouches,n=0;n<e.length&&e[n].identifier!==this._touchIdx;n++);if(n!==e.length){var a=e[n];t.preventDefault();var i=a.pageX,o=a.pageY;return this._onMove(i,o)}}}},{key:"render",value:function(t){t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=3,t.arc(this._baseX,this._baseY,20,0,2*Math.PI,!0),t.stroke(),t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=1,t.arc(this._baseX,this._baseY,30,0,2*Math.PI,!0),t.stroke(),this._pressed&&(t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=3,t.arc(this._stickX,this._stickY,20,0,2*Math.PI,!0),t.stroke())}}])&&Pt(e.prototype,n),a&&Pt(e,a),Object.defineProperty(e,"prototype",{writable:!1}),t}();(Lt=Rt.prototype).addEventListener=function(t,e){return void 0===this._events&&(this._events={}),this._events[t]=this._events[t]||[],this._events[t].push(e),e},Lt.removeEventListener=function(t,e){void 0===this._events&&(this._events={}),t in this._events!=0&&this._events[t].splice(this._events[t].indexOf(e),1)},Lt.dispatchEvent=function(t){if(void 0===this._events&&(this._events={}),void 0!==this._events[t])for(var e=this._events[t].slice(),n=0;n<e.length;n++){var a=e[n].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==a)return a}};var At,Nt,Ct,Gt,Ut,Bt,Ht,Xt,Wt,Yt,$t,zt,Ft,Vt,qt,Qt,Kt,Jt,Zt,te,ee,ne,ae,ie,oe,re,se,ce,pe,le,_e,ue,de=null,fe=!1,he={37:"left",38:"up",39:"right",40:"down",17:"lcontrol",32:"space",13:"enter",27:"esc",192:"tilda"},ge={x:0,y:0},me={left:!1,middle:!1,right:!1},be=function(){var t,e={type:2,enabled:!0};for(e.dx=e.dy=e.x=e.y=0,e.state=[],e.oldstate=[],e.howlong=[],t=0;t<9;t++)e.state[t]=e.oldstate[t]=!1,e.howlong[t]=0;return Oe(e),e},ye=function(t){var e,n={type:1,enabled:!0};for(n.dx=n.dy=n.x=n.y=0,n.state=[],n.oldstate=[],n.howlong=[],e=0;e<9;e++)n.state[e]=n.oldstate[e]=!1,n.howlong[e]=0;if(t)for(n.keybmap=[],e=0;e<9;e++)n.keybmap[e]=t[e];else n.keybmap[1]=38,n.keybmap[2]=40,n.keybmap[3]=39,n.keybmap[4]=37,n.keybmap[5]=32,n.keybmap[6]=17,n.keybmap[7]=13,n.keybmap[8]=27,n.keybmap[9]=192;return Oe(n),n},xe=function(){var t={type:0,enabled:!0};t.dx=t.dy=t.x=t.y=0,t.state=[],t.oldstate=[],t.howlong=[];for(var e=0;e<9;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return t.keybmap=[],t.keybmap[1]=38,t.keybmap[2]=40,t.keybmap[3]=39,t.keybmap[4]=37,t.keybmap[5]=32,t.keybmap[6]=17,t.keybmap[7]=13,t.keybmap[8]=27,Oe(t),t},ve=function(t){De(t),t=null},we=function(t,e){return!!e&&!!t.enabled&&t.state[parseInt(e,10)]},ke=function(t,e){return!!e&&!!t.enabled&&t.state[parseInt(e,10)]&&!t.oldstate[parseInt(e,10)]},Ie=function(t,e){return!e||!!t.enabled&&!t.state[parseInt(e,10)]&&t.oldstate[parseInt(e,10)]},Se=function(t,e){t.state[parseInt(e,10)]=!0},je=function(t){t.enabled=!1},Ee=function(t){t.enabled=!0},Me=function(t){return at(t.x,t.y)},Oe=function(t){var e={};e.data=t,e.next=de,de=e},De=function(t){var e,n;if(de.data==t)n=de.next,de=null,de=n;else{for(e=de;e.next&&e.next.data!=t;)e=e.next;e.next&&(n=e.next.next,e.next=null,e.next=n)}},Te=function(t){var e=Object.create(null);function n(n){if(t.hasOwnProperty(n.keyCode)){var a="keydown"==n.type;e[t[n.keyCode]]=a,n.preventDefault()}}return addEventListener("keydown",n),addEventListener("keyup",n),e},Pe="data/languages/english.json",Le={},Re=function(t){return new Promise((function(e,n){E('lang_loadfile("%s")...'),I(t).then((function(t){Le=t,e(t)}))}))},Ae=function(t,e,n){return Le[t]||t},Ne=function(t){return Ae(t)},Ce=[],Ge=0,Ue=function(t){Ce[Ge++]=t,t&&t.init()},Be=function(){Ce[Ge-1].release(),Ce[Ge-1]=null,Ge--},He=function(){return Ce[Ge-1]},Xe={},We=function(t){var e=y(0,t);return U(e)&&(e=y(0,t+"2"),U(e)&&(e=y(0,t+"3"),U(e)&&(e=y(0,t+"4")))),e},Ye=function(t){for(var e in t)Xe[e]=$e(e,t[e])},$e=function(t,e){var n=ze();return n.data=N(t,e),n.data2=N(t,e),n},ze=function(){return{data:null}},Fe={},Ve=function(t,e){return St().createImageData(t,e)},qe=function(t){return new Promise((function(e,n){if(Fe[t])return e(Fe[t]);var a=document.createElement("img");a.src=t,a.addEventListener("load",(function(){return Fe[t]=a,e(a)}))}))},Qe=function(t,e,n,a,i,o,r,s){if(!t||!e)return!1;e.drawImage(t,n,a,r,s,i,o,r,s)},Ke=function(t,e,n,a,i){e.fillStyle=i,e.fillRect(n,a,n+1,a+1)},Je=function(t,e,n){return"rgb("+t+","+e+","+n+")"},Ze=function(t,e,n,a){for(var i=0;i<t.data.length;i+=4)t.data[i]=e,t.data[i+1]=n,t.data[i+2]=a},tn=function(t){t&&(t.data,t=null)},en={},nn=["animal","bigring","bluering","bosses","bumber","charge","checkpointorb","chef","danger","dangpower","dnadoor","door","explosion","fireball","flyingboy","flyingeyes","font","glasses","goal","goldfish","hud","icon","itembox","joan","kleps","lady_bugsy","levelact","loop","menu","misc","nafder","neon","oranjection","ring","roboxer","shield","spikes","spring","surge","surpreyes","switch","teleporter"],an=0,on=[],rn=function(t,e){var n;return null!=(n=en[t])?n.animation_data[e]:null},sn=function(t,e){return t?t.frame_data[t.data[e]]:0},cn=function(t){return new Promise((function(e,n){pn(t).then(e)}))},pn=function(t){return new Promise((function(e,n){var a=ln(),i=hn(a,t);i=function(t){var e,n,a;for((t.frame_w>t.rect_w||t.frame_h>t.rect_h)&&(t.frame_w=Math.min(t.frame_w,t.rect_w),t.frame_h=Math.min(t.frame_h,t.rect_h)),(t.rect_w%t.frame_w>0||t.rect_h%t.frame_h>0)&&(t.rect_w=t.rect_w%t.frame_w>0?t.rect_w-t.rect_w%t.frame_w+t.frame_w:t.rect_w,t.rect_h=t.rect_h%t.frame_h>0?t.rect_h-t.rect_h%t.frame_h+t.frame_h:t.rect_h),a=t.rect_w/t.frame_w*(t.rect_h/t.frame_h),e=0;e<t.animation_count;e++)for(n=0;n<t.animation_data[e].frame_count;n++)t.animation_data[e].data[n]>=0&&t.animation_data[e].data[n]<a||(t.animation_data[e].data[n]=Math.min(t.animation_data[e].data[n],0,a-1));return t}(i),_n(i).then((function(n){i=dn(n),mn(t.name,i),an++,kt("Loading...",an/on.length),e(i)}))}))},ln=function(){var t={source_file:null,rect_x:0,rect_y:0,rect_w:0,rect_h:0};return t.frame_w=t.frame_h=0,t.hot_spot=at(0,0),t.frame_count=0,t.frame_data=[],t.animation_count=0,t.animation_data=[],t},_n=function(t){return new Promise((function(e,n){qe(t.source_file).then((function(n){t.frame_count=parseInt(t.rect_w/t.frame_w*(t.rect_h/t.frame_h),10),t.frame_data=[],t=un(t,n),e(t)}))}))},un=function(t,e){for(var n=0,a=0,i=0;i<parseInt(t.frame_count,10);i++)t.frame_data[i]={data:e,sx:n+t.rect_x,sy:a+t.rect_y,swidth:t.frame_w,sheight:t.frame_h,x:0,y:0,width:t.frame_w,height:t.frame_h},(n+=t.frame_w)>=t.rect_w&&(n=0,a+=t.frame_h);return t},dn=function(t){for(var e=0;e<t.animation_count;e++)t.animation_data[e].frame_data=t.frame_data,t.animation_data[e].hot_spot=t.hot_spot;return t},fn=function(t){return Promise.all(t.map(pn))},hn=function(t,e){if(t.source_file=g.Nu+e.source_file,t.rect_x=e.source_rect.xpos,t.rect_y=e.source_rect.ypos,t.rect_w=e.source_rect.width,t.rect_h=e.source_rect.height,t.frame_w=e.frame_size.width,t.frame_h=e.frame_size.height,e.hot_spot&&(t.hot_spot.x=e.hot_spot.xpos,t.hot_spot.y=e.hot_spot.ypos),e.animations){t.animation_count=e.animations.length;for(var n=0;n<t.animation_count;n++)t.animation_data[n]=gn(bn(),e.animations[n]),0==t.animation_data[n].frame_count&&E("Animation error: invalid 'data' field. You must specify the frames of the animations")}return t},gn=function(t,e){return t.repeat=e.repeat,t.fps=e.fps,t.data=e.data,t.frame_count=e.data.length,t},mn=function(t,e){!function(t,e,n){m.sprites[e]=n}(b(),t,e)},bn=function(){var t={repeat:!1,fps:8,frame_count:0,data:null};return t.hot_spot=at(0,0),t.frame_data=null,t},yn=0,xn=[],vn=function(t){return xn[t]},wn=function(){return yn},kn=function(t){var e=t.brick_ref.data;if(null!=e&&e.animation_data.length){e.animation_data[0].repeat;var n=e.animation_data[0].frame_count;t.animation_frame+=e.animation_data[0].fps*z(),t.animation_frame>e.animation_data[0].frame_count-1&&(t.animation_frame=0),n=parseInt(t.animation_frame,10),t.brick_ref.image=e.frame_data[e.animation_data[0].data[n]]}return t},In=function(t){return t.brick_ref.image},Sn=function(t){var e=t.bricks;return Promise.all(e.map(jn))},jn=function(t){return new Promise((function(e,n){var a=function(){var t,e={data:null,image:null,property:0,angle:0,behavior:0,zindex:.5,behavior_arg:[]};for(t=0;t<5;t++)e.behavior_arg[t]=0;return e}(),i=t.type;"OBSTACLE"==i?a.property=1:"PASSABLE"==i?a.property=0:"CLOUD"==i?a.property=2:E("Can't read brick attributes: unknown brick type '%s'"),"DEFAULT"==(i=Q(t.behavior)?t.behavior[0]:t.behavior)?a.behavior=0:"CIRCULAR"==i?a.behavior=1:"BREAKABLE"==i?a.behavior=2:"FALL"==i?a.behavior=3:E("Can't read brick attributes: unknown brick type '%s'");for(var o=0;o<5;o++)a.behavior_arg[o]=t.behavior[1+o];a.behavior_arg[a.behavior_arg.length-1]=0,a.angle=t.angle,t.zindex&&(a.zindex=t.zindex),cn(t.sprite).then((function(t){a.data=t,a.image=t.frame_data[0],yn++,e(a)}))}))},En=void 0,Mn=!0,On=!1,Dn=!1,Tn=!1,Pn=!1,Ln=function(){var t={};return t.spawn_point=at(0,0),t.position=at(t.spawn_point.x,t.spawn_point.y),t.angle=0,t.speed=at(0,0),t.maxspeed=0,t.acceleration=0,t.jump_strength=0,t.is_jumping=!1,t.ignore_horizontal=!1,t.input=null,t.animation=null,t.animation_frame=0,t.animation_speed_factor=1,t.mirror=!1,t.visible=!0,t.alpha=1,t.hot_spot=at(0,0),t.carried_by=null,t.carry_offset=at(0,0),t.carrying=null,t},Rn=function(t){t.input&&ve(t.input),t=null},An=function(t,e){var n;if(e&&t&&(t.visible&&t.animation)){if(t.animation_frame+=t.animation.fps*t.animation_speed_factor*z(),t.animation_frame>t.animation.frame_count-1&&(t.animation.repeat?t.animation_frame=0:t.animation_frame=t.animation.frame_count-1),t.position,!(n=Gn(t)))return!1;t.mirror&&Jn(St(),parseInt(t.position.x-(e.x-240),10));var a=parseInt(t.position.x-(e.x-240),10),i=parseInt(t.position.y-(e.y-135.5),10),o=t.mirror?t.angle:-t.angle;t.angle&&(St().translate(a,i),St().rotate(o),St().translate(-a,-i)),St().drawImage(n.data,n.sx,n.sy,n.swidth,n.sheight,parseInt(t.position.x-t.hot_spot.x-(e.x-240),10),parseInt(t.position.y-t.hot_spot.y-(e.y-135.5),10),1*n.width,1*n.height),t.angle&&(St().translate(a,i),St().rotate(-o),St().translate(-a,-i)),t.mirror&&Jn(St(),parseInt(t.position.x-(e.x-240),10))}},Nn=function(t,e,n,a){var i,o,r,s,c,p={};if(t.visible&&t.animation){if(isNaN(t.animation_frame)&&(t.animation_frame=0,t.animation.fps=1),t.animation_frame+=t.animation.fps*t.animation_speed_factor*z(),t.animation_frame>t.animation.frame_count-1&&(t.animation.repeat?t.animation_frame=0:t.animation_frame=t.animation.frame_count-1),!(c=Gn(t)))return!1;for(p.x=t.position.x%(n?c.width:g.KZ)-t.hot_spot.x-(e.x-240)-(n?c.width:0),p.y=t.position.y%(a?c.height:g.KZ)-t.hot_spot.y-(e.y-135.5)-(a?c.height:0),r=n?lt/c.width+3:1,s=a?_t/c.height+3:1,i=0;i<r;i++)for(o=0;o<s;o++)St().drawImage(c.data,c.sx,c.sy,c.swidth,c.sheight,p.x+i*c.width,p.y+o*c.height,1*c.width,1*c.height)}},Cn=function(t,e){e||(e={x:0,y:0}),e.x=e.x||0,e.y=e.y||0,Math.abs(e.x)<g.Ib&&(e.x=0),t.position.x+=e.x*Math.cos(t.angle)+e.y*Math.sin(t.angle),t.position.y+=e.y*Math.cos(t.angle)-e.x*Math.sin(t.angle)},Gn=function(t){return sn(t.animation,parseInt(t.animation_frame,10))},Un=function(t,e){return t.animation_frame=J(e,0,t.animation.frame_count),t},Bn=function(t,e){return!(!t||!e)&&(t.animation!=e&&(t.animation=e,t.hot_spot=e.hot_spot,t.animation_frame=0,t.animation_speed_factor=1),t)},Hn=function(t){var e=t.animation_frame+t.animation.fps*t.animation_speed_factor*z();return!t.animation.repeat&&e>t.animation.frame_count-1},Xn=function(t,e){var n=0,a=0,i=[];if(i[0]=[],i[1]=[],i[0][0]=ot(t.position,st(t.hot_spot,-t.angle)),i[0][1]=it(i[0][0],st(at(Gn(t).width,0),-t.angle)),i[0][2]=it(i[0][0],st(at(Gn(t).width,Gn(t).height),-t.angle)),i[0][3]=it(i[0][0],st(at(0,Gn(t).height),-t.angle)),i[1][0]=ot(e.position,st(e.hot_spot,0)),i[1][1]=it(i[1][0],st(at(Gn(e).width,0),0)),i[1][2]=it(i[1][0],st(at(Gn(e).width,Gn(e).height),0)),i[1][3]=it(i[1][0],st(at(0,Gn(e).height),0)),a+=Math.abs(t.angle)<g.Ib||Math.abs(t.angle-g.PI/2)<g.Ib||Math.abs(t.angle-g.PI)<g.Ib||Math.abs(t.angle-3*g.PI/2)<g.Ib,a+=Math.abs(0)<g.Ib||Math.abs(0-g.PI/2)<g.Ib||Math.abs(0-g.PI)<g.Ib||Math.abs(0-3*g.PI/2)<g.Ib){var o=[],r=[];for(n=0;n<2;n++)o[n]=[],o[n][0]=Math.min(i[n][0].x,i[n][1].x),o[n][1]=Math.min(i[n][0].y,i[n][1].y),o[n][2]=Math.max(i[n][2].x,i[n][3].x),o[n][3]=Math.max(i[n][2].y,i[n][3].y),o[n][0]>o[n][2]&&(r=tt(o[n][0],o[n][2]),o[n][0]=r[0],o[n][2]=r[1]),o[n][1]>o[n][3]&&(r=tt(o[n][1],o[n][3]),o[n][1]=r[0],o[n][3]=r[1]);return Z(o[0],o[1])}var s=[],c=[Math.max(Gn(t).width,Gn(t).height),Math.max(Gn(e).width,Gn(e).height)];for(n=0;n<2;n++)s[n]=rt(it(i[n][0],i[n][2]),.5);return function(t,e,n,a){return ct(ot(t,n))<=e+a}(s[0],c[0],s[1],c[1])},Wn=function(t,e){return Math.abs(t.angle)<g.Ib&&Math.abs(e.angle)<g.Ib?!!Xn(t,e)&&(parseInt(t.position.x-t.hot_spot.x,10),parseInt(t.position.y-t.hot_spot.y,10),parseInt(e.position.x-e.hot_spot.x,10),parseInt(e.position.y-e.hot_spot.y,10),Gn(t),Gn(e),!0):!!function(t,e){var n={},a={},i={},o={},r=[],s=[];return r=Kn(En,t,r),s=Kn(En,e,s),n.x=Math.min(r[0].x,Math.min(r[1].x,Math.min(r[2].x,r[3].x))),n.y=Math.min(r[0].y,Math.min(r[1].y,Math.min(r[2].y,r[3].y))),a.x=Math.min(s[0].x,Math.min(s[1].x,Math.min(s[2].x,s[3].x))),a.y=Math.min(s[0].y,Math.min(s[1].y,Math.min(s[2].y,s[3].y))),i.x=Math.max(r[0].x,Math.max(r[1].x,Math.max(r[2].x,r[3].x)))-n.x,i.y=Math.max(r[0].y,Math.max(r[1].y,Math.max(r[2].y,r[3].y)))-n.y,o.x=Math.max(s[0].x,Math.max(s[1].x,Math.max(s[2].x,s[3].x)))-a.x,o.y=Math.max(s[0].y,Math.max(s[1].y,Math.max(s[2].y,s[3].y)))-a.y,n.x+i.x>=a.x&&n.x<=a.x+o.x&&n.y+i.y>=a.y&&n.y<=a.y+o.y}(t,e)},Yn=function(t,e,n,a,i,o,r,s,c,p,l,_){var u=Gn(t).width,d=Gn(t).height,f=t.position,h=it(f,st(at(0,-d+n),-t.angle)),g=it(f,st(at(0,-n),-t.angle)),m=it(f,st(at(-u/2+n,.5*-d),-t.angle)),b=it(f,st(at(u/2-n,.5*-d),-t.angle)),y=it(f,st(at(-u/2+n,-d+n),-t.angle)),x=it(f,st(at(u/2-n,-d+n),-t.angle)),v=it(f,st(at(-u/2+n,-n),-t.angle)),w=it(f,st(at(u/2-n,-n),-t.angle));return $n(t,e,h,x,b,w,g,v,m,y,a,i,o,r,s,c,p,l,_)},$n=function(t,e,n,a,i,o,r,s,c,p,l,_,u,d,f,h,g,m,b){var y=[n.x-e,n.y-e,n.x+e,n.y+e],x=[r.x-e,r.y-e,r.x+e,r.y+e],v=[c.x-e,c.y-e,c.x+e,c.y+e],w=[i.x-e,i.y-e,i.x+e,i.y+e],k=[p.x-e,p.y-e,p.x+e,p.y+e],I=[a.x-e,a.y-e,a.x+e,a.y+e],S=[s.x-e,s.y-e,s.x+e,s.y+e],j=[o.x-e,o.y-e,o.x+e,o.y+e];return l&&(n&&(_=Qn(l,y)),r&&(h=Qn(l,x)),c&&(m=Qn(l,v)),i&&(d=Qn(l,w)),p&&(b=Qn(l,k)),a&&(u=Qn(l,I)),s&&(g=Qn(l,S)),o&&(f=Qn(l,j))),{up:_,down:h,left:m,right:d,upleft:b,upright:u,downleft:g,downright:f}},zn=function(t){Mn=t},Fn=function(t,e,n,a,i,o,r,s,c,p){var l,_=[n,a,i,c,p];for(l=0;l<_.length;l++){var u=_[l];u&&u.brick_ref&&2==u.brick_ref.property&&(u=null,_[l]=u)}if(r&&r.brick_ref&&2==r.brick_ref.property){var d=Math.min(15,r.brick_ref.image.height/3);t.speed.y>=0&&t.position.y<r.y+e+1+d||(s&&s==r&&(s=null),o&&o==r&&(o=null),r=null)}return{up:_[0],upright:_[1],right:_[2],left:_[3],upleft:_[4],downright:o,down:r,downleft:s}},Vn=function(t,e,n){var a,i,o,r,s,c,p,l,_,u,d,f=at(0,0),h=z(),m=t.position,b=function(t,e,n,a,i,o,r,s,c,p){var l,_,u,d=Gn(t).width,f=Gn(t).height,h=!(Math.abs(t.angle)<g.Ib||Math.abs(t.angle-g.PI/2)<g.Ib||Math.abs(t.angle-g.PI)<g.Ib||Math.abs(t.angle-3*g.PI/2)<g.Ib),m=t.position;return h?(l=1,_=.7,u=.25):(l=.7,_=.5,u=.25),{up:it(m,st(at(0,-f*l+e),-t.angle)),down:it(m,st(at(0,2),-t.angle)),left:it(m,st(at(-d*u+e,-f*_),-t.angle)),right:it(m,st(at(d*u-e,-f*_),-t.angle)),upleft:it(m,st(at(-d*u+e,-f*l+e),-t.angle)),upright:it(m,st(at(d*u-e,-f*l+e),-t.angle)),downleft:it(m,st(at(-d*u+e,2),-t.angle)),downright:it(m,st(at(d*u-e,2),-t.angle))}}(t,-2);b=function(t,e,n,a,i,o,r,s,c,p,l,_,u,d,f,h,g,m){return $n(t,2,n,a,i,o,r,s,c,p,e,l,_,u,d,f,h,g,m)}(t,e,a=b.up,b.upright,i=b.right,b.downright,b.down,b.downleft,o=b.left,b.upleft,r,s,c,p,l,_,u,d),r=b.up,s=b.upright,c=b.right,p=b.downright,l=b.down,_=b.downleft,u=b.left,d=b.upleft;var y=Fn(t,-2,r,s,c,p,l,_,u,d);return r=y.up,s=y.upright,c=y.right,u=y.left,d=y.upleft,l=y.down,_=y.downleft,p=y.downright,function(t,e){var n=z();if(null!=t.carried_by){var a=t.carried_by;e&&0==e.brick_ref.angle&&parseInt(a.speed.y,10)>=5?(t.position=at(t.carried_by.position.x,t.carried_by.position.y),t.carried_by.carrying=null,t.carried_by=null):(t.speed=at(0,0),t.mirror=a.mirror,t.angle=0,t.position=ot(it(a.position,rt(a.speed,n)),t.carry_offset))}}(t,l),null!=t.carried_by?at(0,0):(function(t,e,n,a,i,o){o&&o.brick_ref.angle%90==0&&(t.speed.x>g.Ib||a.x>o.x)&&(t.speed.x=0,t.position.x=o.x+(e.x-a.x)),i&&i.brick_ref.angle%90==0&&(t.speed.x<-g.Ib||n.x<i.x+i.brick_ref.image.width)&&(t.speed.x=0,t.position.x=i.x+i.brick_ref.image.width+(e.x-n.x))}(t,m,o,i,u,c),l?(t.is_jumping=!1,t.ignore_horizontal=!1,function(t,e,n,a,i){var o=a.brick_ref.angle;!we(t.input,5)||we(t.input,2)||i||(t.angle=0,t.is_jumping=!0,0==o?t.speed.y=-t.jump_strength:o>0&&o<90?(t.speed.x=Math.min(t.speed.x,-.7*t.jump_strength),t.speed.y=-.7*t.jump_strength):90==o?(actor.move(t,at(-40,0)),t.speed.x=Math.min(t.speed.x,-t.jump_strength),t.speed.y=-t.jump_strength/2):o>90&&o<180?(actor.move(t,at(0,40)),t.speed.x=Math.min(t.speed.x,-.7*t.jump_strength),t.speed.y=t.jump_strength):180==o?(actor.move(t,at(0,40)),t.speed.x*=-1,t.speed.y=t.jump_strength):o>180&&o<270?(actor.move(t,at(0,40)),t.speed.x=Math.max(t.speed.x,.7*t.jump_strength),t.speed.y=t.jump_strength):270==o?(actor.move(t,at(40,0)),t.speed.x=Math.max(t.speed.x,t.jump_strength),t.speed.y=-t.jump_strength/2):o>270&&o<360&&(t.speed.x=Math.max(t.speed.x,.7*t.jump_strength),t.speed.y=-.7*t.jump_strength))}(t,0,0,l,r)):t.angle=0,f.y=Math.abs(t.speed.y)>g.Ib?t.speed.y*h+1*n*.5*(h*h):0,t.speed.y=Math.min(t.speed.y+1*n*h,480),function(t,e,n,a){a&&a.brick_ref.angle%90==0&&t.speed.y<-g.Ib&&(t.position.y=a.y+a.brick_ref.image.height+(e.y-n.y),t.speed.y=10)}(t,m,a,r),function(t,e,n,a,i,o,r,s,c){var p;if(z(),s&&!t.is_jumping)if(p=s.brick_ref.angle,t.speed.y=a.y=0,t.angle=p*g.PI/180,0==p)t.position.y=i.y+e;else if(p>0&&p<90)i.y=s.y+s.brick_ref.image.height-(t.position.x-s.x)*Math.tan(t.angle),t.position.y=i.y+e,t.mirror,g.eI;else if(90==p){if(Math.abs(t.speed.x)>5){var l=c?c.brick_ref.angle:-1;c&&l>=p&&l<p+90?(i.y=s.x,t.position.x=i.y+e):(t.angle=0,Cn(t,at(-13,0)),t.is_jumping=!0,t.speed=at(0,-.7*Math.abs(t.speed.x)))}else t.angle=0,Cn(t,at(-10,0)),t.is_jumping=!0,t.ignore_horizontal=!1;t.mirror,g.eI}else if(p>90&&p<180)Math.abs(t.speed.x)>5?(i.y=s.y-(t.position.x-s.x)*Math.tan(t.angle),t.position.y=i.y-e):(t.angle=0,Cn(t,at(0,30)),t.is_jumping=!0);else if(180==p)t.speed.x>5&&!(t.mirror&g.eI)||t.speed.x<-5&&t.mirror&g.eI?(i.y=s.y+s.brick_ref.image.height,t.position.y=i.y-e):(t.angle=0,Cn(t,at(0,40)),t.is_jumping=!0,t.speed.x=0);else if(p>180&&p<270)Math.abs(t.speed.x)>5?(i.y=s.y+s.brick_ref.image.height-(t.position.x-s.x)*Math.tan(t.angle),t.position.y=i.y-e):(t.angle=0,Cn(t,at(0,30)),t.is_jumping=!0);else if(270==p){if(Math.abs(t.speed.x)>5){var _=r?r.brick_ref.angle:-1;r&&_>p-90&&_<=p?(i.y=s.x+s.brick_ref.image.width,t.position.x=i.y-e):(t.angle=0,Cn(t,at(13,0)),t.is_jumping=!0,t.speed=at(0,-.7*Math.abs(t.speed.x)))}else t.angle=0,Cn(t,at(10,0)),t.is_jumping=!0,t.ignore_horizontal=!1;t.mirror,g.eI}else p>270&&p<360&&(i.y=s.y-(t.position.x-s.x)*Math.tan(t.angle),t.position.y=i.y+e,t.mirror,g.eI)}(t,-2,0,f,m,0,_,l,p),f.x=Math.abs(t.speed.x)>g.Ib?t.speed.x*h+1*t.acceleration*.5*(h*h):0,function(t,e,n){var a=z();if(we(t.input,4)&&!we(t.input,3))t.ignore_horizontal||we(t.input,2)||(t.speed.x=Math.max(t.speed.x-1*t.acceleration*a,-t.maxspeed),t.mirror=g.eI);else if(we(t.input,3)&&!we(t.input,4))t.ignore_horizontal||we(t.input,2)||(t.speed.x=Math.min(t.speed.x+1*t.acceleration*a,t.maxspeed),t.mirror=IF_NONE);else if(n){var i=0,o=n.brick_ref.angle;o%90==0?i=90==o&&t.mirror&g.eI&&t.speed.x<0||270==o&&!(t.mirror&g.eI)&&t.speed.x>0?t.speed.x>g.Ib?1:-t.speed.x>g.Ib?-1:0:t.speed.x>g.Ib?-1:-t.speed.x>g.Ib?1:0:(o>90&&o<180||o>180&&o<270)&&(i=t.speed.x>g.Ib?-1:-t.speed.x>g.Ib?1:0),t.speed.x+=1*i*t.acceleration*a}}(t,0,l),Math.abs(t.speed.x)<g.Ib&&(t.speed.x=f.x=0),f)},qn=function(t){var e=z(),n=at(0,0);return t.input?(we(t.input,3)&&!we(t.input,4)&&(t.speed.x=Math.min(t.speed.x+t.acceleration*e,t.maxspeed)),we(t.input,4)&&!we(t.input,3)&&(t.speed.x=Math.max(t.speed.x-t.acceleration*e,-t.maxspeed)),!we(t.input,4)&&!we(t.input,3)&&Math.abs(t.speed.x)>g.Ib&&(t.speed.x>0?t.speed.x=Math.max(t.speed.x-t.acceleration*e,0):t.speed.x=Math.min(t.speed.x+t.acceleration*e,0)),we(t.input,2)&&!we(t.input,1)&&(t.speed.y=Math.min(t.speed.y+t.acceleration*e,t.maxspeed)),we(t.input,1)&&!we(t.input,2)&&(t.speed.y=Math.max(t.speed.y-t.acceleration*e,-t.maxspeed)),!we(t.input,1)&&!we(t.input,2)&&Math.abs(t.speed.y)>g.Ib&&(t.speed.y>0?t.speed.y=Math.max(t.speed.y-t.acceleration*e,0):t.speed.y=Math.min(t.speed.y+t.acceleration*e,0))):t.speed=at(0,0),n.x=Math.abs(t.speed.x)>g.Ib?t.speed.x*e+.5*t.acceleration*e*e:0,n.y=0,t.speed.x=n.x,t.speed.y=n.y,n},Qn=function(t,e){var n,a,i,o,r,s,c,p=null,l=!1;for(n=t;n&&!l;n=n.next)if(n.data){if(0==n.data.brick_ref.property||!n.data.enabled)continue;if(2==n.data.brick_ref.property&&p&&1==p.brick_ref.property)continue;if(1==n.data.brick_ref.behavior&&p&&1!=p.brick_ref.behavior&&n.data.y>=p.y)continue;if(Tn&&0==n.data.brick_ref.angle)continue;if(Pn&&180==n.data.brick_ref.angle)continue;if(Dn&&n.data.brick_ref.angle>0&&n.data.brick_ref.angle<180)continue;if(On&&n.data.brick_ref.angle>180&&n.data.brick_ref.angle<360)continue;var _=[n.data.x,n.data.y,n.data.x+n.data.brick_ref.image.width,n.data.y+n.data.brick_ref.image.height];if(Z(e,_))if(1!=n.data.brick_ref.behavior&&p&&1==p.brick_ref.behavior&&n.data.y<=p.y)p=n.data;else if(1==n.data.brick_ref.property&&p&&2==p.brick_ref.property)p=n.data;else if(2==n.data.brick_ref.property&&p&&2==p.brick_ref.property)n.data.y>p.y&&(p=n.data);else if(n.data.brick_ref.angle%90==0)p?Mn?p.brick_ref.angle%180!=0&&(p=n.data):p.brick_ref.angle%180==0&&(p=n.data):p=n.data;else for(a=n.data.brick_ref.angle,s=Math.tan(a*g.PI/180),o=e[0];o<=e[2]&&!l;o++)for(r=e[1];r<=e[3]&&!l;r++){switch(i=!1,parseInt(a/90,10)%4){case 0:c=_[3]+s*(_[0]-o),i=_[0]<=o&&o<=_[2]&&c<=r&&r<=_[3];break;case 1:c=_[3]-s*(_[2]-o),i=_[0]<=o&&o<=_[2]&&_[1]<=r&&r<=c;break;case 2:c=_[3]-s*(_[0]-o),i=_[0]<=o&&o<=_[2]&&_[1]<=r&&r<=c;break;case 3:c=_[3]+s*(_[2]-o),i=_[0]<=o&&o<=_[2]&&c<=r&&r<=_[3]}i&&(p=n.data,l=!0)}}return p},Kn=function(t,e,n){var a,i,o,r,s,c,p,l,_;return o=-e.angle,a=Gn(e).width,i=Gn(e).height,l=e.hot_spot,_=e.position,r=ot(at(0,0),l),s=ot(at(a,0),l),c=ot(at(a,i),l),p=ot(at(0,i),l),n[0]=it(_,st(r,o)),n[1]=it(_,st(s,o)),n[2]=it(_,st(c,o)),n[3]=it(_,st(p,o)),n},Jn=function(t,e){return t.translate(e,0),t.scale(-1,1),t.translate(-e,0),t},Zn=[],ta=function(t){var e,n={};for(n.type=J(t,0,9),n.text=null,n.width=0,n.visible=!0,n.hspace=n.vspace=1,n.value=[],n.position=at(0,0),e=0;e<5;e++)n.value[e]=0;return n},ea=function(t,e){if(!t)return!1;for(var n,a=arguments.length,i=new Array(a>2?a-2:0),o=2;o<a;o++)i[o-2]=arguments[o];for(n=0;n<i.length;n++)i[n]=""+i[n];var r=(e=""+e).match(/\$[A-Z_\d]\w+/g);if(r)for(n=0;n<r.length;n++){var s=r[n].slice(1),c=Ne(s);c&&(e=e.replace("$"+s,c))}if(r=e.match(/\%[s]+/g))for(n=0;n<r.length;n++)if(i[n]){var p=i[n].match(/\$[A-Z_\d]\w+/g);p&&(i[n]=p[0].slice(1)),e=e.replace("%s",Ne(i[n]))}if(r=e.match(/\%[d]+/g))for(n=0;n<r.length;n++)i[n]&&(e=e.replace("%d",""+i[n]));return t.text=""+e,t},na=function(t){return t.text?t.text:""},aa=function(t){return ra(t)},ia=function(t,e){t.width=Math.max(0,e)},oa=function(t,e){var n,a,i,o,r,s=0,c=0,p=[],l=0,_=0;p[_++]={r:!1,g:0,b:0};var u=ra(t);if(n=u.x,a=u.y,t&&t.visible&&t.text)for(l=0;l<t.text.length;l++){if(i=t.text[l],r=!1,q(t.text[l-1])){var d=void 0,f=!1,h=0,g=t.text.slice(l),m=(g=(g=g.replace("(","")).replace(")","")).split(" ")[0];for(d=0;d<m.length;d++)"<"==m[d]&&(f=!0),f||h++,">"==m[d]&&(f=!1);r=t.width>0&&s+(n+t.hspace)*h-t.hspace>t.width}if("<"==i){var b=t.text.slice(l,l+7);if("<color="==b){var y,x,v;l+=7;var w=t.text.slice(l,l+6);y=ca(w.slice(0,2)),x=ca(w.slice(2,4)),v=ca(w.slice(4,6)),p[_++]={r:y,g:x,b:v},l+=7,i=t.text[l]}"</color"==b&&(l+=8,i=t.text[l],_>=2&&_--)}r&&(s=0,c+=a+t.vspace),"\n"!=i?(o=Zn[t.type].ch[i])?(s+=o.width,q(t.text[l-1]),sa(St(),o,parseInt(t.position.x+s-(e.x-240),10),parseInt(t.position.y+c-(e.y-135.5),10),p[_-1].r,p[_-1].g,p[_-1].b)):s+=n+t.hspace:(s=0,c+=a+t.vspace)}},ra=function(t){var e,n;if(t)for(e=0;e<256;e++)if(Zn[t.type]&&null!=(n=Zn[t.type].ch[e]))return at(n.width,n.height);return at(16,16)},sa=function(t,e,n,a,i,o,r){var s=e.data;t.drawImage(s,e.sx,e.sy,e.swidth,e.sheight,n,a-2,1*e.width,1*e.height)},ca=function(t){return(t=t.toLowerCase())>="0"&&t<="9"?t-"0":t>="a"&&t<="f"?t-"a"+10:255},pa=[],la=[],_a=-1,ua=function(){var t;for(Yt=sn(rn("SD_CONFIRMBOX",0),0),$t=at((lt-Yt.width)/2,_t),Jt=xe(),Ft=Ln(),Ft=Bn(Ft,rn("SD_TITLEFOOT",0)),zt=ta(8),ea(zt,Vt),ia(zt,164),t=0;t<qt;t++)pa[t]=[],pa[t][0]=ta(8),pa[t][1]=ta(8),ea(pa[t][0],la[t]),ea(pa[t][1],"<color=ffff00>%s</color>",la[t]);_a=0,Qt=!0,Kt=!1},da=function(){var t,e=z();if(Qt&&($t.y<=(_t-Yt.height)/2?Qt=!1:$t.y-=1355*e),Kt){if($t.y>=_t)return Kt=!1,void Be();$t.y+=1355*e}for(Ft.position=at($t.x+_a*Yt.width/qt+10,$t.y+.75*Yt.height-1),zt.position=at($t.x+10,$t.y+10),t=0;t<qt;t++)pa[t][0].position=at($t.x+t*Yt.width/qt+25,$t.y+.75*Yt.height),pa[t][1].position=pa[t][0].position;Qt||Kt||(ke(Jt,4)?(C(We("choose")),_a=((_a-1)%qt+qt)%qt):ke(Jt,3)?(C(We("choose")),_a=(_a+1)%qt):(ke(Jt,5)||ke(Jt,7))&&(C(We("select")),Kt=!0))},fa=function(){var t,e,n=at(240,135.5);for(wt(),St().drawImage(Yt.data,Yt.sx,Yt.sy,Yt.swidth,Yt.sheight,$t.x,$t.y,Yt.swidth,Yt.sheight),oa(zt,n),t=0;t<qt;t++)e=t==_a?1:0,oa(pa[t][e],n);An(Ft,n)},ha=function(){Rn(Ft),ve(Jt),tn(void 0)},ga=function(t,e,n){_a=-1,Vt=t,la[0]=e,n?(la[1]=n,qt=2):qt=1},ma=function(){if(-1!=_a){var t=_a+1;return _a=-1,t}return 0},ba=function(t){return new Promise((function(e,n){E("background_load('%s')"),I(t).then(Ea).then((function(t){e(t)}))}))},ya=function(t){return E("background_unload()"),null},xa=function(t){if(!t)return!1;var e,n;for(e=0;e<t.length;e++)(n=t[e]).strategy&&n.strategy.update&&n.strategy.update(n.strategy)},va=function(t,e){ka(t,e,!1)},wa=function(t,e){ka(t,e,!0)},ka=function(t,e,n){if(t){var a,i,o=at(240,135.5),r=ot(e,o);for(a=0;a<t.length;a++)i=t[a],(!n&&i.zindex<=.5||n&&i.zindex>.5)&&(i.actor.position.x+=r.x*i.actor.speed.x,i.actor.position.y+=r.y*i.actor.speed.y,Nn(i.actor,o,i.repeat_x,i.repeat_y),i.actor.position.y-=r.y*i.actor.speed.y,i.actor.position.x-=r.x*i.actor.speed.x)}},Ia=function(t){},Sa=function(t){var e=t,n=t.background,a=z();n.actor.position.x+=e.speed_x*a,n.actor.position.y+=e.speed_y*a},ja=function(t){var e,n,a,i=t,o=t.background,r=z();e=i.timer+=r,n=Math.sin(i.angularspeed_x*e+i.initialphase_x),a=Math.cos(i.angularspeed_y*e+i.initialphase_y),o.actor.position.x+=-i.angularspeed_x*i.amplitude_x*n*r,o.actor.position.y+=i.angularspeed_y*i.amplitude_y*a*r},Ea=function(t){var e=t.bg;return Promise.all(e.map(Ma))},Ma=function(t,e){return new Promise((function(e,n){var a,i=function(){var t={};return t.actor=Ln(),t.data=null,t.strategy=null,t.repeat_x=!1,t.repeat_y=!1,t.zindex=0,t}();switch(i.actor.spawn_point.x=t.initial_position.xpos,i.actor.spawn_point.y=t.initial_position.ypos,i.actor.position=at(i.actor.spawn_point.x,i.actor.spawn_point.y),i.actor.speed.x=t.scroll_speed.xspeed,i.actor.speed.y=t.scroll_speed.yspeed,t.behavior&&Q(t.behavior)?t.behavior[0]:t.behavior){case"DEFAULT":i.strategy&&(i.strategy=(i.strategy,null)),i.strategy=((a={}).background=i,a.update=Ia,a);break;case"LINEAR":i.strategy&&(i.strategy=(i.strategy,null)),i.strategy=function(t,e,n){var a={},i=a;return i.background=t,i.update=Sa,a.speed_x=e,a.speed_y=n,i}(i,t.behavior[1],t.behavior[2]);break;case"CIRCULAR":i.strategy&&(i.strategy=(i.strategy,null)),i.strategy=function(t,e,n,a,i,o,r){var s={},c=s;return c.background=t,c.update=ja,s.timer=0,s.amplitude_x=e,s.amplitude_y=n,s.angularspeed_x=2*g.PI*a,s.angularspeed_y=2*g.PI*i,s.initialphase_x=o*g.PI/180,s.initialphase_y=r*g.PI/180,c}(i,t.behavior[1],t.behavior[2],t.behavior[3],t.behavior[4],t.behavior[5],t.behavior[6])}i.repeat_x=t.repeat_x,i.repeat_y=t.repeat_y,t.zindex&&(i.zindex=t.zindex),cn(t.sprite).then((function(t){i.data=t,i.actor.animation=t,i.actor.animation.data=[0],i.actor.image=i.actor.animation.frame_data[0],e(i)}))}))},Oa=["<color=ffff00>$CREDITS_ENGINE</color>\n\n","<color=ffff00>$CREDITS_ACTIVE</color>\n\n","Alexandre Martins:\n$CREDITS_ALEXANDRE\n\n","Di Rodrigues:\n$CREDITS_DI\n\n","Colin:\n$CREDITS_COLIN\n\n","Mateus Reis:\n$CREDITS_MATEUSREIS\n\n","Christopher Martinus:\n$CREDITS_CHRISTOPHER\n\n","Celdecea:\n$CREDITS_CELDECEA\n\n","Christian Zigotzky:\n$CREDITS_XENO\n\n","Joepotato28:\n$CREDITS_JOE\n\n","Arthur Blot:\n$CREDITS_ARTHURBLOT\n\n","Reimund Renner:\n$CREDITS_REIMUND\n\n","Szymon Weihs:\n$CREDITS_SZYMON\n\n","Tomires:\n$CREDITS_TOMIRES\n\n","Sascha de waal:\n$CREDITS_SSDW\n\n","Francesco Sciusco:\n$CREDITS_FRANCESCO\n\n","<color=ffff00>$CREDITS_THANKS</color>\n\n","SourceForge.net\n","allegro.cc\n","OpenGameArt.org\n","GagaGames.com.br\n","Rsonist88\n","PlayDeb.net\n\n","<color=ffff00>$CREDITS_RETIRED</color>\n\n","Neoblast:\n$CREDITS_NEOBLAST\n\n","Bastian von Halem:\n$CREDITS_BASTIAN\n\n","Lainz:\n$CREDITS_LAINZ\n\n","Jogait:\n$CREDITS_JOGAIT\n\n"],Da=function(){te=!1,ie=xe(),ee=ta(4),console.log(ee),ea(ee,Ne("CREDITS_TITLE")),ee.position.x=140,ee.position.y=5,ae=ta(8),ea(ae,Ne("CREDITS_KEY")),ae.position.x=10,ae.position.y=_t-aa(ae).y-5,ne=ta(8);for(var t=0;t<Oa.length;t++){var e=Oa[t],n=e.match(/\$[A-Z_\d]\w+/m);if(n){for(var a=0;a<n.length;a++){var i=n[a].slice(1),o=Ne(i);o&&(e=e.replace("$"+i,o))}Oa[t]=e}}Oa=Oa.join(""),ea(ne,Oa,"%s"),ia(ne,300),ne.position.x=10,ne.position.y=_t,oe=1;for(var r=na(ne),s=0;s<r.length;s++)"\n"==r[s]&&oe++;oe+=10,Zt=Ve(lt,30),re=ba("data/themes/credits.bg.json").then((function(t){re=t,console.log(re),bt(Je(0,0,0),1)})),bt(Je(0,0,0),1)},Ta=function(){var t,e=z();if(xa(re),ne.position.y-=3*aa(ne).y*e,ne.position.y<-oe*(aa(ne).y+(t=ne,at(t.hspace,t.vspace)).y)&&(ne.position.y=_t),te||vt()||(ke(ie,7)?(C(We("select")),te=!0):ke(ie,8)&&(C(We("return")),te=!0)),!A()){var n=music_load("data/music/options.mp4");T(n,g._v)}if(te){if(xt())return void Be();yt(Je(0,0,0),1)}},Pa=function(){wt();var t=at(240,135.5);va(re,t),wa(re,t),oa(ne,t),St().fillRect(0,0,Zt.width,Zt.height),St().fillRect(0,251,Zt.width,Zt.height),oa(ee,t),oa(ae,t)},La=function(){re=ya(),tn(Zt),ve(ie)},Ra=10,Aa=[],Na=function(){var t;for(se=F(),(ce=ta(8)).position=at(5,35),pe=ta(4),ea(pe,Ne("ENDOFDEMO_TITLE")),pe.position=at((lt-parseInt(aa(pe).x,10)*na(pe)).length/2,5),t=0;t<Ra;t++)Aa[t]=Ln(),Aa[t].spawn_point=Aa[t].position=at(lt*t/Ra+15,215),Bn(Aa[t],rn(t%2==1?"SD_BLUERING":"SD_RING",0));bt(Je(0,0,0),2)},Ca=function(){var t,e=F(),n=Math.max(0,(3-parseInt(e-se,10))/1e3);if(ea(ce,Ne("ENDOFDEMO_TEXT"),g.b5,g.Ip,n),e>=se+3){if(xt())return Be(),void Ue(Rh(Eh));yt(Je(0,0,0),2)}for(t=0;t<Ra;t++)Aa[t].position.y=Aa[t].spawn_point.y+10*Math.sin(g.PI*(.001*e)+2*g.PI/Ra*t)},Ga=function(){var t,e=at(240,135.5);for(wt(),t=0;t<Ra;t++)An(Aa[t],e);oa(pe,e),oa(ce,e)},Ua=function(){var t;for(t=0;t<Ra;t++)Rn(Aa[t])},Ba={is_locked:!1,position:{x:0,y:0},dest:{x:0,y:0},speed:0,region_topleft:{x:0,y:0},region_bottomright:{x:0,y:0},dest_region_topleft:{x:0,y:0},dest_region_bottomright:{x:0,y:0},region_topleft_speed:0,region_bottomright_speed:0},Ha=function(t,e){t.x<Ba.region_topleft.x&&(t.x=Ba.region_topleft.x),t.y<Ba.region_topleft.y&&(t.y=Ba.region_topleft.y),t.x>Ba.region_bottomright.x&&(t.x=Ba.region_bottomright.x),t.y>Ba.region_bottomright.y&&(t.y=Ba.region_bottomright.y),Ba.dest=t,e>g.Ib?Ba.speed=ct(ot(Ba.position,Ba.dest))/e:Ba.position=Ba.dest,Ba.position.x=parseInt(t.x,10),Ba.position.y=parseInt(t.y,10)},Xa=function(){return at(Ba.position.x,Ba.position.y)},Wa=function(t){var e=at(t.x,t.y);Ba.dest=Ba.position=e},Ya=function(){var t,e,n,a;Ba.is_locked||(t=-g._v,e=-g._v,n=g._v,a=g._v,Ba.dest_region_topleft.x=Math.max(Math.min(t,n),240),Ba.dest_region_topleft.y=Math.max(Math.min(e,a),135.5),Ba.dest_region_bottomright.x=Math.min(Math.max(t,n),pu().x-240),Ba.dest_region_bottomright.y=Math.min(Math.max(e,a),pu().y-135.5),Ba.region_topleft_speed=ct(ot(Ba.region_topleft,Ba.dest_region_topleft))/.25,Ba.region_bottomright_speed=ct(ot(Ba.region_bottomright,Ba.dest_region_bottomright))/.25)},$a=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Ln(),t.actor.maxspeed=145+K(21),t.actor.input=be(),e.is_running=!1,e.animal_id=K(12),Bn(t.actor,rn("SD_ANIMAL",0))},za=function(t){Rn(t.actor)},Fa=function(t,e,n,a,i,o){var r,s,c,p,l=t,_=t.actor,u=2*l.animal_id+(l.is_running?1:0);Se(_.input,5),_.jump_strength=1.3*(200+K(50)),_.speed.x>g.Ib?(_.speed.x=_.maxspeed,_.mirror=g.in):_.speed.x<-g.Ib&&(_.speed.x=-_.maxspeed,_.mirror=g.eI),Bn(_,rn("SD_ANIMAL",u));var d=Yn(_,2,-2,a,r,null,p,null,s,null,c,null);r=d.up,d.upright,p=d.right,d.downright,s=d.down,d.downleft,c=d.left,d.upleft;var f=Fn(_,-2,r,null,p,null,s,null,c,null);r=f.up,f.upright,p=f.right,f.downright,s=f.down,f.downleft,c=f.left,f.upleft,s&&!l.is_running&&(l.is_running=!0,_.speed.x=(K(2)?-1:1)*_.maxspeed),c&&!r&&(_.speed.x=_.maxspeed),p&&!r&&(_.speed.x=-_.maxspeed),!l.is_running&&(s&&r||c&&p)&&(t.state=cs),Cn(_,Vn(_,a,bu()))},Va=function(t,e){An(t.actor,e)},qa=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Ln(),Za(t,ti()),Bn(t.actor,rn("SD_ENDLEVEL",0))},Qa=function(t){Rn(t.actor),Za(t,null)},Ka=function(t,e,n,a,i,o){var r=t;r.state.handle(r.state,t,e,n)},Ja=function(t,e){An(t.actor,e)},Za=function(t,e){t.state=e},ti=function(){var t={},e=t;return t.handle=ei,e.being_hit=!1,e.hit_count=0,t},ei=function(t,e,n,a){var i,o,r,s=t,c=e.actor;for(i=0;i<a;i++){var p=n[i];oi(e,p)&&!s.being_hit&&(s.being_hit=!0,Bn(c,rn("SD_ENDLEVEL",1)),C(We("boss hit")),p.bounce(p),p.actor.speed.x*=-.5,++s.hit_count>=3&&Za(e,(o=void 0,r=void 0,r=o={},o.handle=ni,r.explode_timer=0,r.break_timer=0,o)))}Hn(c)&&s.being_hit&&(Bn(c,rn("SD_ENDLEVEL",0)),s.being_hit=!1)},ni=function(t,e,n,a){var i,o=t,r=e.actor,s=z();if(o.explode_timer+=s,o.break_timer+=s,o.explode_timer>=.1){var c=at(r.position.x-r.hot_spot.x+K(Gn(r).width),r.position.y-r.hot_spot.y+K(Gn(r).height/2));xu(us,c),C(We("explode")),o.explode_timer=0}o.break_timer>=2&&Za(e,((i={}).handle=ai,i))},ai=function(t,e,n,a){for(var i,o=e.actor,r=0;r<20;r++){var s=at(o.position.x-o.hot_spot.x+K(Gn(o).width),o.position.y-o.hot_spot.y+K(Gn(o).height/2));Iu(s)}uu(o),Bn(o,rn("SD_ENDLEVEL",2)),Za(e,((i={}).handle=ii,i))},ii=function(t,e,n,a){},oi=function(t,e){if(t&&e){var n=[],a=[],i=t.actor,o=e.actor;return n[0]=o.position.x-o.hot_spot.x,n[1]=o.position.y-o.hot_spot.y,n[2]=n[0]+Gn(o).width,n[3]=n[1]+Gn(o).height,a[0]=i.position.x-i.hot_spot.x+5,a[1]=i.position.y-i.hot_spot.y,a[2]=a[0]+Gn(i).width-10,a[3]=a[1]+Gn(i).height/2,e.attacking(e)&&Z(n,a)&&Wn(i,o)}},ri=0,si=0,ci=function(t){var e,n={};switch(E("player_create(%d)"),t){case 0:n.name="Surge";break;case 1:n.name="Neon";break;case 2:n.name="Charge";break;default:n.name="Unknown"}for(n.type=t,n.actor=Ln(),n.disable_movement=!1,n.in_locked_area=!1,n.at_some_border=!1,n.attacking=hi,n.bounce=fi,n.spin=n.spin_dash=n.braking=n.flying=n.climbing=n.landing=n.spring=!1,n.is_fire_jumping=!1,n.getting_hit=n.dying=n.dead=n.blinking=!1,n.on_moveable_platform=!1,n.lock_accel=0,n.flight_timer=n.blink_timer=n.death_timer=0,n.disable_jump_for=0,n.glasses=Ln(),n.got_glasses=!0,n.shield=Ln(),n.shield_type=0,n.invincible=!1,n.invtimer=0,n.invstar=[],e=0;e<5;e++)n.invstar[e]=Ln(),n.invstar[e]=Bn(n.invstar[e],rn("SD_INVSTAR",0));switch(n.got_speedshoes=!1,n.speedshoes_timer=0,n.disable_wall=0,n.entering_loop=!1,n.at_loopfloortop=!1,n.bring_to_back=!1,n.type){case 0:n.actor.acceleration=250,n.actor.maxspeed=700,n.actor.jump_strength=450,n.actor.input=xe(),n.actor=Bn(n.actor,rn(wi(0),0));break;case 1:n.actor.acceleration=200,n.actor.maxspeed=600,n.actor.jump_strength=360,n.actor.input=xe(),n.actor=Bn(n.actor,rn(wi(1),0));break;case 2:n.actor.acceleration=200,n.actor.maxspeed=600,n.actor.jump_strength=360,n.actor.input=xe(),n.actor=Bn(n.actor,rn(wi(2),0))}return _e=1,le=0,E("player_create() ok"),n},pi=function(t,e,n){var a=t.actor;return t.blinking&&(t.blink_timer+=z(),a.visible=F()%250<125,t.blink_timer>=4&&(t.getting_hit=t.blinking=!1,a.visible=!0)),t.disable_movement?t.spin?t.actor=Bn(t.actor,rn(wi(t.type),3)):t.spring&&(t.actor=Bn(t.actor,rn(wi(t.type),13))):Cn(a,_i(t,e,n,bu())),t},li=function(t,e){if(t){var n=t.actor;if(n){var a,i,o=n.hot_spot,r=n.position,s=at(0,0),c=at(0,0),p=[],l=n.angle;if(t.invincible){var _=rn("SD_INVSTAR",0).frame_count;for(t.invtimer+=z(),a=0;a<5;a++)p[a]=720*F()*.001+72*(a+1),c.x=30*Math.cos(p[a]*g.PI/180),c.y=(F()+400*a)%2e3/40,c=st(c,l),t.invstar[a].position.x=n.position.x+c.x,t.invstar[a].position.y=n.position.y-c.y+5,Un(t.invstar[a],K(_))}for(t.got_glasses&&ki(t),0!=t.shield_type&&Si(t),t.type,a=0;a<5&&t.invincible;a++)p[a]%360>=180&&An(t.invstar[a],e);for(i=n.angle,n.angle=n.is_jumping||t.spin?i:et(i),An(n,e),n.angle=i,t.got_glasses&&An(t.glasses,e),0!=t.shield_type&&An(t.shield,e),a=0;a<5&&t.invincible;a++)p[a]%360<180&&An(t.invstar[a],e);switch(t.type){case 0:case 2:default:break;case 1:n.is_jumping&&n.animation==rn(wi(1),3)&&(n.position=at(r.x,r.y),n.angle=l,n.hot_spot=o,0!=t.shield_type&&(t.shield.angle=0,t.shield.hot_spot=s))}}}},_i=function(t,e,n,a){var i,o,r,s,c,p,l,_,u,d,f,h,m,b,y,x,v,w,k,I,S,j,E,M,O=t.actor,D=wi(t.type),T=z(),P=480,L=0,R=1,A=O.maxspeed,N=at(0,0),G=!1,B=t.actor.animation==rn(D,1),H=!1,X=!1,W=!1,Y=null,$=Gn(O).width,F=Gn(O).height,V=!(Math.abs(O.angle)<g.Ib||Math.abs(O.angle-g.PI/2)<g.Ib||Math.abs(O.angle-g.PI)<g.Ib||Math.abs(O.angle-3*g.PI/2)<g.Ib),q=-2,Q=0,tt=0,et=0,nt=O.position;switch(t.type){case 0:V?(Q=1,tt=.8,et=.5):(Q=.7,tt=.5,et=.4);break;case 1:case 2:V?(Q=1,tt=.7,et=.25):(Q=.7,tt=.5,et=.25)}if(m=it(nt,st(at(0,-F*Q+q),-O.angle)),v=it(nt,st(at(0,2),-O.angle)),k=it(nt,st(at(-$*et+q,-F*tt),-O.angle)),y=it(nt,st(at($*et-q,-F*tt),-O.angle)),I=it(nt,st(at(-$*et+q,-F*Q+q),-O.angle)),b=it(nt,st(at($*et-q,-F*Q+q),-O.angle)),w=it(nt,st(at(-$*et+q,2),-O.angle)),x=it(nt,st(at($*et-q,2),-O.angle)),1==t.type&&O.carrying&&Math.abs(O.angle)<g.Ib){var pt=Gn(O.carrying).height,lt=O.speed.y>5?.7*pt:0;w.y+=lt,x.y+=lt,v.y+=lt,k.y+=pt*tt+K(pt)-.5*pt,y.y=k.y}S=8&t.disable_wall,j=2&t.disable_wall,E=4&t.disable_wall,M=1&t.disable_wall,On=S,Dn=j,Tn=E,Pn=M,zn(!(4&t.disable_wall));var _t=$n(O,2,m,b,y,x,v,w,k,I,n,s,_,p,u,c,d,l,f);if(s=_t.up,c=_t.down,l=_t.left,p=_t.right,f=_t.upleft,_=_t.upright,d=_t.downleft,u=_t.downright,zn(!0),t.dying)return O.speed.x=0,O.speed.y=Math.min(P,O.speed.y+a*T),O.mirror=null,O.angle=0,O.visible=!0,t.blinking=!1,t.death_timer+=T,t.dead=t.death_timer>=2.5,O=Bn(O,rn(D,8)),at(0,O.speed.y*T+.5*a*T*T);if(t.dead)return at(0,0);var ut=Fn(O,q,s,_,p,u,c,d,l,f);switch(s=ut.up,_=ut.upright,p=ut.right,l=ut.left,f=ut.upleft,c=ut.down,d=ut.downleft,u=ut.downright,t.type){case 0:O.carry_offset=at(O.mirror&g.eI?7:-9,-40);break;case 1:case 2:O.carry_offset=at(O.mirror&g.eI?7:-7,-42)}if(null!=O.carried_by){var dt,ft=null,ht=0,gt=0,mt=O.carried_by;for(dt=0;dt<e.length;dt++)if(e[dt]==t){gt=dt;break}for(dt=0;dt<e.length;dt++)if(e[dt].actor==mt){ft=e[dt],ht=dt,t.disable_wall=ft.disable_wall,t.entering_loop=ft.entering_loop,t.at_loopfloortop=ft.at_loopfloortop,t.bring_to_back=ft.bring_to_back;break}if(ft&&(1==ft.type&&!ft.flying||ft.getting_hit||ft.dying||ft.dead))O.position=at(O.carried_by.position.x,O.carried_by.position.y),O.carried_by.carrying=null,O.carried_by=null;else{if(!(c&&0==c.brick_ref.angle&&parseInt(mt.speed.y,10)>=5||t.getting_hit||t.dying||t.dead)){var bt=gt<ht?rt(mt.speed,T):at(0,0);return O.speed=at(0,0),O.mirror=mt.mirror,O.angle=0,(O=Bn(O,rn(D,25))).position=ot(it(mt.position,bt),O.carry_offset),at(0,0)}O.position=at(O.carried_by.position.x,O.carried_by.position.y),O.carried_by.carrying=null,O.carried_by=null}}if(t.entering_loop=!1,t.got_speedshoes&&(t.speedshoes_timer>23?t.got_speedshoes=!1:(A*=1.5,t.speedshoes_timer+=T)),ji(t)&&O.is_jumping&&(t.disable_wall&=-5),t.spring&&(c&&parseInt(O.speed.y,10)>=0||t.flying||t.climbing)&&(t.spring=!1),i=(p&&we(O.input,3)||l&&we(O.input,4))&&c,t.on_moveable_platform=ct(ku(c,O))>g.Ib,(r=c&&(O.angle>0&&O.angle<g.PI/2&&O.speed.x>0||O.angle>3*g.PI/2&&O.angle<2*g.PI&&O.speed.x<0))&&(f||_)||Math.abs(O.angle)<g.Ib||Math.abs(O.angle-g.PI)<g.Ib){if(p&&p.brick_ref.angle%90==0&&(O.speed.x>g.Ib||y.x>p.x)&&(!r||r&&90!=p.brick_ref.angle)&&(O.speed.x=0,O.position.x=p.x+(nt.x-y.x),!O.is_jumping&&!t.flying&&!t.climbing&&Math.abs(O.speed.y)<g.Ib&&(Y=rn(D,i?14:0)),r))return at(-5,0);if(l&&l.brick_ref.angle%90==0&&(O.speed.x<-g.Ib||k.x<l.x+l.brick_ref.image.width)&&(!r||r&&270!=l.brick_ref.angle)&&(O.speed.x=0,O.position.x=l.x+l.brick_ref.image.width+(nt.x-k.x),!O.is_jumping&&!t.flying&&!t.climbing&&Math.abs(O.speed.y)<g.Ib&&(Y=rn(D,i?14:0)),r))return at(5,0);O.position.x<=O.hot_spot.x&&(t.spin=!1,X=!0,O.position.x<O.hot_spot.x&&(O.speed.x=0,O.position.x=O.hot_spot.x,c&&(i=!0,Y=rn(D,1)))),O.position.x>=pu().x-(Gn(O).width-O.hot_spot.x)&&(t.spin=!1,H=!0,O.position.x>pu().x-(Gn(O).width-O.hot_spot.x)&&(O.speed.x=0,O.position.x=pu().x-(Gn(O).width-O.hot_spot.x),c&&(i=!0,Y=rn(D,1))))}if(!t.climbing){if(c){var yt,xt,vt=c.brick_ref.angle;if(G=!0,O.ignore_horizontal=!1,t.is_fire_jumping=!1,O.is_jumping=!1,c.brick_ref&&3==c.brick_ref.behavior&&0==c.state&&(c.state=2),Math.abs(O.speed.x)<g.Ib){if(vt%180==0&&(t.spin=!1),we(O.input,2))t.spin_dash||(Y=rn(D,4)),ke(O.input,5)&&(Y=rn(D,6),t.spin_dash=!0,C(We("charge")));else if(!i)if(we(O.input,1))B&&t.at_some_border||(Y=rn(D,5));else if(ji(t))Y=rn(D,0);else{var wt=it(nt,st(at(-8,0),-O.angle)),kt=it(nt,st(at(5,0),-O.angle)),It=at(0,0),St=$n(O,2,It,It,It,kt,It,wt,It,It,n,null,null,null,void 0,null,void 0,null,null);St.downleft&&St.downright||t.on_moveable_platform?we(O.input,4)&&(X||t.at_some_border)||we(O.input,3)&&(H||t.at_some_border)?(O.mirror=X?g.eI:g.in,Y=rn(D,1)):Y=rn(D,0):Y=rn(D,10)}if(t.spin_dash){var jt,Et,Mt,Ot,Dt=O.mirror&g.eI?1:-1;for(jt=0;jt<3;jt++)K(128),Ot=Ve(1,1),Ze(Ot,255,255,255),Et=at(Dt*(7+K(7)),2),Mt=at(Dt*(50+K(200)),-K(200)),wu(Ot,it(O.position,Et),Mt,!0);(Ie(O.input,2)||ou())&&(t.spin=!0,t.spin_dash=!1,(!(O.mirror&g.eI)||l||X)&&(O.mirror&g.eI||p||H)||(O.speed.x=(O.mirror&g.eI?-1:1)*A*1.35),C(We("release")),t.disable_jump_for=.05)}}else if(we(O.input,2)&&(t.spin||C(We("roll")),t.spin=!0),t.spin||t.braking){if(t.spin)Y=rn(D,3);else if(t.braking){var Tt,Pt,Lt,Rt=O.mirror&g.eI?1:-1;K(128),Lt=Ve(1,1),Tt=at(Rt*(10-K(21)),0),Pt=at(Rt*(50+K(200)),-K(200)),wu(Lt,it(O.position,Tt),Pt,!0),Y=rn(D,7),Math.abs(O.speed.x)<10&&(t.braking=!1)}}else{var At=.75*A,Nt=.35*A;Math.abs(O.speed.x)<At?!i&&O.speed.y>=0&&(Y=rn(D,1),O=function(t,e){return t.animation_speed_factor=Math.max(0,e),t}(O,.5+Math.abs(O.speed.x)/At*1.5)):Y=rn(D,2),Math.abs(O.speed.x)>=Nt&&(we(O.input,3)&&O.speed.x<0||we(O.input,4)&&O.speed.x>0)&&(C(We("brake")),t.braking=!0)}if(t.disable_jump_for=Math.max(t.disable_jump_for-T,0),Math.abs(O.speed.x)<g.Ib&&(t.disable_jump_for=0),yt=!t.spin_dash,we(O.input,5)&&t.disable_jump_for<=0&&!we(O.input,2)&&!s&&!t.landing&&yt&&!O.is_jumping&&(C(We("jump")),O.angle=0,O.is_jumping=!0,t.is_fire_jumping=!0,W=!0,t.spin=!1,Y=rn(D,3),0==vt?O.speed.y=1*-O.jump_strength:vt>0&&vt<90?vt>45?(O.speed.x=Math.min(O.speed.x,-.7*O.jump_strength*1),O.speed.y=-.7*O.jump_strength*1):(O.speed.x*=O.speed.x>0?.5:1,O.speed.y=1*-O.jump_strength):90==vt?(Cn(O,at(-40,0)),O.speed.x=Math.min(O.speed.x,1*-O.jump_strength),O.speed.y=-O.jump_strength/2*1):vt>90&&vt<180?(Cn(O,at(0,40)),O.speed.x=Math.min(O.speed.x,-.7*O.jump_strength*1),O.speed.y=1*O.jump_strength):180==vt?(Cn(O,at(0,40)),O.speed.x*=-1,O.speed.y=1*O.jump_strength):vt>180&&vt<270?(Cn(O,at(0,40)),O.speed.x=Math.max(O.speed.x,.7*O.jump_strength*1),O.speed.y=1*O.jump_strength):270==vt?(Cn(O,at(40,0)),O.speed.x=Math.max(O.speed.x,1*O.jump_strength),O.speed.y=-O.jump_strength/2*1):vt>270&&vt<360&&(vt<315?(O.speed.x=Math.max(O.speed.x,.7*O.jump_strength*1),O.speed.y=-.7*O.jump_strength*1):(O.speed.x*=O.speed.x<0?.5:1,O.speed.y=1*-O.jump_strength))),!O.is_jumping){var Ct;vt>0&&vt<90?(Ct=.8*Math.min(1,Math.tan(vt*g.PI/180)),Math.abs(O.speed.y)>g.Ib?O.speed.x=G&&vt<=45?O.speed.x:Math.max(-1.2*A,-1*Ct*O.speed.y):(xt=(O.mirror&g.eI?2:1)*Ct,t.braking&&vt<45?xt*=8*(O.speed.x<0?-.5:1):Math.abs(O.speed.x)<5&&(xt*=25*Math.sin(vt*g.PI/180),t.lock_accel=2),O.speed.x=Math.max(O.speed.x-700*xt*T,-1.2*A))):vt>270&&vt<360&&(Ct=.8*Math.min(1,-Math.tan(vt*g.PI/180)),Math.abs(O.speed.y)>g.Ib?O.speed.x=G&&vt>=315?O.speed.x:Math.min(1.2*A,1*Ct*O.speed.y):(xt=(O.mirror&g.eI?1:2)*Ct,t.braking&&vt>315?xt*=8*(O.speed.x>0?-.5:1):Math.abs(O.speed.x)<5&&(xt*=25*-Math.sin(vt*g.PI/180),t.lock_accel=1),O.speed.x=Math.min(O.speed.x+700*xt*T,1.2*A)))}vt%90==0&&(t.lock_accel=0),d&&u&&Math.abs(O.speed.x)<40&&d.brick_ref.angle>270&&d.brick_ref.angle<360&&u.brick_ref.angle>0&&u.brick_ref.angle<90&&(we(O.input,4)||we(O.input,3)||(O.speed.x=0))}else t.braking=!1,t.lock_accel=0,t.spin_dash&&(t.spin_dash=!1,Y=rn(D,1)),O.animation!=rn(D,0)&&O.animation!=rn(D,10)&&O.animation!=rn(D,5)||(Y=rn(D,1)),(t.spring||B||O.speed.y<0)&&(t.spin=!1),ji(t)||(O.angle=0);if(c||t.is_fire_jumping&&O.speed.y<.88*-O.jump_strength&&Ie(O.input,5)&&(O.speed.y*=.7),1==t.type&&t.flying?(R=t.flight_timer<10?.15:.8,P*=.3):R=1,N.y=Math.abs(O.speed.y)>g.Ib?O.speed.y*T+a*R*.5*(T*T):0,2==t.type&&t.flying||(O.speed.y=Math.min(O.speed.y+a*R*T,P)),o=s&&s.brick_ref.angle%90!=0&&Math.abs(O.angle)<g.Ib,s&&(s.brick_ref.angle%90==0||o)&&O.speed.y<-g.Ib&&(O.position.y=s.y+s.brick_ref.image.height+(nt.y-m.y),O.speed.y=10,1==s.brick_ref.behavior&&Math.sin(s.brick_ref.behavior_arg[3]*s.value[0])>0))return O.speed.y=100,it(N,rt(ku(s,O),T));if((h=c)&&!O.is_jumping){var Gt=h.brick_ref.angle;if(O.speed.y=N.y=0,O.angle=Gt*g.PI/180,0==Gt){var Ut=ku(c,O);nt.y=h.y,L=0,Ut.y>g.Ib?N.y+=Ut.y*T:O.position.y=nt.y+q+1}else if(Gt>0&&Gt<90)nt.y=parseInt(h.y+h.brick_ref.image.height-(O.position.x-h.x)*Math.tan(O.angle),10),O.speed.x<0&&(nt.y+=2),O.position.y=nt.y+q,O.mirror&g.eI||(L=.2);else if(90==Gt){if(Math.abs(O.speed.x)>5){var Bt=u?u.brick_ref.angle:-1;u&&Bt>=Gt&&Bt<Gt+90?t.flying||(O.position.x=h.x+q):(O.angle=0,O.is_jumping=!0,t.spin||t.flying||(Y=rn(D,1)),ji(t)||(t.flying||Cn(O,at(-13,0)),O.speed=at(0,-.9*Math.abs(O.speed.x))))}else O.angle=0,t.flying||Cn(O,at(-10,0)),O.is_jumping=!0,O.ignore_horizontal=!1;O.mirror&g.eI||(L=1.5)}else Gt>90&&Gt<180?(Math.abs(O.speed.x)>5?(nt.y=h.y-(O.position.x-h.x)*Math.tan(O.angle),O.position.y=nt.y-q):(O.angle=0,Cn(O,at(0,30)),O.is_jumping=!0),L=1.5):180==Gt?(Math.abs(O.speed.x)>5?(nt.y=h.y+h.brick_ref.image.height,O.position.y=nt.y-q,(O.speed.x>0&&!u||O.speed.x<0&&!d)&&(Cn(O,at(0,-30)),O.is_jumping=!0,O.speed.x*=-1,O.mirror=O.speed.x<0?g.eI:g.in,O.angle=0)):(O.angle=0,Cn(O,at(0,40)),O.is_jumping=!0,O.speed.x=0),L=1.2):Gt>180&&Gt<270?(Math.abs(O.speed.x)>5?(nt.y=h.y+h.brick_ref.image.height-(O.position.x-h.x)*Math.tan(O.angle),O.position.y=nt.y-q):(O.angle=0,Cn(O,at(0,30)),O.is_jumping=!0),L=1.5):270==Gt?(Math.abs(O.speed.x)>5?(Bt=d?d.brick_ref.angle:-1,d&&Bt>Gt-90&&Bt<=Gt?t.flying||(O.position.x=h.x+h.brick_ref.image.width-q):(O.angle=0,O.is_jumping=!0,t.spin||t.flying||(Y=rn(D,1)),ji(t)||(t.flying||Cn(O,at(13,0)),O.speed=at(0,-.9*Math.abs(O.speed.x))))):(O.angle=0,t.flying||Cn(O,at(10,0)),O.is_jumping=!0,O.ignore_horizontal=!1),O.mirror&g.eI&&(L=1.5)):Gt>270&&Gt<360&&(nt.y=h.y-(O.position.x-h.x)*Math.tan(O.angle),O.speed.x>0&&(nt.y+=2),O.position.y=nt.y+q,O.mirror&g.eI&&(L=.2))}if(N.x=Math.abs(O.speed.x)>g.Ib?O.speed.x*T+(1-L)*O.acceleration*.5*(T*T):0,!we(O.input,4)||we(O.input,3)||t.spin||t.braking||t.landing||t.getting_hit||1==t.lock_accel||X)if(!we(O.input,3)||we(O.input,4)||t.spin||t.braking||t.landing||t.getting_hit||2==t.lock_accel||H){if(c){var Ht,Xt=0,Wt=c.brick_ref.angle;Ht=t.spin?.65:t.braking?4.5:t.landing?.6:1,Wt%90==0?Xt=90==Wt?-1:270==Wt?1:O.speed.x>g.Ib?-1:-O.speed.x>g.Ib?1:0:(Wt>90&&Wt<180||Wt>180&&Wt<270)&&(Xt=O.speed.x>g.Ib?-1:-O.speed.x>g.Ib?1:0),O.speed.x+=Xt*Ht*O.acceleration*T}}else O.ignore_horizontal||!(O.is_jumping||t.spring||B)&&we(O.input,2)||(O.mirror=!1,L=O.speed.x<0?-1:L,O.speed.x<=1.1*A&&(O.speed.x=Math.min(O.speed.x+(1-L)*O.acceleration*T,A)));else O.ignore_horizontal||!(O.is_jumping||t.spring||B)&&we(O.input,2)||(O.mirror=g.eI,L=O.speed.x>0?-1:L,O.speed.x>=1.1*-A&&(O.speed.x=Math.max(O.speed.x-(1-L)*O.acceleration*T,-A)))}switch(t.spring&&(Y=rn(D,O.speed.y<=0?13:1),O.speed.y>0&&(t.spring=!1,O.is_jumping=!1)),t.getting_hit&&(c?t.getting_hit=!1:Y=rn(D,11)),t.type){case 0:break;case 1:if(t.flight_timer+=T,c&&90!=c.brick_ref.angle&&270!=c.brick_ref.angle&&(t.flying=!1,t.flight_timer=0),(O.is_jumping&&O.speed.y>-O.jump_strength/3&&!W&&!t.getting_hit||t.flying)&&ke(O.input,5)&&!t.getting_hit&&t.flight_timer<10&&(t.flying||(t.flight_timer=0),O.speed.y=.1*-bu(),t.flying=!0,O.is_jumping=!1,t.is_fire_jumping=!1),t.flying)if(Y=rn(D,O.carrying?16:20),O.speed.x=J(O.speed.x,-O.maxspeed/2,O.maxspeed/2),t.flight_timer>=10){var Yt=We("tired of flying");U(Yt)||C(Yt),Y=rn(D,19)}else{var $t,zt;for(ji(t)&&(O.angle=0),$t=We("flying"),U($t)||C($t),zt=0;zt<e.length&&null==O.carrying;zt++)if(e[zt]!=t&&parseInt(O.speed.y,10)<=0){var Ft=[e[zt].actor.position.x+.3*Gn(e[zt].actor).width,e[zt].actor.position.y,e[zt].actor.position.x+.7*Gn(e[zt].actor).width,e[zt].actor.position.y+.2*Gn(e[zt].actor).height],Vt=[O.position.x+.3*Gn(O).width,O.position.y+.7*Gn(O).height,O.position.x+.7*Gn(O).width,O.position.y+Gn(O).height],qt=Z(Ft,Vt),Qt=!(null!=e[zt].actor.carried_by||e[zt].dying||e[zt].dead||e[zt].climbing||e[zt].landing||e[zt].getting_hit);qt&&Qt&&!c&&(O.carrying=e[zt].actor,e[zt].actor.carried_by=O,e[zt].spin=e[zt].spin_dash=e[zt].braking=e[zt].flying=e[zt].spring=e[zt].on_moveable_platform=!1,C(We("touch the wall")))}}else O.animation==rn(D,O.carrying?16:20)&&(Y=rn(D,1));break;case 2:if((O.is_jumping&&O.speed.y>-.7*O.jump_strength||t.flying)&&ke(O.input,5)&&!c&&!t.getting_hit&&(O.speed.y=50,t.flying=!0,O.is_jumping=!1,t.is_fire_jumping=!1,O.speed.x=O.mirror&g.eI?Math.min(-100,O.speed.x):Math.max(100,O.speed.x)),t.flying){var Kt=we(O.input,4)&&O.speed.x>0||we(O.input,3)&&O.speed.x<0,Jt=c&&Math.abs(c.brick_ref.angle*g.PI/180-0)<g.Ib;if(Kt+=O.animation==rn(D,21)&&!Hn(O),Jt||O.animation==rn(D,19)||t.landing||(O.mirror&g.eI?(Y=rn(D,Kt?21:20),O.speed.x=Math.max(O.speed.x-.5*O.acceleration*T,-A/2)):(Y=rn(D,Kt?21:20),O.speed.x=Math.min(O.speed.x+.5*O.acceleration*T,A/2))),Jt)t.landing=!0,O.is_jumping=!1,Y=rn(D,19),O.speed.y=0,N.y=0,t.climbing=!1;else if(Ie(O.input,5))t.flying=!1,Y=rn(D,18);else{var Zt,te=[l,d,p,u,c];for(Zt=0;Zt<te.length;Zt++)(h=te[Zt])&&h.brick_ref.angle%90!=0&&(t.flying=!1,t.landing=!1)}Jt||s||(l&&l.brick_ref.angle%90==0||p&&p.brick_ref.angle%90==0)&&(t.climbing=!0,t.flying=!1,C(We("touch the ground")))}if(t.landing&&(Math.abs(O.speed.x)<g.Ib||!c)&&(t.flying=t.landing=!1),t.climbing){var ee=at(0,0);if(O.speed.x=N.x=0,l&&!p&&(O.mirror|=g.eI),p&&!l&&(O.mirror&=~g.eI),ee=it(ee,rt(ku(l,O),T)),((ee=it(ee,rt(ku(p,O),T))).y<=0&&!s||ee.y>=0&&!c||!l&&p)&&(N=it(N,ee)),l||p)if(ke(O.input,5)){var ne=rn(D,17),ae=rn(D,22);O.animation!=ne&&O.animation!=ae||(t.climbing=!1,O.is_jumping=!0,t.is_fire_jumping=!0,O.speed.x=.7*(O.mirror&g.eI?1:-1)*O.jump_strength,O.speed.y=-.5*O.jump_strength,l&&!p&&(O.mirror&=~g.eI),!l&&p&&(O.mirror|=g.eI),Y=rn(D,3),C(We("jump")))}else we(O.input,1)?s||(N.y=.1*-A*T,Y=rn(D,17)):we(O.input,2)?c?t.climbing=!1:(N.y=.1*A*T,Y=rn(D,17)):Y=rn(D,22);else(h=O.mirror&g.eI?d:u)?(Y=rn(D,23),O.ignore_horizontal=!0,N=it(N,rt(ku(h,O),T)),Hn(O)&&(t.climbing=!1,O.ignore_horizontal=!1,O.speed=at((O.mirror&g.eI?-1:1)*A*.15,-bu()/12.5),N.x=5*(O.mirror&g.eI?-1:1))):(t.climbing=!1,O.is_jumping=!0,Y=rn(D,3))}}return t.at_some_border=!1,Y&&(O=Bn(O,Y)),Math.abs(O.speed.x)<4&&(t.braking=!1,(!we(O.input,3)&&!we(O.input,4)||we(O.input,3)&&we(O.input,4)||t.spin||t.landing)&&(N.x=0,O.speed.x=0)),N.x+=ku(c,O).x*T,N.x=O.position.x<=O.hot_spot.x&&O.speed.x<0?0:N.x,N.x=O.position.x>=pu().x-(Gn(O).width-O.hot_spot.x)&&O.speed.x>0?0:N.x,N},ui=function(t){var e,n,a=t.actor,i=!1;if(!t.blinking&&!t.dying&&!t.invincible)if(Ii(t),0!=t.shield_type)i=!0,t.shield_type=0,C(We("death"));else if(le>0){for(i=!0,n=0;n<Math.min(gi(),15);n++)(e=xu(ps,a.position)).is_moving=!0,e.actor.speed.x=e.actor.maxspeed*(K(100)-50)/100,e.actor.speed.y=-e.actor.jump_strength+K(e.actor.jump_strength);yi(0),C(We("ringless"))}else di(t);i&&(t.getting_hit=!0,t.flying=t.landing=t.climbing=t.spring=!1,t.is_fire_jumping=!1,t.spin_dash=t.spin=!1,t.blinking=!0,t.blink_timer=0,a.speed.x=a.mirror&g.eI?200:-200,a.speed.y=-.75*a.jump_strength,Cn(a,at(0,-5)))},di=function(t){t.dying||(Ii(t),t.shield_type=0,t.invincible=!1,t.got_speedshoes=!1,t.dying=!0,t.death_timer=0,t.spring=!1,t.actor.speed.y=1.2*-t.actor.jump_strength,t.flying=t.climbing=t.landing=!1,t.is_fire_jumping=!1,t.spin=t.spin_dash=!1,t.blinking=!1,C(We("death")))},fi=function(t){Se(t.actor.input,5),t.spring=!1,t.actor.speed.y=-t.actor.jump_strength,t.actor.is_jumping=!0,t.is_fire_jumping=!1,t.flying=!1},hi=function(t){var e=rn(wi(t.type),3);return t.spin||t.spin_dash||t.actor.animation==e||2==t.type&&(t.landing||t.flying)},gi=function(){return le},mi=function(){return ri},bi=function(){return si},yi=function(t){le=J(t,0,9999),t/100>=_e&&(_e+=1,xi(mi()+1),lu(We("1up")))},xi=function(t){ri=t},vi=function(t){si=t},wi=function(t){switch(t){case 0:return"SD_SONIC";case 1:return"SD_TAILS";case 2:return"SD_KNUCKLES";default:return"null"}},ki=function(t){if(t&&t.actor){var e=0,n=t.actor.mirror&g.eI,a=!0,i=et(t.actor.angle),o=at(0,0),r=ot(t.actor.position,st(at(0,t.actor.hot_spot.y),-i)),s=t.actor.animation;switch(t.type){case 0:if(s==rn(wi(0),0))o=at(3,24),e=1;else if(s==rn(wi(0),1))switch(parseInt(t.actor.animation_frame,10)){case 0:e=2,o=at(5,23);break;case 1:e=2,o=at(4,25);break;case 2:e=1,o=at(7,25);break;case 3:case 4:e=1,o=at(5,23);break;case 5:e=1,o=at(4,24);break;case 6:e=2,o=at(6,24);break;case 7:e=2,o=at(6,23)}else if(s==rn(wi(0),2))e=1,o=at(8,26);else if(s==rn(wi(0),5))e=3,o=0==parseInt(t.actor.animation_frame,10)?at(0,19):at(-1,21);else if(s==rn(wi(0),7))e=1,o=parseInt(t.actor.animation_frame,10)<2?at(8,26):at(10,28);else if(s==rn(wi(0),10))switch(e=1,parseInt(t.actor.animation_frame,10)){case 0:o=at(1,22);break;case 1:o=at(-1,23);break;case 2:o=at(1,23)}else s==rn(wi(0),11)?(e=3,o=at(-4,30)):s==rn(wi(0),12)?(e=3,o=at(1,19)):s==rn(wi(0),13)?(e=3,o=at(4,13)):s==rn(wi(0),14)?(e=1,o=at(12,31)):s==rn(wi(0),15)?(e=0,o=at(3,23)):s==rn(wi(0),25)?(e=0,o=at(3,22)):a=!1;break;case 1:if(s==rn(wi(1),0))o=at(5,34),e=1;else if(s==rn(wi(1),1))switch(e=2,parseInt(t.actor.animation_frame,10)){case 0:o=at(2,33);break;case 1:case 5:o=at(3,33);break;case 2:o=at(8,33);break;case 3:case 7:o=at(3,32);break;case 4:o=at(1,33);break;case 6:o=at(7,33)}else if(s==rn(wi(1),2))e=2,o=0==parseInt(t.actor.animation_frame,10)?at(7,35):at(6,34);else if(s==rn(wi(1),4))e=1,o=at(9,44);else if(s==rn(wi(1),5))e=1,o=at(7,32);else if(s==rn(wi(1),7))e=1,o=0==parseInt(t.actor.animation_frame,10)?at(2,33):at(4,33);else if(s==rn(wi(1),10))switch(e=4,parseInt(t.actor.animation_frame,10)){case 0:o=at(5,33);break;case 1:o=at(6,33)}else if(s==rn(wi(1),11))e=1,o=at(1,33);else if(s==rn(wi(1),12))e=1,o=at(6,28);else if(s==rn(wi(1),13))e=3,o=at(2,17);else if(s==rn(wi(1),14))e=1,o=at(9,35);else if(s==rn(wi(1),15))switch(e=4,parseInt(t.actor.animation_frame,10)){case 0:case 8:case 9:case 10:o=at(5,34);break;default:o=at(5,33)}else s==rn(wi(1),16)?(e=1,o=at(8,37)):s==rn(wi(1),19)?(e=1,o=0==parseInt(t.actor.animation_frame,10)?at(9,39):at(9,40)):s==rn(wi(1),20)?(e=1,o=at(8,39)):s==rn(wi(1),25)?(e=1,o=at(0,23)):a=!1;break;case 2:if(s==rn(wi(2),0))e=1,o=at(1,24);else if(s==rn(wi(2),1))switch(parseInt(t.actor.animation_frame,10)){case 0:e=1,o=at(5,29);break;case 1:e=2,o=at(5,29);break;case 2:e=2,o=at(8,29);break;case 3:e=2,o=at(9,28);break;case 4:e=1,o=at(6,28);break;case 5:e=1,o=at(6,29);break;case 6:e=1,o=at(5,28);break;case 7:e=1,o=at(4,27)}else if(s==rn(wi(2),2))e=1,o=at(7,29);else if(s==rn(wi(2),4))e=1,o=0==parseInt(t.actor.animation_frame,10)?at(0,31):at(0,40);else if(s==rn(wi(2),5))e=1,o=0==parseInt(t.actor.animation_frame,10)?at(0,21):at(-1,21);else if(s==rn(wi(2),7))e=0,o=at(-2,27);else if(s==rn(wi(2),10))switch(e=1,parseInt(t.actor.animation_frame,10)){case 0:o=at(9,30);break;case 1:o=at(8,27)}else if(s==rn(wi(2),11))e=1,o=at(-3,27);else if(s==rn(wi(2),12))e=1,o=at(5,24);else if(s==rn(wi(2),13))e=3,o=at(-1,16);else if(s==rn(wi(2),14))switch(parseInt(t.actor.animation_frame,10)){case 0:e=1,o=at(5,29);break;case 1:e=2,o=at(5,29);break;case 2:e=2,o=at(8,29);break;case 3:e=2,o=at(9,28);break;case 4:e=1,o=at(6,28);break;case 5:e=1,o=at(6,29);break;case 6:e=1,o=at(5,28);break;case 7:e=1,o=at(4,27)}else if(s==rn(wi(2),15))e=0,o=at(1,23);else if(s==rn(wi(2),16))switch(e=1,parseInt(t.actor.animation_frame,10)){case 0:o=at(6,23);break;case 1:o=at(5,20);break;case 2:o=at(0,22)}else if(s==rn(wi(2),17))switch(e=3,parseInt(t.actor.animation_frame,10)){case 0:o=at(-1,22);break;case 1:o=at(-2,20);break;case 2:o=at(0,21);break;case 3:o=at(-1,24);break;case 4:o=at(0,23);break;case 5:o=at(0,22)}else if(s==rn(wi(2),18))e=1,o=0==parseInt(t.actor.animation_frame,10)?at(6,23):at(5,20);else if(s==rn(wi(2),19))e=1,o=at(8,44);else if(s==rn(wi(2),20))e=1,o=at(8,39);else if(s==rn(wi(2),21))switch(e=4,parseInt(t.actor.animation_frame,10)){case 0:o=at(-8,41);break;case 1:o=at(0,43);break;case 2:o=at(10,41)}else if(s==rn(wi(2),22))e=3,o=at(0,22);else if(s==rn(wi(2),23))switch(parseInt(t.actor.animation_frame,10)){case 0:e=3,o=at(7,17);break;case 1:e=3,o=at(11,15);break;case 2:e=0,o=at(12,13)}else s==rn(wi(2),25)?(e=0,o=at(0,23)):a=!1}return o.x*=n?-1:1,t.glasses=Bn(t.glasses,rn("SD_GLASSES",e)),t.glasses.position=it(r,st(o,-i)),t.glasses.angle=i,t.glasses.mirror=t.actor.mirror,t.glasses.visible=a&&t.actor.visible,t}},Ii=function(t){},Si=function(t){var e=t.shield,n=t.actor,a=at(0,0);switch(t.shield_type){case 1:a=at(0,-22),e.position=it(n.position,st(a,-et(n.angle))),e=Bn(e,rn("SD_SHIELD",0));break;case 2:a=at(0,-22),e.position=it(n.position,st(a,-et(n.angle))),e=Bn(e,rn("SD_FIRESHIELD",0));break;case 3:a=at(0,-22),e.position=it(n.position,st(a,-et(n.angle))),e=Bn(e,rn("SD_THUNDERSHIELD",0));break;case 4:a=at(0,-22),e.position=it(n.position,st(a,-et(n.angle))),e=Bn(e,rn("SD_WATERSHIELD",0));break;case 5:a=at(0,-22),e.position=it(n.position,st(a,-et(n.angle))),e=Bn(e,rn("SD_ACIDSHIELD",0));break;case 6:a=at(0,-22),e.position=it(n.position,st(a,-et(n.angle))),e=Bn(e,rn("SD_WINDSHIELD",0))}},ji=function(t){return 0!==t.disable_wall},Ei=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Ln(),e.is_disappearing=!1,Bn(t.actor,rn("SD_BLUERING",0))},Mi=function(t){Rn(t.actor)},Oi=function(t,e,n,a,i,o){var r;for(r=0;r<n;r++){var s=e[r];s&&!s.dying&&Xn(s.actor,t.actor)&&(t.state=cs,yi(gi()+50),du(5e3),C(We("big ring")),fu("$BONUSMSG_TITLE","$BONUSMSG_TEXT"),md(gd,bd(gd)+1))}},Di=function(t,e){An(t.actor,e)},Ti=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Ln(),e.is_disappearing=!1,Bn(t.actor,rn("SD_BLUERING",0))},Pi=function(t,e,n,a,i,o){var r=ru(),s=t,c=t.actor;c.visible=r.got_glasses||ou(),s.is_disappearing?Hn(c)&&(t.state=cs):!r.dying&&r.got_glasses&&Xn(c,r.actor)&&(Bn(c,rn("SD_BLUERING",1)),yi(gi()+5),C(We("blue ring")),s.is_disappearing=!0)},Li=function(t,e){An(t.actor,e)},Ri=function(t){Rn(t.actor)},Ai=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Ln(),e.getting_hit=!1,Bn(t.actor,rn("SD_BUMPER",0))},Ni=function(t,e,n,a,i,o){var r,s=t,c=t.actor;for(r=0;r<n;r++){var p=e[r];p&&!p.dying&&Wn(p.actor,c)&&(s.getting_hit||(s.getting_hit=!0,Bn(c,rn("SD_BUMPER",1)),C(We("bumper")),Ui(t,p)))}s.getting_hit&&actor_animation_finished(c)&&(s.getting_hit=!1,Bn(c,rn("SD_BUMPER",0)))},Ci=function(t,e){An(t.actor,e)},Gi=function(t){Rn(t.actor)},Ui=function(t,e){var n,a,i,o=t.actor;(n=e.actor_speed).x=n.x<0?Math.min(-300,n.x):Math.max(300,n.x),a=rt(pt(ot(o.position,e.actor_position)),v2d_magnitude(n)),i=rt(a,1),e.actor_speed=rt(it(n,rt(i,-1e4)),1/10001),o.speed=rt(it(n,i),1/10001),e.flying=!1,e.landing=!1,e.climbing=!1,e.spring=!1},Bi=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Ln(),e.is_active=!1,Bn(t.actor,rn("SD_CHECKPOINT",0))},Hi=function(t,e,n,a,i,o){var r,s=t,c=t.actor;if(s.is_active)Hn(c)&&Bn(c,rn("SD_CHECKPOINT",2));else for(r=0;r<n;r++){var p=e[r];if(p&&!p.dying&&Wn(p.actor,c)){s.is_active=!0,C(We("checkpoint")),_u(c.position),Bn(c,rn("SD_CHECKPOINT",1));break}}},Xi=function(t,e){An(t.actor,e)},Wi=function(t){Rn(t.actor)},Yi=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Ln(),Bn(t.actor,rn("SD_ITEMBOX",10))},$i=function(t,e,n,a,i,o){},zi=function(t,e){An(t.actor,e)},Fi=function(t){Rn(t.actor)},Vi=function(t,e){var n={},a=n;return n.init=qi,n.release=Ji,n.update=Qi,n.render=Ki,a.sprite_name=t,a.player_is_vulnerable=e,n},qi=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Ln(),Bn(t.actor,rn(e.sprite_name,0))},Qi=function(t,e,n,a,i,o){var r,s=t,c=t.actor;for(r=0;r<n;r++){var p=e[r];p&&(p.dying||p.blinking||p.invincible||!Xn(c,p.actor)||s.player_is_vulnerable(p)&&p.hit(p))}c.visible=ou()},Ki=function(t,e){An(t.actor,e)},Ji=function(t){Rn(t.actor)},Zi=function(t){return!0},to=function(t){return 2!=t.shield_type},eo=function(t,e){t.actor_speed=e},no=function(t){t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Ln(),Bn(t.actor,rn("SD_DANGPOWER",0))},ao=function(t,e,n,a,i,o){var r,s=z(),c=t.actor,p=rt(c.speed,s);for(r=0;r<n;r++){var l=e[r];l&&!l.dying&&Xn(c,l.actor)&&(l.hit(l),t.state=cs)}c.position=it(c.position,p)},io=function(t,e){An(t.actor,e)},oo=function(t){Rn(t.actor)},ro=function(t,e){var n={},a=n;return n.init=so,n.release=lo,n.update=co,n.render=po,a.authorized_player_type=t,a.is_vertical_door=e,n},so=function(t){var e,n,a=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Ln(),n=parseInt(a.authorized_player_type,10),e=a.is_vertical_door?"SD_DNADOOR":"SD_HORIZONTALDNADOOR",Bn(t.actor,rn(e,n))},co=function(t,e,n,a,i,o){var r,s,c={},p=t.actor,l=!1,_=!1,u=z(),d=[],f=[];for(t.obstacle=!0,s=0;s<n;s++){var h=e[s];h&&(h.dying||h.actor_carrying||h.actor_carried_by||!_o(h,t)||(h.type==c.authorized_player_type?(t.obstacle=!1,_=Wn(p,h.actor)):l=!0))}if(l&&(t.obstacle=!0),t.obstacle?p.alpha=Math.min(1,p.alpha+2*u):_&&(p.alpha=Math.max(.4,p.alpha-2*u)),_)for(d[0]=p.position.x-p.hot_spot.x-5,d[1]=p.position.y-p.hot_spot.y-5,d[2]=d[0]+Gn(p).width+10,d[3]=d[1]+Gn(p).height+10,r=i;null!=r;r=r.next)r.data.type==t.type&&(f[0]=r.data.actor_position.x-r.data.actor_hot_spot.x-5,f[1]=r.data.actor_position.y-r.data.actor_hot_spot.y-5,f[2]=f[0]+Gn(r.data.actor).width+10,f[3]=f[1]+Gn(r.data.actor).height+10,Z(d,f)&&(r.data.actor_alpha<p.alpha?p.alpha=r.data.actor_alpha:r.data.actor_alpha=p.alpha))},po=function(t,e){An(t.actor,e)},lo=function(t){Rn(t.actor)},_o=function(t,e){var n=[],a=[],i=t.actor,o=e.actor;return n[0]=i.position.x-i.hot_spot.x,n[1]=i.position.y-i.hot_spot.y,n[2]=n[0]+Gn(i).width,n[3]=n[1]+Gn(i).height,a[0]=o.position.x-o.hot_spot.x,a[1]=o.position.y-o.hot_spot.y-3,a[2]=a[0]+Gn(o).width,a[3]=a[1]+Gn(o).height+3,Z(n,a)},uo=function(t){var e=t;t.obstacle=!0,t.bring_to_back=!0,t.preserve=!0,t.actor=Ln(),e.is_closed=!0,Bn(t.actor,rn("SD_DOOR",0))},fo=function(t,e,n,a,i,o){var r=t,s=t.actor,c=z();r.is_closed?s.position.y=parseInt(Math.min(s.position.y+2e3*c,s.spawn_point.y),10):s.position.y=parseInt(Math.max(s.position.y-2e3*c,s.spawn_point.y-.8*Gn(s).height),10)},ho=function(t,e){An(t.actor,e)},go=function(t){Rn(t.actor)},mo=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Ln(),e.who=null,Bn(t.actor,rn("SD_ENDSIGN",0))},bo=function(t,e,n,a,i,o){var r,s=t,c=t.actor;if(null==s.who)for(r=0;r<n;r++){var p=e[r];p&&!p.dying&&Wn(p.actor,c)&&(s.who=p,C(We("end sign")),Bn(c,rn("SD_ENDSIGN",1)),uu(t.actor))}else if(Hn(c)){var l=2+s.who.type;Bn(c,rn("SD_ENDSIGN",l))}},yo=function(t,e){An(t.actor,e)},xo=function(t){Rn(t.actor)},vo=function(t){t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Ln(),Bn(t.actor,rn("SD_EXPLOSION",K(2)))},wo=function(t,e,n,a,i,o){Hn(t.actor)&&(t.state=cs)},ko=function(t,e){An(t.actor,e)},Io=function(t){Rn(t.actor)},So=function(t){t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=actor.create(),Bn(t.actor,rn("SD_GLASSES",4)),t.actor.hot_spot.y*=.5},jo=function(t,e,n,a,i,o){var r=t.actor,s=z();r.angle+=Math.sign(r.speed.x)*(6*g.PI*s),r.position=it(r.position,function(t,e){var n=z(),a=at(0,0);return a.x=t.speed.x*n,a.y=t.speed.y*n+.5*e*n*n,t.speed.y+=e*n,a}(r,bu()))},Eo=function(t,e){An(t.actor,e)},Mo=function(t){Rn(t.actor)},Oo=function(t,e){ea(t.font,e)},Do=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Ln(),e.elapsed_time=0,e.font=ta(0),ea(e.font,"0"),Bn(t.actor,rn("SD_RING",0)),t.actor.visible=!1},To=function(t,e,n,a,i,o){var r=t,s=z();r.elapsed_time+=s,r.elapsed_time<.5?t.actor.position.y-=100*s:r.elapsed_time>2&&(t.state=cs),r.font.position=t.actor.position},Po=function(t,e){oa(t.font,e)},Lo=function(t){var e=t;Rn(t.actor),e.font},Ro=function(t,e,n,a){var i,o,r=g.JU,s=null;for(i=e;i;i=i.next)i.data&&i.data.type==n&&(o=ot(i.data.actor.position,t.actor.position),ct(o)<r&&(s=i.data,r=ct(o)));return a&&(a.dist=r),s},Ao=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Ln(),Bn(t.actor,rn("SD_GOAL",0))},No=function(t,e,n,a,i,o){var r,s=Ro(t,i,hs,null);r=null!=s?s.actor.position.x>t.actor.position.x?0:1:0,Bn(t.actor,rn("SD_GOAL",r))},Co=function(t,e){An(t.actor,e)},Go=function(t){Rn(t.actor)},Uo=function(t,e){Bn(t.actor,rn("SD_ICON",e))},Bo=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Ln(),e.elapsed_time=0,Uo(t,0)},Ho=function(t,e,n,a,i,o){var r=t,s=t.actor,c=z();if(r.elapsed_time+=c,r.elapsed_time<1)s.position.y-=40*c;else if(r.elapsed_time>=2.5){var p,l,_,u=parseInt(s.position.x-s.hot_spot.x,10),d=parseInt(s.position.y-s.hot_spot.y,10),f=Gn(s);for(p=0;p<f.h;p++)for(l=0;l<f.w;l++)_=Ve(1,1),Ze(_,255,255,255),wu(_,at(u+l,d+p),at(l-f.width/2+(K(f.width)-f.width/2),p-K(f.height/2)),!1);t.state=cs}},Xo=function(t,e){An(t.actor,e)},Wo=function(t){Rn(t.actor)},Yo=function(t,e){cu(100),xi(mi()+1),lu(We("1up"))},$o=function(t,e){cu(100),yi(gi()+10),C(We("ring"))},zo=function(t,e){cu(100),e.invincible=!0,e.invtimer=0,T(D("data/music/invincible.mp4"),0)},Fo=function(t,e){cu(100),e.got_speedshoes=!0,e.speedshoes_timer=0,T(D("data/music/speed.mp4"),0)},Vo=function(t,e){cu(100),e.got_glasses=!0},qo=function(t,e){cu(100),e.shield_type=1,C(We("shield"))},Qo=function(t,e){cu(100),e.shield_type=2,C(We("fire shield"))},Ko=function(t,e){cu(100),e.shield_type=3,C(We("thunder shield"))},Jo=function(t,e){cu(100),e.shield_type=4,C(We("water shield"))},Zo=function(t,e){cu(100),e.shield_type=5,C(We("acid shield"))},tr=function(t,e){cu(100),e.shield_type=6,audio.sound_play(We("wind shield"))},er=function(t,e){player_hit(e)},nr=function(t,e){cu(100)},ar=function(t,e){var n={},a=n;return n.init=ir,n.release=sr,n.update=or,n.render=rr,a.on_destroy=t,a.anim_id=e,n},ir=function(t){var e=t;t.obstacle=!0,t.bring_to_back=!1,t.preserve=!0,t.actor=Ln(),Bn(t.actor,rn("SD_ITEMBOX",e.anim_id))},or=function(t,e,n,a,i,o){var r,s=t.actor,c=t;for(r=0;r<n;r++){var p=e[r];if(p&&!(p.actor.is_jumping&&p.actor.speed.y<-10)&&t.state===ss&&cr(t,p)&&hi(p)){console.log("ITEM BOX HIT");var l=xu(_s,it(s.position,at(0,-5)));l.change_animation(l,c.anim_id),xu(us,it(s.position,at(0,-20))),xu(ls,s.position),C(We("destroy")),p.actor.is_jumping&&p.bounce(p),c.on_destroy(t,p),t.state=cs}}c.anim_id=c.anim_id<e.length?su():c.anim_id,Bn(t.actor,rn("SD_ITEMBOX",c.anim_id))},rr=function(t,e){An(t.actor,e)},sr=function(t){Rn(t.actor)},cr=function(t,e){var n,a=t.actor.position;return n=Xn(t.actor,e.actor),t.actor.position=a,n},pr=function(t,e){var n={},a=n;return n.init=lr,n.release=_r,n.update=ur,n.render=dr,a.on_collision=t,a.sprite_name=e,n},lr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Ln(),t.actor=Bn(t.actor,rn(e.sprite_name,0))},_r=function(t){},ur=function(t,e,n,a,i,o){var r,s=t,c=t.actor;for(c.visible=!1,r=0;r<n;r++){var p=e[r];p&&Xn(c,p.actor)&&(p.at_loopfloortop=fr(t,i,p),s.on_collision(p))}},dr=function(t,e){An(t.actor,e)},fr=function(t,e,n){var a=Ro(t,e,gs,null);return null!=a&&Xn(n.actor,a.actor)},hr=function(t){t.disable_wall|=8,t.entering_loop=!0,t.bring_to_back=!1},gr=function(t){if(!t.flying){var e=t.actor.speed.x>0;t.disable_wall&=-11,t.disable_wall|=e?2:8,t.bring_to_back=e}},mr=function(t){t.disable_wall|=2,t.entering_loop=!0,t.bring_to_back=!0},br=function(t){t.entering_loop||(t.disable_wall=0,t.bring_to_back=!1)},yr=function(t){t.at_loopfloortop||t.flying||(t.disable_wall|=4,t.entering_loop=!0,t.bring_to_back=!0)},xr=function(t){t.at_loopfloortop||t.entering_loop||t.flying||(t.disable_wall&=-5,t.bring_to_back=!1)},vr=function(t){if(!t.flying)if(4&t.disable_wall){var e=t.actor.speed.x>0;t.disable_wall&=-11,t.disable_wall|=e?2:8,t.bring_to_back=!0}else t.disable_wall&=-11,t.bring_to_back=!0},wr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Ln(),t.actor.maxspeed=220+K(140),t.actor.jump_strength=1.2*(350+K(50)),t.actor.input=be(),e.is_disappearing=!1,e.is_moving=!1,e.life_time=0,Bn(t.actor,rn("SD_RING",0))},kr=function(t){},Ir=function(t,e,n,a,i,o){var r,s=z(),c=t,p=t.actor;for(r=0;r<n;r++){var l=e[r];if(l&&(!c.is_moving||c.is_moving&&!l.getting_hit&&c.life_time>=.5)&&!c.is_disappearing&&!l.dying&&Xn(p,l.actor)){yi(gi()+1),c.is_disappearing=!0,C(We("ring"));break}}if(c.is_disappearing)Bn(p,rn("SD_RING",1)),Hn(p)&&(t.state=cs);else if(c.is_moving){if(Se(p.input,5),t.preserve=!1,c.life_time+=s,c.life_time>5){var _=240+K(20);p.visible=parseInt((F(),10))<_/2,c.life_time>8&&(t.state=cs)}Cn(p,Vn(p,a,bu()))}},Sr=function(t,e){An(t.actor,e)},jr=function(t,e,n){var a={},i=a;return a.init=Er,a.release=Mr,a.update=Or,a.render=Dr,i.collision=t,i.anim_id=e,i.cycle_length=n,a},Er=function(t){var e=t;t.obstacle=!0,t.bring_to_back=!0,t.preserve=!0,t.actor=Ln(),e.timer=0,e.hidden=!1,Bn(t.actor,rn("SD_SPIKES",e.anim_id))},Mr=function(t){Rn(t.actor)},Or=function(t,e,n,a,i,o){var r,s=t,c=z();if(s.timer+=c,s.timer>=.5*s.cycle_length&&(s.timer=0,s.hidden=!s.hidden,C(We(s.hidden?"spikes disappearing":"spikes appearing"))),t.obstacle=!s.hidden,t.actor.visible=!s.hidden,!s.hidden)for(r=0;r<n;r++){var p=e[r];if(p&&!p.dying&&!p.blinking&&!p.invincible&&s.collision(t,p)){var l=We("spikes hit");U(l)||C(l),ui(p)}}},Dr=function(t,e){An(t.actor,e)},Tr=function(t,e){var n=[],a=t.actor;return n[0]=a.position.x-a.hot_spot.x,n[1]=a.position.y-a.hot_spot.y,n[2]=n[0]+Gn(a).width,n[3]=n[1]+Gn(a).height,Z(n,e)},Pr=function(t,e){var n,a=[],i=t.actor;return a[0]=i.position.x-i.hot_spot.x+5,a[1]=i.position.y-i.hot_spot.y-5,a[2]=a[0]+Gn(i).width-10,a[3]=a[1]+10,n=e.actor.position.y-e.actor.hot_spot.y+Gn(e.actor).height,Tr(e,a)&&n<i.position.y-i.hot_spot.y+Gn(i).height/2},Lr=function(t,e){var n=[],a=t.actor;return n[0]=a.position.x-a.hot_spot.x+5,n[1]=a.position.y-a.hot_spot.y+Gn(a).height-5,n[2]=n[0]+Gn(a).width-10,n[3]=n[1]+10,Tr(e,n)},Rr=function(t,e){var n=[],a=t.actor;return n[0]=a.position.x-a.hot_spot.x+Gn(a).width-5,n[1]=a.position.y-a.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+Gn(a).height-10,Tr(e,n)},Ar=function(t,e){var n=[],a=t.actor;return n[0]=a.position.x-a.hot_spot.x-5,n[1]=a.position.y-a.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+Gn(a).height-10,Tr(e,n)},Nr=function(t,e,n){var a={};return a.init=Cr,a.release=Gr,a.update=Ur,a.render=Br,a.on_bump=t,a.sprite_name=e,a.strength=n,a},Cr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Ln(),e.is_bumping=!1,e.bang_timer=0,Bn(t.actor,rn(e.sprite_name,0))},Gr=function(t){},Ur=function(t,e,n,a,i,o){var r,s=t,c=z();for(s.bang_timer+=c,r=0;r<n;r++){var p=e[r];p&&!p.dying&&Wn(p.actor,t.actor)&&s.on_bump(t,p)}s.is_bumping&&Hn(t.actor)&&(Bn(t.actor,rn(s.sprite_name,0)),s.is_bumping=!1)},Br=function(t,e){An(t.actor,e)},Hr=function(t,e){e.actor.speed.y>=1&&!e.actor.carrying&&!e.actor.carried_by&&Wr(t,e)},Xr=function(t,e){Wr(t,e)},Wr=function(t,e){var n=t;t.is_bumping=!0,function(t,e){var n=z(),a=[],i=[];a[0]=e.x*t.actor.speed.x>=0,a[1]=e.y*t.actor.speed.y>=0,i[0]=e.x*t.actor.speed.x<=0&&Math.abs(e.x)>g.Ib,i[1]=e.y*t.actor.speed.y<=0&&Math.abs(e.y)>g.Ib,Math.abs(e.y)>g.Ib&&(t.spring=!0),t.flying=!1,t.climbing=!1,t.landing=!1,t.getting_hit=!1,t.is_fire_jumping=!1,(Math.abs(e.x)>Math.abs(t.actor.speed.x)&&a[0]||i[0])&&(t.actor.speed.x=e.x),(Math.abs(e.y)>Math.abs(t.actor.speed.y)&&a[1]||i[1])&&(t.actor.speed.y=e.y,t.actor.position.y+=t.actor.speed.y*n)}(e,t.strength),Bn(n.actor,rn(t.sprite_name,1)),t.strength.x>g.Ib?e.actor.mirror&=~g.eI:t.strength.x<-g.Ib&&(e.actor.mirror|=g.eI),t.bang_timer>.2&&(C(We("spring")),t.bang_timer=0)},Yr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Ln(),e.is_disabled=!1,e.is_active=!1,e.timer=0,Bn(t.actor,rn("SD_TELEPORTER",0))},$r=function(t,e,n,a,i,o){var r,s=t,c=t.actor,p=z(),l=0;if(s.is_active){if(s.timer+=p,s.timer>=3){var _=s.who;for(Ee(_.actor.input),ad(_.actor),r=0;r<n;r++){var u=e[r];if(u!=_){var d=it(c.position,at(40*l++-20,-30));Vr(u,d)}}s.is_active=!1,s.is_disabled=!0}Bn(c,rn("SD_TELEPORTER",1))}else Bn(c,rn("SD_TELEPORTER",0))},zr=function(t,e){An(t.actor,e)},Fr=function(t){Rn(t.actor)},Vr=function(t,e){t&&(t.actor.position=e,t.actor.speed=at(0,0),t.actor.is_jumping=!1,t.flying=!1,t.climbing=!1,t.getting_hit=!1,t.spring=!1,t.actor.angle=0,t.disable_wall=0,t.entering_loop=!1,t.at_loopfloortop=!1,t.bring_to_back=!1)},qr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Ln(),e.is_pressed=!1,e.partner=null,Bn(t.actor,rn("SD_SWITCH",0))},Qr=function(t){Rn(t.actor)},Kr=function(t,e,n,a,i,o){var r,s,c=t,p={},l={};c.partner=null,r=Ro(t,i,ds,p),s=Ro(t,i,fs,l),null!=r&&p.dist<l.dist&&(c.partner=r),null!=s&&l.dist<p.dist&&(c.partner=s),null==c.partner?Zr(t,r,e,n,ts,es):c.partner==r?Zr(t,r,e,n,ns,as):c.partner==s&&Zr(t,s,e,n,is,os)},Jr=function(t,e){An(t.actor,e)},Zr=function(t,e,n,a,i,o){var r,s=!0,c=t,p=t.actor;for(r=0;r<a;r++){var l=n[r];rs(t,l)&&(s=!1,c.is_pressed||(i(e,l),C(We("switch")),Bn(p,rn("SD_SWITCH",1)),c.is_pressed=!0))}s&&c.is_pressed&&(o(e),Bn(p,rn("SD_SWITCH",0)),c.is_pressed=!1)},ts=function(t,e){},es=function(t){},ns=function(t,e){!function(t){t.is_closed=!1,C(We("open door"))}(t)},as=function(t){!function(t){t.is_closed=!0,C(We("close door"))}(t)},is=function(t,e){!function(t,e){var n=t,a=t.actor;n.is_active||n.is_disabled||(n.is_active=!0,n.who=e,je(e.actor.input),ad(a),C(We("teleporter")))}(t,e)},os=function(t){},rs=function(t,e){if(!t)return!1;if(!e)return!1;var n=[],a=[];return n[0]=t.actor.position.x-t.actor.hot_spot.x,n[1]=t.actor.position.y-t.actor.hot_spot.y,n[2]=n[0]+Gn(t.actor).width,n[3]=n[1]+Gn(t.actor).height,a[0]=e.actor.position.x-e.actor.hot_spot.x+.3*Gn(e.actor).width,a[1]=e.actor.position.y-e.actor.hot_spot.y+.5*Gn(e.actor).height,a[2]=a[0]+.4*Gn(e.actor).width,a[3]=a[1]+.5*Gn(e.actor).height,!e.dying&&!e.climbing&&!e.flying&&Z(n,a)},ss=0,cs=1,ps=0,ls=9,_s=10,us=12,ds=26,fs=27,hs=31,gs=35,ms=function(t){var e=null;switch(t){case ps:e=function(){var t={};return t.init=wr,t.release=kr,t.update=Ir,t.render=Sr,t}();break;case 1:e=ar(Yo,0);break;case 2:e=ar($o,3);break;case 3:e=ar(zo,4);break;case 4:e=ar(Fo,5);break;case 5:e=ar(Vo,6);break;case 6:e=ar(qo,7);break;case 42:e=ar(Qo,11);break;case 78:e=ar(Ko,12);break;case 79:e=ar(Jo,13);break;case 80:e=ar(Zo,14);break;case 81:e=ar(tr,15);break;case 7:e=ar(er,8);break;case 8:e=ar(nr,9);break;case ls:e=function(){var t={};return t.init=Yi,t.release=Fi,t.update=$i,t.render=zi,t}();break;case _s:e=function(){var t={};return t.init=Bo,t.release=Wo,t.update=Ho,t.render=Xo,t.change_animation=Uo,t}();break;case 11:e=function(){var t={};return t.init=So,t.release=Mo,t.update=jo,t.render=Eo,t}();break;case us:e=function(){var t={};return t.init=vo,t.release=Io,t.update=wo,t.render=ko,t}();break;case 13:e=function(){var t={};return t.init=Do,t.release=Lo,t.update=To,t.render=Po,t.set_text=Oo,t}();break;case 15:e=function(){var t={};return t.init=$a,t.release=za,t.update=Fa,t.render=Va,t}();break;case 16:e=pr(hr,"SD_LOOPRIGHT");break;case 17:e=pr(gr,"SD_LOOPMIDDLE");break;case 18:e=pr(mr,"SD_LOOPLEFT");break;case 19:e=pr(br,"SD_LOOPNONE");break;case 33:e=pr(yr,"SD_LOOPFLOOR");break;case 34:e=pr(xr,"SD_LOOPFLOORNONE");break;case gs:e=pr(vr,"SD_LOOPFLOORTOP");break;case 20:e=Nr(Hr,"SD_YELLOWSPRING",at(0,-500));break;case 54:e=Nr(Xr,"SD_BYELLOWSPRING",at(0,500));break;case 50:e=Nr(Xr,"SD_TRYELLOWSPRING",at(400,-600));break;case 48:e=Nr(Xr,"SD_RYELLOWSPRING",at(600,0));break;case 52:e=Nr(Xr,"SD_BRYELLOWSPRING",at(400,600));break;case 53:e=Nr(Xr,"SD_BLYELLOWSPRING",at(-400,600));break;case 49:e=Nr(Xr,"SD_LYELLOWSPRING",at(-600,0));break;case 51:e=Nr(Xr,"SD_TLYELLOWSPRING",at(-400,-600));break;case 21:e=Nr(Hr,"SD_REDSPRING",at(0,-750));break;case 47:e=Nr(Xr,"SD_BREDSPRING",at(0,750));break;case 43:e=Nr(Xr,"SD_TRREDSPRING",at(800,-1e3));break;case 22:e=Nr(Xr,"SD_RREDSPRING",at(1200,0));break;case 45:e=Nr(Xr,"SD_BRREDSPRING",at(800,1e3));break;case 46:e=Nr(Xr,"SD_BLREDSPRING",at(-800,1e3));break;case 23:e=Nr(Xr,"SD_LREDSPRING",at(-1200,0));break;case 44:e=Nr(Xr,"SD_TLREDSPRING",at(-800,-1e3));break;case 55:e=Nr(Hr,"SD_BLUESPRING",at(0,-1500));break;case 62:e=Nr(Xr,"SD_BBLUESPRING",at(0,1500));break;case 58:e=Nr(Xr,"SD_TRBLUESPRING",at(1800,-1500));break;case 56:e=Nr(Xr,"SD_RBLUESPRING",at(2e3,0));break;case 60:e=Nr(Xr,"SD_BRBLUESPRING",at(1800,1500));break;case 61:e=Nr(Xr,"SD_BLBLUESPRING",at(-1800,1500));break;case 57:e=Nr(Xr,"SD_LBLUESPRING",at(-2e3,0));break;case 59:e=Nr(Xr,"SD_TLBLUESPRING",at(-1800,-1500));break;case 24:e=function(){var t={};return t.init=Ti,t.release=Ri,t.update=Pi,t.render=Li,t}();break;case 25:e=function(){var t={};return t.init=qr,t.release=Qr,t.update=Kr,t.render=Jr,t}();break;case ds:G_.length>1&&(e=function(){var t={};return t.init=uo,t.release=go,t.update=fo,t.render=ho,t}());break;case fs:e=function(){var t={};return t.init=Yr,t.release=Fr,t.update=$r,t.render=zr,t}();break;case 28:e=function(){var t={};return t.init=Ei,t.release=Mi,t.update=Oi,t.render=Di,t}();break;case 29:e=function(){var t={};return t.init=Bi,t.release=Wi,t.update=Hi,t.render=Xi,t}();break;case 30:e=function(){var t={};return t.init=Ao,t.release=Go,t.update=No,t.render=Co,t}();break;case hs:e=function(){var t={};return t.init=mo,t.release=xo,t.update=bo,t.render=yo,t}();break;case 32:e=function(){var t={},e=t;return t.init=qa,t.release=Qa,t.update=Ka,t.render=Ja,e.state=null,t}();break;case 36:e=function(){var t={};return t.init=Ai,t.release=Gi,t.update=Ni,t.render=Ci,t}();break;case 37:e=Vi("SD_DANGER",Zi);break;case 75:e=Vi("SD_VERTICALDANGER",Zi);break;case 76:e=Vi("SD_FIREDANGER",to);break;case 77:e=Vi("SD_VERTICALFIREDANGER",to);break;case 38:e=jr(Pr,0,g.JU);break;case 63:e=jr(Lr,2,g.JU);break;case 64:e=jr(Rr,1,g.JU);break;case 65:e=jr(Ar,3,g.JU);break;case 66:e=jr(Pr,0,5);break;case 67:e=jr(Lr,2,5);break;case 68:e=jr(Rr,1,5);break;case 69:e=jr(Ar,3,5);break;case 39:e=ro(0,!0);break;case 70:e=ro(1,!0);break;case 71:e=ro(2,!0);break;case 72:e=ro(0,!1);break;case 73:e=ro(1,!1);break;case 74:e=ro(2,!1);break;case 40:case 41:e=function(){var t={};return t.init=no,t.release=oo,t.update=ao,t.render=io,t.dangerouspower_set_speed=eo,t}()}return null!=e&&(e.type=t,e.state=ss,e.init(e)),e},bs=function(t,e,n,a,i,o){t.update(t,e,n,a,i,o)},ys=function(t,e){t.render(t,e)},xs=function(t){},vs=function(t){},ws=function(t,e,n,a,i,o){},ks=function(t,e){var n=t.get_object_instance(t).actor,a=n.position;n.position=at(parseInt(n.position.x,10),parseInt(n.position.y,10)),An(n,e),n.position=a},Is=function(t){return t.object},Ss=function(t){return t.reference_to_current_state},js=function t(e,n){return null!=e?e.name?e:t(e.next,n):null},Es=function(t){var e=t.decorated_machine;return e.get_object_instance(e)},Ms=function(t){var e=t.decorated_machine;e.init(e)},Os=function(t){},Ds=function(t,e,n,a,i,o){var r,s=t.decorated_machine,c=t,p=t.get_object_instance(t),l=z();r=rt(c.speed,l),p.actor.position=it(p.actor.position,r),s.update(s,e,n,a,i,o)},Ts=function(t,e){var n=t.decorated_machine;n.render(n,e)},Ps=function(t){var e=t.decorated_machine;e&&e.init(e)},Ls=function(t){},Rs=function(t,e,n,a,i,o){var r,s=t.decorated_machine,c=t,p=t.get_object_instance(t);for(r=0;r<n;r++){var l=e[r];l&&Wn(p.actor,l.actor)&&(hi(l)||l.invincible?(l.actor.is_jumping&&fi(l),cu(c.score),xu(us,it(p.actor.position,at(0,-15))),Iu(p.actor.position),C(We("destroy")),p.state=zl):l.hit(l))}s&&s.update(s,e,n,a,i,o)},As=function(t,e){var n=t.decorated_machine;n.render(n,e)},Ns=function(t){var e=t.decorated_machine;e.init(e)},Cs=function(t){},Gs=function(t,e,n,a,i,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t).actor,p=z(),l=null,_=null,u=null,d=null,f=null,h=null,g=null,m=null,b=.001*F(),y=c.position;c.position.x+=-s.amplitude_x*s.angularspeed_x*Math.sin(s.initialphase_x+s.angularspeed_x*b)*p,c.position.y+=s.amplitude_y*s.angularspeed_y*Math.cos(s.initialphase_y+s.angularspeed_y*b)*p;var x=Yn(c,0,0,a,l,_,u,d,f,h,g,m);l=x.up,_=x.upright,u=x.right,d=x.downright,f=x.down,h=x.downleft,g=x.left,m=x.upleft;var v=Fn(c,0,l,_,u,d,f,h,g,m);l=v.up,_=v.upright,u=v.right,d=v.downright,f=v.down,h=v.downleft,g=v.left,m=v.upleft,null!=u&&c.position.x>y.x&&(c.position.x=c.hot_spot.x-Gn(c).width+u.x),null!=g&&c.position.x<y.x&&(c.position.x=c.hot_spot.x+g.x+In(g).width),null!=f&&c.position.y>y.y&&(c.position.y=c.hot_spot.y-Gn(c).height+f.y),null!=l&&c.position.y<y.y&&(c.position.y=c.hot_spot.y+l.y+In(l).height),r.update(r,e,n,a,i,o)},Us=function(t,e){var n=t.decorated_machine;n.render(n,e)},Bs=function(t){var e=t.decorated_machine;e.init(e)},Hs=function(t){},Xs=function(t,e,n,a,i,o){var r=t.decorated_machine,s=t.get_object_instance(t).actor;Cn(s,Vn(s,a,bu())),r.update(r,e,n,a,i,o)},Ws=function(t,e){var n=t.decorated_machine;n.render(n,e)},Ys=function(t,e){var n={};return n.init=$s,n.release=zs,n.update=Fs,n.render=Vs,n.get_object_instance=Es,n.decorated_machine=t,n.look_strategy=e,n},$s=function(t){var e=t.decorated_machine;e.init(e)},zs=function(t){},Fs=function(t,e,n,a,i,o){var r=t.decorated_machine,s=t;e[0]&&s.look_strategy(s,e[0]),r.update(r,e,n,a,i,o)},Vs=function(t,e){var n=t.decorated_machine;n.render(n,e)},qs=function(t){var e=t;e.get_object_instance(e).actor.mirror&=~g.eI},Qs=function(t){var e=t;e.get_object_instance(e).actor.mirror|=g.eI},Ks=function(t){var e=t,n=e.get_object_instance(e),a=$l(n);a&&(n.actor.position.x<a.actor.position.x?n.actor.mirror&=~g.eI:n.actor.mirror|=g.eI)},Js=function(t){var e=t,n=e.get_object_instance(e);n.actor.position.x>t.old_x?n.actor.mirror&=~g.eI:n.actor.mirror|=g.eI,t.old_x=n.actor.position.x},Zs=function(t){var e=t.decorated_machine;e.init(e)},tc=function(t){},ec=function(t,e,n,a,i,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t),p=$l(c);if(p){var l=ot(p.actor.position,c.actor.position);if(ct(l)>=5){var _=z(),u=pt(l),d=rt(u,s.speed*_);c.actor.position=it(c.actor.position,d)}}r.update(r,e,n,a,i,o)},nc=function(t,e){var n=t.decorated_machine;n.render(n,e)},ac=function(t){var e=t.decorated_machine;sc(t),e.init(e)},ic=function(t){},oc=function(t,e,n,a,i,o){sc(t)},rc=function(t,e){var n=t.decorated_machine;n.render(n,e)},sc=function(t){var e=t,n=t.get_object_instance(t);Bn(n.actor,e.anim)},cc=function(t){var e=t.decorated_machine;e.init(e)},pc=function(t){},lc=function(t,e,n,a,i,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t).actor,p=z(),l=null,_=null,u=null,d=null,f=null,h=null,g=null,m=null;c.position.x+=s.direction*s.speed*p;var b=Yn(c,2,-2,a,l,_,u,d,f,h,g,m);l=b.up,_=b.upright,u=b.right,d=b.downright,f=b.down,h=b.downleft,g=b.left,m=b.upleft;var y=Fn(c,-2,l,_,u,d,f,h,g,m);l=y.up,_=y.upright,u=y.right,d=y.downright,f=y.down,h=y.downleft,g=y.left,m=y.upleft,null!=u&&s.direction>0&&(c.position.x=c.hot_spot.x-Gn(c).width+u.x,s.direction=-1),null!=g&&s.direction<0&&(c.position.x=c.hot_spot.x+g.x+In(g).width,s.direction=1),null!=f&&(null==d&&null!=h?s.direction=-1:null==h&&null!=d&&(s.direction=1)),r.update(r,e,n,a,i,o)},_c=function(t,e){var n=t.decorated_machine;n.render(n,e)},uc={},dc=[{command:"set_animation",action:function(t,e,n){var a,i,o,r;return 2==e?(a=t,i=n[0],o=n[1],(r={}).init=ac,r.release=ic,r.update=oc,r.render=rc,r.get_object_instance=Es,r.decorated_machine=a,r.anim=rn(i,o),t=r):M("Object script error - set_animation expects two parameters: sprite_name, animation_id"),t}},{command:"set_obstacle",action:function(t,e,n){1==e?t=objectdecorator_setobstacle_new(t,n[0],0):2==e?t=objectdecorator_setobstacle_new(t,n[0],n[1]):M("Object script error - set_obstacle expects at least one and at most two parameters: is_obstacle (TRUE or FALSE) [, angle]")}},{command:"set_alpha",action:function(t,e,n){1==e?t=objectdecorator_setalpha_new(t,n[0]):M("Object script error - set_alpha expects one parameter: alpha (0.0 (transparent) <= alpha <= 1.0 (opaque))")}},{command:"hide",action:function(t,e,n){0==e?t=objectdecorator_setalpha_new(t,0):M("Object script error - hide expects no parameters")}},{command:"show",action:function(t,e,n){0==e?t=objectdecorator_setalpha_new(t,1):M("Object script error - show expects no parameters")}},{command:"enemy",action:function(t,e,n){return 1==e?t=function(t,e){var n={};return n.init=Ps,n.release=Ls,n.update=Rs,n.render=As,n.get_object_instance=Es,n.decorated_machine=t,n.score=e,n}(t,n):M("Object script error - enemy expects one parameter: score"),t}},{command:"lock_camera",action:function(t,e,n){4==e?t=objectdecorator_lockcamera_new(t,n[0],n[1],n[2],n[3]):M("Object script error - lock_camera expects four parameters: x1, y1, x2, y2")}},{command:"move_player",action:function(t,e,n){2==e?t=objectdecorator_moveplayer_new(t,n[0],n[1]):M("Object script error - move_player expects two parameters: speed_x, speed_y")}},{command:"hit_player",action:function(t,e,n){0==e?t=objectdecorator_hitplayer_new(t):M("Object script error - hit_player expects no parameters")}},{command:"burn_player",action:function(t,e,n){0==e?t=objectdecorator_burnplayer_new(t):M("Object script error - burn_player expects no parameters")}},{command:"shock_player",action:function(t,e,n){0==e?t=objectdecorator_shockplayer_new(t):M("Object script error - shock_player expects no parameters")}},{command:"acid_player",action:function(t,e,n){0==e?t=objectdecorator_acidplayer_new(t):M("Object script error - acid_player expects no parameters")}},{command:"add_rings",action:function(t,e,n){1==e?t=objectdecorator_addrings_new(t,n[0]):M("Object script error - add_rings expects one parameter: number_of_rings")}},{command:"add_to_score",action:function(t,e,n){1==e?t=objectdecorator_addtoscore_new(t,n[0]):M("Object script error - add_to_score expects one parameter: score")}},{command:"set_player_animation",action:function(t,e,n){2==e?t=objectdecorator_setplayeranimation_new(t,n[0],n[1]):M("Object script error - set_player_animation expects two parameters: sprite_name, animation_id")}},{command:"enable_player_movement",action:function(t,e,n){0==e?t=objectdecorator_enableplayermovement_new(t):M("Object script error - enable_player_movement expects no parameters")}},{command:"disable_player_movement",action:function(t,e,n){0==e?t=objectdecorator_disableplayermovement_new(t):M("Object script error - disable_player_movement expects no parameters")}},{command:"set_player_xspeed",action:function(t,e,n){1==e?t=objectdecorator_setplayerxspeed_new(t,n[0]):M("Object script error - set_player_xspeed expects one parameter: speed")}},{command:"set_player_yspeed",action:function(t,e,n){1==e?t=objectdecorator_setplayeryspeed_new(t,n[0]):M("Object script error - set_player_yspeed expects one parameter: speed")}},{command:"set_player_position",action:function(t,e,n){2==e?t=objectdecorator_setplayerposition_new(t,n[0],n[1]):M("Object script error - set_player_position expects two parameters: xpos, ypos")}},{command:"bounce_player",action:function(t,e,n){0==e?t=objectdecorator_bounceplayer_new(t):M("Object script error - bounce_player expects no parameters")}},{command:"observe_player",action:function(t,e,n){1==e?t=objectdecorator_observeplayer_new(t,n[0]):M("Object script error - observe_player expects one parameter: player_name")}},{command:"observe_current_player",action:function(t,e,n){0==e?t=objectdecorator_observecurrentplayer_new(t):M("Object script error - observe_current_player expects no parameters")}},{command:"observe_active_player",action:function(t,e,n){0==e?t=objectdecorator_observeactiveplayer_new(t):M("Object script error - observe_active_player expects no parameters")}},{command:"observe_all_players",action:mc},{command:"observe_next_player",action:mc},{command:"attach_to_player",action:function(t,e,n){0==e?t=objectdecorator_attachtoplayer_new(t,0,0):1==e?t=objectdecorator_attachtoplayer_new(t,n[0],0):2==e?t=objectdecorator_attachtoplayer_new(t,n[0],n[1]):M("Object script error - attach_to_player expects at most two parameters: [offset_x [, offset_y]]")}},{command:"springfy_player",action:function(t,e,n){0==e?t=objectdecorator_springfyplayer_new(t):M("Object script error - springfy_player expects no parameters")}},{command:"roll_player",action:function(t,e,n){0==e?t=objectdecorator_rollplayer_new(t):M("Object script error - roll_player expects no parameters")}},{command:"walk",action:function(t,e,n){var a,i,o;return 1==e?(a=t,i=n,(o={}).init=cc,o.release=pc,o.update=lc,o.render=_c,o.get_object_instance=Es,o.decorated_machine=a,o.speed=i,o.direction=-1,t=o):M("Object script error - walk expects one parameter: speed"),t}},{command:"gravity",action:function(t,e,n){var a,i,o;return 0==e?(a=t,o=i={},i.init=Bs,i.release=Hs,i.update=Xs,i.render=Ws,i.get_object_instance=Es,o.decorated_machine=a,t=i):M("Object script error - gravity expects no parameters"),t}},{command:"jump",action:function(t,e,n){1==e?t=objectdecorator_jump_new(t,n[0]):M("Object script error - jump expects one parameter: jump_strength")}},{command:"move",action:bc},{command:"bullet_trajectory",action:bc},{command:"elliptical_trajectory",action:function(t,e,n){var a,i,o,r,s,c,p,l;return e>=4&&e<=6?(a=t,i=n[0],o=n[1],r=n[2],s=n[3],c=n[4],p=n[5],(l={}).init=Ns,l.release=Cs,l.update=Gs,l.render=Us,l.get_object_instance=Es,l.decorated_machine=a,l.amplitude_x=i,l.amplitude_y=o,l.angularspeed_x=r*(2*g.PI),l.angularspeed_y=s*(2*g.PI),l.initialphase_x=c*g.PI/180,l.initialphase_y=p*g.PI/180,t=l):M("Object script error - elliptical_trajectory expects at least four and at most six parameters: amplitude_x, amplitude_y, angularspeed_x, angularspeed_y [, initialphase_x [, initialphase_y]]"),t}},{command:"mosquito_movement",action:function(t,e,n){var a,i,o;return 1==e?(a=t,i=n,(o={}).init=Zs,o.release=tc,o.update=ec,o.render=nc,o.get_object_instance=Es,o.decorated_machine=a,o.speed=i,t=o):M("Object script error - mosquito_movement expects one parameter: speed"),t}},{command:"look_left",action:function(t,e,n){0==e?t=Ys(t,qs):M("Object script error - look_left expects no parameters")}},{command:"look_right",action:function(t,e,n){0==e?t=Ys(t,Qs):M("Object script error - look_right expects no parameters")}},{command:"look_at_player",action:function(t,e,n){return 0==e?t=Ys(t,Ks):M("Object script error - look_at_player expects no parameters"),t}},{command:"look_at_walking_direction",action:function(t,e,n){return 0==e?t=Ys(t,Js):M("Object script error - look_at_walking_direction expects no parameters"),t}},{command:"create_item",action:function(t,e,n){3==e?t=objectdecorator_createitem_new(t,n[0],n[1],n[2]):M("Object script error - create_item expects three parameters: item_id, offset_x, offset_y")}},{command:"change_closest_object_state",action:function(t,e,n){2==e?t=objectdecorator_changeclosestobjectstate_new(t,n[0],n[1]):M("Object script error - change_closest_object_state expects two parameters: object_name, new_state_name")}},{command:"create_child",action:function(t,e,n){3==e?t=objectdecorator_createchild_new(t,n[0],n[1],n[2],""):4==e?t=objectdecorator_createchild_new(t,n[0],n[1],n[2],n[3]):M("Object script error - create_child expects three or four parameters: object_name, offset_x, offset_y [, child_name]")}},{command:"change_child_state",action:function(t,e,n){2==e?t=objectdecorator_changechildstate_new(t,n[0],n[1]):M("Object script error - change_child_state expects two parameters: child_name, new_state_name")}},{command:"change_parent_state",action:function(t,e,n){1==e?t=objectdecorator_changeparentstate_new(t,n[0]):M("Object script error - change_parent_state expects one parameter: new_state_name")}},{command:"destroy",action:function(t,e,n){0==e?t=objectdecorator_destroy_new(t):M("Object script error - destroy expects no parameters")}},{command:"change_state",action:function(t,e,n){1==e?t=objectdecorator_ontimeout_new(t,0,n[0]):M("Object script error - change_state expects one parameter: new_state_name")}},{command:"on_timeout",action:function(t,e,n){2==e?t=objectdecorator_ontimeout_new(t,n[0],n[1]):M("Object script error - on_timeout expects two parameters: timeout (in seconds), new_state_name")}},{command:"on_collision",action:function(t,e,n){2==e?t=objectdecorator_oncollision_new(t,n[0],n[1]):M("Object script error - on_collision expects two parameters: object_name, new_state_name")}},{command:"on_animation_finished",action:function(t,e,n){1==e?t=objectdecorator_onanimationfinished_new(t,n[0]):M("Object script error - on_animation_finished expects one parameter: new_state_name")}},{command:"on_random_event",action:function(t,e,n){2==e?t=objectdecorator_onrandomevent_new(t,n[0],n[1]):M("Object script error - on_random_event expects two parameters: probability (0.0 <= probability <= 1.0), new_state_name")}},{command:"on_player_collision",action:function(t,e,n){1==e?t=objectdecorator_onplayercollision_new(t,n[0]):M("Object script error - on_player_collision expects one parameter: new_state_name")}},{command:"on_player_attack",action:function(t,e,n){1==e?t=objectdecorator_onplayerattack_new(t,n[0]):M("Object script error - on_player_attack expects one parameter: new_state_name")}},{command:"on_player_rect_collision",action:function(t,e,n){5==e?t=objectdecorator_onplayerrectcollision_new(t,n[0],n[1],n[2],n[3],n[4]):M("Object script error - on_player_rect_collision expects five parameters: offset_x1, offset_y1, offset_x2, offset_y2, new_state_name")}},{command:"on_no_shield",action:function(t,e,n){1==e?t=objectdecorator_onnoshield_new(t,n[0]):M("Object script error - on_no_shield expects one parameter: new_state_name")}},{command:"on_shield",action:function(t,e,n){1==e?t=objectdecorator_onshield_new(t,n[0]):M("Object script error - on_shield expects one parameter: new_state_name")}},{command:"on_fire_shield",action:function(t,e,n){1==e?t=objectdecorator_onfireshield_new(t,n[0]):M("Object script error - on_fire_shield expects one parameter: new_state_name")}},{command:"on_thunder_shield",action:function(t,e,n){1==e?t=objectdecorator_onthundershield_new(t,n[0]):M("Object script error - on_thunder_shield expects one parameter: new_state_name")}},{command:"on_water_shield",action:function(t,e,n){1==e?t=objectdecorator_onwatershield_new(t,n[0]):M("Object script error - on_water_shield expects one parameter: new_state_name")}},{command:"on_acid_shield",action:function(t,e,n){1==e?t=objectdecorator_onacidshield_new(t,n[0]):M("Object script error - on_acid_shield expects one parameter: new_state_name")}},{command:"on_wind_shield",action:function(t,e,n){1==e?t=objectdecorator_onwindshield_new(t,n[0]):M("Object script error - on_wind_shield expects one parameter: new_state_name")}},{command:"on_brick_collision",action:function(t,e,n){1==e?t=objectdecorator_onbrickcollision_new(t,n[0]):M("Object script error - on_brick_collision expects one parameter: new_state_name")}},{command:"on_floor_collision",action:function(t,e,n){1==e?t=objectdecorator_onfloorcollision_new(t,n[0]):M("Object script error - on_floor_collision expects one parameter: new_state_name")}},{command:"on_ceiling_collision",action:function(t,e,n){1==e?t=objectdecorator_onceilingcollision_new(t,n[0]):M("Object script error - on_ceiling_collision expects one parameter: new_state_name")}},{command:"on_left_wall_collision",action:function(t,e,n){1==e?t=objectdecorator_onleftwallcollision_new(t,n[0]):M("Object script error - on_left_wall_collision expects one parameter: new_state_name")}},{command:"on_right_wall_collision",action:function(t,e,n){1==e?t=objectdecorator_onrightwallcollision_new(t,n[0]):M("Object script error - on_right_wall_collision expects one parameter: new_state_name")}},{command:"show_dialog_box",action:function(t,e,n){2==e?t=objectdecorator_showdialogbox_new(t,n[0],n[1]):M("Object script error - show_dialog_box expects two parameters: title, message")}},{command:"hide_dialog_box",action:function(t,e,n){0==e?t=objectdecorator_hidedialogbox_new(t):M("Object script error - hide_dialog_box expects no parameters")}},{command:"clear_level",action:function(t,e,n){0==e?t=objectdecorator_clearlevel_new(t):M("Object script error - clear_level expects no parameters")}},{command:"play_sample",action:function(t,e,n){1==e?t=objectdecorator_playsample_new(t,n[0],1,0,1,0):2==e?t=objectdecorator_playsample_new(t,n[0],n[1],0,1,0):3==e?t=objectdecorator_playsample_new(t,n[0],n[1],n[2],1,0):4==e?t=objectdecorator_playsample_new(t,n[0],n[1],n[2],n[3],0):5==e?t=objectdecorator_playsample_new(t,n[0],n[1],n[2],n[3],n[4]):M("Object script error - play_sample expects at least one and at most five parameters: sound_name [, volume [, pan [, frequency [, loops]]]]")}},{command:"play_music",action:function(t,e,n){1==e?t=objectdecorator_playmusic_new(t,n[0],0):2==e?t=objectdecorator_playmusic_new(t,n[0],n[1]):M("Object script error - play_music expects at least one and at most two parameters: music_name [, loops]")}},{command:"play_level_music",action:function(t,e,n){0==e?t=objectdecorator_playlevelmusic_new(t):M("Object script error - play_level_music expects no parameters")}},{command:"set_music_volume",action:function(t,e,n){1==e?t=objectdecorator_setmusicvolume_new(t,n[0]):M("Object script error - set_music_volume expects one parameter: volume")}},{command:null,action:null}],fc=function(t,e){return function(t,e){var n,a,i,o=e;if(0===o.state){var r=t.state.name;for(o.state,o.vm.state_list=(a=o.vm,i=t.state.list,null==js(a.state_list,i)&&(a.state_list=function(t,e,n){var a,i,o,r={};return r.name=e,r.data=(a=n,(o=i={}).init=xs,o.release=vs,o.update=ws,o.render=ks,o.get_object_instance=Is,o.basic=!0,i.object=a,o),r.next=t,r}(a.state_list,i,a.owner)),a.state_list),o.vm=function(t,e){var n=js(t.state_list,e);return null!=n?t.reference_to_current_state=n.data:E('Object script error: can\'t find state "%s".'),t}(o.vm,r),n=Ss(o.vm),ue=0,function(t,e){ue<1024?(uc[ue]={},uc[ue].stmt=t,uc[ue].machine=e,ue++):E("Object script error: you may write %d commands or less per state")}(t.state.list,n);ue-- >0;)n=hc(uc[ue].stmt,uc[ue].machine);n&&n.init(n)}return o.vm.reference_to_current_state=n,t.destroy_if_far_from_play_area&&(o.preserve=!1),t.always_active&&(o.always_active=!0),t.hide_unless_in_editor_mode&&(o.hide_unless_in_editor_mode=!0),o}(e,t)};function hc(t,e){var n,a,i,o,r=t;for(a=r.length,n=0;n<a;n++)o=(i=r[n])[1]&&void 0!==i[1]?i[1].length?i[1].length:1:0,e=gc(e,i[0],o,i[1]);return e}function gc(t,e,n,a){for(var i=0,o=dc[i++];null!=o.command&&null!=o.action;)o.command==e&&(t=o.action(t,n,a)),o=dc[i++];return t}function mc(t,e,n){0==e?t=objectdecorator_observeallplayers_new(t):M("Object script error - observe_all_players expects no parameters")}function bc(t,e,n){var a,i,o,r;return 2==e?(a=t,i=n[0],o=n[1],(r={}).init=Ms,r.release=Os,r.update=Ds,r.render=Ts,r.get_object_instance=Es,r.decorated_machine=a,r.speed=at(i,o),t=r):M("Object script error - bullet_trajectory expects two parameters: speed_x, speed_y"),t}var yc,xc,vc,wc,kc,Ic,Sc,jc,Ec,Mc,Oc,Dc,Tc,Pc,Lc,Rc,Ac,Nc,Cc,Gc,Uc,Bc,Hc,Xc,Wc,Yc,$c,zc,Fc,Vc,qc,Qc,Kc,Jc,Zc,tp,ep,np,ap,ip,op,rp,sp,cp,pp,lp,_p,up,dp,fp,hp,gp,mp,bp,yp,xp,vp,wp,kp,Ip,Sp,jp,Ep,Mp,Op,Dp,Tp,Pp,Lp,Rp,Ap,Np,Cp,Gp,Up,Bp,Hp,Xp,Wp,Yp,$p,zp,Fp,Vp,qp,Qp,Kp,Jp,Zp,tl,el,nl,al,il,ol,rl,sl,cl,pl,ll,_l,ul,dl,fl,hl,gl,ml,bl,yl,xl,vl,wl,kl,Il,Sl,jl,El,Ml,Ol,Dl,Tl,Pl,Ll,Rl,Al,Nl,Cl,Gl,Ul,Bl,Hl=[],Xl=function(t){return Fl(t)},Wl=function(t,e,n,a,i,o){if(t){var r=Ss(t.vm);r.update(r,e,n,a,i,o)}},Yl=function(t,e){if(t){var n=Ss(t.vm);(!t.hide_unless_in_editor_mode||t.hide_unless_in_editor_mode&&ou())&&n.render(n,e)}},$l=function(t){return null!=t.observed_player?t.observed_player:ru()},zl=1,Fl=function(t){var e,n={},a={};return n.name=t,n.state=0,n.actor=Ln(),n.actor.input=be(),n.actor=Bn(n.actor,rn("SD_QUESTIONMARK",0)),n.preserve=!0,n.obstacle=!1,n.obstacle_angle=0,n.always_active=!1,n.hide_unless_in_editor_mode=!1,n.vm=((e={}).owner=n,e.state_list=null,e.reference_to_current_state=null,e),n.created_from_editor=!0,n.parent=null,n.children=ql(),n.observed_player=null,a.in_object_name=t,a.out_object_block=null,a.out_object_block=Vl(yc,a),null!=a.out_object_block?n=fc(n,a.out_object_block):E("Object '%s' does not exist"),n},Vl=function(t,e){var n=t[e.in_object_name];return n?(e.in_object_name,n):(E("Object script error: unknown keyword '%s'"),0)},ql=function(){return null},Ql=[],Kl=function(){return xc},Jl=function(t){return xc>0?(t=J(t,0,xc-1),Ql[t]):null},Zl=function t(e){return null!=e&&(e.next=t(e.next),e=null,e=null),e},t_=!1,e_=[38,40,39,37,78,66,17,123],n_=[87,83,68,65,90,89,71,80],a_={},i_={},o_=0,r_=0,s_=[ps,1,2,3,4,5,7,6,42,78,79,80,81,16,17,18,19,20,54,48,49,50,51,52,53,21,47,22,23,43,44,45,46,55,62,56,57,58,59,60,61,24,25,ds,fs,28,29,30,hs,32,33,34,gs,36,37,75,76,77,38,63,64,65,66,67,68,69,39,70,71,72,73,74,-1],c_=0,p_=function(){return t_},l_=function(){console.log("SAVE");var t=Z_();tu(t),C(We("level saved"))},__=function(){var t,e=z();t=we(Sc,7)?3750:750,(we(Sc,1)||we(jc,1))&&(a_.y-=t*e),(we(Sc,2)||we(jc,2))&&(a_.y+=t*e),(we(Sc,4)||we(jc,4))&&(a_.x-=t*e),(we(Sc,3)||we(jc,3))&&(a_.x+=t*e),a_.x=parseInt(Math.max(a_.x,240),10),a_.y=parseInt(Math.max(a_.y,135.5),10),Wa(a_)},u_=function(t){switch(t){case 1:return"brick";case 2:return"built-in item";case 3:return"object";case 4:return"group"}return"unknown"},d_=function(t,e){switch(t){case 1:vn(e);break;case 2:ms(e)}return""},f_=function t(){o_=0,r_=0,4==(Ec=1==Ec?2:2==Ec?3:3==Ec?4:4==Ec?1:Ec)&&0==Kl()&&t()},h_=function t(){o_=0,r_=0,4==(Ec=2==Ec?1:3==Ec?2:4==Ec?3:1==Ec?4:Ec)&&0==Kl()&&t()},g_=function t(){var e;switch(Ec){case 1:e=wn(),null==vn(o_=(o_+1)%e)&&t();break;case 2:o_=s_[r_=(r_+1)%(e=Dc)];break;case 3:o_=(o_+1)%(e=Pc);break;case 4:e=Kl(),o_=(o_+1)%e}},m_=function t(){var e;switch(Ec){case 1:e=wn(),null==vn(o_=(o_-1+e)%e)&&t();break;case 2:o_=s_[r_=(r_-1+(e=Dc))%e];break;case 3:o_=(o_-1+(e=Pc))%e;break;case 4:e=Kl(),o_=(o_-1+e)%e}},b_=function(t){var e;for(e=0;e<Dc;e++)if(t==s_[e])return e;return-1},y_=function t(e,n,a){var i=null,o=at(0,0);switch(e){case 1:null!=vn(n)&&(i=vn(n).image);break;case 2:var r=ms(n);null!=r&&(i=Gn(r.actor),(o=r.actor.hot_spot).y-=2);break;case 3:var s=Xl(v_(n));null!=s&&(i=Gn(s.actor),(o=s.actor.hot_spot).y-=2);break;case 4:var c;for(c=Jl(n);c;c=c.next)t(EDITORGRP_ENTITY_TO_EDT(c.entity.type),c.entity.id,it(a,c.entity.position))}null!=i&&Qe(i.data,St(),i.sx,i.sy,parseInt(a.x-o.x,10),parseInt(a.y-o.y,10),i.swidth,i.sheight)},x_=function(t){var e;for(e=0;e<Pc;e++)if(t==Tc[e])return e;return-1},v_=function(t){return null},w_=function(){c_=!1},k_=function(){},I_=function(){ke(jc,7)&&(c_=!c_)},S_=function(t){var e=ot(a_,at(240,135.5)),n=parseInt(e.x%1,10),a=parseInt(e.y%1,10),i=-n+1*parseInt(t.x/1,10),o=-a+1*parseInt(t.y/1,10);return it(e,at(i,o))},j_=function(t,e,n,a){var i={};return i.type=t?1:2,i.obj_type=e,i.obj_id=n,i.obj_position=a,i},E_=function(t,e,n){var a={};return a.type=t?3:4,a.obj_position=e,a.obj_old_position=n,a},M_=function(){Rc=D_(Rc),Lc=null,Ac=null},O_=function t(e){console.log("REGISTER",e);var n,a=!1;if(4!=e.obj_type){var i,o,r;for((r={}).action=e,r.in_group=a,r.in_group&&(r.group_key=n),null!=(i=Ac)&&(i.next=D_(i.next)),o=Lc;null!=o.next;)o=o.next;o.next=r,r.prev=o,r.next=null,Ac=r}else{var s,c=48879;for(a=!0,n=c++,s=Jl(e.obj_id);s;s=s.next){var p=s.entity,l=EDITORGRP_ENTITY_TO_EDT(p.type);t(j_(!0,l,p.id,it(p.position,e.obj_position)))}a=!1}},D_=function(t){var e,n;for(e=t;null!=e;)n=e.next,e=null,e=n;return null},T_=function t(){var e,n;Ac!=Rc&&(e=Ac,Ac=Ac.prev,e.in_group&&e.prev&&e.prev.in_group&&e.group_key==e.prev.group_key&&t(),(n=e.action).type=1==n.type?2:2==n.type?1:3==n.type?4:4==n.type?3:n.type,L_(n))},P_=function t(){var e,n;null!=Ac.next&&((e=Ac=Ac.next).in_group&&e.next&&e.next.in_group&&e.group_key==e.next.group_key&&t(),n=e.action,L_(n))},L_=function t(e){if(console.log("COMMIT",e),1==e.type)switch(e.obj_type){case 1:yu(e.obj_id,e.obj_position);break;case 2:xu(e.obj_id,e.obj_position);break;case 3:vu(v_(e.obj_id),e.obj_position);break;case 4:var n;for(n=Jl(e.obj_id);n;n=n.next){var a=n.entity,i=EDITORGRP_ENTITY_TO_EDT(a.type);t(j_(!0,i,a.id,it(a.position,e.obj_position)))}}else if(2==e.type)switch(e.obj_type){case 1:var o,r=vn(e.obj_id);for(o=Nc;o;o=o.next)o.data.brick_ref==r&&ct(ot(at(o.data.x,o.data.y),e.obj_position))<g.Ib&&(o.data.state=1);break;case 2:var s,c=e.obj_id;for(s=item_list;s;s=s.next)s.data.type==c&&ct(ot(s.data.actor.position,e.obj_position))<g.Ib&&(s.data.state=IS_DEAD);break;case 3:var p,l=e.obj_id;for(p=enemy_list;p;p=p.next)x_(p.data.name)==l&&ct(ot(p.data.actor.position,e.obj_position))<g.Ib&&(p.data.state=ES_DEAD)}else 3==e.type?(_u(e.obj_position),Mu()):4==e.type&&(_u(e.obj_old_position),Mu())},R_=function(t,e){C_(t,e,!0),An(t.actor,e),C_(t,e,!1)},A_=function(t){return 1==t.state},N_=function(t,e){var n;for(n=0;n<e.length&&1!=t.state;n++)if(e[n]&&Wn(t.actor,e[n].actor))return!(!e[n].attacking(e[n])&&!e[n].invincible&&(e[n].hit(e[n]),1));return!1},C_=function(t,e,n){var a=t.actor,i=.001*F();if(3===t.type){var o,r=at(0,0);if(sn(rn("SD_INVSTAR",0),1),1!=t.state)for(o=0;o<5;o++)r.x=a.position.x+20*Math.cos(2*g.PI*i+2*o*g.PI/5),r.y=a.position.y+20*Math.sin(g.PI*i+2*o*g.PI/5)}},G_=[0,1,2],U_=lt,B_="data/levels/blue_ocean_1.json",H_=null,X_=[],W_=[],Y_=[],$_=[],z_={position:{x:0,y:0}},F_=[],V_=[],q_=[],Q_=[],K_=[],J_=function(t){B_=t,E("level_setfile('%s')")},Z_=function(){return B_},tu=function(t){var e,n,a,i,o,r={name:Cc,act:Xc,theme:Uc,bgtheme:Bc,grouptheme:Hc,spawn_point:Fc,music:Gc,boss:null,bricklist:[],itemlist:[],enemylist:[],dialogbox:[]};od()&&(r.boss={id:ep.type,x:ep.actor.spawn_point.x,y:ep.actor.spawn_point.y,rx:ep.rect_x,ry:ep.rect_y,rw:ep.rect_w,rh:ep.rect_h});var s=[];for(a=H_;a;a=a.next)s.push({id:Du(a.data),xpos:a.data.sx,ypos:a.data.sy});r.bricklist=s;var c=[];for(i=X_;i;i=i.next)i.data&&c.push({id:i.data.type,xpos:i.data.actor.spawn_point.x,ypos:i.data.actor.spawn_point.y});r.itemlist=c;var p=[];for(o=W_;o;o=o.next)o.data&&o.data.created_from_editor&&p.push({id:o.data.name,xpos:o.data.actor.spawn_point.x,ypos:o.data.actor.spawn_point.y});r.enemylist=p;var l=[];for(e=0,n=K_.length;e<n;e++)l.push({xpos:K_[e].rect_x,ypos:K_[e].rect_y,width:K_[e].rect_w,height:K_[e].rect_h,title:K_[e].title,message:K_[e].message});r.dialogbox=l;var _=t.split("/");_=_[_.length-1],console.log("saveFile",t,r),E("level_save() ok")},eu=function(){var t;U_=lt,E("level_init()"),H_=null,X_=[],$_=[],Wc=800,Yc=$c=0,zc=0,Ep=0,sp=!1,Qc=!1,Kc="",cp=pp=lp=0,V_=fp=hp=0,_p=up=!1,dp=!1,Jc=null,Cu(),E("editor_init()"),Nc=ju(),t_=!1,Dc=s_.length,Ec=1,o_=0,vc=jt(),wc=Et(),Tc=Hl.name,kc=qe("data/images/editorbg.png"),Sc=ye(e_),jc=ye(n_),Ic=function(){var t,e={type:4,enabled:!0};for(e.dx=e.dy=e.x=e.y=0,e.state=[],e.oldstate=[],e.howlong=[],t=0;t<9;t++)e.state[t]=e.oldstate[t]=!1,e.howlong[t]=0;return Oe(e),e}(),Mc=ta(8),Oc=ta(8),function(){var t;for(xc=0,t=0;t<501;t++)Ql[t]=null}(),w_(),E("editor_init() ok"),rd(B_).then((function(){for(E("Creating players..."),t=0;t<G_.length;t++){var e=ci(G_[t]);e.hit=ui,e.kill=di,e.set_rings=yi,e.get_rings=gi,e.got_glasses=!1,$_.push(e)}for(Yu(),Zc=$_[tp=0],Ba.is_locked=!1,Ba.speed=0,Ba.region_topleft_speed=0,Ba.region_bottomright_speed=0,Ba.position=Ba.dest=at(0,0),Ba.region_topleft.x=Ba.dest_region_topleft.x=240,Ba.region_topleft.y=Ba.dest_region_topleft.y=135.5,Ba.region_bottomright.x=Ba.dest_region_bottomright.x=pu().x-240,Ba.region_bottomright.y=Ba.dest_region_bottomright.y=pu().y-135.5,Wa(Zc.actor.position),ad(Zc.actor),yi(0),np=!1,ap=!1,E("Loading hud..."),(ip=Ln()).position=at(16,7),ip=Bn(ip,rn("SD_MAINGUI",0)),(op=Ln()).position=at(16,248),op=Bn(op,rn("SD_LIFEGUI",0)),(rp=ta(0)).position=it(op.position,at(32,11)),t=0;t<3;t++)F_[t]=ta(2),F_[t].position=it(ip.position,at(42,16*t+2));for((yp=Ln()).position=at(0,-240),yp=Bn(yp,rn("SD_LEVELOP",0)),(xp=Ln()).position=at(260,250),xp=Bn(xp,rn("SD_LEVELACT",Xc-1)),(vp=ta(3)).position=at(330,50),ea(vp,"%s",Cc.toUpperCase()),ia(vp,180),gp=ta(4),mp=ta(7),bp=Ln(),t=0;t<3;t++)q_[t]=ta(2),Q_[t]=Ln();wp=!1,kp=0,(Ip=Ln()).position.y=_t,Ip=Bn(Ip,rn("SD_DIALOGBOX",0)),Sp=ta(8),jp=ta(8)}))},nu=function(){var t,e;zc+=z();var n,a,i,o,r,s,c,p=!1,l=!1,_=!1,u=z();if(td(),Ju(),Zu(),p_())!function(){Nc||(Nc=ju());var t,e,n,a,i,o=sn(rn("SD_ARROW",0),0),r=aa(Mc).x,s=aa(Mc).y,c=ot(a_,at(240,135.5));if(we(Sc,7)&&ke(Sc,8)&&l_(),we(Sc,8))return E("editor_disable()"),M_(),t_=!1,Tt(vc,wc,Mt()),void E("editor_disable() ok");if(we(Sc,7)?((ke(Sc,5)||ke(Ic,2))&&f_(),(ke(Sc,6)||ke(Ic,1))&&h_()):((ke(Sc,5)||ke(Ic,2))&&g_(),(ke(Sc,6)||ke(Ic,1))&&m_()),i_.x=J(Me(Ic).x,0,lt-o.width),i_.y=J(Me(Ic).y,0,_t-o.height),ke(Ic,5)&&we(Sc,7)){var p=S_(i_),l=E_(!0,p,spawn_point);L_(l),O_(l)}if(ke(Ic,5)&&!we(Sc,7)){var _=j_(!0,Ec,o_,S_(i_));L_(_),O_(_)}if(t=ke(Ic,7),e=ke(Ic,6),t||e)switch(console.log(t,e,Ec,1),Ec){case 1:for(n=Nc;n;n=n.next){var u=[n.data.x,n.data.y,n.data.x+n.data.brick_ref.image.width,n.data.y+n.data.brick_ref.image.height],d=[i_.x+c.x,i_.y+c.y,i_.x+c.x+1,i_.y+c.y+1];if(Z(u,d)){if(!t){var f=j_(!1,1,Eu(n.data),at(n.data.x,n.data.y));L_(f),O_(f);break}o_=Eu(n.data)}}break;case 2:for(a=item_list;a;a=a.next){var h=[a.data.actor.position.x-a.data.actor.hot_spot.x,a.data.actor.position.y-a.data.actor.hot_spot.y,a.data.actor.position.x-a.data.actor.hot_spot.x+Gn(a.data.actor).width,a.data.actor.position.y-a.data.actor.hot_spot.y+Gn(a.data.actor).height],g=[i_.x+c.x,i_.y+c.y,i_.x+c.x+1,i_.y+c.y+1];if(Z(h,g)){if(!t){var m=j_(!1,2,a.data.type,a.data.actor.position);L_(m),O_(m);break}var b=b_(a.data.type);b>=0&&(r_=b,o_=s_[b])}}break;case 3:for(i=enemy_list;i;i=i.next){var y=[i.data.actor.position.x-i.data.actor.hot_spot.x,i.data.actor.position.y-i.data.actor.hot_spot.y,i.data.actor.position.x-i.data.actor.hot_spot.x+Gn(i.data.actor).width,i.data.actor.position.y-i.data.actor.hot_spot.y+Gn(i.data.actor).height],x=[i_.x+c.x,i_.y+c.y,i_.x+c.x+1,i_.y+c.y+1],v=x_(i.data.name);if(v>=0&&Z(y,x)){if(!t){var w=j_(!1,3,v,i.data.actor.position);L_(w),O_(w);break}o_=v}}}we(Sc,7)&&(ke(jc,5)?T_():ke(jc,6)&&P_()),I_(),__(),ea(Mc,"%d,%d",parseInt(S_(i_).x,10),parseInt(S_(i_).y,10)),Mc.position.x=J(parseInt(i_.x,10),10,lt-r*na(Mc).length-10),Mc.position.y=J(parseInt(i_.y-3*s,10),10,261),Oc.position=at(10,10),3!=Ec?ea(Oc,"<color=ffff00>%s %d</color>\n%s",u_(Ec),o_,d_(Ec,o_)):ea(Oc,'<color=ffff00>%s "%s"</color>\n%s',u_(Ec),v_(o_),d_(Ec,o_))}();else{for(_=zc<5,t=0;t<$_.length&&!_;t++)$_[t]&&(_=$_[t].dead);if(Zc&&Zc.actor&&ke(Zc.actor.input,8)&&!_){console.log("QUIT");var d=[];return Vc.pause(),d[0]=Ae("CBOX_QUIT_QUESTION"),d[1]=Ae("CBOX_QUIT_OPTION1"),d[2]=Ae("CBOX_QUIT_OPTION2"),ga(d[0],d[1],d[2]),void Ue(Rh(Mh))}if(1==(e=ma())?Qc=!0:2==e&&T(Vc,!0),Qc)return xt()?(Be(),void hd()):void yt(Je(0,0,0),1);if(ke(Sc,9))return E("editor_enable()"),(Rc={}).in_group=!1,Rc.prev=null,Rc.next=null,Lc=Rc,Ac=Rc,t_=!0,a_.x=parseInt(Xa().x,10),a_.y=parseInt(Xa().y,10),i_=at(240,135.5),vc=jt(),wc=Et(),Tt(3,!1,Mt()),void E("editor_enable() ok");for(l=zc<5,t=0;t<$_.length&&!l;t++)l=$_[t].dying||$_[t].dead;if(Zc&&ke(Zc.actor.input,7)&&!l)return Zc.spin_dash=Zc.braking=!1,null==O||O.is_paused||(O.is_paused=!0,O.pause()),void Ue(Rh(wh));ip=Bn(ip,rn("SD_MAINGUI",gi()>0?0:1)),op=Bn(op,rn("SD_LIFEGUI",tp)),rp=ea(rp,"%d",mi()),ea(F_[0],"%d",bi());var f=parseInt(zc%60,10);if(f<10&&(f="0"+f),ea(F_[1],"%s",parseInt(zc/60,10)+":"+f),ea(F_[2],"%d",gi()),yp&&(zc<5?zc<1.5?(yp.position.y+=360*u,yp.position.y>-2&&(yp.position.y=-2),vp.position.x-=320*u,vp.position.x<140&&(vp.position.x=140),xp.position.y-=200*u,xp.position.y<200&&(xp.position.y=200)):zc>3.5&&(yp.position.x-=320*u):(yp.visible=!1,vp.visible=!1,xp.visible=!1)),sp){var h=0,m=F(),b=We("ring count"),y=We("cash"),x=We("glasses");if(m>=cp+2e3){for(t=0;t<$_.length;t++)$_[t]&&($_[t].actor.speed.x=0);for(gp.position.x=Math.min(gp.position.x+800*u,30),mp.position.x=Math.min(mp.position.x+700*u,12),bp.position.x=Math.max(bp.position.x-700*u,250),t=0;t<3;t++)Q_[t].position.x=Math.min(Q_[t].position.x+(400-50*t)*u,50),q_[t].position.x=Math.max(q_[t].position.x-(400-50*t)*u,230);h=hp-(V_+fp),ea(q_[0],"%d",parseInt(V_,10)),ea(q_[1],"%d",parseInt(fp,10)),ea(q_[2],"%d",parseInt(h,10)),dp||(P(),C(We("goal")),dp=!0)}if(m>=cp+6e3&&!_p)if(V_=Math.max(0,V_-400*u),fp=Math.max(0,fp-2e3*u),V_>0||fp>0)b&&m>=lp&&(lp=m+100,C(b));else for(_p=!0,pp=m+4e3,C(y),t=0;t<$_.length;t++)if($_[t].got_glasses){C(x);break}_p&&m>=pp&&(up=!0)}for(Xu(),Hu(),p=!1,t=0;t<$_.length;t++)$_[t].dying&&(p=!0);for(r=Qu(),n=Vu(),a=null,xa(Jc),s=X_;s;s=s.next)if(s.data&&s.data.actor){var v=s.data.actor.position.x,w=s.data.actor.position.y,k=Gn(s.data.actor).width,I=Gn(s.data.actor).height;if(id(v,w,k,I,U_)){if(bs(s.data,$_,3,n,X_,W_),s.data.obstacle){var S=void 0,j=void 0,M=it(s.data.actor.hot_spot,at(0,-1)),D=Gn(s.data.actor),A=$u(D.width,D.height-1,ot(s.data.actor.position,M),0);A.brick_ref.zindex=s.data.bring_to_back?.4:.5,(S={}).next=a,S.data=A,a=S,(j={}).next=n,j.data=A,n=j}}else s.data.preserve||(s.data.state=cs)}for(c=W_;c;c=c.next)if(c.data){var N=c.data.actor.position.x,G=c.data.actor.position.y,U=Gn(c.data.actor).width,B=Gn(c.data.actor).height;if(id(N,G,U,B,U_)||c.data.always_active){if(Zc&&Zc.actor&&Zc.actor.input.enabled&&(p||sp||Wl(c.data,$_,$_.length,n,r,W_)),c.data.obstacle){var H=void 0,X=void 0,W=it(c.data.actor.hot_spot,at(0,-1)),Y=Gn(c.data.actor),$=$u(Y.width,Y.height-1,ot(c.data.actor.position,W),c.data.obstacle_angle);(H={}).next=a,H.data=$,a=H,(X={}).next=n,X.data=$,n=X}}else c.data.preserve?id(c.data.actor.spawn_point.x,c.data.actor.spawn_point.y,U,B,U_)||(c.data.actor.position=at(c.data.actor.spawn_point.x,c.data.actor.spawn_point.y)):c.data.state=cs}if(od()&&Zc&&Zc.actor){var V,q=Zc.actor,Q=[q.position.x,q.position.y,q.position.x+1,q.position.y+1],tt=[ep.rect_x,ep.rect_y,ep.rect_x+ep.rect_w,ep.rect_y+ep.rect_h];if(p||function(t,e,n){var a=t.actor,i=null,o=null,r=null,s=null,c=null,p=null,l=null,_=null,u=[],d=Yn(a,2,-2,n,i,o,r,s,c,p,l,_);i=d.up,o=d.upright,r=d.right,s=d.downright,c=d.down,p=d.downleft,l=d.left,_=d.upleft;var f=Fn(a,-2,i,o,r,s,c,p,l,_);if(i=f.up,o=f.upright,r=f.right,s=f.downright,c=f.down,p=f.downleft,l=f.left,_=f.upleft,u[0]=i,u[1]=o,u[2]=r,u[3]=s,u[4]=c,u[5]=p,u[6]=l,u[7]=_,gu())switch(t.hp<=0&&1!=t.state&&(mu(),t.state=1),t.type){case 0:!function(t,e,n,a){var i=ru(),o=.001*F(),r=t.actor,s=t.value[0],c=t.value[1];if(1==t.state){if(t.bring_to_front=!0,Bn(r,rn("SD_SIMPLEBOSS",2)),r.position.y+=100*z(),o>=c+.15){var p=at(r.position.x-r.hot_spot.x+K(Gn(r).width),r.position.y-r.hot_spot.y+K(Gn(r).height));xu(us,p),r.position.y<=r.spawn_point.y+406.5&&C(We("boss hit")),c=o}}else r.maxspeed=200-100/t.initial_hp*t.hp,r.acceleration=r.maxspeed,r.position.x<r.spawn_point.x-200&&(t.direction=1),r.position.x>r.spawn_point.x&&(t.direction=3),1==t.direction?Se(r.input,3):3==t.direction&&Se(r.input,4),r.position.y=r.spawn_point.y+20*Math.cos(g.PI*o),r.mirror=1==t.direction?g.in:g.eI,Cn(r,qn(r)),o>=s+2/t.initial_hp*t.hp&&(vu([0,3][parseInt(K(2),10)],r.position).actor.speed.y=-150-K(50),s=o),N_(t,e)&&r.animation==rn("SD_SIMPLEBOSS",0)&&(Bn(r,rn("SD_SIMPLEBOSS",1)),C(We("boss hit")),i.actor.speed.x*=-1,i.actor.speed.y=100,t.hp--),Hn(r)&&Bn(r,rn("SD_SIMPLEBOSS",0)),t.value[0]=s,t.value[1]=c}(t,e);break;case 1:!function(t,e,n,a){var i,o=ru(),r=t.actor,s=.001*F(),c=z(),p=t.value[0],l=t.value[1],_=t.value[2];switch(t.state){case 0:if(t.direction=o.actor.position.x<r.position.x?3:1,r.position.y=r.spawn_point.y+30*Math.cos(g.PI*s),Hn(r)&&actor.change_animation(r,rn("SD_MECHASHADOW",0)),s>=p+5){var u,d=at(o.actor.position.x-r.position.x,o.actor.position.y-r.position.y);d=rt(pt(d),200),(u=xu(40,r.position)).dangerouspower_set_speed(u,d),C(We("big shot")),p=s}if(s>=l+15){var f=t.rect_x+t.rect_w/2;t.direction=r.position.x>f?3:1,Bn(r,rn("SD_MECHASHADOW",2)),t.state=2,l=s}break;case 2:var h=t.rect_x+100,m=t.rect_x+t.rect_w-100,b=m-h+(r.position.x-h),y=3==t.direction?-1:1;r.position.x+=200*y*c,r.position.y=r.spawn_point.y-100*Math.sin(g.PI/(m-h)*b),Hn(r)&&Bn(r,rn("SD_MECHASHADOW",2)),(-1==y&&r.position.x<=h||1==y&&r.position.x>=m)&&(Bn(r,rn("SD_MECHASHADOW",0)),t.state=0);break;case 1:if(t.bring_to_front=!0,Bn(r,rn("SD_MECHASHADOW",4)),r.position.y+=100*z(),s>=_+.15){var x=at(r.position.x-r.hot_spot.x+K(Gn(r).width),r.position.y-r.hot_spot.y+K(Gn(r).height));xu(us,x),r.position.y<=r.spawn_point.y+406.5&&C(We("boss hit")),_=s}}i=r.animation==rn("SD_MECHASHADOW",1)||r.animation==rn("SD_MECHASHADOW",3),N_(t,e)&&!i&&1!=t.state&&(r.animation=rn("SD_MECHASHADOW",2==t.state?3:1),C(We("boss hit")),t.hp--,o.actor.speed.x*=-.5,o.actor.speed.y=o.actor.jump_strength),r.mirror=1==t.direction?g.in:g.eI}(t,e);break;case 2:!function(t,e,n,a){var i=ru(),o=.001*F(),r=t.actor,s=t.value[0],c=t.value[1],p=t.value[2];if(1==t.state){if(t.bring_to_front=!0,Bn(r,rn("SD_SIMPLEBOSS",2)),r.position.y+=100*z(),o>=c+.15){var l=at(r.position.x-r.hot_spot.x+K(Gn(r).width),r.position.y-r.hot_spot.y+K(Gn(r).height));xu(us,l),r.position.y<=r.spawn_point.y+406.5&&C(We("boss hit")),c=o}}else r.maxspeed=200-100/t.initial_hp*t.hp,r.acceleration=r.maxspeed,r.position.x<r.spawn_point.x-200&&(t.direction=1),r.position.x>r.spawn_point.x&&(t.direction=3),1==t.direction?Se(r.input,3):3==t.direction&&Se(r.input,4),r.position.y=r.spawn_point.y+20*Math.cos(g.PI*o),r.mirror=1==t.direction?g.in:g.eI,Cn(r,qn(r)),o>=s+2/t.initial_hp*t.hp&&(vu(["9","6"][parseInt(K(2),10)],r.position).actor.speed.y=-150-K(50),s=o),o>=p+3/t.initial_hp*t.hp&&(xu(41,r.position).actor.speed.y=100,C(We("fire")),p=o),N_(t,e)&&r.animation==rn("SD_SIMPLEBOSS",0)&&(Bn(r,rn("SD_SIMPLEBOSS",1)),C(We("boss hit")),i.actor.speed.x*=-1,i.actor.speed.y=100,t.hp--),Hn(r)&&Bn(r,rn("SD_SIMPLEBOSS",0)),t.value[0]=s,t.value[1]=c,t.value[2]=p}(t,e);break;case 3:!function(t,e,n,a){var i,o=ru(),r=t.actor,s=.001*F(),c=z(),p=t.value[0],l=t.value[1],_=t.value[2],u=t.value[3];switch(t.state){case 0:if(t.direction=o.actor.position.x<r.position.x?3:1,r.position.y=r.spawn_point.y+30*Math.cos(g.PI*s),Hn(r)&&Bn(r,rn("SD_MECHASHADOW",0)),s>=p+4){var d,f=at(o.actor.position.x-r.position.x,o.actor.position.y-r.position.y);f=rt(pt(f),200),(d=xu(40,r.position)).dangerouspower_set_speed(d,f),C(We("big shot")),p=s}if(s>=l+8){var h=t.rect_x+t.rect_w/2;t.direction=r.position.x>h?3:1,Bn(r,rn("SD_MECHASHADOW",2)),t.state=2,l=s}break;case 2:var m=t.rect_x+100,b=t.rect_x+t.rect_w-100,y=b-m+(r.position.x-m),x=3==t.direction?-1:1;r.position.x+=200*x*c,r.position.y=r.spawn_point.y-100*Math.sin(g.PI/(b-m)*y),s>=u+.2&&(xu(41,r.position).actor.speed.y=-200,C(We("fire")),u=s),Hn(r)&&Bn(r,rn("SD_MECHASHADOW",2)),(-1==x&&r.position.x<=m||1==x&&r.position.x>=b)&&(Bn(r,rn("SD_MECHASHADOW",0)),t.state=0);break;case 1:if(t.bring_to_front=!0,Bn(r,rn("SD_MECHASHADOW",4)),r.position.y+=100*z(),s>=_+.15){var v=at(r.position.x-r.hot_spot.x+K(Gn(r).width),r.position.y-r.hot_spot.y+K(Gn(r).height));xu(us,v),r.position.y<=r.spawn_point.y+406.5&&C(We("boss hit")),_=s}}i=r.animation==rn("SD_MECHASHADOW",1)||r.animation==rn("SD_MECHASHADOW",3),N_(t,e)&&!i&&1!=t.state&&(r.animation=rn("SD_MECHASHADOW",2==t.state?3:1),C(We("boss hit")),t.hp--,o.actor.speed.x*=-.5,o.actor.speed.y=o.actor.jump_strength),r.mirror=1==t.direction?g.in:g.eI,t.value[0]=p,t.value[1]=l,t.value[2]=_,t.value[3]=u}(t,e)}}(ep,$_,H_),!A_(ep)&&Z(Q,tt)&&(np=!0,ap=!0),!A_(ep))for(t=0;t<$_.length;t++)($_[t]!=Zc||Zc.actor.carrying)&&((V=$_[t].actor).position.x>ep.rect_x-30&&V.position.x<ep.rect_x&&(V.position.x=ep.rect_x-30,V.speed.x=0),V.position.x>ep.rect_x+ep.rect_w&&V.position.x<ep.rect_x+ep.rect_w+30&&(V.position.x=ep.rect_x+ep.rect_w+30,V.speed.x=0));(A_(ep)||Zc.dying)&&(np=!1,Vc&&(L(R()-.5*u),R()<g.Ib&&(P(),L(1),qc=!0)))}for(t=0;t<$_.length;t++)je($_[t].actor.input);for(Zc&&Zc.actor&&zc>=3.5&&Ee(Zc.actor.input),t=0;t<$_.length;t++){var et=$_[t].actor.position.x,nt=$_[t].actor.position.y,st=Gn($_[t].actor).width,ut=Gn($_[t].actor).height,dt=$_[t].actor.hot_spot.y;if(t!=tp&&($_[t].getting_hit&&Wu(t),$_[t].dying&&(Wu(t),z_!=$_[t].actor&&Ha($_[t].actor.position,0))),$_[t].dead){if(!(mi()>1))return Be(),void Ue(Rh(kh));if(xt())return xi(mi()-1),void Tu();yt(Je(0,0,0),1)}if(up){if(xt())return void Be();yt(Je(0,0,0),1)}(id(et,nt,st,ut,U_/4)||$_[t].dying)&&(!p||$_[t].dying||$_[t].getting_hit)&&pi($_[t],$_,n),$_[t].actor.position.y<dt&&!$_[t].dying?($_[t].actor.position.y=dt,$_[t].actor.speed.y=0):$_[t].actor.position.y>$c-(ut-dt)&&id(et,nt,st,ut,U_/4)&&di($_[t])}if(p||sp||(zc+=z()/1e3,Zc&&ke(Zc.actor.input,6)&&(!(Math.abs(Zc.actor.speed.y)<g.Ib)||Zc.on_moveable_platform||np||Zc.disable_movement||Zc.in_locked_area?C(We("deny")):Wu((tp+1)%3))),od()&&np){var ft=Zc.actor;ft&&(ft.position.x<ep.rect_x?(ft.position.x=ep.rect_x,ft.speed.x=Math.max(0,ft.speed.x)):ft.position.x>ep.rect_x+ep.rect_w&&(ft.position.x=ep.rect_x+ep.rect_w,ft.speed.x=Math.min(ft.speed.x,0)),ft.position.y=J(ft.position.y,ep.rect_y,ep.rect_y+ep.rect_h))}for(Gu(n),i=n;i;i=i.next){if(i.data&&2==i.data.brick_ref.behavior){var ht=i.data.brick_ref.image.width,gt=i.data.brick_ref.image.height,mt=[i.data.x,i.data.y,i.data.x+ht,i.data.y+gt],bt=[i.data.x,i.data.y,i.data.x+ht,i.data.y+gt];for(t=0;t<$_.length;t++)if($_[t]&&(mt[0]=$_[t].actor.position.x-$_[t].actor.hot_spot.x-3,mt[1]=$_[t].actor.position.y-$_[t].actor.hot_spot.y-3,mt[2]=mt[0]+Gn($_[t].actor).width+6,mt[3]=mt[1]+Gn($_[t].actor).height+6,($_[t].spin_dash||$_[t].spin||2==$_[t].type)&&Z(mt,bt))){var vt,wt,kt=void 0,It=void 0;for(wt=Math.max(i.data.brick_ref.behavior_arg[0],1),vt=Math.max(i.data.brick_ref.behavior_arg[1],1),kt=0;kt<wt;kt++)for(It=0;It<vt;It++){var St=at(i.data.x+kt*ht/wt,i.data.y+It*gt/vt),Ot=at(.3*-$_[t].actor.speed.x,-100-K(50)),Dt=Ve(ht/wt,gt/vt);Math.abs(Ot.x)>g.Ib&&(Ot.x+=(Ot.x>0?1:-1)*K(50)),wu(Dt,St,Ot,!1)}C(We("break")),i.data.state=1}}if(i.data&&3==i.data.brick_ref.behavior&&2==i.data.state){var Pt=i.data;if(Pt.value[1]+=z(),Pt.value[1]>=1){var Lt,Rt,At=void 0,Nt=void 0,Ct=0!=parseInt(Pt.brick_ref.behavior_arg[2],10),Gt=Pt.brick_ref.image;for(Lt=Math.max(Pt.brick_ref.behavior_arg[0],1),Rt=Math.max(Pt.brick_ref.behavior_arg[1],1),At=0;At<Lt;At++)for(Nt=0;Nt<Rt;Nt++){var Ut=at(Pt.x+At*Gt.width/Lt,Pt.y+Nt*Gt.height/Rt),Bt=at(0,20+20*Nt+20*(Ct?At:Lt-At)),Ht=Ve(Gt.width/Lt,Gt.height/Rt);wu(Ht,Ut,Bt,!1)}C(We("break")),Pt.state=1}}nd(i.data)}for(i=a;i;i=o)o=i.next,ed(i.data),i=null;if(a=null,qu(n),Ku(r),Zc&&Zc.actor&&ad(Zc.actor),sp)Ha(it(z_.position,at(0,-90)),.17);else if(np){var Xt=[ep.rect_x+240,ep.rect_x+ep.rect_w-240],Wt=at(J(z_.position.x,Xt[0],Xt[1]),z_.position.y);Ha(it(Wt,at(0,-90)),.17)}else p||Ha(z_.position,.1);!function(){var t,e=z();Ya(),t=ot(Ba.dest,Ba.position),ct(t)>10&&(t=pt(t),Ba.position.x+=t.x*Ba.speed*e,Ba.position.y+=t.y*Ba.speed*e),t=ot(Ba.dest_region_topleft,Ba.region_topleft),ct(t)>10&&(t=pt(t),Ba.region_topleft.x+=t.x*Ba.region_topleft_speed*e,Ba.region_topleft.y+=t.y*Ba.region_topleft_speed*e),t=ot(Ba.dest_region_bottomright,Ba.region_bottomright),ct(t)>10&&(t=pt(t),Ba.region_bottomright.x+=t.x*Ba.region_bottomright_speed*e,Ba.region_bottomright.y+=t.y*Ba.region_bottomright_speed*e)}()}Bu()},au=function(){if(wt(),p_())return e=ot(a_,at(240,135.5)),kc.width,kc.height,function(){if(c_){var t,e,n,a,i=ot(a_,at(240,135.5));for(n=Ve(1,1),a=Je(0,128,160),Ze(n,0,0,0),t=0;t<n.height;t++)Ke(0,St(),n.width-1,t,a);for(t=0;t<n.width;t++)Ke(0,St(),t,n.height-1,a);for(t=0;t<=480;t++)for(e=0;e<=271;e++)ot(S_(at(t*n.width,e*n.height)),i);tn(n)}}(),Su(),y_(Ec,o_,ot(S_(i_),e)),t=sn(rn("SD_ARROW",0),0),Qe(t.data,St(),t.sx,t.sy,parseInt(i_.x,10),parseInt(i_.y,10),t.width,t.height),oa(Mc,at(240,135.5)),void oa(Oc,at(240,135.5));var t,e;va(Jc,Xa()),Pu(),wa(Jc,Xa()),Ru()},iu=function(){var t;for(E("level_release()"),tn(Kc),Ou(),t=0;t<$_.length;t++)$_[t];for(E("editor_release()"),k_(),function(){var t;for(t=0;t<xc;t++)Ql[t]=Zl(Ql[t]);xc=0}(),ve(jc),ve(Sc),ve(Ic),t_=!1,Ec=2,o_=0,E("editor_release() ok"),Rn(op),Rn(ip),t=0;t<$_.length;t++)F_[t];for(Rn(yp),Rn(xp),Rn(bp),t=0;t<3;t++)q_[t],Rn(Q_[t]);Rn(Ip),E("level_release() ok")},ou=function(){return p_()},ru=function(){return Zc},su=function(){return tp},cu=function(t){var e;t=Math.max(0,t),vi(bi()+t),(e=xu(13,it(Zc.actor.position,at(-9,0)))).set_text(e,t)},pu=function(){return at(Yc,$c)},lu=function(t){Vc&&P(),C(t)},_u=function(t){Fc=at(t.x,t.y)},uu=function(t){var e;if(!sp){for(sp=!0,cp=F(),V_=10*gi(),hp+=V_,e=0;e<$_.length;e++)$_[e]&&$_[e].got_glasses&&du(5e3);for(vi(bi()+hp),e=0;e<$_.length;e++)$_[e]&&(je($_[e].actor.input),$_[e].spin_dash=!1);for(ad(t),hu(),(gp=ea(gp,"TEAM SONIC")).position=at(-500,20),(mp=ea(mp,"GOT THROUGH")).position=at(-500,46),(bp=Bn(bp,rn("SD_LEVELACT",Xc-1))).position=at(820,25),e=0;e<3;e++)Q_[e].position=at(-500,120+20*e),q_[e].position=at(820,120+20*e);Q_[0]=Bn(Q_[0],rn("SD_RINGBONUS",0)),Q_[1]=Bn(Q_[1],rn("SD_SECRETBONUS",0)),Q_[2]=Bn(Q_[2],rn("SD_TOTAL",0))}},du=function(t){fp+=t,hp+=t},fu=function(t,e){(!wp||na(Sp)||na(jp))&&(wp=!0,kp=F(),ea(Sp,t),ea(jp,e),ia(jp,260))},hu=function(){wp=!1},gu=function(){return ap},mu=function(){var t,e;for(t=W_;t;t=t.next)(e=t.data)&&(e.state=1)},bu=function(){return Wc},yu=function(t,e){var n,a;for((a={}).data={},a.data.brick_ref=vn(t),a.data.animation_frame=0,a.data.x=a.data.sx=parseInt(e.x,10),a.data.y=a.data.sy=parseInt(e.y,10),a.data.enabled=!0,a.data.state=0,a.data.value=[],n=0;n<3;n++)a.data.value[n]=0;return Fu(a),a.data},xu=function(t,e){var n={};return n.data=ms(t),n.data&&(n.data.actor.spawn_point=at(e.x,e.y),n.data.actor.position=at(e.x,e.y)),n.next=X_,X_=n,n.data},vu=function(t,e){var n,a=at(e.x,e.y);return(n={}).data=Xl(t),n.data.actor.spawn_point=at(a.x,a.y),n.data.actor.position=at(a.x,a.y),n.next=W_,W_=n,n.data},wu=function(t,e,n,a){var i,o;p_()?tn(t):((i={}).image=t,i.position=e,i.speed=n,i.destroy_on_brick=a,(o={}).data=i,o.next=Y_,Y_=o)},ku=function(t,e){var n,a,i,o,r,s;return t?(n=t.value[0],1===t.brick_ref.behavior?(a=t.brick_ref.behavior_arg[0],i=t.brick_ref.behavior_arg[1],o=t.brick_ref.behavior_arg[2]*(2*g.PI),r=t.brick_ref.behavior_arg[3]*(2*g.PI),s=t.brick_ref.behavior_arg[4]*g.PI/180,at(-a*o*Math.sin(o*n+s),i*r*Math.cos(r*n+s))):at(0,0)):at(0,0)},Iu=function(t){return xu(15,t)},Su=function(){Pu()},ju=function(){return H_},Eu=function(t){return Du(t)},Mu=function(){Yu()},Ou=function(){var t,e,n,a,i,o;for(E("level_unload()"),Vc.pause(),E("releasing brick list..."),t=H_;t;t=e)e=t.next,t.data=null,t=null;for(H_=null,E("releasing item list..."),n=X_;n;n=a)a=n.next,n.data,n=null;for(X_=null,E("releasing enemy list..."),i=W_;i;i=o)o=i.next,i.data,i=null;W_=null,od()&&(E("releasing the boss..."),function(t){Rn(t.actor)}(ep),ep=null),E("unloading the brickset..."),E("unloading the background..."),E("level_unload() ok")},Du=function(t){var e;for(e=0;e<wn();e++)if(t.brick_ref==vn(e))return e;return-1},Tu=function(){var t=Fc;iu(),eu(),Fc=t},Pu=function(){var t,e,n,a,i={};for(e=t=Vu();e;e=e.next)e.data&&e.data.brick_ref.zindex<.5&&(e.data=kn(e.data),i=In(e.data),St().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,e.data.x-(parseInt(Xa().x,10)-240),e.data.y-(parseInt(Xa().y,10)-135.5),1*i.width,1*i.height));for(Lu(!0),e=t;e;e=e.next)if(e.data){var o=e.data.brick_ref;Math.abs(o.zindex-.5)<g.Ib&&1!=o.property&&(e.data=kn(e.data),i=In(e.data),St().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,e.data.x-(parseInt(Xa().x,10)-240),e.data.y-(parseInt(Xa().y,10)-135.5),1*i.width,1*i.height))}for(n=X_;n;n=n.next)n.data&&n.data.bring_to_back&&ys(n.data,Xa());for(e=t;e;e=e.next)if(e.data){var r=e.data.brick_ref;Math.abs(r.zindex-.5)<g.Ib&&1==r.property&&(e.data=kn(e.data),i=In(e.data),St().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,e.data.x-(parseInt(Xa().x,10)-240),e.data.y-(parseInt(Xa().y,10)-135.5),1*i.width,1*i.height))}for(od()&&!ep.bring_to_front&&R_(ep,Xa()),a=W_;a;a=a.next)Yl(a.data,Xa());for(Lu(!1),od()&&ep.bring_to_front&&R_(ep,Xa()),n=X_;n;n=n.next)n.data&&ys(n.data,Xa());for(Uu(),e=t;e;e=e.next)e.data&&e.data.brick_ref.zindex>.5&&(e.data=kn(e.data),i=In(e.data),St().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,e.data.x-(parseInt(Xa().x,10)-240),e.data.y-(parseInt(Xa().y,10)-135.5),1*i.width,1*i.height));qu(t)},Lu=function(t){if(Zc){var e;for(e=$_.length-1;e>=0;e--)$_[e]!=Zc&&!!$_[e].bring_to_back==t&&li($_[e],Xa());!!Zc.bring_to_back==t&&li(Zc,Xa())}},Ru=function(){var t,e=at(240,135.5);if(sp)for(An(bp,e),oa(gp,e),oa(mp,e),t=0;t<3;t++)An(Q_[t],e),oa(q_[t],e);else{for(An(ip,e),An(op,e),oa(rp,e),t=0;t<3;t++)oa(F_[t],e);Au()}zc<2.5&&wt("rgb(0,0,0)"),An(yp,e),An(xp,e),oa(vp,e),Nu(e)},Au=function(){var t,e=[],n=[],a=0,i=.001*F();for(t=0;t<10;t++)n[t]=!0;if(Zc){switch(Zc.got_glasses&&(e[a++]=sn(rn("SD_ICON",6),0)),Zc.shield_type){case 1:e[a++]=sn(rn("SD_ICON",7),0);break;case 2:e[a++]=sn(rn("SD_ICON",11),0);break;case 3:e[a++]=sn(rn("SD_ICON",12),0);break;case 4:e[a++]=sn(rn("SD_ICON",13),0);break;case 5:e[a++]=sn(rn("SD_ICON",14),0);break;case 6:e[a++]=sn(rn("SD_ICON",15),0)}if(Zc.invincible&&(e[a++]=sn(rn("SD_ICON",4),0),Zc.invtimer>=17.25)){var o=(23-Zc.invtimer)/5.75;n[a-1]=Math.sin(.5*g.PI*i/(o+.1))>=0}if(Zc.got_speedshoes&&(e[a++]=sn(rn("SD_ICON",5),0),Zc.speedshoes_timer>=17.25)){var r=(23-Zc.speedshoes_timer)/5.75;n[a-1]=Math.sin(.5*g.PI*i/(r+.1))>=0}}for(t=0;t<a;t++)n[t]&&Qe(e[t].data,St(),e[t].sx,e[t].sy,lt-(e[t].width+5)*(t+1),5,e[t].swidth,e[t].sheight)},Nu=function(t){An(Ip,t),oa(Sp,t),oa(jp,t)},Cu=function(){Y_=null},Gu=function(t){var e,n,a,i,o,r=z(),s=Wc,c=null;for(a=Y_;a;a=i)if(o=a.data){if(n=id(o.position.x,o.position.y,o.position.x+o.image.width,o.position.y+o.image.height,U_),e=!1,o.destroy_on_brick&&n&&o.speed.y>0){var p=[o.position.x,o.position.y,o.position.x+o.image.width,o.position.y+o.image.height],l=void 0;for(l=t;l&&!e;l=l.next){var _=l.data;if(_&&1==_.brick_ref.property&&0==_.brick_ref.angle){var u=[_.x,_.y,_.x+_.brick_ref.image.width,_.y+_.brick_ref.image.height];Z(p,u)&&(e=!0)}}}!n||e?c?c.next=i:Y_=i:(o.position.x+=o.speed.x*r,o.position.y+=o.speed.y*r+.5*s*(r*r),o.speed.y+=s*r,c=a)}},Uu=function(){var t,e,n,a,i,o,r=at(Xa().x-240,Xa().y-135.5);for(t=Y_;t;t=t.next)(e=t.data)&&(n=e.image,a=St(),i=parseInt(e.position.x-r.x,10),o=parseInt(e.position.y-r.y,10),g.in,a.putImageData(n,i,o))},Bu=function(){null==Vc||sp||qc||A()||T(Vc,!0)},Hu=function(){if(Ip){var t=z(),e=F();if(wp){if(e>=kp+7e3)return void(wp=!1);Ip.position.x=(lt-Gn(Ip).width)/2,Ip.position.y=Math.max(Ip.position.y-100*t,_t-1.3*Gn(Ip).height)}else Ip.position.y=Math.min(Ip.position.y+100*t,_t);Sp.position=it(Ip.position,at(2,10)),jp.position=it(Ip.position,at(2,23))}},Xu=function(){if(Zc&&Zc.actor){var t,e=[],n=[];if(!(zc<2))for(e[0]=Zc.actor.position.x,e[1]=Zc.actor.position.y,e[2]=e[0]+Gn(Zc.actor).width,e[3]=e[1]+Gn(Zc.actor).height,t=0;t<Ep;t++)if(!K_[t].disabled&&(n[0]=K_[t].rect_x,n[1]=K_[t].rect_y,n[2]=n[0]+K_[t].rect_w,n[3]=n[1]+K_[t].rect_h,Z(e,n))){K_[t].disabled=!0,fu(K_[t].title,K_[t].message);break}}},Wu=function(t){Zc.spin_dash=Zc.braking=!1,$_[tp=t]&&(Zc=$_[tp],ad(Zc.actor),Ee(Zc.actor.input))},Yu=function(){var t,e;for(t=0;t<$_.length;t++)e=parseInt(Fc.x,10)<=Yc/2?2-t:t,$_[t].actor.mirror=parseInt(Fc.x,10)<=Yc/2?g.in:g.eI,$_[t].actor.spawn_point.x=$_[t].actor.position.x=Fc.x+15*e,$_[t].actor.spawn_point.y=$_[t].actor.position.y=Fc.y},$u=function(t,e,n,a){var i,o={},r={data:null};for(r.image=Ve(t,e),r.angle=a,r.property=1,r.behavior=0,r.zindex=.5,r.behavior_arg=[],i=0;i<5;i++)r.behavior_arg[i]=0;for(o.brick_ref=r,o.animation_frame=0,o.enabled=!0,o.x=o.sx=parseInt(n.x,10),o.y=o.sy=parseInt(n.y,10),o.value=[],i=0;i<3;i++)o.value[i]=0;return o},zu=function(t,e){var n=t.brick_ref,a=e.brick_ref;if(!n||!a)return!1;if(n.zindex<a.zindex)return-1;if(n.zindex>a.zindex)return 1;if(n.property!=a.property){var i=[0,100,50];return i[n.property]-i[a.property]}return n.angle%180!=0&&a.angle%180==0?-1:n.angle%180==0&&a.angle%180!=0?1:t.sy-e.sy},Fu=function(t){var e;if(H_)if(zu(t.data,H_.data)>=0)t.next=H_,H_=t;else{for(e=H_;e.next&&zu(e.next.data,t.data)>0;)e=e.next;t.next=e.next,e.next=t}else t.next=null,H_=t},Vu=function(){var t,e,n,a,i,o,r=[];for(t=H_;t;t=t.next)t.data&&t.data.brick_ref&&t.data.brick_ref.image&&(n=Math.min(t.data.x,t.data.sx),a=Math.min(t.data.y,t.data.sy),i=t.data.brick_ref.image.width,o=t.data.brick_ref.image.height,(id(n,a,i,o,2*U_)||1==t.data.brick_ref.behavior)&&((e={}).data=t.data,e.next=r,r=e));return r},qu=function(t){for(var e;t;)e=t.next,t=null,t=e},Qu=function(){var t,e,n,a,i,o,r,s=null;for(t=X_;t;t=t.next)t.data&&(r=Gn(t.data.actor))&&(n=parseInt(t.data.actor.position.x,10),a=parseInt(t.data.actor.position.y,10),i=r.width,o=r.height,id(n,a,i,o,U_)&&((e={}).data=t.data,e.next=s,s=e));return s},Ku=function(t){for(var e;t;)e=t.next,t=null,t=e},Ju=function(){var t,e;if(X_)for(X_.data&&X_.data.state==cs&&(e=X_.next,X_.data,X_=e),t=X_;t&&t.next;t=t.next)t.next&&t.next.data&&t.next.data.state==cs&&(e=t.next,t.next=e.next,e.data,e=null)},Zu=function(){var t,e;if(W_)for(W_&&W_.data&&W_.data.state==zl&&(e=W_.next,W_.data,W_=null,W_=e),t=W_;t&&t.next;t=t.next)t&&t.next&&t.next.data&&t.next.data.state==zl&&(e=t.next,t.next=e.next,e.data,e=null)},td=function(){var t,e;if(H_)for(H_.data&&1==H_.data.state&&(e=H_.next,H_.data=null,H_=null,H_=e),t=H_;t&&t.next;t=t.next)1==t.next.data.state&&(e=t.next,t.next=e.next,e.data=null,e=null)},ed=function(t){tn(t.brick_ref.image),t.brick_ref=null,t=null},nd=function(t){var e,n,a,i,o,r;t&&(t.value[0]+=z(),e=t.value[0],1===t.brick_ref.behavior)&&(n=t.brick_ref.behavior_arg[0],a=t.brick_ref.behavior_arg[1],i=t.brick_ref.behavior_arg[2]*(2*g.PI),o=t.brick_ref.behavior_arg[3]*(2*g.PI),r=t.brick_ref.behavior_arg[4]*g.PI/180,t.x=t.sx+Math.round(n*Math.cos(i*e+r)),t.y=t.sy+Math.round(a*Math.sin(o*e+r)))},ad=function(t){z_={position:{x:t.position.x,y:t.position.y}}},id=function(t,e,n,a,i){var o=Xa(),r=[t,e,t+n,e+a],s=[o.x-240-i,o.y-135.5-i,o.x+240+i,o.y+135.5+i];return Z(r,s)},od=function(){return null!=ep},rd=function(t){return Cc="Untitled",Gc="",Uc="",Bc="",Hc="",Fc=at(0,0),Ep=0,ep=null,Xc=1,new Promise((function(e,n){E('level_load("%s")'),I(t).then(sd).then((function(){Vc=D(Gc),function(){var t,e,n;for(t=e=-g._v,n=H_;n;n=n.next)n.data&&n.data.brick_ref&&"BRK_NONE"!=n.data.brick_ref.property&&(t=Math.max(t,n.data.sx+In(n.data).width),e=Math.max(e,n.data.sy+In(n.data).height));Yc=Math.max(t,lt),$c=Math.max(e,_t)}(),E("level_load() ok"),e()}))}))},sd=function(t){var e;for(Uc=t.theme,Bc=t.bgtheme,Hc=t.grouptheme,Gc=t.music,Cc=t.name,t.author,t.version,t.requires,Xc=t.act,Fc=t.spawn_point,t.readonly,t.boss&&(ep=function(t,e,n,a,i,o){var r,s,c={};for(c.type=t,c.state=0,c.rect_x=n,c.rect_y=a,c.rect_w=i,c.rect_h=o,c.value=[],r=0;r<10;r++)c.value[r]=0;switch(c.bring_to_front=!1,c.actor=s=Ln(),s.spawn_point=at(e.x,e.y),s.position=at(e.x,e.y),s.input=be(),t){case 0:case 2:Bn(s,rn("SD_SIMPLEBOSS",0)),c.initial_hp=c.hp=3,c.direction=3,s.maxspeed=100,s.acceleration=100;break;case 1:case 3:Bn(s,rn("SD_MECHASHADOW",0)),c.initial_hp=c.hp=10,c.direction=3,s.maxspeed=100,s.acceleration=100}return c}(t.boss.id,at(t.boss.x,t.boss.y),t.boss.rx,t.boss.ry,t.boss.rw,t.boss.rh),console.log("BOSS",ep)),e=0;e<t.dialogbox.length;e++){var n={disabled:!1};n.rect_x=t.dialogbox[e].xpos,n.rect_y=t.dialogbox[e].ypos,n.rect_w=t.dialogbox[e].width,n.rect_h=t.dialogbox[e].height,n.title=Ne(t.dialogbox[e].title),n.message=Ne(t.dialogbox[e].message),K_.push(n),Ep=K_.length}for(e=0;e<t.enemylist.length;e++)vu(t.enemylist[e].id,at(t.enemylist[e].xpos,t.enemylist[e].ypos));return new Promise((function(n,a){var i;(i=t.theme,new Promise((function(t,e){E("brickdata_load('%s')"),I(i).then(Sn).then((function(t){xn=t})).then(t)}))).then((function(a){for(var i=0;i<t.bricklist.length;i++)yu(t.bricklist[i].id,at(t.bricklist[i].xpos,t.bricklist[i].ypos));ba(t.bgtheme).then((function(a){for(Jc=a,e=0;e<t.itemlist.length;e++)X_[e]=xu(t.itemlist[e].id,at(t.itemlist[e].xpos,t.itemlist[e].ypos));n()}))}))}))},cd=function(t){return new Promise((function(e,n){var a={};E("load_quest('%s')"),a.file=t,a.name="",a.author="",a.version="",a.description="",a.image=null,a.level_count=0,a.show_ending=!1,I(t).then(pd).then((function(t){t&&(a=t),E("load_quest() ok!"),e(a)}))}))},pd=function(t){return new Promise((function(e,n){var a={};a.name=t.name||"",a.author=t.author||"Open Sonic",a.version=t.version||"0",a.description=t.description||"",a.show_ending=t.show_ending||!1,a.level_count=t.levels?t.levels.length:0,a.level_path=t.levels||[],function(t){return new Promise((function(e,n){var a=t||"data/images/null.png";a=g.Nu+a,qe(a).then((function(t){e(t)}))}))}(t.image).then((function(t){a.image=t,e(a)}))}))},ld={TOTALTIME:0,BIGRINGS:0,GLASSES:0},_d=function(){var t;for(Dp=!1,t=0;t<3;t++)ld[t]=0},ud=function(){return 0==Mp.level_count?(E("Quest '%s' has no levels.",Mp.file),void game_quit()):Op<Mp.level_count&&!Dp?(J_(Mp.level_path[Op]),Ue(Rh(vh)),void Op++):(Be(),void(Dp?Ue(Rh(jh)):Mp.show_ending?Ue(Rh(Sh)):Ue(Rh(Eh))))},dd=function(){},fd=function(){},hd=function(){Dp=!0},gd=0,md=function(t,e){var n=J(parseInt(t,10),0,2);ld[n]=e},bd=function(t){var e=J(parseInt(t,10),0,2);return ld[e]},yd=[],xd=function(){Tp=0,yd[0]=ta(7),yd[0].position=at(-50,112),ea(yd[0],"GAME"),yd[1]=ta(7),yd[1].position=at(298,112),ea(yd[1],"OVER")},vd=function(){var t=z();if((Tp+=t)>5){if(xt())return hd(),void Be();yt(Je(0,0,0),2)}yd[0].position.x+=200*t,yd[0].position.x>80&&(yd[0].position.x=80),yd[1].position.x-=200*t,yd[1].position.x<168&&(yd[1].position.x=168)},wd=function(){wt();var t=at(240,135.5);oa(yd[0],t),oa(yd[1],t)},kd=function(){tn(void 0),yd[1],yd[0],hd()},Id=function(){Pp=0,ba("data/themes/intro.bg.json").then((function(t){Lp=t,bt(Je(0,0,0),1)}))},Sd=function(){if(Lp&&(Pp+=z(),xa(Lp),Pp>=3)){if(xt())return Be(),void Ue(Rh(jh));yt(Je(0,0,0),1)}},jd=function(){if(Lp){var t=at(240,135.5);va(Lp,t),wa(Lp,t)}},Ed=function(){Lp=null},Md=["data/languages/deutsch.json","data/languages/dutch.json","data/languages/english.json","data/languages/francais.json","data/languages/indonesian.json","data/languages/italiano.json","data/languages/polish.json","data/languages/ptbr.json"],Od=1,Dd=[],Td=[],Pd=function(){Up=0,Ap=!1,Xp=0,Hp=xe(),Cp=ta(8),Dd[0]=ta(4),ea(Dd[0],"SELECT YOUR"),Dd[0].position.x=(lt-na(Dd[0]).length*aa(Dd[0]).x)/2-140,Dd[0].position.y=10,Dd[1]=ta(4),ea(Dd[1],"LANGUAGE"),Dd[1].position.x=(lt-na(Dd[1]).length*aa(Dd[1]).x)/2-120,Dd[1].position.y=Dd[0].position.y+aa(Dd[1]).y+10+10,Dd[2]=ta(8),ea(Dd[2],Ne("MENU_CQ_BACK")),Dd[2].position.x=10,Dd[2].position.y=_t-1.5*aa(Dd[2]).y,Wp=ba("data/themes/langselect.bg.json").then((function(t){Wp=t,bt(Je(0,0,0),1)})),Bp=Ln(),Bn(Bp,rn("SD_TITLEFOOT",0)),Cd(),bt(Je(0,0,0),1)},Ld=function(){var t=z();if(Xp+=t,xa(Wp),Bp&&Td.length&&(Bp.position=at(Td[0][Up].position.x,Td[0][Up].position.y),Bp.position.x-=15,Bp.position.x+=5*Math.cos(2*g.PI*Xp)),!Ap&&!vt()){if(ke(Hp,2)&&(Up=(Up+1)%Np,C(We("choose"))),ke(Hp,1)&&(Up=((Up-1)%Np+Np)%Np,C(We("choose"))),ke(Hp,5)||ke(Hp,7)){if(!Gp)return;var e=Gp[Up].filepath;E('Loading language "%s", "%s"',Gp[Up].title),Re("data/languages/english.json"),Re(e),Nd(e),C(We("select"))}ke(Hp,8)&&(C(We("return")),Ap=!0)}if(Rp=Math.floor(1+Up/8),Od=Math.floor(1+Math.max(0,Np-1)/8),ea(Cp,"page %d/%d",Rp,Od),Cp.position.x=lt-na(Cp).length*aa(Cp).x-10,Cp.position.y=_t-aa(Cp).y-3,!A()){var n=D("data/music/options.mp4");T(n,g._v)}if(Ap){if(xt())return void Be();yt(Je(0,0,0),1)}},Rd=function(){var t,e=at(240,135.5);for(wt(),va(Wp,e),wa(Wp,e),oa(Dd[0],e),oa(Dd[1],e),oa(Dd[2],e),Od>1&&oa(Cp,e),t=8*(Rp-1);t<8*Rp;t++)Md[t]&&Td.length>1&&oa(Td[Up==t?1:0][t],e);An(Bp,e)},Ad=function(){Gd(),Wp=ya(),Rn(Bp),Dd[0],Dd[1],ve(Hp)},Nd=function(t){var e;e=t,B.language=e,H()},Cd=function(){E("load_lang_list()"),k(Md).then((function(t){Np=(Gp=t).length,Td[0]=[],Td[1]=[];for(var e=0;e<Np;e++)Gp[e].filepath=Md[e],Td[0][e]=ta(8),Td[1][e]=ta(8),ea(Td[0][e],Gp[e].LANG_LANGUAGE),ea(Td[1][e],Gp[e].LANG_LANGUAGE),Td[0][e].position=at(25,75+e%8*20),Td[1][e].position=at(25,75+e%8*20)}))},Gd=function(){var t;for(E("unload_lang_list()"),t=0;t<Np;t++)Td[0][t],Td[1][t];Td[0]=null,Td[1]=null,Gp=null,Np=0},Ud=["data/quests/default.json","data/quests/extra.json","data/quests/superbosses.json","data/quests/tutorial.json"],Bd=3,Hd=[],Xd=[],Wd=function(){var t,e;for(rl=!1,Yp=0,Vp=.001*F(),qp=!1,zp=null,$p=xe(),je($p),Vd(),_l=D("data/music/title.mp4"),T(_l,!0),Fp=ba("data/themes/menu.bg.json").then((function(t){Fp=t,bt(Je(0,0,0),1)})),tl=!0,el=Ln(),(el=Bn(el,rn("SD_TITLESURGE",0))).position.x=(lt-Gn(el).width)/2+5,el.position.y=-15,nl=Ln(),(nl=Bn(nl,rn("SD_TITLEBG",0))).position.x=(lt-Gn(nl).width)/2,nl.position.y=el.position.y+25,al=Ln(),(al=Bn(al,rn("SD_TITLEGAMENAME",0))).position.x=(lt-Gn(al).width)/2,al.position.y=el.position.y+Gn(el).height-9,(il=ta(8)).position=at(3,259),ea(il,"%s",g.Ip),(ol=ta(0)).position=at(405,3),ea(ol,"V%d.%d.%d",g.ve,g.t4,g.t3),Kp=0,Zp=Ln(),Zp=Bn(Zp,rn("SD_TITLEFOOT",0)),(Qp=[])[0]=Ae("MENU_1PGAME"),Qp[1]=Ae("MENU_TUTORIAL"),Qp[2]=Ae("MENU_CUSTOMQUESTS"),Qp[3]=Ae("MENU_OPTIONS"),Bd=Qp.length,Jp=[],t=0;t<2;t++)for(e=0;e<Bd;e++)Jp[e]||(Jp[e]=[]),Jp[e][t]=ta(t),Jp[e][t].position=at(240-Gn(nl).width/5,al.position.y+65+10*e),ea(Jp[e][t],Qp[e]);Hd[0]=ta(8),Hd[0].position=at(5,3),Hd[1]=ta(8),Hd[1].position=at(5,258),(sl=ta(8)).position=at(5,170),bt(Je(0,0,0),1.5)},Yd=function(){var t,e=.001*F();if(null!=zp&&xt())return Be(),void Ue(zp);switch(e<=Vp+2?je($p):qp||(Ee($p),qp=!0),xa(Fp),Yp){case 0:tl&&Hn(el)&&(tl=!1,el=Bn(el,rn("SD_TITLESURGE",1)),Ee($p)),al.visible=!tl,Zp.position.x=Jp[Kp][0].position.x-20+3*Math.cos(2*g.PI*e),Zp.position.y=Jp[Kp][0].position.y,ke($p,1)&&(C(We("choose")),Kp--),ke($p,2)&&(C(We("choose")),Kp++),Kp=(Kp%Bd+Bd)%Bd,(ke($p,5)||ke($p,7))&&(C(We("select")),Fd(Kp));break;case 1:for(ke($p,8)&&(C(We("return")),Yp=0),t=0;t<pl;t++)Xd[t].position=at(30,20+t%14*10),Xd[t].visible=qd(t)==qd(cl);if(Zp.position.x=10,Zp.position.y=Xd[cl].position.y,ke($p,1)&&(C(We("choose")),cl--),ke($p,2)&&(C(We("choose")),cl++),cl=(cl%pl+pl)%pl,ea(Hd[0],Ne("MENU_CQ_SELECT"),qd(cl),Qd()),ea(Hd[1],Ne("MENU_CQ_BACK")),ea(sl,Ne("MENU_CQ_INFO"),ll[cl].version,ll[cl].name,ll[cl].author,ll[cl].description),ke($p,5)||ke($p,7))return C(We("select")),void Kd(ll[cl])}},$d=function(){var t,e=at(240,135.5);if(wt(),!rl||!xt())switch(va(Fp,e),wa(Fp,e),Yp){case 0:for(t=0;t<Bd;t++)oa(Jp[t][t==Kp?1:0],e);An(Zp,e),oa(il,e),oa(ol,e),An(nl,e),tl&&wt(),An(el,e),An(al,e);break;case 1:var n=ll[cl].image;for(oa(sl,e),Qe(n,St(),0,0,lt-n.width-25,parseInt(Xd[0].position.y,10),n.width,n.height),oa(Hd[0],e),oa(Hd[1],e),t=0;t<pl;t++)oa(Xd[t],e);An(Zp,e)}},zd=function(){var t,e;for(_l.pause(),t=0;t<2;t++)for(e=0;e<Bd;e++)Jp[e][t];Rn(nl),Rn(al),Rn(el),Rn(Zp),ve($p)},Fd=function(t){var e=Ud[0];switch(t){case 0:return void cd(e).then((function(t){Kd(t)}));case 1:return void cd("data/quests/tutorial.json").then((function(t){Kd(t)}));case 2:Yp=1,cl=0;break;case 3:return zp=Rh(Th),void yt(Je(0,0,0),.5)}},Vd=function(){var t;for(pl=Ud.length,ll=[],t=0;t<pl;t++)!function(e){cd(Ud[t]).then((function(t){Xd[e]=ta(8),ll[e]=t,ea(Xd[e],t.name)}))}(t)},qd=function(t){return Math.floor(t/14+1)},Qd=function(){return Math.floor(pl/14+(pl%14==0?0:1))},Kd=function(t){var e,n;Mp=e=t,xi(5),vi(0),E("Running quest %s, '%s'...",e.file,e.name),n=0,Op=Math.max(0,n),zp=Rh(Ih),je($p),yt(Je(0,0,0),.5)},Jd=function t(e){var n;if(e)for(e.init(e),n=0;n<e.child_count;n++)t(e.child[n])},Zd=function t(e){var n;if(e){for(n=0;n<e.child_count;n++)t(e.child[n]);e.update(e)}},tf=function t(e,n){var a;if(e){for(a=0;a<e.child_count;a++)t(e.child[a],n);e.render(e,n)}},ef=function t(e){var n,a=0;if(e){for(n=0;n<e.child_count;n++)a+=t(e.child[n]);return 1+a}return 0},nf=function(t,e,n,a){var i={};return i.init=t,i.release=e,i.update=n,i.render=a,i.font=null,i.data=null,i.parent=null,i.child_count=0,i.child=[],i},af=function(t,e){t.child_count<10&&(t.child[t.child_count++]=e,e.parent=t)},of=function(t){if(t.font=ta(8),ea(t.font,"LABEL"),null!=t.parent){var e,n,a=0,i=null!=t.parent.font?aa(t.parent.font):at(12,12);for(e=0;e<t.parent.child_count&&t.parent.child[e]!=t;e++);for(n=0;n<e;n++)a+=ef(t.parent.child[n])-1;t.font.position={x:t.parent.font.position.x,y:t.parent.font.position.y},t.font.position.x+=3*i.x,t.font.position.y+=(1+a+e)*i.y*2}},rf=function(t){t.font},sf=function(t,e){oa(t.font,e)},cf=function(){xl=0,ul=!1,bl=0,gl=xe(),ml=null,dl=!0,fl=ta(4),ea(fl,Ne("OPTIONS_TITLE")),fl.position.x=140,fl.position.y=10,yl=ba("data/themes/options.bg.json").then((function(t){yl=t})),hl=Ln(),Bn(hl,rn("SD_TITLEFOOT",0)),hl.position=at(-50,-50),vl=th(),Jd(vl)},pf=function(){var t=z();if(bl+=t,ea(fl,Ne("OPTIONS_TITLE")),dl&&(bt(Je(0,0,0),1),dl=!1),xa(yl),ul||null!=ml||vt()||(ke(gl,2)&&(xl=(xl+1)%5,C(We("choose"))),ke(gl,1)&&(xl=((xl-1)%5+5)%5,C(We("choose"))),ke(gl,8)&&(C(We("return")),ul=!0)),Zd(vl),ul)vt()||P();else if(!A()&&bl>=.2){var e=D("data/music/options.mp4");T(e,g._v)}if(ul){if(xt())return uf(),Be(),void Ue(Rh(jh));yt(Je(0,0,0),1)}if(null!=ml){if(xt())return uf(),Ue(ml),ml=null,void(dl=!0);yt(Je(0,0,0),1)}},lf=function(){var t=at(240,135.5);va(yl,t),wa(yl,t),oa(fl,t),tf(vl,t),An(hl,t)},_f=function(){Rn(hl),ve(gl)},uf=function(){var t,e,n;!function(t){B.video_resolution=t,H()}(jt()),t=Mt(),B.fullscreen=t,H(),e=Et(),B.smooth_graphics=e,H(),n=Ot(),B.show_fps=n,H()},df=function(t,e){of(t),t.data=e,ea(t.font,Ne(e))},ff=function(t){t.data=null,rf(t)},hf=function(t){ea(t.font,Ne(t.data))},gf=function(t,e){sf(t,e)},mf=function(t,e,n){var a;of(t),ea(t.font,Ne(e)),t.data={},(a=t.data).option_index=n,a.lang_key=e},bf=function(t){t.data=null,rf(t)},yf=function(t){var e=t.data;return xl==e.option_index},xf=function(t){var e=t.data;ea(t.font,Ne(e.lang_key)),yf(t)&&(ea(t.font,"<color=ffff00>%s</color>",Ne(e.lang_key)),hl.position=it(t.font.position,at(3*Math.cos(2*g.PI*bl)-20,0)))},vf=function(t,e){sf(t,e)},wf=function(t){of(t),ea(t.font,""),t.font.position=at(0,25)},kf=function(t){rf(t)},If=function(t){},Sf=function(t,e){sf(t,e)},jf=function(t){df(t,"OPTIONS_GRAPHICS")},Ef=function(t){ff(t)},Mf=function(t){hf(t)},Of=function(t,e){gf(t,e)},Df=function(t){mf(t,"OPTIONS_FPS",0)},Tf=function(t){bf(t)},Pf=function(t){xf(t),function(t){return yf(t)}(t)&&(vt()||((ke(gl,5)||ke(gl,7))&&(C(We("select")),Dt(!Ot())),ke(gl,3)&&Ot()&&(C(We("select")),Dt(!1)),ke(gl,4)&&(Ot()||(C(We("select")),Dt(!0)))))},Lf=function(t,e){var n,a=[];vf(t,e),(n=ta(8)).position=at(175,t.font.position.y),a[0]=Ne("OPTIONS_YES"),a[1]=Ne("OPTIONS_NO"),Ot()?ea(n,"<color=ffff00>%s</color>  %s",a[0],a[1]):ea(n,"%s  <color=ffff00>%s</color>",a[0],a[1]),oa(n,e)},Rf=function(t){df(t,"OPTIONS_GAME")},Af=function(t){ff(t)},Nf=function(t){hf(t)},Cf=function(t,e){gf(t,e)},Gf=function(t){mf(t,"OPTIONS_LANGUAGE",1)},Uf=function(t){bf(t)},Bf=function(t){xf(t),function(t){return yf(t)}(t)&&(vt()||(ke(gl,5)||ke(gl,7))&&(C(We("select")),ml=Rh(Oh)))},Hf=function(t,e){vf(t,e)},Xf=function(t){mf(t,"OPTIONS_STAGESELECT",2)},Wf=function(t){bf(t)},Yf=function(t){xf(t),function(t){return yf(t)}(t)&&(vt()||(ke(gl,5)||ke(gl,7))&&(C(We("select")),ml=Rh(Ph)))},$f=function(t,e){vf(t,e)},zf=function(t){mf(t,"OPTIONS_CREDITS",3)},Ff=function(t){bf(t)},Vf=function(t){xf(t),function(t){return yf(t)}(t)&&(vt()||(ke(gl,5)||ke(gl,7))&&(C(We("select")),ml=Rh(Dh)))},qf=function(t,e){vf(t,e)},Qf=function(t){mf(t,"OPTIONS_BACK",4)},Kf=function(t){bf(t)},Jf=function(t){xf(t),function(t){return yf(t)}(t)&&(vt()||(ke(gl,5)||ke(gl,7))&&(C(We("select")),ul=!0))},Zf=function(t,e){vf(t,e)},th=function(){var t,e,n,a,i,o,r,s;return n=nf(Df,Tf,Pf,Lf),e=nf(jf,Ef,Mf,Of),af(e,n),i=nf(Gf,Uf,Bf,Hf),o=nf(zf,Ff,Vf,qf),r=nf(Xf,Wf,Yf,$f),a=nf(Rf,Af,Nf,Cf),af(a,i),af(a,r),af(a,o),s=nf(Qf,Kf,Jf,Zf),t=nf(wf,kf,If,Sf),af(t,e),af(t,a),af(t,s),t},eh=function(){wl=xe(),kl=!1,Il=!1,Sl=0},nh=function(){var t;if(ke(wl,8))return Ae("CBOX_QUIT_QUESTION",t[0],sizeof(t[0])),Ae("CBOX_QUIT_OPTION1",t[1],sizeof(t[1])),Ae("CBOX_QUIT_OPTION2",t[2],sizeof(t[2])),ga(t[0],t[1],t[2]),void Ue(Rh(Mh));if(1==ma()&&(Il=!0),Il)return xt()?(Be(),Be(),void hd()):void yt(image.rgb(0,0,0),1);if(kl){if(ke(wl,7))return audio.music_resume(),void Be()}else Ie(wl,7)&&(kl=!0)},ah=function(){var t=sn(rn("SD_PAUSE",0),0),e=1+.5*Math.abs(Math.cos(g.PI/2*Sl));at((lt-t.width)/2-(e-1)*t.width/2,(_t-t.height)/2-(e-1)*t.height/2),Il||(Sl+=z())},ih=function(){tn(void 0),ve(wl)},oh=function(){F(),Dl=!1,(jl=ta(8)).position=at(5,35),El=ta(4),ea(El,Ne("QUESTCLEARED_TITLE")),El.position=at((parseInt(aa(El).x*na(El)).length,10),5),Ml=Ln(),Bn(Ml,rn("SD_SONIC",24)),Ml.position=at(20,150),T(D("data/music/invincible.mp4"),0),Ol=xe(),bt(Je(0,0,0),2)},rh=function(){var t=bi(),e=bd("QUESTVALUE_TOTALTIME")/3600,n=parseInt(bd("QUESTVALUE_TOTALTIME")/60%60,10),a=parseInt(bd("QUESTVALUE_TOTALTIME")%60,10),i=bd("QUESTVALUE_GLASSES"),o=bd("QUESTVALUE_BIGRINGS");if(F(),ea(jl,Ne("QUESTCLEARED_TEXT"),"NO_QUEST_NAME",t,e,n,a,i,o,g.b5,g.Ip),ke(Ol,5)&&(Dl=!0),Dl){if(xt())return Be(),void Ue(Rh(jh));yt(Je(0,0,0),2)}},sh=function(){var t=at(240,135.5);wt(),oa(El,t),oa(jl,t),An(Ml,t)},ch=function(){ve(Ol),Rn(Ml)},ph=["data/levels/blue_ocean_1.json","data/levels/blue_ocean_2.json","data/levels/blue_ocean_3.json","data/levels/desert1.json","data/levels/exotic_1.json","data/levels/exotic_2.json","data/levels/exotic_3.json","data/levels/exotichell_1.json","data/levels/prototype.json","data/levels/superboss_1.json","data/levels/superboss_2.json","data/levels/template.json","data/levels/tutorial_1.json","data/levels/tutorial_2.json","data/levels/test.json"],lh=1,_h=[],uh=0,dh=0,fh=[],hh=function(){dh=0,Cl=0,Ul=0,Nl=xe(),Pl=ta(4),ea(Pl,Ne("STAGESELECT_TITLE")),Pl.position.x=(lt-na(Pl).length*aa(Pl).x)/2-150,Pl.position.y=10,Ll=ta(8),ea(Ll,Ne("STAGESELECT_MSG")),Ll.position.x=10,Ll.position.y=_t-1.5*aa(Ll).y,Rl=ta(8),ea(Rl,Ne("STAGESELECT_PAGE"),0,0),Rl.position.x=lt-na(Rl).length*aa(Rl).x-10,Rl.position.y=40,ba("data/themes/levelselect.bg.json").then((function(t){Gl=t})),Al=Ln(),Bn(Al,rn("SD_TITLEFOOT",0)),yh(),bt(Je(0,0,0),1)},gh=function(){var t=z();if(Cl+=t,xa(Gl),fh.length){if(Al.position=at(fh[dh].position.x,fh[dh].position.y),Al.position.x+=3*Math.cos(2*g.PI*Cl)-20,Tl=Math.floor(dh/8+1),lh=Math.floor(uh/8+(uh%8==0?0:1)),ea(Rl,Ne("STAGESELECT_PAGE"),Tl,lh),Rl.position.x=lt-na(Rl).length*aa(Rl).x-10,2==Ul)vt()||P();else if(!A()){var e=D("data/music/options.mp4");T(e,g._v)}switch(Ul){case 0:vt()||(ke(Nl,2)&&(dh=(dh+1)%uh,C(We("choose"))),ke(Nl,1)&&(dh=((dh-1)%uh+uh)%uh,C(We("choose"))),(ke(Nl,5)||ke(Nl,7))&&(E('Loading level "%s", "%s"',_h[dh].name,_h[dh].filepath),J_(_h[dh].filepath),C(We("select")),Ul=2),ke(Nl,8)&&(C(We("return")),Ul=1));break;case 1:if(xt())return void Be();yt(Je(0,0,0),1);break;case 2:if(xt())return xi(5),vi(0),Ue(Rh(vh)),void(Ul=3);yt(Je(0,0,0),1);break;case 3:bt(Je(0,0,0),1),Ul=0}}},mh=function(){var t,e=at(240,135.5);for(va(Gl,e),wa(Gl,e),oa(Pl,e),oa(Ll,e),lh>1&&oa(Rl,e),t=8*(Tl-1);t<8*Tl;t++)_h[t]&&(ea(fh[t],dh==t?"<color=ffff00>%s - %s %s</color>":"%s - %s %s",_h[t].name,Ne("STAGESELECT_ACT"),_h[t].act),oa(fh[t],e));An(Al,e)},bh=function(){xh(),Gl=ya(),Rn(Al),ve(Nl)},yh=function(){E("load_stage_list()"),k(ph).then((function(t){uh=(_h=t).length;for(var e=0;e<uh;e++)fh[e]=ta(8),fh[e].position=at(25,60+e%8*20),_h[e].filepath=ph[e]}))},xh=function(){},vh=1,wh=2,kh=3,Ih=4,Sh=5,jh=6,Eh=7,Mh=8,Oh=9,Dh=10,Th=11,Ph=12,Lh=[],Rh=function(t){return console.log("GET SCENE",t),Lh[t]},Ah=function(t,e,n,a){return{init:t,update:e,render:n,release:a}},Nh=function(){var t,e,n;e=function(e){var n;!function(t){var e,n;for(n=0;n<10;)n=(e=F())>W?e-W:0,W=e>=W?W:e;n=Math.min(n,16),Y=.001*n,i++,(o+=parseInt(n,10))>=1e3&&(r=i,i=0,o=0),W=F()}(),function(){var t,e,n=z();for(e=de;e;e=e.next){for(t=0;t<9;t++)e.data.oldstate[t]=e.data.state[t];for(t=0;t<9;t++)we(e.data,t)?e.data.howlong[t]+=n:e.data.howlong[t]=0;switch(e.data.type){case 1:e.data.state[1]=Ct.up,e.data.state[2]=Ct.down,e.data.state[4]=Ct.left,e.data.state[3]=Ct.right,e.data.state[5]=Ct.space,e.data.state[6]=Ct.lcontrol,e.data.state[7]=Ct.enter,e.data.state[8]=Ct.esc,e.data.state[9]=Ct.tilda;break;case 4:e.data.x=ge.x,e.data.y=ge.y,e.data.state[5]=me.left,e.data.state[7]=me.middle,e.data.state[6]=me.right;break;case 2:for(t=0;t<9;t++)e.data.state[t]=!1;break;case 3:At&&!Nt&&(e.data.state[1]=joy[0].stick[0].axis[1].d1,e.data.state[2]=joy[0].stick[0].axis[1].d2,e.data.state[4]=joy[0].stick[0].axis[0].d1,e.data.state[3]=joy[0].stick[0].axis[0].d2,e.data.state[5]=joy[0].button[0].b,e.data.state[6]=joy[0].button[1].b,e.data.state[7]=joy[0].button[2].b,e.data.state[8]=joy[0].button[3].b);break;case 0:e.data.state[1]=Ct.up,e.data.state[2]=Ct.down,e.data.state[4]=Ct.left,e.data.state[3]=Ct.right,e.data.state[5]=Ct.space,e.data.state[6]=Ct.lcontrol,e.data.state[7]=Ct.enter,e.data.state[8]=Ct.esc,fe&&(e.data.state[1]=Gt.up(),e.data.state[2]=Gt.down(),e.data.state[4]=Gt.left(),e.data.state[3]=Gt.right(),e.data.state[5]=Ut._pressed,e.data.state[8]=Bt._pressed,e.data.state[6]=Ht._pressed),Xt&&(Wt="undefined"!=typeof navigator&&(navigator.getGamepads()[0]||null)),Wt&&(e.data.state[1]=Wt.buttons[12].pressed,e.data.state[2]=Wt.buttons[13].pressed,e.data.state[4]=Wt.buttons[14].pressed,e.data.state[3]=Wt.buttons[15].pressed,e.data.state[5]=Wt.buttons[0].pressed,e.data.state[6]=Wt.buttons[1].pressed,e.data.state[7]=Wt.buttons[2].pressed,e.data.state[8]=Wt.buttons[3].pressed)}}}(),(t=He())&&(t.update(),t==He()&&t.render()),u=!1,0!=_&&((f+=z())<h?(n=parseInt(1.25*f/h*100,10),n=J(n,0,100),n=1==_?100-n:n,n/=100,St().fillStyle=d,St().globalAlpha=n,St().fillRect(0,0,s.width,s.height)):(2==_&&(St().fillStyle=d,St().fillRect(0,0,s.width,s.height)),_=0,h=f=0,d=0,u=!0)),St().globalAlpha=1,Ot()&&(St().font="14px Arial",St().fillStyle="white",St().fillText(r,450,20)),Gt&&Gt.render(St()),Ut&&Ut.render(St()),Bt&&Bt.render(St()),Ht&&Ht.render(St())},n=null,requestAnimationFrame((function t(a){var i=!1;if(null!=n){Math.min(a-n,100);i=!1===e()}n=a,i||requestAnimationFrame(t)}))},Ch=function(){E("preferences_init()"),function(){if(B.video_resolution="TINY",B.fullscreen=!1,B.smooth_graphics=!1,B.show_fps=!1,B.language="data/languages/english.json","undefined"!=typeof window)for(var t in B)B[t]=window.localStorage.getItem(t)?localStorage.getItem(t):B[t],"false"==B[t]&&(B[t]=!1);console.log("PREFERENCES",B)}()},Gh=function(t){var e,n,a,l;E("timer_init()"),i=0,o=0,r=0,Y=0,W=F(),Bh(),e=t.video_resolution,n=t.smooth_graphics,a=t.fullscreen,t.color_depth,l=t.show_fps,Tt(e,n,a),Dt(l),(s=document.getElementById("canvas"))?(console.log("111111111"),c=s.getContext("2d"),ht=s.width/lt,gt=s.height/_t,c.scale(s.width/lt,s.height/_t)):(console.log("222222222"),s=document.createElement("canvas"),c=s.getContext("2d"),s.width=lt,s.height=_t,document.body.appendChild(s)),ht=lt/window.innerWidth,gt=ht,c.imageSmoothingEnabled=!1,c.mozImageSmoothingEnabled=!1,console.log("PIXEL RATIO",window.devicePixelRatio),console.log("VIDEO_SCREEN_W",lt),console.log("VIDEO_SCREEN_H",_t),console.log("CANVAS",s.width,s.height),console.log("WINDOW",window.innerWidth),console.log("SCALE",ht),p=c,wt(),E("input_init()"),de=null,It().addEventListener("contextmenu",(function(t){if(2===t.button)return t.preventDefault(),!1}),!1),It().addEventListener("mousemove",(function(t){ge=function(t,e){var n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}}(It(),t)}),!1),It().addEventListener("mousedown",(function(t){switch(t.which){case 1:me.left=!0;break;case 2:me.middle=!0;break;case 3:me.right=!0}}),!1),It().addEventListener("mouseup",(function(t){switch(t.which){case 1:me.left=!1;break;case 2:me.middle=!1;break;case 3:me.right=!1}}),!1),At=!1,Nt=!1,Xt="undefined"!=typeof navigator&&"getGamepads"in navigator,console.log("canGamepad",Xt),(fe=function(){try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}}())&&(console.log("21111",It()),(Gt=new Rt({container:It(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX>=window.innerWidth/2||e.pageY<window.innerHeight/2)})),(Ut=new Rt({container:It(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX<window.innerWidth/2||e.pageY<window.innerHeight/2)})),(Bt=new Rt({container:It(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX>window.innerWidth/2||e.pageY>window.innerHeight/2)})),(Ht=new Rt({container:It(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX<window.innerWidth/2||e.pageY>window.innerHeight/2)}))),Ct=Te(he),m.images={},m.images,m.samples={},x=m.samples,m.musics={},v=m.musics},Uh=function(t,e){E("soundfactory: loading the samples table..."),I("data/config/samples.json").then((function(t){Ye(t)})),E("Loading objects scripts..."),yc=null,I("data/objects/enemies.json").then((function(t){yc=t})),function(){for(var t=0;t<256;t++)Lh[t]=null;Lh[vh]=Ah(eu,nu,au,iu),Lh[wh]=Ah(eh,nh,ah,ih),Lh[kh]=Ah(xd,vd,wd,kd),Lh[Ih]=Ah(_d,ud,dd,fd),Lh[jh]=Ah(Wd,Yd,$d,zd),Lh[0]=Ah(Id,Sd,jd,Ed),Lh[Sh]=Ah(Na,Ca,Ga,Ua),Lh[Eh]=Ah(oh,rh,sh,ch),Lh[Mh]=Ah(ua,da,fa,ha),Lh[Oh]=Ah(Pd,Ld,Rd,Ad),Lh[Dh]=Ah(Da,Ta,Pa,La),Lh[Th]=Ah(cf,pf,lf,_f),Lh[Ph]=Ah(hh,gh,mh,bh)}(),function(t,e){E("Initializing the language module"),Re(Pe=t||Pe).then((function(t){console.log(t),E("lang_init() ok!"),e()}))}(t.language,(function(){!function(){Ge=0;for(var t=0;t<16;t++)Ce[t]=null}(),e()}))},Bh=function(){return""};!function(t){Ch();var e=function(t){var e={};return e.video_resolution=B.video_resolution,e.smooth_graphics=B.smooth_graphics,e.fullscreen=B.fullscreen,e.show_fps=B.show_fps,e.language=B.language,e.video_resolution=t.video_resolution?t.video_resolution:e.video_resolution,e.smooth_graphics=t.smooth_graphics?t.smooth_graphics:e.smooth_graphics,e.fullscreen=t.fullscreen?t.fullscreen:e.fullscreen,e.show_fps=t.show_fps?t.show_fps:e.show_fps,e.color_depth=t.color_depth?t.color_depth:32,e.level=t.level?t.level:null,e.quest=t.quest?t.quest:null,e.language=t.language?t.language:e.language,e.video_resolution=X("video_resolution")?X("video_resolution"):e.video_resolution,e.smooth_graphics=X("smooth_graphics")?X("smooth_graphics"):e.smooth_graphics,e.fullscreen=X("fullscreen")?X("fullscreen"):e.fullscreen,e.show_fps=X("show_fps")?X("show_fps"):e.show_fps,e.color_depth=X("color_depth")?X("color_depth"):e.color_depth,e.level=X("level")?X("level"):e.level,e.quest=X("quest")?X("quest"):e.quest,e.language=X("language")?X("language"):e.language,e.level?(e.custom_level=!0,e.custom_level_path=e.level):e.custom_level=!1,e.quest?(e.custom_quest=!0,e.custom_quest_path=e.quest):e.custom_quest=!1,e}(t);console.log("COMMAND LINE",e),Gh(e),new Promise((function(t,e){var n;for(E("Loading sprites..."),m.sprites={},en=m.sprites,n=0;n<nn.length;n++)nn[n]="data/sprites/"+nn[n]+".json";kt("Loading...",0),k(nn).then((function(e){for(console.log("GOT ALL SPRITE JSON FILES"),n=0;n<e.length;n++)for(var a in e[n])e[n][a].name=a,on.push(e[n][a]);fn(on).then((function(){E("All sprites have been loaded!"),en=b(),t()}))}))})).then((function(){!function(){var t,e,n,a=["ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","0123456789:","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_abcdefghijklmnopqrstuvwxyz{|}~"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_abcdefghijklmnopqrstuvwxyz{|}~"];for(E("font_init()"),t=0;t<a.length;t++)for(Zn[t]={ch:[]},n="FT_FONT"+t,e=0;e<a[t].length;e++)Zn[t].ch[a[t][e]]=sn(rn(n,0),e);E("font_init() ok")}(),Uh(e,(function(){xi(5),vi(0),function(t){t.custom_level?(J_(t.custom_level_path),Ue(Rh(vh))):Ue(Rh(0))}(e),Nh()}))}))}((Bl={Xvideo_resolution:"TINY",Xsmooth_graphics:!1,Xfullscreen:!1,Xshow_fps:!0,Xcolor_depth:32,Xlevel:null},a(Bl,"Xlevel","data/levels/blue_ocean_3.json"),a(Bl,"Xquest",null),a(Bl,"Xquest","data/quests/tutorial.json"),a(Bl,"Xlanguage",null),a(Bl,"Xlanguage","data/languages/italiano.json"),Bl))})()})();