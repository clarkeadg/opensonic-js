(()=>{"use strict";var t,e,n,a,i,r,o,c,s,u,l="Open Sonic",d="http://opensnc.sourceforge.net",p=1e-5,f=1<<30,_=1/0,h=999999999,m=Math.PI,g={sprites:{},images:{},samples:{},musics:{}},v=function(){return g.sprites},b=function(t,e){return g.samples[e]},y=function(t){return Promise.all(t.map(x))},x=function(t){return e=void 0,n=void 0,i=function(){var e,n,a;return function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(i){switch(i.label){case 0:e={},i.label=1;case 1:return i.trys.push([1,5,6,7]),[4,fetch("".concat("").concat(t))];case 2:return(n=i.sent()).ok?[4,n.json()]:[3,4];case 3:e=i.sent(),i.label=4;case 4:return[3,7];case 5:return a=i.sent(),console.log("err",a),[3,7];case 6:return[2,e];case 7:return[2]}}))},new((a=void 0)||(a=Promise))((function(t,r){function o(t){try{s(i.next(t))}catch(t){r(t)}}function c(t){try{s(i.throw(t))}catch(t){r(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof a?n:new a((function(t){t(n)}))).then(o,c)}s((i=i.apply(e,n||[])).next())}));var e,n,a,i},w=function(e,n){!function(t,e,n){t[e]=n}(t,e,n)},k=function(t){console.log(t)},E=function(t){console.log("FATAL ERROR",t)},S=null,M=function(t){k('music_load("'.concat(t,'")'));var n=new Audio;return n.src=t,function(t,n){!function(t,e,n){t[e]=n}(e,t,n)}(t,n),n},T=function(t,e){if(O()&&j(),null!=t){t.loop=!!e;try{t.play()}catch(t){}}S=t},j=function(){null!=S&&S.pause(),S=null},I=function(t){null!=S&&(t>1&&(t=1),t<0&&(t=0),S.volume=t)},D=function(){return null!=S?S.volume:0},O=function(){return null!=S&&!S.paused},R=function(t,e){e=""+e;var n=new Audio;n.src=e;var a=new Audio;a.src=e;var i=new Audio;i.src=e;var r=new Audio;return r.src=e,w(t,n),w(t+"2",a),w(t+"3",i),w(t+"4",r),n},A=function(t){L(t)},L=function(t){t&&t.play&&t.play()},N=function(t){return!!t&&!t.paused},C={video_resolution:"",fullscreen:!1,smooth_graphics:!1,show_fps:!1,language:""},G=function(){if("undefined"!=typeof window)for(var t in C)C[t],window.localStorage.setItem(t,C[t])},P=function(t){if("undefined"!=typeof window){var e=RegExp("[?&]"+t+"=([^&]*)").exec(window.location.search);return e&&decodeURIComponent(e[1].replace(/\+/g," "))}return null},U=0,B=0,Y=0,H=0,W=0,F=0,X=function(){return W},z=function(){var t=$();return t<F&&(F=t),t-F},$=function(){return Math.floor(Date.now())},Q=function(t){return" "==t},V=function(t){return void 0!==t&&t&&t.constructor===Array},K=function(t){return~~q(Math.random()*t,0,t)},q=function(t,e,n){return Math.min(Math.max(t,e),n)},J=function(t,e){return t[0]<e[2]&&t[2]>e[0]&&t[1]<e[3]&&t[3]>e[1]},Z=function(t,e){return et(t,e,t.length)},tt=function(t){return t>=0&&t<m/4-p?0:t>=m/4-p&&t<m/2-p?m/4:t>=m/2-p&&t<m/2+p?m/2:t>=m/2+p&&t<m-p?3*m/4:t>=m-p&&t<m+p?m:t>=m+p&&t<3*m/2-p?5*m/4:t>=3*m/2-p&&t<3*m/2+p?3*m/2:t>3*m/2+p&&t<=7*m/4+p?7*m/4:0},et=function(t,e,n){var a,i,r=t,o=e;for(a=0;a<n;a++)i=r[a],r[a]=o[a],o[a]=i;return[r[a],o[a]]},nt=function(t,e){return{x:t,y:e}},at=function(t,e){return{x:t.x+e.x,y:t.y+e.y}},it=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},rt=function(t,e){return{x:e*t.x,y:e*t.y}},ot=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},ct=function(t,e){var n=t.x,a=t.y;return{x:n*Math.cos(e)-a*Math.sin(e),y:a*Math.cos(e)+n*Math.sin(e)}},st=function(t){var e=ot(t);return e>p?nt(t.x/e,t.y/e):nt(0,0)},ut=480,lt=271,dt=!1,pt=!1,ft=!1,_t=1,ht=1,mt=function(){return nt(_t,ht)},gt=function(t,e){0==r&&(r=1,o=!1,c=t,s=0,u=e)},vt=function(t,e){0==r&&(r=2,o=!1,c=t,s=0,u=e)},bt=function(){return o},yt=function(){return 0!=r},xt=function(t){a.fillStyle=t||"rgb(0, 0, 0)",a.fillRect(0,0,n.width,n.height)},wt=function(t,e){xt();var n=Et();n.beginPath(),n.rect(130,115.5,210,20),n.fillStyle="black",n.fill(),n.lineWidth=1,n.strokeStyle="white",n.stroke(),e=e<1?0:e>202?202:202/e,n.beginPath(),n.rect(134,118.5,e,14),n.fillStyle="white",n.fill(),n.lineWidth=1,n.strokeStyle="black",n.stroke(),n.font="14px Arial",n.fillStyle="white",n.fillText(t,130,105.5)},kt=function(){return n},Et=function(){return a},St=function(){return i},Mt=function(){return dt},Tt=function(){return pt},jt=function(){return ft},It=function(t){ft=t},Dt=function(t,e,n){i=t,pt=n,dt=e};function Ot(t){return Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ot(t)}function Rt(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,(i=a.key,r=void 0,r=function(t,e){if("object"!==Ot(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,"string");if("object"!==Ot(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i),"symbol"===Ot(r)?r:String(r)),a)}var i,r}var At,Lt,Nt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._container=e.container||document.body,this._strokeStyle=e.strokeStyle||"cyan",this._mouseSupport=void 0!==e.mouseSupport&&e.mouseSupport,this._stationaryBase=e.stationaryBase||!1,this._baseX=this._stickX=e.baseX||0,this._baseY=this._stickY=e.baseY||0,this._limitStickTravel=e.limitStickTravel||!1,this._stickRadius=void 0!==e.stickRadius?e.stickRadius:100,this._pressed=!1,this._touchIdx=null;var n=function(t,e){return function(){return t.apply(e,arguments)}};this._$onTouchStart=n(this._onTouchStart,this),this._$onTouchEnd=n(this._onTouchEnd,this),this._$onTouchMove=n(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=n(this._onMouseDown,this),this._$onMouseUp=n(this._onMouseUp,this),this._$onMouseMove=n(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))}var e,n,a;return e=t,a=[{key:"touchScreenAvailable",value:function(){return"createTouch"in document}}],(n=[{key:"destroy",value:function(){this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))}},{key:"deltaX",value:function(){return this._stickX-this._baseX}},{key:"deltaY",value:function(){return this._stickY-this._baseY}},{key:"up",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(e>=0||Math.abs(t)>2*Math.abs(e))}},{key:"down",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(e<=0||Math.abs(t)>2*Math.abs(e))}},{key:"right",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(t<=0||Math.abs(e)>2*Math.abs(t))}},{key:"left",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(t>=0||Math.abs(e)>2*Math.abs(t))}},{key:"_onUp",value:function(){this._pressed=!1,0==this._stationaryBase&&(this._baseX=this._baseY=0,this._stickX=this._stickY=0)}},{key:"_onDown",value:function(t,e){this._pressed=!0;var n=mt();t*=n.x,e*=n.y,this._stationaryBase,this._stickX=t,this._stickY=e}},{key:"_onMove",value:function(t,e){var n=mt();t*=n.x,e*=n.y,!0===this._pressed&&(this._stickX=t,this._stickY=e)}},{key:"_onMouseUp",value:function(t){return this._onUp()}},{key:"_onMouseDown",value:function(t){t.preventDefault();var e=t.clientX,n=t.clientY;return this._onDown(e,n)}},{key:"_onMouseMove",value:function(t){var e=t.clientX,n=t.clientY;return this._onMove(e,n)}},{key:"_onTouchStart",value:function(t){if(null===this._touchIdx&&!1!==this.dispatchEvent("touchStartValidation",t)){this.dispatchEvent("touchStart",t),t.preventDefault();var e=t.changedTouches[0];this._touchIdx=e.identifier;var n=e.pageX,a=e.pageY;return this._onDown(n,a)}}},{key:"_onTouchEnd",value:function(t){if(null!==this._touchIdx){this.dispatchEvent("touchEnd",t);for(var e=t.changedTouches,n=0;n<e.length&&e[n].identifier!==this._touchIdx;n++);if(n!==e.length)return this._touchIdx=null,t.preventDefault(),this._onUp()}}},{key:"_onTouchMove",value:function(t){if(null!==this._touchIdx){for(var e=t.changedTouches,n=0;n<e.length&&e[n].identifier!==this._touchIdx;n++);if(n!==e.length){var a=e[n];t.preventDefault();var i=a.pageX,r=a.pageY;return this._onMove(i,r)}}}},{key:"render",value:function(t){t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=3,t.arc(this._baseX,this._baseY,20,0,2*Math.PI,!0),t.stroke(),t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=1,t.arc(this._baseX,this._baseY,30,0,2*Math.PI,!0),t.stroke(),this._pressed&&(t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=3,t.arc(this._stickX,this._stickY,20,0,2*Math.PI,!0),t.stroke())}}])&&Rt(e.prototype,n),a&&Rt(e,a),Object.defineProperty(e,"prototype",{writable:!1}),t}();(At=Nt.prototype).addEventListener=function(t,e){return void 0===this._events&&(this._events={}),this._events[t]=this._events[t]||[],this._events[t].push(e),e},At.removeEventListener=function(t,e){void 0===this._events&&(this._events={}),t in this._events!=0&&this._events[t].splice(this._events[t].indexOf(e),1)},At.dispatchEvent=function(t){if(void 0===this._events&&(this._events={}),void 0!==this._events[t])for(var e=this._events[t].slice(),n=0;n<e.length;n++){var a=e[n].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==a)return a}},function(t){t[t.IB_UP=1]="IB_UP",t[t.IB_DOWN=2]="IB_DOWN",t[t.IB_RIGHT=3]="IB_RIGHT",t[t.IB_LEFT=4]="IB_LEFT",t[t.IB_FIRE1=5]="IB_FIRE1",t[t.IB_FIRE2=6]="IB_FIRE2",t[t.IB_FIRE3=7]="IB_FIRE3",t[t.IB_FIRE4=8]="IB_FIRE4",t[t.IB_FIRE5=9]="IB_FIRE5"}(Lt||(Lt={}));var Ct,Gt=Lt.IB_UP,Pt=Lt.IB_DOWN,Ut=Lt.IB_LEFT,Bt=Lt.IB_RIGHT,Yt=Lt.IB_FIRE1,Ht=Lt.IB_FIRE2,Wt=Lt.IB_FIRE3,Ft=Lt.IB_FIRE4,Xt=Lt.IB_FIRE5;!function(t){t[t.IT_KEYBOARD=1]="IT_KEYBOARD",t[t.IT_MOUSE=2]="IT_MOUSE",t[t.IT_COMPUTER=3]="IT_COMPUTER",t[t.IT_JOYSTICK=4]="IT_JOYSTICK",t[t.IT_USER=5]="IT_USER"}(Ct||(Ct={}));var zt,$t,Qt,Vt,Kt,qt,Jt,Zt,te,ee,ne,ae,ie,re,oe,ce=null,se=!1,ue=!1,le=!1,de={37:"left",38:"up",39:"right",40:"down",17:"lcontrol",32:"space",13:"enter",27:"esc",192:"tilda"},pe=null,fe=null,_e=null,he=null,me=null,ge=null,ve=null,be=nt(0,0),ye={left:!1,middle:!1,right:!1},xe=function(){for(var t={type:Ct.IT_COMPUTER,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},e=0;e<9;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return Re(t),t},we=function(t){for(var e={type:Ct.IT_KEYBOARD,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},n=0;n<9;n++)e.state[n]=e.oldstate[n]=!1,e.howlong[n]=0;if(t)for(e.keybmap=[],n=0;n<9;n++)e.keybmap[n]=t[n];else e.keybmap[Gt]=38,e.keybmap[Pt]=40,e.keybmap[Bt]=39,e.keybmap[Ut]=37,e.keybmap[Yt]=32,e.keybmap[Ht]=17,e.keybmap[Wt]=13,e.keybmap[Ft]=27,e.keybmap[Xt]=192;return Re(e),e},ke=function(){for(var t={type:Ct.IT_USER,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},e=0;e<9;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return t.keybmap=[],t.keybmap[Gt]=38,t.keybmap[Pt]=40,t.keybmap[Bt]=39,t.keybmap[Ut]=37,t.keybmap[Yt]=32,t.keybmap[Ht]=17,t.keybmap[Wt]=13,t.keybmap[Ft]=27,Re(t),t},Ee=function(t){Ae(t),t=null},Se=function(t,e){return!!e&&!!t.enabled&&t.state[e]},Me=function(t,e){return!(!e||!t)&&!!t.enabled&&t.state[e]&&!t.oldstate[e]},Te=function(t,e){return!e||!!t.enabled&&!t.state[e]&&t.oldstate[e]},je=function(t,e){t.state[e]=!0},Ie=function(t){t.enabled=!1},De=function(t){t.enabled=!0},Oe=function(t){return nt(t.x,t.y)},Re=function(t){ce={data:t,next:ce}},Ae=function(t){var e,n;if(ce.data==t)n=ce.next,ce=null,ce=n;else{for(e=ce;e.next&&e.next.data!=t;)e=e.next;e.next&&(n=e.next.next,e.next=null,e.next=n)}},Le=function(t){var e=Object.create(null);function n(n){if(t.hasOwnProperty(n.keyCode)){var a="keydown"==n.type;e[t[n.keyCode]]=a,n.preventDefault()}}return addEventListener("keydown",n),addEventListener("keyup",n),e},Ne=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},Ce=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Ge="data/languages/english.json",Pe={},Ue=function(t){return Ne(void 0,void 0,void 0,(function(){var e;return Ce(this,(function(n){switch(n.label){case 0:return k('lang_loadfile("'.concat(t,'")...')),[4,x(t)];case 1:return e=n.sent(),Pe=e,[2]}}))}))},Be=function(t){return Pe[t]||t},Ye=function(t){return Be(t)},He=[],We=0,Fe=function(t){He[We++]=t,t&&t.init()},Xe=function(){He[We-1].release(),He[We-1]=null,We--},ze=function(){return He[We-1]},$e={},Qe=function(t){var e=b(0,t);return N(e)&&(e=b(0,t+"2"),N(e)&&(e=b(0,t+"3"),N(e)&&(e=b(0,t+"4")))),e},Ve=function(){return t=void 0,e=void 0,a=function(){var t;return function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(e){switch(e.label){case 0:return k("soundfactory: loading the samples table..."),[4,x("data/config/samples.json")];case 1:return t=e.sent(),Ke(t),[2]}}))},new((n=void 0)||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}));var t,e,n,a},Ke=function(t){for(var e in t)$e[e]=qe(e,t[e])},qe=function(t,e){var n=Je();return n.data=R(t,e),n.data2=R(t,e),n},Je=function(){return{data:null,data2:null}},Ze={},tn=function(t,e){return Et().createImageData(t,e)},en=function(t){return new Promise((function(e,n){if(Ze[t])return e(Ze[t]);var a=document.createElement("img");a.src=t,a.addEventListener("load",(function(){return Ze[t]=a,e(a)}))}))},nn=function(t,e,n,a,i,r,o,c){if(!t||!e)return!1;e.drawImage(t,n,a,o,c,i,r,o,c)},an=function(t,e,n,a,i){e.fillStyle=i,e.fillRect(n,a,n+1,a+1)},rn=function(t,e,n){return"rgb(".concat(t,", ").concat(e,", ").concat(n,")")},on=function(t,e,n,a){for(var i=0;i<t.data.length;i+=4)t.data[i]=e,t.data[i+1]=n,t.data[i+2]=a},cn=function(t){t&&(t=null)},sn=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},un=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},ln={},dn=["animal","bigring","bluering","bosses","bumber","charge","checkpointorb","chef","danger","dangpower","dnadoor","door","explosion","fireball","flyingboy","flyingeyes","font","glasses","goal","goldfish","hud","icon","itembox","joan","kleps","lady_bugsy","levelact","loop","menu","misc","nafder","neon","oranjection","ring","roboxer","shield","spikes","spring","surge","surpreyes","switch","teleporter"],pn=0,fn=[],_n=function(t,e){var n;return null!=(n=ln[t])?n.animation_data[e]:null},hn=function(t,e){return t?t.frame_data[t.data[e]]:null},mn=function(t){return sn(void 0,void 0,void 0,(function(){return un(this,(function(e){switch(e.label){case 0:return[4,gn(t)];case 1:return[2,e.sent()]}}))}))},gn=function(t){return sn(void 0,void 0,void 0,(function(){var e,n,a;return un(this,(function(i){switch(i.label){case 0:return e=vn(),n=function(t){var e,n,a;for((t.frame_w>t.rect_w||t.frame_h>t.rect_h)&&(t.frame_w=Math.min(t.frame_w,t.rect_w),t.frame_h=Math.min(t.frame_h,t.rect_h)),(t.rect_w%t.frame_w>0||t.rect_h%t.frame_h>0)&&(t.rect_w=t.rect_w%t.frame_w>0?t.rect_w-t.rect_w%t.frame_w+t.frame_w:t.rect_w,t.rect_h=t.rect_h%t.frame_h>0?t.rect_h-t.rect_h%t.frame_h+t.frame_h:t.rect_h),a=t.rect_w/t.frame_w*(t.rect_h/t.frame_h),e=0;e<t.animation_count;e++)for(n=0;n<t.animation_data[e].frame_count;n++)t.animation_data[e].data[n]>=0&&t.animation_data[e].data[n]<a||(t.animation_data[e].data[n]=Math.min(t.animation_data[e].data[n],0,a-1));return t}(n=kn(e,t)),[4,bn(n)];case 1:return a=i.sent(),n=xn(a),Sn(t.name,n),pn++,wt("Loading...",pn/fn.length),[2,n]}}))}))},vn=function(){return{source_file:null,rect_x:0,rect_y:0,rect_w:0,rect_h:0,frame_w:0,frame_h:0,hot_spot:nt(0,0),frame_count:0,frame_data:[],animation_count:0,animation_data:[]}},bn=function(t){return sn(void 0,void 0,void 0,(function(){var e;return un(this,(function(n){switch(n.label){case 0:return[4,en(t.source_file)];case 1:return e=n.sent(),t.frame_count=t.rect_w/t.frame_w*(t.rect_h/t.frame_h),t.frame_data=[],[2,t=yn(t,e)]}}))}))},yn=function(t,e){for(var n=0,a=0,i=0;i<t.frame_count;i++){var r={data:e,sx:n+t.rect_x,sy:a+t.rect_y,swidth:t.frame_w,sheight:t.frame_h,x:0,y:0,width:t.frame_w,height:t.frame_h};t.frame_data[i]=r,(n+=t.frame_w)>=t.rect_w&&(n=0,a+=t.frame_h)}return t},xn=function(t){for(var e=0;e<t.animation_count;e++)t.animation_data[e].frame_data=t.frame_data,t.animation_data[e].hot_spot=t.hot_spot;return t},wn=function(t){return Promise.all(t.map(gn))},kn=function(t,e){if(t.source_file=""+e.source_file,t.rect_x=e.source_rect.xpos,t.rect_y=e.source_rect.ypos,t.rect_w=e.source_rect.width,t.rect_h=e.source_rect.height,t.frame_w=e.frame_size.width,t.frame_h=e.frame_size.height,e.hot_spot&&(t.hot_spot.x=e.hot_spot.xpos,t.hot_spot.y=e.hot_spot.ypos),e.animations){t.animation_count=e.animations.length;for(var n=0;n<t.animation_count;n++)t.animation_data[n]=En(Mn(),e.animations[n]),0==t.animation_data[n].frame_count&&k("Animation error: invalid 'data' field. You must specify the frames of the animations")}return t},En=function(t,e){return t.repeat=e.repeat,t.fps=e.fps,t.data=e.data,t.frame_count=e.data.length,t},Sn=function(t,e){!function(t,e,n){g.sprites[e]=n}(v(),t,e)},Mn=function(){return{repeat:!1,fps:8,frame_count:0,data:null,hot_spot:nt(0,0),frame_data:null}},Tn=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},jn=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},In=0,Dn=[],On=function(t){return Dn[t]},Rn=function(){return In},An=function(t){var e=t.brick_ref.data;if(null!=e&&e.animation_data.length){e.animation_data[0].repeat;var n=e.animation_data[0].frame_count;t.animation_frame+=e.animation_data[0].fps*X(),t.animation_frame>e.animation_data[0].frame_count-1&&(t.animation_frame=0),n=~~t.animation_frame,t.brick_ref.image=e.frame_data[e.animation_data[0].data[n]]}},Ln=function(t){return t.brick_ref.image},Nn=function(t){return Tn(void 0,void 0,void 0,(function(){var e,n,a,i;return jn(this,(function(r){switch(r.label){case 0:for(e=function(){for(var t={data:null,image:null,property:0,angle:0,behavior:0,zindex:.5,behavior_arg:[]},e=0;e<5;e++)t.behavior_arg[e]=0;return t}(),"OBSTACLE"==(n=t.type)?e.property=1:"PASSABLE"==n?e.property=0:"CLOUD"==n?e.property=2:k("Can't read brick attributes: unknown brick type ".concat(n)),"DEFAULT"==(n=V(t.behavior)?t.behavior[0]:t.behavior)?e.behavior=0:"CIRCULAR"==n?e.behavior=1:"BREAKABLE"==n?e.behavior=2:"FALL"==n?e.behavior=3:k("Can't read brick attributes: unknown brick type ".concat(n)),a=0;a<5;a++)e.behavior_arg[a]=t.behavior[1+a];return e.behavior_arg[e.behavior_arg.length-1]=0,e.angle=t.angle,t.zindex&&(e.zindex=t.zindex),[4,mn(t.sprite)];case 1:return i=r.sent(),e.data=i,e.image=i.frame_data[0],In++,[2,e]}}))}))},Cn=void 0,Gn=!0,Pn=0,Un=0,Bn=0,Yn=0,Hn=function(){return{spawn_point:nt(0,0),position:nt(0,0),angle:0,speed:nt(0,0),maxspeed:0,acceleration:0,jump_strength:0,is_jumping:!1,ignore_horizontal:!1,input:null,animation:null,animation_frame:0,animation_speed_factor:1,mirror:0,visible:!0,alpha:1,hot_spot:nt(0,0),carried_by:null,carry_offset:nt(0,0),carrying:null}},Wn=function(t){t.input&&Ee(t.input),t=null},Fn=function(t,e){if(e&&t&&t.visible&&t.animation){t.animation_frame+=t.animation.fps*t.animation_speed_factor*X(),t.animation_frame>t.animation.frame_count-1&&(t.animation.repeat?t.animation_frame=0:t.animation_frame=t.animation.frame_count-1);var n=$n(t);if(!n)return!1;t.mirror&&ca(Et(),t.position.x-(e.x-240));var a=t.position.x-(e.x-240),i=t.position.y-(e.y-135.5),r=t.mirror?t.angle:-t.angle;t.angle&&(Et().translate(a,i),Et().rotate(r),Et().translate(-a,-i)),Et().drawImage(n.data,n.sx,n.sy,n.swidth,n.sheight,~~(t.position.x-t.hot_spot.x-(e.x-240)),~~(t.position.y-t.hot_spot.y-(e.y-135.5)),1*n.width,1*n.height),t.angle&&(Et().translate(a,i),Et().rotate(-r),Et().translate(-a,-i)),t.mirror&&ca(Et(),t.position.x-(e.x-240))}},Xn=function(t,e,n,a){var i=nt(0,0);if(t.visible&&t.animation){isNaN(t.animation_frame)&&(t.animation_frame=0,t.animation.fps=1),t.animation_frame+=t.animation.fps*t.animation_speed_factor*X(),t.animation_frame>t.animation.frame_count-1&&(t.animation.repeat?t.animation_frame=0:t.animation_frame=t.animation.frame_count-1);var r=$n(t);if(!r)return!1;i.x=t.position.x%(n?r.width:h)-t.hot_spot.x-(e.x-240)-(n?r.width:0),i.y=t.position.y%(a?r.height:h)-t.hot_spot.y-(e.y-135.5)-(a?r.height:0);for(var o=n?ut/r.width+3:1,c=a?lt/r.height+3:1,s=0;s<o;s++)for(var u=0;u<c;u++)Et().drawImage(r.data,r.sx,r.sy,r.swidth,r.sheight,~~(i.x+s*r.width),~~(i.y+u*r.height),1*r.width,1*r.height)}},zn=function(t,e){e||(e={x:0,y:0}),e.x=e.x||0,e.y=e.y||0,Math.abs(e.x)<p&&(e.x=0),t.position.x+=e.x*Math.cos(t.angle)+e.y*Math.sin(t.angle),t.position.y+=e.y*Math.cos(t.angle)-e.x*Math.sin(t.angle)},$n=function(t){return hn(t.animation,~~t.animation_frame)},Qn=function(t,e){return t.animation_frame=q(e,0,t.animation.frame_count),t},Vn=function(t,e){return!(!t||!e)&&(t.animation!=e&&(t.animation=e,t.hot_spot=e.hot_spot,t.animation_frame=0,t.animation_speed_factor=1),t)},Kn=function(t){var e=t.animation_frame+t.animation.fps*t.animation_speed_factor*X();return!t.animation.repeat&&e>t.animation.frame_count-1},qn=function(t,e){var n=0,a=[];if(a[0]=[nt(0,0),nt(0,0),nt(0,0),nt(0,0)],a[1]=[nt(0,0),nt(0,0),nt(0,0),nt(0,0)],a[0][0]=it(t.position,ct(t.hot_spot,-t.angle)),a[0][1]=at(a[0][0],ct(nt($n(t).width,0),-t.angle)),a[0][2]=at(a[0][0],ct(nt($n(t).width,$n(t).height),-t.angle)),a[0][3]=at(a[0][0],ct(nt(0,$n(t).height),-t.angle)),a[1][0]=it(e.position,ct(e.hot_spot,0)),a[1][1]=at(a[1][0],ct(nt($n(e).width,0),0)),a[1][2]=at(a[1][0],ct(nt($n(e).width,$n(e).height),0)),a[1][3]=at(a[1][0],ct(nt(0,$n(e).height),0)),(Math.abs(t.angle)<p||Math.abs(t.angle-m/2)<p||Math.abs(t.angle-m)<p||Math.abs(t.angle-3*m/2)<p)&&n++,(Math.abs(e.angle)<p||Math.abs(e.angle-m/2)<p||Math.abs(e.angle-m)<p||Math.abs(e.angle-3*m/2)<p)&&n++,n){for(var i=[],r=[],o=0;o<2;o++){i[o]=[];var c=Math.min(a[o][0].x,a[o][1].x),s=Math.min(a[o][0].y,a[o][1].y),u=Math.max(a[o][2].x,a[o][3].x),l=Math.max(a[o][2].y,a[o][3].y);i[o][0]=c,i[o][1]=s,i[o][2]=u,i[o][3]=l,c>u&&(r=Z(i[o][0],i[o][2]),i[o][0]=r[0],i[o][2]=r[1]),s>l&&(r=Z(i[o][1],i[o][3]),i[o][1]=r[0],i[o][3]=r[1])}return J(i[0],i[1])}var d=[],f=[Math.max($n(t).width,$n(t).height),Math.max($n(e).width,$n(e).height)];for(o=0;o<2;o++)d[o]=rt(at(a[o][0],a[o][2]),.5);return function(t,e,n,a){return ot(it(t,n))<=e+a}(d[0],f[0],d[1],f[1])},Jn=function(t,e){return Math.abs(t.angle)<p&&Math.abs(e.angle)<p?!!qn(t,e)&&(t.position.x-t.hot_spot.x,t.position.y-t.hot_spot.y,e.position.x-e.hot_spot.x,e.position.y-e.hot_spot.y,$n(t).data,$n(e).data,!0):!!function(t,e){var n=nt(0,0),a=nt(0,0),i=nt(0,0),r=nt(0,0),o=[],c=[];return o=oa(Cn,t,o),c=oa(Cn,e,c),n.x=Math.min(o[0].x,Math.min(o[1].x,Math.min(o[2].x,o[3].x))),n.y=Math.min(o[0].y,Math.min(o[1].y,Math.min(o[2].y,o[3].y))),a.x=Math.min(c[0].x,Math.min(c[1].x,Math.min(c[2].x,c[3].x))),a.y=Math.min(c[0].y,Math.min(c[1].y,Math.min(c[2].y,c[3].y))),i.x=Math.max(o[0].x,Math.max(o[1].x,Math.max(o[2].x,o[3].x)))-n.x,i.y=Math.max(o[0].y,Math.max(o[1].y,Math.max(o[2].y,o[3].y)))-n.y,r.x=Math.max(c[0].x,Math.max(c[1].x,Math.max(c[2].x,c[3].x)))-a.x,r.y=Math.max(c[0].y,Math.max(c[1].y,Math.max(c[2].y,c[3].y)))-a.y,n.x+i.x>=a.x&&n.x<=a.x+r.x&&n.y+i.y>=a.y&&n.y<=a.y+r.y}(t,e)},Zn=function(t,e,n,a,i,r,o,c,s,u,l,d){var p=$n(t).width,f=$n(t).height,_=t.position,h=at(_,ct(nt(0,-f+n),-t.angle)),m=at(_,ct(nt(0,-n),-t.angle)),g=at(_,ct(nt(-p/2+n,.5*-f),-t.angle)),v=at(_,ct(nt(p/2-n,.5*-f),-t.angle)),b=at(_,ct(nt(-p/2+n,-f+n),-t.angle)),y=at(_,ct(nt(p/2-n,-f+n),-t.angle)),x=at(_,ct(nt(-p/2+n,-n),-t.angle)),w=at(_,ct(nt(p/2-n,-n),-t.angle));return ta(t,e,h,y,v,w,m,x,g,b,a,i,r,o,c,s,u,l,d)},ta=function(t,e,n,a,i,r,o,c,s,u,l,d,p,f,_,h,m,g,v){var b=[n.x-e,n.y-e,n.x+e,n.y+e],y=[o.x-e,o.y-e,o.x+e,o.y+e],x=[s.x-e,s.y-e,s.x+e,s.y+e],w=[i.x-e,i.y-e,i.x+e,i.y+e],k=[u.x-e,u.y-e,u.x+e,u.y+e],E=[a.x-e,a.y-e,a.x+e,a.y+e],S=[c.x-e,c.y-e,c.x+e,c.y+e],M=[r.x-e,r.y-e,r.x+e,r.y+e];return l&&(n&&(d=ra(l,b)),o&&(h=ra(l,y)),s&&(g=ra(l,x)),i&&(f=ra(l,w)),u&&(v=ra(l,k)),a&&(p=ra(l,E)),c&&(m=ra(l,S)),r&&(_=ra(l,M))),{up:d,down:h,left:g,right:f,upleft:v,upright:p,downleft:m,downright:_}},ea=function(t){Gn=t},na=function(t,e,n,a,i,r,o,c,s,u){var l,d=[n,a,i,s,u];for(l=0;l<d.length;l++){var p=d[l];p&&p.brick_ref&&2==p.brick_ref.property&&(p=null,d[l]=p)}if(o&&o.brick_ref&&2==o.brick_ref.property){var f=Math.min(15,o.brick_ref.image.height/3);t.speed.y>=0&&t.position.y<o.y+e+1+f||(c&&c==o&&(c=null),r&&r==o&&(r=null),o=null)}return{up:d[0],upright:d[1],right:d[2],left:d[3],upleft:d[4],downright:r,down:o,downleft:c}},aa=function(t,e,n){var a,i,r,o,c,s,u,l,d,f,_,h=nt(0,0),g=X(),v=t.position,b=function(t,e,n,a,i,r,o,c,s,u){var l,d,f,_=$n(t).width,h=$n(t).height,g=!(Math.abs(t.angle)<p||Math.abs(t.angle-m/2)<p||Math.abs(t.angle-m)<p||Math.abs(t.angle-3*m/2)<p),v=t.position;return g?(l=1,d=.7,f=.25):(l=.7,d=.5,f=.25),{up:at(v,ct(nt(0,-h*l+e),-t.angle)),down:at(v,ct(nt(0,2),-t.angle)),left:at(v,ct(nt(-_*f+e,-h*d),-t.angle)),right:at(v,ct(nt(_*f-e,-h*d),-t.angle)),upleft:at(v,ct(nt(-_*f+e,-h*l+e),-t.angle)),upright:at(v,ct(nt(_*f-e,-h*l+e),-t.angle)),downleft:at(v,ct(nt(-_*f+e,2),-t.angle)),downright:at(v,ct(nt(_*f-e,2),-t.angle))}}(t,-2);b=function(t,e,n,a,i,r,o,c,s,u,l,d,p,f,_,h,m,g){return ta(t,2,n,a,i,r,o,c,s,u,e,l,d,p,f,_,h,m,g)}(t,e,a=b.up,b.upright,i=b.right,b.downright,b.down,b.downleft,r=b.left,b.upleft,o,c,s,u,l,d,f,_),o=b.up,c=b.upright,s=b.right,u=b.downright,l=b.down,d=b.downleft,f=b.left,_=b.upleft;var y=na(t,-2,o,c,s,u,l,d,f,_);return o=y.up,c=y.upright,s=y.right,f=y.left,_=y.upleft,l=y.down,d=y.downleft,u=y.downright,function(t,e){var n=X();if(null!=t.carried_by){var a=t.carried_by;e&&0==e.brick_ref.angle&&a.speed.y>=5?(t.position=nt(t.carried_by.position.x,t.carried_by.position.y),t.carried_by.carrying=null,t.carried_by=null):(t.speed=nt(0,0),t.mirror=a.mirror,t.angle=0,t.position=it(at(a.position,rt(a.speed,n)),t.carry_offset))}}(t,l),null!=t.carried_by?nt(0,0):(function(t,e,n,a,i,r){r&&r.brick_ref.angle%90==0&&(t.speed.x>p||a.x>r.x)&&(t.speed.x=0,t.position.x=r.x+(e.x-a.x)),i&&i.brick_ref.angle%90==0&&(t.speed.x<-1e-5||n.x<i.x+i.brick_ref.image.width)&&(t.speed.x=0,t.position.x=i.x+i.brick_ref.image.width+(e.x-n.x))}(t,v,r,i,f,s),l?(t.is_jumping=!1,t.ignore_horizontal=!1,function(t,e,n,a,i){var r=a.brick_ref.angle;!Se(t.input,Yt)||Se(t.input,Pt)||i||(t.angle=0,t.is_jumping=!0,0==r?t.speed.y=-t.jump_strength:r>0&&r<90?(t.speed.x=Math.min(t.speed.x,-.7*t.jump_strength),t.speed.y=-.7*t.jump_strength):90==r?(zn(t,nt(-40,0)),t.speed.x=Math.min(t.speed.x,-t.jump_strength),t.speed.y=-t.jump_strength/2):r>90&&r<180?(zn(t,nt(0,40)),t.speed.x=Math.min(t.speed.x,-.7*t.jump_strength),t.speed.y=t.jump_strength):180==r?(zn(t,nt(0,40)),t.speed.x*=-1,t.speed.y=t.jump_strength):r>180&&r<270?(zn(t,nt(0,40)),t.speed.x=Math.max(t.speed.x,.7*t.jump_strength),t.speed.y=t.jump_strength):270==r?(zn(t,nt(40,0)),t.speed.x=Math.max(t.speed.x,t.jump_strength),t.speed.y=-t.jump_strength/2):r>270&&r<360&&(t.speed.x=Math.max(t.speed.x,.7*t.jump_strength),t.speed.y=-.7*t.jump_strength))}(t,0,0,l,o)):t.angle=0,h.y=Math.abs(t.speed.y)>p?t.speed.y*g+1*n*.5*(g*g):0,t.speed.y=Math.min(t.speed.y+1*n*g,480),function(t,e,n,a){a&&a.brick_ref.angle%90==0&&t.speed.y<-1e-5&&(t.position.y=a.y+a.brick_ref.image.height+(e.y-n.y),t.speed.y=10)}(t,v,a,o),function(t,e,n,a,i,r,o,c,s){var u;if(X(),c&&!t.is_jumping)if(u=c.brick_ref.angle,t.speed.y=a.y=0,t.angle=u*m/180,0==u)t.position.y=i.y+e;else if(u>0&&u<90)i.y=c.y+c.brick_ref.image.height-(t.position.x-c.x)*Math.tan(t.angle),t.position.y=i.y+e,t.mirror;else if(90==u){if(Math.abs(t.speed.x)>5){var l=s?s.brick_ref.angle:-1;s&&l>=u&&l<u+90?(i.y=c.x,t.position.x=i.y+e):(t.angle=0,zn(t,nt(-13,0)),t.is_jumping=!0,t.speed=nt(0,-.7*Math.abs(t.speed.x)))}else t.angle=0,zn(t,nt(-10,0)),t.is_jumping=!0,t.ignore_horizontal=!1;t.mirror}else u>90&&u<180?Math.abs(t.speed.x)>5?(i.y=c.y-(t.position.x-c.x)*Math.tan(t.angle),t.position.y=i.y-e):(t.angle=0,zn(t,nt(0,30)),t.is_jumping=!0):180==u?t.speed.x>5&&!(1&t.mirror)||t.speed.x<-5&&1&t.mirror?(i.y=c.y+c.brick_ref.image.height,t.position.y=i.y-e):(t.angle=0,zn(t,nt(0,40)),t.is_jumping=!0,t.speed.x=0):u>180&&u<270?Math.abs(t.speed.x)>5?(i.y=c.y+c.brick_ref.image.height-(t.position.x-c.x)*Math.tan(t.angle),t.position.y=i.y-e):(t.angle=0,zn(t,nt(0,30)),t.is_jumping=!0):270==u?(Math.abs(t.speed.x)>5?(l=o?o.brick_ref.angle:-1,o&&l>u-90&&l<=u?(i.y=c.x+c.brick_ref.image.width,t.position.x=i.y-e):(t.angle=0,zn(t,nt(13,0)),t.is_jumping=!0,t.speed=nt(0,-.7*Math.abs(t.speed.x)))):(t.angle=0,zn(t,nt(10,0)),t.is_jumping=!0,t.ignore_horizontal=!1),t.mirror):u>270&&u<360&&(i.y=c.y-(t.position.x-c.x)*Math.tan(t.angle),t.position.y=i.y+e,t.mirror)}(t,-2,0,h,v,0,d,l,u),h.x=Math.abs(t.speed.x)>p?t.speed.x*g+1*t.acceleration*.5*(g*g):0,function(t,e,n){var a=X();if(Se(t.input,Ut)&&!Se(t.input,Bt))t.ignore_horizontal||Se(t.input,Pt)||(t.speed.x=Math.max(t.speed.x-1*t.acceleration*a,-t.maxspeed),t.mirror=1);else if(Se(t.input,Bt)&&!Se(t.input,Ut))t.ignore_horizontal||Se(t.input,Pt)||(t.speed.x=Math.min(t.speed.x+1*t.acceleration*a,t.maxspeed),t.mirror=0);else if(n){var i=0,r=n.brick_ref.angle;r%90==0?i=90==r&&1&t.mirror&&t.speed.x<0||270==r&&!(1&t.mirror)&&t.speed.x>0?t.speed.x>p?1:-t.speed.x>p?-1:0:t.speed.x>p?-1:-t.speed.x>p?1:0:(r>90&&r<180||r>180&&r<270)&&(i=t.speed.x>p?-1:-t.speed.x>p?1:0),t.speed.x+=1*i*t.acceleration*a}}(t,0,l),Math.abs(t.speed.x)<p&&(t.speed.x=h.x=0),h)},ia=function(t){var e=X(),n=nt(0,0);return t.input?(Se(t.input,Bt)&&!Se(t.input,Ut)&&(t.speed.x=Math.min(t.speed.x+t.acceleration*e,t.maxspeed)),Se(t.input,Ut)&&!Se(t.input,Bt)&&(t.speed.x=Math.max(t.speed.x-t.acceleration*e,-t.maxspeed)),!Se(t.input,Ut)&&!Se(t.input,Bt)&&Math.abs(t.speed.x)>p&&(t.speed.x>0?t.speed.x=Math.max(t.speed.x-t.acceleration*e,0):t.speed.x=Math.min(t.speed.x+t.acceleration*e,0)),Se(t.input,Pt)&&!Se(t.input,Gt)&&(t.speed.y=Math.min(t.speed.y+t.acceleration*e,t.maxspeed)),Se(t.input,Gt)&&!Se(t.input,Pt)&&(t.speed.y=Math.max(t.speed.y-t.acceleration*e,-t.maxspeed)),!Se(t.input,Gt)&&!Se(t.input,Pt)&&Math.abs(t.speed.y)>p&&(t.speed.y>0?t.speed.y=Math.max(t.speed.y-t.acceleration*e,0):t.speed.y=Math.min(t.speed.y+t.acceleration*e,0))):t.speed=nt(0,0),n.x=Math.abs(t.speed.x)>p?t.speed.x*e+.5*t.acceleration*e*e:0,n.y=0,t.speed.x=n.x,t.speed.y=n.y,n},ra=function(t,e){var n,a,i,r,o,c,s,u=null,l=!1;for(n=t;n&&!l;n=n.next)if(n.data){if(0==n.data.brick_ref.property||!n.data.enabled)continue;if(2==n.data.brick_ref.property&&u&&1==u.brick_ref.property)continue;if(1==n.data.brick_ref.behavior&&u&&1!=u.brick_ref.behavior&&n.data.y>=u.y)continue;if(Bn&&0==n.data.brick_ref.angle)continue;if(Yn&&180==n.data.brick_ref.angle)continue;if(Un&&n.data.brick_ref.angle>0&&n.data.brick_ref.angle<180)continue;if(Pn&&n.data.brick_ref.angle>180&&n.data.brick_ref.angle<360)continue;var d=[n.data.x,n.data.y,n.data.x+n.data.brick_ref.image.width,n.data.y+n.data.brick_ref.image.height];if(J(e,d))if(1!=n.data.brick_ref.behavior&&u&&1==u.brick_ref.behavior&&n.data.y<=u.y)u=n.data;else if(1==n.data.brick_ref.property&&u&&2==u.brick_ref.property)u=n.data;else if(2==n.data.brick_ref.property&&u&&2==u.brick_ref.property)n.data.y>u.y&&(u=n.data);else if(n.data.brick_ref.angle%90==0)u?Gn?u.brick_ref.angle%180!=0&&(u=n.data):u.brick_ref.angle%180==0&&(u=n.data):u=n.data;else for(a=n.data.brick_ref.angle,c=Math.tan(a*m/180),r=e[0];r<=e[2]&&!l;r++)for(o=e[1];o<=e[3]&&!l;o++){switch(i=!1,~~(a/90)%4){case 0:s=d[3]+c*(d[0]-r),i=d[0]<=r&&r<=d[2]&&s<=o&&o<=d[3];break;case 1:s=d[3]-c*(d[2]-r),i=d[0]<=r&&r<=d[2]&&d[1]<=o&&o<=s;break;case 2:s=d[3]-c*(d[0]-r),i=d[0]<=r&&r<=d[2]&&d[1]<=o&&o<=s;break;case 3:s=d[3]+c*(d[2]-r),i=d[0]<=r&&r<=d[2]&&s<=o&&o<=d[3]}i&&(u=n.data,l=!0)}}return u},oa=function(t,e,n){var a,i,r,o,c,s,u,l,d;return r=-e.angle,a=$n(e).width,i=$n(e).height,l=e.hot_spot,d=e.position,o=it(nt(0,0),l),c=it(nt(a,0),l),s=it(nt(a,i),l),u=it(nt(0,i),l),n[0]=at(d,ct(o,r)),n[1]=at(d,ct(c,r)),n[2]=at(d,ct(s,r)),n[3]=at(d,ct(u,r)),n},ca=function(t,e){return t.translate(e,0),t.scale(-1,1),t.translate(-e,0),t},sa=[],ua={},la={},da=function(t){for(var e={type:q(t,0,9),text:null,width:0,visible:!0,hspace:1,vspace:1,value:[],position:nt(0,0)},n=0;n<5;n++)e.value[n]=0;return e},pa=function(t){t.text&&(t.text=null)},fa=function(t,e){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];if(!t)return!1;for(var i=0;i<n.length;i++)n[i]=""+n[i];var r=(e=""+e).match(/\$[A-Z_\d]\w+/g);if(r)for(i=0;i<r.length;i++){var o=r[i].slice(1),c=Ye(o);c&&(e=e.replace("$"+o,c))}if(r=e.match(/\%[s]+/g))for(i=0;i<r.length;i++)n[i]&&((o=n[i].match(/\$[A-Z_\d]\w+/g))&&(n[i]=o[0].slice(1)),e=e.replace("%s",Ye(n[i])));if(r=e.match(/\%[d]+/g))for(i=0;i<r.length;i++)n[i]&&(e=e.replace("%d",""+n[i]));return t.text=""+e,t},_a=function(t){return t.text?t.text:""},ha=function(t){return va(t)},ma=function(t,e){t.width=Math.max(0,e)},ga=function(t,e){var n,a,i,r,o,c=0,s=0,u=[],l=0,d=0;u[d++]={disabled:!0,r:0,g:0,b:0};var p=va(t);if(n=p.x,a=p.y,t&&t.visible&&t.text)for(l=0;l<t.text.length;l++){if(i=t.text[l],o=!1,Q(t.text[l-1])){var f=void 0,_=!1,h=0,m=t.text.slice(l),g=(m=(m=m.replace("(","")).replace(")","")).split(" ")[0];for(f=0;f<g.length;f++)"<"==g[f]&&(_=!0),_||h++,">"==g[f]&&(_=!1);o=t.width>0&&c+(n+t.hspace)*h-t.hspace>t.width}if("<"==i){if("<color="==(_=t.text.slice(l,l+7))){l+=7;var v=t.text.slice(l,l+6),b={disabled:!1,r:ya(v.slice(0,2)),g:ya(v.slice(2,4)),b:ya(v.slice(4,6))};u[d++]=b,l+=7,i=t.text[l]}"</color"==_&&(l+=8,i=t.text[l],d>=2&&d--)}o&&(c=0,s+=a+t.vspace),"\n"!=i?(r=sa[t.type].ch[i])?(c+=r.width,Q(t.text[l-1]),ba(i,Et(),r,~~t.position.x+c-(e.x-240),~~t.position.y+s-(e.y-135.5),u[d-1])):c+=n+t.hspace:(c=0,s+=a+t.vspace)}},va=function(t){var e,n;if(t)for(e=0;e<256;e++)if(sa[t.type]&&null!=(n=sa[t.type].ch[e]))return nt(n.width,n.height);return nt(16,16)},ba=function(t,e,n,a,i,r){var o,c;r&&!r.disabled?(o=xa(n.data),c=wa(t,n.data,o,r.r,r.g,r.b)):c=n.data,e.drawImage(c,n.sx,n.sy,n.swidth,n.sheight,a,i-2,1*n.width,1*n.height)},ya=function(t){var e=/^#?([a-f\d]{2})$/i.exec(t);return e?parseInt(e[1],16):null},xa=function(t){if(ua[t.src])return ua[t.src];var e=t.width,n=t.height,a=[],i=document.createElement("canvas");i.width=e,i.height=n;var r=i.getContext("2d");r.drawImage(t,0,0);for(var o=r.getImageData(0,0,e,n).data,c=0;c<4;c++){var s=document.createElement("canvas");s.width=e,s.height=n;var u=s.getContext("2d");u.drawImage(t,0,0);for(var l=u.getImageData(0,0,e,n),d=l.data,p=0,f=o.length;p<f;p+=4)d[p]=0===c?o[p]:0,d[p+1]=1===c?o[p+1]:0,d[p+2]=2===c?o[p+2]:0,d[p+3]=o[p+3];u.putImageData(l,0,0);var _=new Image;_.src=s.toDataURL(),a.push(_)}return ua[t.src]=a,a},wa=function(t,e,n,a,i,r){var o=t+"_"+a+"_"+i+"_"+r+"_"+e.src,c=la[o];if(c)return c;var s=document.createElement("canvas");s.width=e.width,s.height=e.height;var u=s.getContext("2d");u.globalAlpha=1,u.globalCompositeOperation="copy",u.drawImage(n[3],0,0),u.globalCompositeOperation="lighter",a>0&&(u.globalAlpha=a/255,u.drawImage(n[0],0,0)),i>0&&(u.globalAlpha=i/255,u.drawImage(n[1],0,0)),r>0&&(u.globalAlpha=r/255,u.drawImage(n[2],0,0));var l=u.getImageData(0,0,s.width,s.height);u.putImageData(l,0,0);var d=new Image;return d.src=s.toDataURL(),ka(s)||(la[o]=d),d},ka=function(t){for(var e=t.getContext("2d").getImageData(0,0,t.width,t.height),n=0;n<e.data.length;n+=4)if(0!==e.data[n+3])return!1;return!0},Ea=[],Sa=[],Ma=0,Ta=-1,ja=!1,Ia=!1,Da=function(){(Qt=new Image).src=Et().canvas.toDataURL(),nn(Qt,Et(),0,0,0,0,Et().canvas.width,Et().canvas.height),$t=hn(_n("SD_CONFIRMBOX",0),0),Vt=nt((ut-$t.width)/2,lt),Zt=ke(),qt=Hn(),Vn(qt,_n("SD_TITLEFOOT",0)),Kt=da(8),fa(Kt,Jt),ma(Kt,164);for(var t=0;t<Ma;t++)Ea[t]=[],Ea[t][0]=da(8),Ea[t][1]=da(8),fa(Ea[t][0],Sa[t]),fa(Ea[t][1],"<color=ffff00>%s</color>",Sa[t]);Ta=0,ja=!0,Ia=!1},Oa=function(){var t,e=X();if(ja&&(Vt.y<=(lt-$t.height)/2?ja=!1:Vt.y-=1355*e),Ia){if(Vt.y>=lt)return Ia=!1,void Xe();Vt.y+=1355*e}for(qt.position=nt(Vt.x+Ta*$t.width/Ma+10,Vt.y+.75*$t.height-1),Kt.position=nt(Vt.x+10,Vt.y+10),t=0;t<Ma;t++)Ea[t][0].position=nt(Vt.x+t*$t.width/Ma+25,Vt.y+.75*$t.height),Ea[t][1].position=Ea[t][0].position;ja||Ia||(Me(Zt,Ut)?(A(Qe("choose")),Ta=((Ta-1)%Ma+Ma)%Ma):Me(Zt,Bt)?(A(Qe("choose")),Ta=(Ta+1)%Ma):(Me(Zt,Yt)||Me(Zt,Wt))&&(A(Qe("select")),Ia=!0))},Ra=function(){var t,e,n=nt(240,135.5);for(xt(),nn(Qt,Et(),0,0,0,0,Qt.width,Qt.height),Et().drawImage($t.data,$t.sx,$t.sy,$t.swidth,$t.sheight,Vt.x,Vt.y,$t.swidth,$t.sheight),ga(Kt,n),t=0;t<Ma;t++)e=t==Ta?1:0,ga(Ea[t][e],n);Fn(qt,n)},Aa=function(){Wn(qt),Ee(Zt),pa(Kt)},La=function(){if(-1!=Ta){var t=Ta+1;return Ta=-1,t}return 0},Na=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},Ca=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Ga=function(t){return Na(void 0,void 0,void 0,(function(){var e,n;return Ca(this,(function(a){switch(a.label){case 0:return k('background_load("'.concat(t,'")')),[4,x(t)];case 1:return e=a.sent(),[4,Qa(e)];case 2:return[2,{data:n=a.sent(),length:n.length}]}}))}))},Pa=function(t){k("background_unload()");for(var e=0;e<t.length;e++)t.data[e]=Wa(t.data[e]);return null},Ua=function(t){if(!t)return!1;for(var e=0;e<t.length;e++){var n=t.data[e];n.strategy&&n.strategy.update&&n.strategy.update(n.strategy)}},Ba=function(t,e){Ha(t,e,!1)},Ya=function(t,e){Ha(t,e,!0)},Ha=function(t,e,n){if(t){var a,i,r=nt(240,135.5),o=it(e,r);for(a=0;a<t.length;a++)i=t.data[a],(!n&&i.zindex<=.5||n&&i.zindex>.5)&&(i.actor.position.x+=o.x*i.actor.speed.x,i.actor.position.y+=o.y*i.actor.speed.y,Xn(i.actor,r,i.repeat_x,i.repeat_y),i.actor.position.y-=o.y*i.actor.speed.y,i.actor.position.x-=o.x*i.actor.speed.x)}},Wa=function(t){return t.strategy=Fa(t.strategy),function(t){var e,n;if(null!=t.source_file&&(t.source_file=null),null!=t.frame_data&&(t.frame_data=null),null!=t.animation_data){for(e=0;e<t.animation_count;e++)t.animation_data[e]=(null!=(n=t.animation_data[e])&&(null!=n.data&&(n.data=null),n=null),null);t.animation_data=null}t=null}(t.data),Wn(t.actor),t=null,null},Fa=function(t){return null},Xa=function(t){},za=function(t){var e=t,n=t.background,a=X();n.actor.position.x+=e.speed_x*a,n.actor.position.y+=e.speed_y*a},$a=function(t){var e,n,a,i=t,r=t.background,o=X();e=i.timer+=o,n=Math.sin(i.angularspeed_x*e+i.initialphase_x),a=Math.cos(i.angularspeed_y*e+i.initialphase_y),r.actor.position.x+=-i.angularspeed_x*i.amplitude_x*n*o,r.actor.position.y+=i.angularspeed_y*i.amplitude_y*a*o},Qa=function(t){return Na(void 0,void 0,void 0,(function(){return Ca(this,(function(e){return[2,Promise.all(t.bg.map(Va))]}))}))},Va=function(t){return Na(void 0,void 0,void 0,(function(){var e,n,a;return Ca(this,(function(i){switch(i.label){case 0:switch((e={actor:Hn(),data:null,strategy:null,repeat_x:!1,repeat_y:!1,zindex:0}).actor.spawn_point.x=t.initial_position.xpos,e.actor.spawn_point.y=t.initial_position.ypos,e.actor.position=nt(e.actor.spawn_point.x,e.actor.spawn_point.y),e.actor.speed.x=t.scroll_speed.xspeed,e.actor.speed.y=t.scroll_speed.yspeed,t.behavior&&V(t.behavior)?t.behavior[0]:t.behavior){case"DEFAULT":e.strategy&&(e.strategy=Fa(e.strategy)),e.strategy=function(t){return{background:t,update:Xa}}(e);break;case"LINEAR":e.strategy&&(e.strategy=Fa(e.strategy)),e.strategy=function(t,e,n){var a={background:t,update:za},i=a;return i.speed_x=e,i.speed_y=n,a}(e,t.behavior[1],t.behavior[2]);break;case"CIRCULAR":e.strategy&&(e.strategy=Fa(e.strategy)),e.strategy=function(t,e,n,a,i,r,o){var c={background:t,update:$a},s=c;return s.timer=0,s.amplitude_x=e,s.amplitude_y=n,s.angularspeed_x=2*m*a,s.angularspeed_y=2*m*i,s.initialphase_x=r*m/180,s.initialphase_y=o*m/180,c}(e,t.behavior[1],t.behavior[2],t.behavior[3],t.behavior[4],t.behavior[5],t.behavior[6])}return e.repeat_x=t.repeat_x,e.repeat_y=t.repeat_y,t.zindex&&(e.zindex=t.zindex),[4,mn(t.sprite)];case 1:return n=i.sent(),a=n,e.data=a,e.actor.animation=a,e.actor.animation.data=[0],[2,e]}}))}))},Ka=["<color=ffff00>$CREDITS_ENGINE</color>\n\n","<color=ffff00>$CREDITS_ACTIVE</color>\n\n","Alexandre Martins:\n$CREDITS_ALEXANDRE\n\n","Di Rodrigues:\n$CREDITS_DI\n\n","Colin:\n$CREDITS_COLIN\n\n","Mateus Reis:\n$CREDITS_MATEUSREIS\n\n","Christopher Martinus:\n$CREDITS_CHRISTOPHER\n\n","Celdecea:\n$CREDITS_CELDECEA\n\n","Christian Zigotzky:\n$CREDITS_XENO\n\n","Joepotato28:\n$CREDITS_JOE\n\n","Arthur Blot:\n$CREDITS_ARTHURBLOT\n\n","Reimund Renner:\n$CREDITS_REIMUND\n\n","Szymon Weihs:\n$CREDITS_SZYMON\n\n","Tomires:\n$CREDITS_TOMIRES\n\n","Sascha de waal:\n$CREDITS_SSDW\n\n","Francesco Sciusco:\n$CREDITS_FRANCESCO\n\n","<color=ffff00>$CREDITS_THANKS</color>\n\n","SourceForge.net\n","allegro.cc\n","OpenGameArt.org\n","GagaGames.com.br\n","Rsonist88\n","PlayDeb.net\n\n","<color=ffff00>$CREDITS_RETIRED</color>\n\n","Neoblast:\n$CREDITS_NEOBLAST\n\n","Bastian von Halem:\n$CREDITS_BASTIAN\n\n","Lainz:\n$CREDITS_LAINZ\n\n","Jogait:\n$CREDITS_JOGAIT\n\n"],qa=!1,Ja=0,Za=function(){return t=void 0,e=void 0,a=function(){var t,e,n,a,i,r,o,c;return function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(s){switch(s.label){case 0:for(qa=!1,ie=ke(),ee=da(4),fa(ee,Ye("CREDITS_TITLE")),ee.position.x=140,ee.position.y=5,ae=da(8),fa(ae,Ye("CREDITS_KEY")),ae.position.x=10,ae.position.y=lt-ha(ae).y-5,ne=da(8),o=0;o<Ka.length;o++)if(t=Ka[o],e=t.match(/\$[A-Z_\d]\w+/m)){for(n=0;n<e.length;n++)a=e[n].slice(1),(i=Ye(a))&&(t=t.replace("$"+a,i));Ka[o]=t}for(fa(ne,Ka.join(""),"%s"),ma(ne,300),ne.position.x=10,ne.position.y=lt,Ja=1,r=_a(ne),o=0;o<r.length;o++)"\n"==r[o]&&Ja++;return Ja+=10,te=tn(ut,30),[4,Ga("data/themes/credits.bg.json")];case 1:return c=s.sent(),re=c,gt(rn(0,0,0),1),[2]}}))},new((n=void 0)||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}));var t,e,n,a},ti=function(){var t,e=X();if(Ua(re),ne.position.y-=3*ha(ne).y*e,ne.position.y<-Ja*(ha(ne).y+(t=ne,nt(t.hspace,t.vspace)).y)&&(ne.position.y=lt),qa||yt()||(Me(ie,Wt)?(A(Qe("select")),qa=!0):Me(ie,Ft)&&(A(Qe("return")),qa=!0)),!O()){var n=M("data/music/options.mp4");T(n,!0)}if(qa){if(bt())return void Xe();vt(rn(0,0,0),1)}},ei=function(){xt();var t=nt(240,135.5);Ba(re,t),Ya(re,t),ga(ne,t),Et().fillRect(0,0,te.width,te.height),Et().fillRect(0,251,te.width,te.height),ga(ee,t),ga(ae,t)},ni=function(){re=Pa(re),cn(te),pa(ee),pa(ne),pa(ae),Ee(ie)},ai=10,ii=0,ri=null,oi=null,ci=[],si=function(){var t;for(ii=z(),(ri=da(8)).position=nt(5,35),oi=da(4),fa(oi,Ye("ENDOFDEMO_TITLE")),oi.position=nt((ut-ha(oi).x*_a(oi).length)/2,5),t=0;t<ai;t++)ci[t]=Hn(),ci[t].spawn_point=ci[t].position=nt(ut*t/ai+15,215),Vn(ci[t],_n(t%2==1?"SD_BLUERING":"SD_RING",0));gt(rn(0,0,0),2)},ui=function(){var t,e=z(),n=Math.max(0,(3-(e-ii))/1e3);if(fa(ri,Ye("ENDOFDEMO_TEXT"),l,d,n),e>=ii+3){if(bt())return Xe(),void Fe(By(Ay));vt(rn(0,0,0),2)}for(t=0;t<ai;t++)ci[t].position.y=ci[t].spawn_point.y+10*Math.sin(m*(.001*e)+2*m/ai*t)},li=function(){var t,e=nt(240,135.5);for(xt(),t=0;t<ai;t++)Fn(ci[t],e);ga(oi,e),ga(ri,e)},di=function(){var t;for(t=0;t<ai;t++)Wn(ci[t]);pa(oi),pa(ri)},pi={is_locked:!1,position:nt(0,0),dest:nt(0,0),speed:0,region_topleft:nt(0,0),region_bottomright:nt(0,0),dest_region_topleft:nt(0,0),dest_region_bottomright:nt(0,0),region_topleft_speed:0,region_bottomright_speed:0},fi=function(t,e){t.x<pi.region_topleft.x&&(t.x=pi.region_topleft.x),t.y<pi.region_topleft.y&&(t.y=pi.region_topleft.y),t.x>pi.region_bottomright.x&&(t.x=pi.region_bottomright.x),t.y>pi.region_bottomright.y&&(t.y=pi.region_bottomright.y),pi.dest=t,e>p?pi.speed=ot(it(pi.position,pi.dest))/e:pi.position=pi.dest,pi.position.x=t.x,pi.position.y=t.y},_i=function(){return nt(pi.position.x,pi.position.y)},hi=function(t){pi.dest=pi.position=t},mi=function(t,e,n,a){pi.dest_region_topleft.x=Math.max(Math.min(t,n),240),pi.dest_region_topleft.y=Math.max(Math.min(e,a),135.5),pi.dest_region_bottomright.x=Math.min(Math.max(t,n),Ph().x-240),pi.dest_region_bottomright.y=Math.min(Math.max(e,a),Ph().y-135.5),pi.region_topleft_speed=ot(it(pi.region_topleft,pi.dest_region_topleft))/.25,pi.region_bottomright_speed=ot(it(pi.region_bottomright,pi.dest_region_bottomright))/.25},gi=function(t){},vi=function(t){},bi=function(t,e,n,a,i,r){},yi=function(t,e){var n=t.get_object_instance(t).actor,a=n.position;n.position=nt(n.position.x,n.position.y),Fn(n,e),n.position=a},xi=function(t){return t.object},wi=function(t){return t.reference_to_current_state},ki=function(t,e){var n=Si(t.state_list,e);return null!=n?t.reference_to_current_state=n.data:k("Object script error: can't find state ".concat(e)),t},Ei=function(t){if(null!=t){var e=t.data;Ei(t.next),e.release(e)}return null},Si=function(t,e){return null!=t?t.name==e?Si(t.next,e):t:null},Mi=function(t){var e=t.decorated_machine;return e.get_object_instance(e)},Ti=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Hn(),t.actor.maxspeed=145+K(21),t.actor.input=xe(),e.is_running=!1,e.animal_id=K(12),Vn(t.actor,_n("SD_ANIMAL",0))},ji=function(t){Wn(t.actor)},Ii=function(t,e,n,a,i,r){var o,c,s,u,l=t,d=t.actor,f=2*l.animal_id+(l.is_running?1:0);je(d.input,Yt),d.jump_strength=1.3*(200+K(50)),d.speed.x>p?(d.speed.x=d.maxspeed,d.mirror=0):d.speed.x<-1e-5&&(d.speed.x=-d.maxspeed,d.mirror=1),Vn(d,_n("SD_ANIMAL",f));var _=Zn(d,2,-2,a,o,null,u,null,c,null,s,null);o=_.up,_.upright,u=_.right,_.downright,c=_.down,_.downleft,s=_.left,_.upleft;var h=na(d,-2,o,null,u,null,c,null,s,null);o=h.up,h.upright,u=h.right,h.downright,c=h.down,h.downleft,s=h.left,h.upleft,c&&!l.is_running&&(l.is_running=!0,d.speed.x=(K(2)?-1:1)*d.maxspeed),s&&!o&&(d.speed.x=d.maxspeed),u&&!o&&(d.speed.x=-d.maxspeed),!l.is_running&&(c&&o||s&&u)&&(t.state=Rc),zn(d,aa(d,a,Vh()))},Di=function(t,e){Fn(t.actor,e)},Oi=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Hn(),Ni(t,Ci()),Vn(t.actor,_n("SD_ENDLEVEL",0))},Ri=function(t){Wn(t.actor),Ni(t,null)},Ai=function(t,e,n,a,i,r){var o=t;o.state.handle(o.state,t,e,n)},Li=function(t,e){Fn(t.actor,e)},Ni=function(t,e){t.state=e},Ci=function(){var t={handle:Gi},e=t;return e.being_hit=!1,e.hit_count=0,t},Gi=function(t,e,n,a){for(var i,r,o=t,c=e.actor,s=0;s<a;s++){var u=n[s];Yi(e,u)&&!o.being_hit&&(o.being_hit=!0,Vn(c,_n("SD_ENDLEVEL",1)),A(Qe("boss hit")),is(u),u.actor.speed.x*=-.5,++o.hit_count>=3&&Ni(e,(i=void 0,r=void 0,r=i={handle:Pi},i.handle=Pi,r.explode_timer=0,r.break_timer=0,i)))}Kn(c)&&o.being_hit&&(Vn(c,_n("SD_ENDLEVEL",0)),o.being_hit=!1)},Pi=function(t,e,n,a){var i=t,r=e.actor,o=X();if(i.explode_timer+=o,i.break_timer+=o,i.explode_timer>=.1){var c=nt(r.position.x-r.hot_spot.x+K($n(r).width),r.position.y-r.hot_spot.y+K($n(r).height/2));qh(Ec,c),A(Qe("explode")),i.explode_timer=0}i.break_timer>=2&&Ni(e,{handle:Ui})},Ui=function(t,e,n,a){for(var i=e.actor,r=0;r<20;r++){var o=nt(i.position.x-i.hot_spot.x+K($n(i).width),i.position.y-i.hot_spot.y+K($n(i).height/2));em(o)}Yh(i),Vn(i,_n("SD_ENDLEVEL",2)),Ni(e,{handle:Bi})},Bi=function(t,e,n,a){},Yi=function(t,e){if(t&&e){var n=[],a=[],i=t.actor,r=e.actor;return n[0]=r.position.x-r.hot_spot.x,n[1]=r.position.y-r.hot_spot.y,n[2]=n[0]+$n(r).width,n[3]=n[1]+$n(r).height,a[0]=i.position.x-i.hot_spot.x+5,a[1]=i.position.y-i.hot_spot.y,a[2]=a[0]+$n(i).width-10,a[3]=a[1]+$n(i).height/2,rs(e)&&J(n,a)&&Jn(i,r)}},Hi=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Hn(),Vn(t.actor,_n("SD_BLUERING",0))},Wi=function(t){Wn(t.actor)},Fi=function(t,e,n,a,i,r){for(var o=0;o<n;o++){var c=e[o];c&&!c.dying&&qn(c.actor,t.actor)&&(t.state=Rc,us(os()+50),Hh(5e3),A(Qe("big ring")),Wh("$BONUSMSG_TITLE","$BONUSMSG_TEXT"),Yg(Dg,Hg(Dg)+1))}},Xi=function(t,e){Fn(t.actor,e)},zi=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Hn(),e.is_disappearing=!1,Vn(t.actor,_n("SD_BLUERING",0))},$i=function(t,e,n,a,i,r){var o=Nh(),c=t,s=t.actor;s.visible=o.got_glasses||Lh(),c.is_disappearing?Kn(s)&&(t.state=Rc):!o.dying&&o.got_glasses&&qn(s,o.actor)&&(Vn(s,_n("SD_BLUERING",1)),us(os()+5),A(Qe("blue ring")),c.is_disappearing=!0)},Qi=function(t,e){Fn(t.actor,e)},Vi=function(t){Wn(t.actor)},Ki=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Hn(),e.getting_hit=!1,Vn(t.actor,_n("SD_BUMPER",0))},qi=function(t,e,n,a,i,r){for(var o=t,c=t.actor,s=0;s<n;s++){var u=e[s];u&&!u.dying&&Jn(u.actor,c)&&(o.getting_hit||(o.getting_hit=!0,Vn(c,_n("SD_BUMPER",1)),A(Qe("bumper")),tr(t,u)))}o.getting_hit&&Kn(c)&&(o.getting_hit=!1,Vn(c,_n("SD_BUMPER",0)))},Ji=function(t,e){Fn(t.actor,e)},Zi=function(t){Wn(t.actor)},tr=function(t,e){var n,a,i,r=t.actor;(n=e.actor.speed).x=n.x<0?Math.min(-300,n.x):Math.max(300,n.x),a=rt(st(it(r.position,e.actor.position)),ot(n)),i=rt(a,1),e.actor.speed=rt(at(n,rt(i,-1e4)),1/10001),r.speed=rt(at(n,i),1/10001),e.flying=!1,e.landing=!1,e.climbing=!1,e.spring=!1},er=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Hn(),e.is_active=!1,Vn(t.actor,_n("SD_CHECKPOINT",0))},nr=function(t,e,n,a,i,r){var o=t,c=t.actor;if(o.is_active)Kn(c)&&Vn(c,_n("SD_CHECKPOINT",2));else for(var s=0;s<n;s++){var u=e[s];if(u&&!u.dying&&Jn(u.actor,c)){o.is_active=!0,A(Qe("checkpoint")),Bh(c.position),Vn(c,_n("SD_CHECKPOINT",1));break}}},ar=function(t,e){Fn(t.actor,e)},ir=function(t){Wn(t.actor)},rr=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Hn(),Vn(t.actor,_n("SD_ITEMBOX",10))},or=function(t,e,n,a,i,r){},cr=function(t,e){Fn(t.actor,e)},sr=function(t){Wn(t.actor)},ur=function(t,e){var n={init:lr,release:fr,update:dr,render:pr},a=n;return n.init=lr,n.release=fr,n.update=dr,n.render=pr,a.sprite_name=t,a.player_is_vulnerable=e,n},lr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Hn(),Vn(t.actor,_n(e.sprite_name,0))},dr=function(t,e,n,a,i,r){for(var o=t,c=t.actor,s=0;s<n;s++){var u=e[s];u&&(u.dying||u.blinking||u.invincible||!qn(c,u.actor)||o.player_is_vulnerable(u)&&ns(u))}c.visible=Lh()},pr=function(t,e){Fn(t.actor,e)},fr=function(t){Wn(t.actor)},_r=function(t){return!0},hr=function(t){return t.shield_type!=Fc},mr=function(t,e){t.actor.speed=e},gr=function(t){t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Hn(),Vn(t.actor,_n("SD_DANGPOWER",0))},vr=function(t,e,n,a,i,r){for(var o=X(),c=t.actor,s=rt(c.speed,o),u=0;u<n;u++){var l=e[u];l&&!l.dying&&qn(c,l.actor)&&(ns(l),t.state=Rc)}c.position=at(c.position,s)},br=function(t,e){Fn(t.actor,e)},yr=function(t){Wn(t.actor)},xr=function(t,e){var n={init:wr,release:Sr,update:kr,render:Er},a=n;return a.authorized_player_type=t,a.is_vertical_door=e,n},wr=function(t){var e,n,a=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Hn(),n=a.authorized_player_type,e=a.is_vertical_door?"SD_DNADOOR":"SD_HORIZONTALDNADOOR",Vn(t.actor,_n(e,n))},kr=function(t,e,n,a,i,r){var o,c=t,s=t.actor,u=!1,l=!1,d=X(),p=[],f=[];t.obstacle=!0;for(var _=0;_<n;_++){var h=e[_];h&&(h.dying||h.actor.carrying||h.actor.carried_by||!Mr(h,t)||(h.type==c.authorized_player_type?(t.obstacle=!1,l=Jn(s,h.actor)):u=!0))}if(u&&(t.obstacle=!0),t.obstacle?s.alpha=Math.min(1,s.alpha+2*d):l&&(s.alpha=Math.max(.4,s.alpha-2*d)),l)for(p[0]=s.position.x-s.hot_spot.x-5,p[1]=s.position.y-s.hot_spot.y-5,p[2]=p[0]+$n(s).width+10,p[3]=p[1]+$n(s).height+10,o=i;null!=o;o=o.next)o.data.type==t.type&&(f[0]=o.data.actor.position.x-o.data.actor.hot_spot.x-5,f[1]=o.data.actor.position.y-o.data.actor.hot_spot.y-5,f[2]=f[0]+$n(o.data.actor).width+10,f[3]=f[1]+$n(o.data.actor).height+10,J(p,f)&&(o.data.actor.alpha<s.alpha?s.alpha=o.data.actor.alpha:o.data.actor.alpha=s.alpha))},Er=function(t,e){Fn(t.actor,e)},Sr=function(t){Wn(t.actor)},Mr=function(t,e){var n=[],a=[],i=t.actor,r=e.actor;return n[0]=i.position.x-i.hot_spot.x,n[1]=i.position.y-i.hot_spot.y,n[2]=n[0]+$n(i).width,n[3]=n[1]+$n(i).height,a[0]=r.position.x-r.hot_spot.x,a[1]=r.position.y-r.hot_spot.y-3,a[2]=a[0]+$n(r).width,a[3]=a[1]+$n(r).height+3,J(n,a)},Tr=function(t){var e=t;t.obstacle=!0,t.bring_to_back=!0,t.preserve=!0,t.actor=Hn(),e.is_closed=!0,Vn(t.actor,_n("SD_DOOR",0))},jr=function(t,e,n,a,i,r){var o=t,c=t.actor,s=X();o.is_closed?c.position.y=Math.min(c.position.y+2e3*s,c.spawn_point.y):c.position.y=Math.max(c.position.y-2e3*s,c.spawn_point.y-.8*$n(c).height)},Ir=function(t,e){Fn(t.actor,e)},Dr=function(t){Wn(t.actor)},Or=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Hn(),e.who=null,Vn(t.actor,_n("SD_ENDSIGN",0))},Rr=function(t,e,n,a,i,r){var o=t,c=t.actor;if(null==o.who){var s=void 0;for(s=0;s<n;s++){var u=e[s];u&&!u.dying&&Jn(u.actor,c)&&(o.who=u,A(Qe("end sign")),Vn(c,_n("SD_ENDSIGN",1)),Yh(t.actor))}}else if(Kn(c)){var l=2+o.who.type;Vn(c,_n("SD_ENDSIGN",l))}},Ar=function(t,e){Fn(t.actor,e)},Lr=function(t){Wn(t.actor)},Nr=function(t){t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Hn(),Vn(t.actor,_n("SD_EXPLOSION",K(2)))},Cr=function(t,e,n,a,i,r){Kn(t.actor)&&(t.state=Rc)},Gr=function(t,e){Fn(t.actor,e)},Pr=function(t){Wn(t.actor)},Ur=function(t){t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Hn(),Vn(t.actor,_n("SD_GLASSES",4)),t.actor.hot_spot.y*=.5},Br=function(t,e,n,a,i,r){var o=t.actor,c=X();o.angle+=Math.sign(o.speed.x)*(6*m*c),o.position=at(o.position,function(t,e){var n=X(),a=nt(0,0);return a.x=t.speed.x*n,a.y=t.speed.y*n+.5*e*n*n,t.speed.y+=e*n,a}(o,Vh()))},Yr=function(t,e){Fn(t.actor,e)},Hr=function(t){Wn(t.actor)},Wr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Hn(),e.elapsed_time=0,e.font=da(0),fa(e.font,"0"),Vn(t.actor,_n("SD_RING",0)),t.actor.visible=!1},Fr=function(t,e,n,a,i,r){var o=t,c=X();o.elapsed_time+=c,o.elapsed_time<.5?t.actor.position.y-=100*c:o.elapsed_time>2&&(t.state=Rc),o.font.position=t.actor.position},Xr=function(t,e){ga(t.font,e)},zr=function(t){var e=t;Wn(t.actor),pa(e.font)},$r=function(t,e,n,a){for(var i=_,r=null,o=null,c=e;c;c=c.next)c.data&&c.data.type==n&&(o=it(c.data.actor.position,t.actor.position),ot(o)<i&&(r=c.data,i=ot(o)));return a&&(a.dist=i),r},Qr=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Hn(),Vn(t.actor,_n("SD_GOAL",0))},Vr=function(t,e,n,a,i,r){var o,c=$r(t,i,Tc,null);o=null!=c?c.actor.position.x>t.actor.position.x?0:1:0,Vn(t.actor,_n("SD_GOAL",o))},Kr=function(t,e){Fn(t.actor,e)},qr=function(t){Wn(t.actor)},Jr=function(t,e){Vn(t.actor,_n("SD_ICON",e))},Zr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Hn(),e.elapsed_time=0,Jr(t,0)},to=function(t,e,n,a,i,r){var o=t,c=t.actor,s=X();if(o.elapsed_time+=s,o.elapsed_time<1)c.position.y-=40*s;else if(o.elapsed_time>=2.5){var u=void 0,l=void 0,d=c.position.x-c.hot_spot.x,p=c.position.y-c.hot_spot.y,f=$n(c),_=void 0;for(u=0;u<f.height;u++)for(l=0;l<f.width;l++)_=tn(1,1),on(_,255,255,255),Zh(_,nt(d+l,p+u),nt(l-f.width/2+(K(f.width)-f.width/2),u-K(f.height/2)),!1);t.state=Rc}},eo=function(t,e){Fn(t.actor,e)},no=function(t){Wn(t.actor)},ao=function(t,e){Gh(100),ls(cs()+1),Uh(Qe("1up"))},io=function(t,e){Gh(100),us(os()+10),A(Qe("ring"))},ro=function(t,e){Gh(100),e.invincible=!0,e.invtimer=0,T(M("data/music/invincible.mp4"),!1)},oo=function(t,e){Gh(100),e.got_speedshoes=!0,e.speedshoes_timer=0,T(M("data/music/speed.mp4"),!1)},co=function(t,e){Gh(100),e.got_glasses=!0},so=function(t,e){Gh(100),e.shield_type=Wc,A(Qe("shield"))},uo=function(t,e){Gh(100),e.shield_type=Fc,A(Qe("fire shield"))},lo=function(t,e){Gh(100),e.shield_type=Xc,A(Qe("thunder shield"))},po=function(t,e){Gh(100),e.shield_type=zc,A(Qe("water shield"))},fo=function(t,e){Gh(100),e.shield_type=$c,A(Qe("acid shield"))},_o=function(t,e){Gh(100),e.shield_type=Qc,A(Qe("wind shield"))},ho=function(t,e){ns(e)},mo=function(t,e){Gh(100)},go=function(t,e){var n={init:vo,release:xo,update:bo,render:yo},a=n;return a.on_destroy=t,a.anim_id=e,n},vo=function(t){var e=t;t.obstacle=!0,t.bring_to_back=!1,t.preserve=!0,t.actor=Hn(),Vn(t.actor,_n("SD_ITEMBOX",e.anim_id))},bo=function(t,e,n,a,i,r){for(var o=t.actor,c=t,s=0;s<n;s++){var u=e[s];if(u&&!(u.actor.is_jumping&&u.actor.speed.y<-10)&&t.state===Oc&&wo(t,u)&&rs(u)){var l=qh(kc,at(o.position,nt(0,-5)));Jr(l,c.anim_id),qh(Ec,at(o.position,nt(0,-20))),qh(wc,o.position),A(Qe("destroy")),u.actor.is_jumping&&is(u),c.on_destroy(t,u),t.state=Rc}}c.anim_id=c.anim_id<e.length?Ch():c.anim_id,Vn(t.actor,_n("SD_ITEMBOX",c.anim_id))},yo=function(t,e){Fn(t.actor,e)},xo=function(t){Wn(t.actor)},wo=function(t,e){var n,a=t.actor.position;return n=qn(t.actor,e.actor),t.actor.position=a,n},ko=function(t,e){var n={init:Eo,release:So,update:Mo,render:To},a=n;return a.on_collision=t,a.sprite_name=e,n},Eo=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Hn(),Vn(t.actor,_n(e.sprite_name,0))},So=function(t){Wn(t.actor)},Mo=function(t,e,n,a,i,r){var o=t,c=t.actor;c.visible=!1;for(var s=0;s<n;s++){var u=e[s];u&&qn(c,u.actor)&&(u.at_loopfloortop=jo(t,i,u),o.on_collision(u))}},To=function(t,e){Fn(t.actor,e)},jo=function(t,e,n){var a=$r(t,e,jc,null);return null!=a&&qn(n.actor,a.actor)},Io=function(t){t.disable_wall|=Uc,t.entering_loop=!0,t.bring_to_back=!1},Do=function(t){if(!t.flying){var e=t.actor.speed.x>0;t.disable_wall&=~(Uc|Gc),t.disable_wall|=e?Gc:Uc,t.bring_to_back=e}},Oo=function(t){t.disable_wall|=Gc,t.entering_loop=!0,t.bring_to_back=!0},Ro=function(t){t.entering_loop||(t.disable_wall=Cc,t.bring_to_back=!1)},Ao=function(t){t.at_loopfloortop||t.flying||(t.disable_wall|=Pc,t.entering_loop=!0,t.bring_to_back=!0)},Lo=function(t){t.at_loopfloortop||t.entering_loop||t.flying||(t.disable_wall&=~Pc,t.bring_to_back=!1)},No=function(t){if(!t.flying)if(t.disable_wall&Pc){var e=t.actor.speed.x>0;t.disable_wall&=~(Uc|Gc),t.disable_wall|=e?Gc:Uc,t.bring_to_back=!0}else t.disable_wall&=~(Uc|Gc),t.bring_to_back=!0},Co=function(t){t.is_moving=!0,t.actor.speed.x=t.actor.maxspeed*(K(100)-50)/100,t.actor.speed.y=-t.actor.jump_strength+K(t.actor.jump_strength)},Go=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Hn(),t.actor.maxspeed=220+K(140),t.actor.jump_strength=1.2*(350+K(50)),t.actor.input=xe(),e.is_disappearing=!1,e.is_moving=!1,e.life_time=0,Vn(t.actor,_n("SD_RING",0))},Po=function(t){Wn(t.actor)},Uo=function(t,e,n,a,i,r){for(var o=X(),c=t,s=t.actor,u=0;u<n;u++){var l=e[u];if(l&&(!c.is_moving||c.is_moving&&!l.getting_hit&&c.life_time>=.5)&&!c.is_disappearing&&!l.dying&&qn(s,l.actor)){us(os()+1),c.is_disappearing=!0,A(Qe("ring"));break}}if(c.is_disappearing)Vn(s,_n("SD_RING",1)),Kn(s)&&(t.state=Rc);else if(c.is_moving){if(je(s.input,Yt),t.preserve=!1,c.life_time+=o,c.life_time>5){var d=240+K(20);s.visible=z()%d<d/2,c.life_time>8&&(t.state=Rc)}zn(s,aa(s,a,Vh()))}},Bo=function(t,e){Fn(t.actor,e)},Yo=function(t,e,n){var a={init:Ho,release:Wo,update:Fo,render:Xo},i=a;return i.collision=t,i.anim_id=e,i.cycle_length=n,a},Ho=function(t){var e=t;t.obstacle=!0,t.bring_to_back=!0,t.preserve=!0,t.actor=Hn(),e.timer=0,e.hidden=!1,Vn(t.actor,_n("SD_SPIKES",e.anim_id))},Wo=function(t){Wn(t.actor)},Fo=function(t,e,n,a,i,r){var o=t,c=X();if(o.timer+=c,o.timer>=.5*o.cycle_length&&(o.timer=0,o.hidden=!o.hidden,A(Qe(o.hidden?"spikes disappearing":"spikes appearing"))),t.obstacle=!o.hidden,t.actor.visible=!o.hidden,!o.hidden)for(var s=0;s<n;s++){var u=e[s];if(u&&!u.dying&&!u.blinking&&!u.invincible&&o.collision(t,u)){var l=Qe("spikes hit");N(l)||A(l),ns(u)}}},Xo=function(t,e){Fn(t.actor,e)},zo=function(t,e){var n=[],a=t.actor;return n[0]=a.position.x-a.hot_spot.x,n[1]=a.position.y-a.hot_spot.y,n[2]=n[0]+$n(a).width,n[3]=n[1]+$n(a).height,J(n,e)},$o=function(t,e){var n,a=[],i=t.actor;return a[0]=i.position.x-i.hot_spot.x+5,a[1]=i.position.y-i.hot_spot.y-5,a[2]=a[0]+$n(i).width-10,a[3]=a[1]+10,n=e.actor.position.y-e.actor.hot_spot.y+$n(e.actor).height,zo(e,a)&&n<i.position.y-i.hot_spot.y+$n(i).height/2},Qo=function(t,e){var n=[],a=t.actor;return n[0]=a.position.x-a.hot_spot.x+5,n[1]=a.position.y-a.hot_spot.y+$n(a).height-5,n[2]=n[0]+$n(a).width-10,n[3]=n[1]+10,zo(e,n)},Vo=function(t,e){var n=[],a=t.actor;return n[0]=a.position.x-a.hot_spot.x+$n(a).width-5,n[1]=a.position.y-a.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+$n(a).height-10,zo(e,n)},Ko=function(t,e){var n=[],a=t.actor;return n[0]=a.position.x-a.hot_spot.x-5,n[1]=a.position.y-a.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+$n(a).height-10,zo(e,n)},qo=function(t,e,n){var a={init:Jo,release:Zo,update:tc,render:ec},i=a;return i.on_bump=t,i.sprite_name=e,i.strength=n,a},Jo=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Hn(),e.is_bumping=!1,e.bang_timer=0,Vn(t.actor,_n(e.sprite_name,0))},Zo=function(t){Wn(t.actor)},tc=function(t,e,n,a,i,r){var o=t,c=X();o.bang_timer+=c;for(var s=0;s<n;s++){var u=e[s];u&&!u.dying&&Jn(u.actor,t.actor)&&o.on_bump(t,u)}o.is_bumping&&Kn(t.actor)&&(Vn(t.actor,_n(o.sprite_name,0)),o.is_bumping=!1)},ec=function(t,e){Fn(t.actor,e)},nc=function(t,e){e.actor.speed.y>=1&&!e.actor.carrying&&!e.actor.carried_by&&ic(t,e)},ac=function(t,e){ic(t,e)},ic=function(t,e){var n=t;t.is_bumping=!0,function(t,e){var n=X(),a=[],i=[];a[0]=e.x*t.actor.speed.x>=0,a[1]=e.y*t.actor.speed.y>=0,i[0]=e.x*t.actor.speed.x<=0&&Math.abs(e.x)>p,i[1]=e.y*t.actor.speed.y<=0&&Math.abs(e.y)>p,Math.abs(e.y)>p&&(t.spring=!0),t.flying=!1,t.climbing=!1,t.landing=!1,t.getting_hit=!1,t.is_fire_jumping=!1,(Math.abs(e.x)>Math.abs(t.actor.speed.x)&&a[0]||i[0])&&(t.actor.speed.x=e.x),(Math.abs(e.y)>Math.abs(t.actor.speed.y)&&a[1]||i[1])&&(t.actor.speed.y=e.y,t.actor.position.y+=t.actor.speed.y*n)}(e,t.strength),Vn(n.actor,_n(t.sprite_name,1)),t.strength.x>p?e.actor.mirror&=-2:t.strength.x<-1e-5&&(e.actor.mirror|=1),t.bang_timer>.2&&(A(Qe("spring")),t.bang_timer=0)},rc=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Hn(),e.is_disabled=!1,e.is_active=!1,e.timer=0,Vn(t.actor,_n("SD_TELEPORTER",0))},oc=function(t,e,n,a,i,r){var o=t,c=t.actor,s=X(),u=0;if(o.is_active){if(o.timer+=s,o.timer>=3){var l=o.who;De(l.actor.input),Lm(l.actor);for(var d=0;d<n;d++){var p=e[d];if(p!=l){var f=at(c.position,nt(40*u++-20,-30));uc(p,f)}}o.is_active=!1,o.is_disabled=!0}Vn(c,_n("SD_TELEPORTER",1))}else Vn(c,_n("SD_TELEPORTER",0))},cc=function(t,e){Fn(t.actor,e)},sc=function(t){Wn(t.actor)},uc=function(t,e){t&&(t.actor.position=e,t.actor.speed=nt(0,0),t.actor.is_jumping=!1,t.flying=!1,t.climbing=!1,t.getting_hit=!1,t.spring=!1,t.actor.angle=0,t.disable_wall=Cc,t.entering_loop=!1,t.at_loopfloortop=!1,t.bring_to_back=!1)},lc=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Hn(),e.is_pressed=!1,e.partner=null,Vn(t.actor,_n("SD_SWITCH",0))},dc=function(t){Wn(t.actor)},pc=function(t,e,n,a,i,r){var o,c,s=t,u={dist:0},l={dist:0};s.partner=null,o=$r(t,i,Sc,u),c=$r(t,i,Mc,l),null!=o&&u.dist<l.dist&&(s.partner=o),null!=c&&l.dist<u.dist&&(s.partner=c),null==s.partner?_c(t,o,e,n,hc,mc):s.partner==o?_c(t,o,e,n,gc,vc):s.partner==c&&_c(t,c,e,n,bc,yc)},fc=function(t,e){Fn(t.actor,e)},_c=function(t,e,n,a,i,r){for(var o=!0,c=t,s=t.actor,u=0;u<a;u++){var l=n[u];xc(t,l)&&(o=!1,c.is_pressed||(i(e,l),A(Qe("switch")),Vn(s,_n("SD_SWITCH",1)),c.is_pressed=!0))}o&&c.is_pressed&&(r(e),Vn(s,_n("SD_SWITCH",0)),c.is_pressed=!1)},hc=function(t,e){},mc=function(t){},gc=function(t,e){!function(t){t.is_closed=!1,A(Qe("open door"))}(t)},vc=function(t){!function(t){t.is_closed=!0,A(Qe("close door"))}(t)},bc=function(t,e){!function(t,e){var n=t,a=t.actor;n.is_active||n.is_disabled||(n.is_active=!0,n.who=e,Ie(e.actor.input),Lm(a),A(Qe("teleporter")))}(t,e)},yc=function(t){},xc=function(t,e){if(!t)return!1;if(!e)return!1;var n=[],a=[];return n[0]=t.actor.position.x-t.actor.hot_spot.x,n[1]=t.actor.position.y-t.actor.hot_spot.y,n[2]=n[0]+$n(t.actor).width,n[3]=n[1]+$n(t.actor).height,a[0]=e.actor.position.x-e.actor.hot_spot.x+.3*$n(e.actor).width,a[1]=e.actor.position.y-e.actor.hot_spot.y+.5*$n(e.actor).height,a[2]=a[0]+.4*$n(e.actor).width,a[3]=a[1]+.5*$n(e.actor).height,!e.dying&&!e.climbing&&!e.flying&&J(n,a)},wc=9,kc=10,Ec=12,Sc=26,Mc=27,Tc=31,jc=35;!function(t){t[t.IS_IDLE=0]="IS_IDLE",t[t.IS_DEAD=1]="IS_DEAD"}(oe||(oe={}));var Ic,Dc,Oc=oe.IS_IDLE,Rc=oe.IS_DEAD,Ac=function(t){var e=null;switch(t){case 0:e={init:Go,release:Po,update:Uo,render:Bo};break;case 1:e=go(ao,0);break;case 2:e=go(io,3);break;case 3:e=go(ro,4);break;case 4:e=go(oo,5);break;case 5:e=go(co,6);break;case 6:e=go(so,7);break;case 42:e=go(uo,11);break;case 78:e=go(lo,12);break;case 79:e=go(po,13);break;case 80:e=go(fo,14);break;case 81:e=go(_o,15);break;case 7:e=go(ho,8);break;case 8:e=go(mo,9);break;case wc:e={init:rr,release:sr,update:or,render:cr};break;case kc:e={init:Zr,release:no,update:to,render:eo};break;case 11:e={init:Ur,release:Hr,update:Br,render:Yr};break;case Ec:e={init:Nr,release:Pr,update:Cr,render:Gr};break;case 13:e={init:Wr,release:zr,update:Fr,render:Xr};break;case 15:e={init:Ti,release:ji,update:Ii,render:Di};break;case 16:e=ko(Io,"SD_LOOPRIGHT");break;case 17:e=ko(Do,"SD_LOOPMIDDLE");break;case 18:e=ko(Oo,"SD_LOOPLEFT");break;case 19:e=ko(Ro,"SD_LOOPNONE");break;case 33:e=ko(Ao,"SD_LOOPFLOOR");break;case 34:e=ko(Lo,"SD_LOOPFLOORNONE");break;case jc:e=ko(No,"SD_LOOPFLOORTOP");break;case 20:e=qo(nc,"SD_YELLOWSPRING",nt(0,-500));break;case 54:e=qo(ac,"SD_BYELLOWSPRING",nt(0,500));break;case 50:e=qo(ac,"SD_TRYELLOWSPRING",nt(400,-600));break;case 48:e=qo(ac,"SD_RYELLOWSPRING",nt(600,0));break;case 52:e=qo(ac,"SD_BRYELLOWSPRING",nt(400,600));break;case 53:e=qo(ac,"SD_BLYELLOWSPRING",nt(-400,600));break;case 49:e=qo(ac,"SD_LYELLOWSPRING",nt(-600,0));break;case 51:e=qo(ac,"SD_TLYELLOWSPRING",nt(-400,-600));break;case 21:e=qo(nc,"SD_REDSPRING",nt(0,-750));break;case 47:e=qo(ac,"SD_BREDSPRING",nt(0,750));break;case 43:e=qo(ac,"SD_TRREDSPRING",nt(800,-1e3));break;case 22:e=qo(ac,"SD_RREDSPRING",nt(1200,0));break;case 45:e=qo(ac,"SD_BRREDSPRING",nt(800,1e3));break;case 46:e=qo(ac,"SD_BLREDSPRING",nt(-800,1e3));break;case 23:e=qo(ac,"SD_LREDSPRING",nt(-1200,0));break;case 44:e=qo(ac,"SD_TLREDSPRING",nt(-800,-1e3));break;case 55:e=qo(nc,"SD_BLUESPRING",nt(0,-1500));break;case 62:e=qo(ac,"SD_BBLUESPRING",nt(0,1500));break;case 58:e=qo(ac,"SD_TRBLUESPRING",nt(1800,-1500));break;case 56:e=qo(ac,"SD_RBLUESPRING",nt(2e3,0));break;case 60:e=qo(ac,"SD_BRBLUESPRING",nt(1800,1500));break;case 61:e=qo(ac,"SD_BLBLUESPRING",nt(-1800,1500));break;case 57:e=qo(ac,"SD_LBLUESPRING",nt(-2e3,0));break;case 59:e=qo(ac,"SD_TLBLUESPRING",nt(-1800,-1500));break;case 24:e={init:zi,release:Vi,update:$i,render:Qi};break;case 25:e={init:lc,release:dc,update:pc,render:fc};break;case Sc:bh.length>1&&(e={init:Tr,release:Dr,update:jr,render:Ir});break;case Mc:e={init:rc,release:sc,update:oc,render:cc};break;case 28:e={init:Hi,release:Wi,update:Fi,render:Xi};break;case 29:e={init:er,release:ir,update:nr,render:ar};break;case 30:e={init:Qr,release:qr,update:Vr,render:Kr};break;case Tc:e={init:Or,release:Lr,update:Rr,render:Ar};break;case 32:e={init:Oi,release:Ri,update:Ai,render:Li,state:null};break;case 36:e={init:Ki,release:Zi,update:qi,render:Ji};break;case 37:e=ur("SD_DANGER",_r);break;case 75:e=ur("SD_VERTICALDANGER",_r);break;case 76:e=ur("SD_FIREDANGER",hr);break;case 77:e=ur("SD_VERTICALFIREDANGER",hr);break;case 38:e=Yo($o,0,_);break;case 63:e=Yo(Qo,2,_);break;case 64:e=Yo(Vo,1,_);break;case 65:e=Yo(Ko,3,_);break;case 66:e=Yo($o,0,5);break;case 67:e=Yo(Qo,2,5);break;case 68:e=Yo(Vo,1,5);break;case 69:e=Yo(Ko,3,5);break;case 39:e=xr(Bc,!0);break;case 70:e=xr(Yc,!0);break;case 71:e=xr(Hc,!0);break;case 72:e=xr(Bc,!1);break;case 73:e=xr(Yc,!1);break;case 74:e=xr(Hc,!1);break;case 40:case 41:e={init:gr,release:yr,update:vr,render:br}}return null!=e&&(e.type=t,e.state=Oc,e.init(e)),e},Lc=function(t,e,n,a,i,r){t.update(t,e,n,a,i,r)},Nc=function(t,e){t.render(t,e)},Cc=0,Gc=2,Pc=4,Uc=8,Bc=0,Yc=1,Hc=2,Wc=1,Fc=2,Xc=3,zc=4,$c=5,Qc=6,Vc=0,Kc=0,qc=function(t){k("player_create(".concat(t,")"));for(var e={name:"Unknown",type:t,actor:Hn(),disable_movement:!1,in_locked_area:!1,at_some_border:!1,spin:!1,spin_dash:!1,braking:!1,flying:!1,climbing:!1,landing:!1,spring:!1,is_fire_jumping:!1,getting_hit:!1,dying:!1,dead:!1,blinking:!1,on_moveable_platform:!1,lock_accel:0,flight_timer:0,blink_timer:0,death_timer:0,disable_jump_for:0,glasses:Hn(),got_glasses:!1,shield:Hn(),shield_type:0,invincible:!1,invtimer:0,invstar:[],got_speedshoes:!1,speedshoes_timer:0,disable_wall:Cc,entering_loop:!1,at_loopfloortop:!1,bring_to_back:!1},n=0;n<5;n++)e.invstar[n]=Hn(),Vn(e.invstar[n],_n("SD_INVSTAR",0));switch(e.type){case Bc:e.name="Surge",e.actor.acceleration=250,e.actor.maxspeed=700,e.actor.jump_strength=450,e.actor.input=ke(),Vn(e.actor,_n(ps(Bc),0));break;case Yc:e.name="Neon",e.actor.acceleration=200,e.actor.maxspeed=600,e.actor.jump_strength=360,e.actor.input=ke(),Vn(e.actor,_n(ps(Yc),0));break;case Hc:e.name="Charge",e.actor.acceleration=200,e.actor.maxspeed=600,e.actor.jump_strength=360,e.actor.input=ke(),Vn(e.actor,_n(ps(Hc),0))}return Dc=1,Ic=0,k("player_create() ok"),e},Jc=function(t){for(var e=0;e<t.invstar.length;e++)Wn(t.invstar[e]);Wn(t.glasses),Wn(t.actor)},Zc=function(t,e,n){var a=t.actor;return t.blinking&&(t.blink_timer+=X(),a.visible=z()%250<125,t.blink_timer>=4&&(t.getting_hit=t.blinking=!1,a.visible=!0)),t.disable_movement?t.spin?Vn(t.actor,_n(ps(t.type),3)):t.spring&&Vn(t.actor,_n(ps(t.type),13)):zn(a,es(t,e,n,Vh())),t},ts=function(t,e){if(t){var n=t.actor;if(n){var a,i,r=n.hot_spot,o=n.position,c=nt(0,0),s=nt(0,0),u=[],l=n.angle;if(t.invincible){var d=_n("SD_INVSTAR",0).frame_count;for(t.invtimer+=X(),a=0;a<5;a++)u[a]=720*z()*.001+72*(a+1),s.x=30*Math.cos(u[a]*m/180),s.y=(z()+400*a)%2e3/40,s=ct(s,l),t.invstar[a].position.x=n.position.x+s.x,t.invstar[a].position.y=n.position.y-s.y+5,Qn(t.invstar[a],K(d))}for(t.got_glasses&&fs(t),0!=t.shield_type&&hs(t),t.type,a=0;a<5&&t.invincible;a++)u[a]%360>=180&&Fn(t.invstar[a],e);for(i=n.angle,n.angle=n.is_jumping||t.spin?i:tt(i),Fn(n,e),n.angle=i,t.got_glasses&&Fn(t.glasses,e),0!=t.shield_type&&Fn(t.shield,e),a=0;a<5&&t.invincible;a++)u[a]%360<180&&Fn(t.invstar[a],e);switch(t.type){case Bc:break;case Yc:n.is_jumping&&n.animation==_n(ps(Yc),3)&&(n.position=nt(o.x,o.y),n.angle=l,n.hot_spot=r,0!=t.shield_type&&(t.shield.angle=0,t.shield.hot_spot=c))}}}},es=function(t,e,n,a){var i,r,o,c,s,u,l,d,f,_,h,g,v,b,y,x,w,k,E,S,M,T,j,I,D=t.actor,O=ps(t.type),R=X(),L=480,C=0,G=1,P=D.maxspeed,U=nt(0,0),B=!1,Y=t.actor.animation==_n(O,1),H=!1,W=!1,F=!1,z=null,$=$n(D).width,Q=$n(D).height,V=!(Math.abs(D.angle)<p||Math.abs(D.angle-m/2)<p||Math.abs(D.angle-m)<p||Math.abs(D.angle-3*m/2)<p),Z=-2,tt=0,et=0,st=0,ut=D.position;switch(t.type){case Bc:V?(tt=1,et=.8,st=.5):(tt=.7,et=.5,st=.4);break;case Yc:case Hc:V?(tt=1,et=.7,st=.25):(tt=.7,et=.5,st=.25)}if(v=at(ut,ct(nt(0,-Q*tt+Z),-D.angle)),w=at(ut,ct(nt(0,2),-D.angle)),E=at(ut,ct(nt(-$*st+Z,-Q*et),-D.angle)),y=at(ut,ct(nt($*st-Z,-Q*et),-D.angle)),S=at(ut,ct(nt(-$*st+Z,-Q*tt+Z),-D.angle)),b=at(ut,ct(nt($*st-Z,-Q*tt+Z),-D.angle)),k=at(ut,ct(nt(-$*st+Z,2),-D.angle)),x=at(ut,ct(nt($*st-Z,2),-D.angle)),t.type==Yc&&D.carrying&&Math.abs(D.angle)<p){var lt=$n(D.carrying).height,dt=D.speed.y>5?.7*lt:0;k.y+=dt,x.y+=dt,w.y+=dt,E.y+=lt*et+K(lt)-.5*lt,y.y=E.y}M=t.disable_wall&Uc,T=t.disable_wall&Gc,j=t.disable_wall&Pc,I=1&t.disable_wall,Pn=M,Un=T,Bn=j,Yn=I,ea(!(t.disable_wall&Pc));var pt=ta(D,2,v,b,y,x,w,k,E,S,n,c,d,u,f,s,_,l,h);if(c=pt.up,s=pt.down,l=pt.left,u=pt.right,h=pt.upleft,d=pt.upright,_=pt.downleft,f=pt.downright,ea(!0),t.dying)return D.speed.x=0,D.speed.y=Math.min(L,D.speed.y+a*R),D.mirror=null,D.angle=0,D.visible=!0,t.blinking=!1,t.death_timer+=R,t.dead=t.death_timer>=2.5,Vn(D,_n(O,8)),nt(0,D.speed.y*R+.5*a*R*R);if(t.dead)return nt(0,0);var ft=na(D,Z,c,d,u,f,s,_,l,h);switch(c=ft.up,d=ft.upright,u=ft.right,l=ft.left,h=ft.upleft,s=ft.down,_=ft.downleft,f=ft.downright,t.type){case Bc:D.carry_offset=nt(1&D.mirror?7:-9,-40);break;case Yc:case Hc:D.carry_offset=nt(1&D.mirror?7:-7,-42)}if(null!=D.carried_by){var _t=null,ht=void 0,mt=0,gt=0,vt=D.carried_by;for(ht=0;ht<e.length;ht++)if(e[ht]==t){gt=ht;break}for(ht=0;ht<e.length;ht++)if(e[ht].actor==vt){_t=e[ht],mt=ht,t.disable_wall=_t.disable_wall,t.entering_loop=_t.entering_loop,t.at_loopfloortop=_t.at_loopfloortop,t.bring_to_back=_t.bring_to_back;break}if(_t&&(_t.type==Yc&&!_t.flying||_t.getting_hit||_t.dying||_t.dead))D.position=nt(D.carried_by.position.x,D.carried_by.position.y),D.carried_by.carrying=null,D.carried_by=null;else{if(!(s&&0==s.brick_ref.angle&&vt.speed.y>=5||t.getting_hit||t.dying||t.dead)){var bt=gt<mt?rt(vt.speed,R):nt(0,0);return D.speed=nt(0,0),D.mirror=vt.mirror,D.angle=0,Vn(D,_n(O,25)),D.position=it(at(vt.position,bt),D.carry_offset),nt(0,0)}D.position=nt(D.carried_by.position.x,D.carried_by.position.y),D.carried_by.carrying=null,D.carried_by=null}}if(t.entering_loop=!1,t.got_speedshoes&&(t.speedshoes_timer>23?t.got_speedshoes=!1:(P*=1.5,t.speedshoes_timer+=R)),ms(t)&&D.is_jumping&&(t.disable_wall&=~Pc),t.spring&&(s&&D.speed.y>=0||t.flying||t.climbing)&&(t.spring=!1),i=(u&&Se(D.input,Bt)||l&&Se(D.input,Ut))&&s,t.on_moveable_platform=ot(tm(s,D))>p,(o=s&&(D.angle>0&&D.angle<m/2&&D.speed.x>0||D.angle>3*m/2&&D.angle<2*m&&D.speed.x<0))&&(h||d)||Math.abs(D.angle)<p||Math.abs(D.angle-m)<p){if(u&&u.brick_ref.angle%90==0&&(D.speed.x>p||y.x>u.x)&&(!o||o&&90!=u.brick_ref.angle)&&(D.speed.x=0,D.position.x=u.x+(ut.x-y.x),!D.is_jumping&&!t.flying&&!t.climbing&&Math.abs(D.speed.y)<p&&(z=_n(O,i?14:0)),o))return nt(-5,0);if(l&&l.brick_ref.angle%90==0&&(D.speed.x<-1e-5||E.x<l.x+l.brick_ref.image.width)&&(!o||o&&270!=l.brick_ref.angle)&&(D.speed.x=0,D.position.x=l.x+l.brick_ref.image.width+(ut.x-E.x),!D.is_jumping&&!t.flying&&!t.climbing&&Math.abs(D.speed.y)<p&&(z=_n(O,i?14:0)),o))return nt(5,0);D.position.x<=D.hot_spot.x&&(t.spin=!1,W=!0,D.position.x<D.hot_spot.x&&(D.speed.x=0,D.position.x=D.hot_spot.x,s&&(i=!0,z=_n(O,1)))),D.position.x>=Ph().x-($n(D).width-D.hot_spot.x)&&(t.spin=!1,H=!0,D.position.x>Ph().x-($n(D).width-D.hot_spot.x)&&(D.speed.x=0,D.position.x=Ph().x-($n(D).width-D.hot_spot.x),s&&(i=!0,z=_n(O,1))))}if(!t.climbing){if(s){var yt,xt=s.brick_ref.angle,wt=void 0;if(B=!0,D.ignore_horizontal=!1,t.is_fire_jumping=!1,D.is_jumping=!1,s.brick_ref&&3==s.brick_ref.behavior&&0==s.state&&(s.state=2),Math.abs(D.speed.x)<p){if(xt%180==0&&(t.spin=!1),Se(D.input,Pt))t.spin_dash||(z=_n(O,4)),Me(D.input,Yt)&&(z=_n(O,6),t.spin_dash=!0,A(Qe("charge")));else if(!i)if(Se(D.input,Gt))Y&&t.at_some_border||(z=_n(O,5));else if(ms(t))z=_n(O,0);else{var kt=at(ut,ct(nt(-8,0),-D.angle)),Et=at(ut,ct(nt(5,0),-D.angle)),St=nt(0,0),Mt=ta(D,2,St,St,St,Et,St,kt,St,St,n,null,null,null,void 0,null,void 0,null,null);Mt.downleft&&Mt.downright||t.on_moveable_platform?Se(D.input,Ut)&&(W||t.at_some_border)||Se(D.input,Bt)&&(H||t.at_some_border)?(D.mirror=W?1:0,z=_n(O,1)):z=_n(O,0):z=_n(O,10)}if(t.spin_dash){var Tt=void 0,jt=1&D.mirror?1:-1,It=void 0,Dt=void 0,Ot=void 0;for(Tt=0;Tt<3;Tt++)K(128),Ot=tn(1,1),on(Ot,255,255,255),It=nt(jt*(7+K(7)),2),Dt=nt(jt*(50+K(200)),-K(200)),Zh(Ot,at(D.position,It),Dt,!0);(Te(D.input,Pt)||Lh())&&(t.spin=!0,t.spin_dash=!1,(!(1&D.mirror)||l||W)&&(1&D.mirror||u||H)||(D.speed.x=(1&D.mirror?-1:1)*P*1.35),A(Qe("release")),t.disable_jump_for=.05)}}else if(Se(D.input,Pt)&&(t.spin||A(Qe("roll")),t.spin=!0),t.spin||t.braking)t.spin?z=_n(O,3):t.braking&&(jt=1&D.mirror?1:-1,It=void 0,Dt=void 0,Ot=void 0,K(128),Ot=tn(1,1),It=nt(jt*(10-K(21)),0),Dt=nt(jt*(50+K(200)),-K(200)),Zh(Ot,at(D.position,It),Dt,!0),z=_n(O,7),Math.abs(D.speed.x)<10&&(t.braking=!1));else{var Rt=.75*P,At=.35*P;Math.abs(D.speed.x)<Rt?!i&&D.speed.y>=0&&(z=_n(O,1),D=function(t,e){return t.animation_speed_factor=Math.max(0,e),t}(D,.5+Math.abs(D.speed.x)/Rt*1.5)):z=_n(O,2),Math.abs(D.speed.x)>=At&&(Se(D.input,Bt)&&D.speed.x<0||Se(D.input,Ut)&&D.speed.x>0)&&(A(Qe("brake")),t.braking=!0)}if(t.disable_jump_for=Math.max(t.disable_jump_for-R,0),Math.abs(D.speed.x)<p&&(t.disable_jump_for=0),yt=!t.spin_dash,Se(D.input,Yt)&&t.disable_jump_for<=0&&!Se(D.input,Pt)&&!c&&!t.landing&&yt&&!D.is_jumping&&(A(Qe("jump")),D.angle=0,D.is_jumping=!0,t.is_fire_jumping=!0,F=!0,t.spin=!1,z=_n(O,3),0==xt?D.speed.y=1*-D.jump_strength:xt>0&&xt<90?xt>45?(D.speed.x=Math.min(D.speed.x,-.7*D.jump_strength*1),D.speed.y=-.7*D.jump_strength*1):(D.speed.x*=D.speed.x>0?.5:1,D.speed.y=1*-D.jump_strength):90==xt?(zn(D,nt(-40,0)),D.speed.x=Math.min(D.speed.x,1*-D.jump_strength),D.speed.y=-D.jump_strength/2*1):xt>90&&xt<180?(zn(D,nt(0,40)),D.speed.x=Math.min(D.speed.x,-.7*D.jump_strength*1),D.speed.y=1*D.jump_strength):180==xt?(zn(D,nt(0,40)),D.speed.x*=-1,D.speed.y=1*D.jump_strength):xt>180&&xt<270?(zn(D,nt(0,40)),D.speed.x=Math.max(D.speed.x,.7*D.jump_strength*1),D.speed.y=1*D.jump_strength):270==xt?(zn(D,nt(40,0)),D.speed.x=Math.max(D.speed.x,1*D.jump_strength),D.speed.y=-D.jump_strength/2*1):xt>270&&xt<360&&(xt<315?(D.speed.x=Math.max(D.speed.x,.7*D.jump_strength*1),D.speed.y=-.7*D.jump_strength*1):(D.speed.x*=D.speed.x<0?.5:1,D.speed.y=1*-D.jump_strength))),!D.is_jumping){var Lt=void 0;xt>0&&xt<90?(Lt=.8*Math.min(1,Math.tan(xt*m/180)),Math.abs(D.speed.y)>p?D.speed.x=B&&xt<=45?D.speed.x:Math.max(-1.2*P,-1*Lt*D.speed.y):(wt=(1&D.mirror?2:1)*Lt,t.braking&&xt<45?wt*=8*(D.speed.x<0?-.5:1):Math.abs(D.speed.x)<5&&(wt*=25*Math.sin(xt*m/180),t.lock_accel=2),D.speed.x=Math.max(D.speed.x-700*wt*R,-1.2*P))):xt>270&&xt<360&&(Lt=.8*Math.min(1,-Math.tan(xt*m/180)),Math.abs(D.speed.y)>p?D.speed.x=B&&xt>=315?D.speed.x:Math.min(1.2*P,1*Lt*D.speed.y):(wt=(1&D.mirror?1:2)*Lt,t.braking&&xt>315?wt*=8*(D.speed.x>0?-.5:1):Math.abs(D.speed.x)<5&&(wt*=25*-Math.sin(xt*m/180),t.lock_accel=1),D.speed.x=Math.min(D.speed.x+700*wt*R,1.2*P)))}xt%90==0&&(t.lock_accel=0),_&&f&&Math.abs(D.speed.x)<40&&_.brick_ref.angle>270&&_.brick_ref.angle<360&&f.brick_ref.angle>0&&f.brick_ref.angle<90&&(Se(D.input,Ut)||Se(D.input,Bt)||(D.speed.x=0))}else t.braking=!1,t.lock_accel=0,t.spin_dash&&(t.spin_dash=!1,z=_n(O,1)),D.animation!=_n(O,0)&&D.animation!=_n(O,10)&&D.animation!=_n(O,5)||(z=_n(O,1)),(t.spring||Y||D.speed.y<0)&&(t.spin=!1),ms(t)||(D.angle=0);if(s||t.is_fire_jumping&&D.speed.y<.88*-D.jump_strength&&Te(D.input,Yt)&&(D.speed.y*=.7),t.type==Yc&&t.flying?(G=t.flight_timer<10?.15:.8,L*=.3):G=1,U.y=Math.abs(D.speed.y)>p?D.speed.y*R+a*G*.5*(R*R):0,t.type==Hc&&t.flying||(D.speed.y=Math.min(D.speed.y+a*G*R,L)),r=c&&c.brick_ref.angle%90!=0&&Math.abs(D.angle)<p,c&&(c.brick_ref.angle%90==0||r)&&D.speed.y<-1e-5&&(D.position.y=c.y+c.brick_ref.image.height+(ut.y-v.y),D.speed.y=10,1==c.brick_ref.behavior&&Math.sin(c.brick_ref.behavior_arg[3]*c.value[0])>0))return D.speed.y=100,at(U,rt(tm(c,D),R));if((g=s)&&!D.is_jumping)if(xt=g.brick_ref.angle,D.speed.y=U.y=0,D.angle=xt*m/180,0==xt){var Nt=tm(s,D);ut.y=g.y,C=0,Nt.y>p?U.y+=Nt.y*R:D.position.y=ut.y+Z+1}else if(xt>0&&xt<90)ut.y=g.y+g.brick_ref.image.height-(D.position.x-g.x)*Math.tan(D.angle),D.speed.x<0&&(ut.y+=2),D.position.y=ut.y+Z,1&D.mirror||(C=.2);else if(90==xt){if(Math.abs(D.speed.x)>5){var Ct=f?f.brick_ref.angle:-1;f&&Ct>=xt&&Ct<xt+90?t.flying||(D.position.x=g.x+Z):(D.angle=0,D.is_jumping=!0,t.spin||t.flying||(z=_n(O,1)),ms(t)||(t.flying||zn(D,nt(-13,0)),D.speed=nt(0,-.9*Math.abs(D.speed.x))))}else D.angle=0,t.flying||zn(D,nt(-10,0)),D.is_jumping=!0,D.ignore_horizontal=!1;1&D.mirror||(C=1.5)}else xt>90&&xt<180?(Math.abs(D.speed.x)>5?(ut.y=g.y-(D.position.x-g.x)*Math.tan(D.angle),D.position.y=ut.y-Z):(D.angle=0,zn(D,nt(0,30)),D.is_jumping=!0),C=1.5):180==xt?(Math.abs(D.speed.x)>5?(ut.y=g.y+g.brick_ref.image.height,D.position.y=ut.y-Z,(D.speed.x>0&&!f||D.speed.x<0&&!_)&&(zn(D,nt(0,-30)),D.is_jumping=!0,D.speed.x*=-1,D.mirror=D.speed.x<0?1:0,D.angle=0)):(D.angle=0,zn(D,nt(0,40)),D.is_jumping=!0,D.speed.x=0),C=1.2):xt>180&&xt<270?(Math.abs(D.speed.x)>5?(ut.y=g.y+g.brick_ref.image.height-(D.position.x-g.x)*Math.tan(D.angle),D.position.y=ut.y-Z):(D.angle=0,zn(D,nt(0,30)),D.is_jumping=!0),C=1.5):270==xt?(Math.abs(D.speed.x)>5?(Ct=_?_.brick_ref.angle:-1,_&&Ct>xt-90&&Ct<=xt?t.flying||(D.position.x=g.x+g.brick_ref.image.width-Z):(D.angle=0,D.is_jumping=!0,t.spin||t.flying||(z=_n(O,1)),ms(t)||(t.flying||zn(D,nt(13,0)),D.speed=nt(0,-.9*Math.abs(D.speed.x))))):(D.angle=0,t.flying||zn(D,nt(10,0)),D.is_jumping=!0,D.ignore_horizontal=!1),1&D.mirror&&(C=1.5)):xt>270&&xt<360&&(ut.y=g.y-(D.position.x-g.x)*Math.tan(D.angle),D.speed.x>0&&(ut.y+=2),D.position.y=ut.y+Z,1&D.mirror&&(C=.2));if(U.x=Math.abs(D.speed.x)>p?D.speed.x*R+(1-C)*D.acceleration*.5*(R*R):0,!Se(D.input,Ut)||Se(D.input,Bt)||t.spin||t.braking||t.landing||t.getting_hit||1==t.lock_accel||W)if(!Se(D.input,Bt)||Se(D.input,Ut)||t.spin||t.braking||t.landing||t.getting_hit||2==t.lock_accel||H){if(s){var Ht=0;xt=s.brick_ref.angle,wt=0,wt=t.spin?.65:t.braking?4.5:t.landing?.6:1,xt%90==0?Ht=90==xt?-1:270==xt?1:D.speed.x>p?-1:-D.speed.x>p?1:0:(xt>90&&xt<180||xt>180&&xt<270)&&(Ht=D.speed.x>p?-1:-D.speed.x>p?1:0),D.speed.x+=Ht*wt*D.acceleration*R}}else D.ignore_horizontal||!(D.is_jumping||t.spring||Y)&&Se(D.input,Pt)||(D.mirror=0,C=D.speed.x<0?-1:C,D.speed.x<=1.1*P&&(D.speed.x=Math.min(D.speed.x+(1-C)*D.acceleration*R,P)));else D.ignore_horizontal||!(D.is_jumping||t.spring||Y)&&Se(D.input,Pt)||(D.mirror=1,C=D.speed.x>0?-1:C,D.speed.x>=1.1*-P&&(D.speed.x=Math.max(D.speed.x-(1-C)*D.acceleration*R,-P)))}switch(t.spring&&(z=_n(O,D.speed.y<=0?13:1),D.speed.y>0&&(t.spring=!1,D.is_jumping=!1)),t.getting_hit&&(s?t.getting_hit=!1:z=_n(O,11)),t.type){case Bc:break;case Yc:if(t.flight_timer+=R,s&&90!=s.brick_ref.angle&&270!=s.brick_ref.angle&&(t.flying=!1,t.flight_timer=0),(D.is_jumping&&D.speed.y>-D.jump_strength/3&&!F&&!t.getting_hit||t.flying)&&Me(D.input,Yt)&&!t.getting_hit&&t.flight_timer<10&&(t.flying||(t.flight_timer=0),D.speed.y=.1*-Vh(),t.flying=!0,D.is_jumping=!1,t.is_fire_jumping=!1),t.flying){if(z=_n(O,D.carrying?16:20),D.speed.x=q(D.speed.x,-D.maxspeed/2,D.maxspeed/2),t.flight_timer>=10){var Wt=Qe("tired of flying");N(Wt)||A(Wt),z=_n(O,19)}else for(Wt=void 0,ht=void 0,ms(t)&&(D.angle=0),Wt=Qe("flying"),N(Wt)||A(Wt),ht=0;ht<e.length&&null==D.carrying;ht++)if(e[ht]!=t&&D.speed.y<=0){var Ft=[e[ht].actor.position.x+.3*$n(e[ht].actor).width,e[ht].actor.position.y,e[ht].actor.position.x+.7*$n(e[ht].actor).width,e[ht].actor.position.y+.2*$n(e[ht].actor).height],Xt=[D.position.x+.3*$n(D).width,D.position.y+.7*$n(D).height,D.position.x+.7*$n(D).width,D.position.y+$n(D).height],zt=J(Ft,Xt),$t=!(null!=e[ht].actor.carried_by||e[ht].dying||e[ht].dead||e[ht].climbing||e[ht].landing||e[ht].getting_hit);zt&&$t&&!s&&(D.carrying=e[ht].actor,e[ht].actor.carried_by=D,e[ht].spin=e[ht].spin_dash=e[ht].braking=e[ht].flying=e[ht].spring=e[ht].on_moveable_platform=!1,A(Qe("touch the wall")))}}else D.animation==_n(O,D.carrying?16:20)&&(z=_n(O,1));break;case Hc:if((D.is_jumping&&D.speed.y>-.7*D.jump_strength||t.flying)&&Me(D.input,Yt)&&!s&&!t.getting_hit&&(D.speed.y=50,t.flying=!0,D.is_jumping=!1,t.is_fire_jumping=!1,D.speed.x=1&D.mirror?Math.min(-100,D.speed.x):Math.max(100,D.speed.x)),t.flying){var Qt=Se(D.input,Ut)&&D.speed.x>0||Se(D.input,Bt)&&D.speed.x,Vt=s&&Math.abs(s.brick_ref.angle*m/180-0)<p;if(Qt=D.animation==_n(O,21)&&!Kn(D),Vt||D.animation==_n(O,19)||t.landing||(1&D.mirror?(z=_n(O,Qt?21:20),D.speed.x=Math.max(D.speed.x-.5*D.acceleration*R,-P/2)):(z=_n(O,Qt?21:20),D.speed.x=Math.min(D.speed.x+.5*D.acceleration*R,P/2))),Vt)t.landing=!0,D.is_jumping=!1,z=_n(O,19),D.speed.y=0,U.y=0,t.climbing=!1;else if(Te(D.input,Yt))t.flying=!1,z=_n(O,18);else{var Kt=void 0,qt=[l,_,u,f,s];for(Kt=0;Kt<qt.length;Kt++)(g=qt[Kt])&&g.brick_ref.angle%90!=0&&(t.flying=!1,t.landing=!1)}Vt||c||(l&&l.brick_ref.angle%90==0||u&&u.brick_ref.angle%90==0)&&(t.climbing=!0,t.flying=!1,A(Qe("touch the ground")))}if(t.landing&&(Math.abs(D.speed.x)<p||!s)&&(t.flying=t.landing=!1),t.climbing){var Jt=nt(0,0);if(D.speed.x=U.x=0,l&&!u&&(D.mirror|=1),u&&!l&&(D.mirror&=-2),Jt=at(Jt,rt(tm(l,D),R)),((Jt=at(Jt,rt(tm(u,D),R))).y<=0&&!c||Jt.y>=0&&!s||!l&&u)&&(U=at(U,Jt)),l||u)if(Me(D.input,Yt)){var Zt=_n(O,17),te=_n(O,22);D.animation!=Zt&&D.animation!=te||(t.climbing=!1,D.is_jumping=!0,t.is_fire_jumping=!0,D.speed.x=.7*(1&D.mirror?1:-1)*D.jump_strength,D.speed.y=-.5*D.jump_strength,l&&!u&&(D.mirror&=-2),!l&&u&&(D.mirror|=1),z=_n(O,3),A(Qe("jump")))}else Se(D.input,Gt)?c||(U.y=.1*-P*R,z=_n(O,17)):Se(D.input,Pt)?s?t.climbing=!1:(U.y=.1*P*R,z=_n(O,17)):z=_n(O,22);else(g=1&D.mirror?_:f)?(z=_n(O,23),D.ignore_horizontal=!0,U=at(U,rt(tm(g,D),R)),Kn(D)&&(t.climbing=!1,D.ignore_horizontal=!1,D.speed=nt((1&D.mirror?-1:1)*P*.15,-Vh()/12.5),U.x=5*(1&D.mirror?-1:1))):(t.climbing=!1,D.is_jumping=!0,z=_n(O,3))}}return t.at_some_border=!1,z&&Vn(D,z),Math.abs(D.speed.x)<4&&(t.braking=!1,(!Se(D.input,Bt)&&!Se(D.input,Ut)||Se(D.input,Bt)&&Se(D.input,Ut)||t.spin||t.landing)&&(U.x=0,D.speed.x=0)),U.x+=tm(s,D).x*R,U.x=D.position.x<=D.hot_spot.x&&D.speed.x<0?0:U.x,U.x=D.position.x>=Ph().x-($n(D).width-D.hot_spot.x)&&D.speed.x>0?0:U.x,U},ns=function(t){var e,n,a=t.actor,i=!1;if(!t.blinking&&!t.dying&&!t.invincible)if(_s(t),0!=t.shield_type)i=!0,t.shield_type=0,A(Qe("death"));else if(Ic>0){for(i=!0,n=0;n<Math.min(os(),15);n++)e=qh(0,a.position),Co(e);us(0),A(Qe("ringless"))}else as(t);i&&(t.getting_hit=!0,t.flying=t.landing=t.climbing=t.spring=!1,t.is_fire_jumping=!1,t.spin_dash=t.spin=!1,t.blinking=!0,t.blink_timer=0,a.speed.x=1&a.mirror?200:-200,a.speed.y=-.75*a.jump_strength,zn(a,nt(0,-5)))},as=function(t){t.dying||(_s(t),t.shield_type=0,t.invincible=!1,t.got_speedshoes=!1,t.dying=!0,t.death_timer=0,t.spring=!1,t.actor.speed.y=1.2*-t.actor.jump_strength,t.flying=t.climbing=t.landing=!1,t.is_fire_jumping=!1,t.spin=t.spin_dash=!1,t.blinking=!1,A(Qe("death")))},is=function(t){je(t.actor.input,Yt),t.spring=!1,t.actor.speed.y=-t.actor.jump_strength,t.actor.is_jumping=!0,t.is_fire_jumping=!1,t.flying=!1},rs=function(t){var e=_n(ps(t.type),3);return t.spin||t.spin_dash||t.actor.animation==e||t.type==Hc&&(t.landing||t.flying)},os=function(){return Ic},cs=function(){return Vc},ss=function(){return Kc},us=function(t){Ic=q(t,0,9999),t/100>=Dc&&(Dc+=1,ls(cs()+1),Uh(Qe("1up")))},ls=function(t){Vc=t},ds=function(t){Kc=t},ps=function(t){switch(t){case Bc:return"SD_SONIC";case Yc:return"SD_TAILS";case Hc:return"SD_KNUCKLES";default:return"null"}},fs=function(t){if(t&&t.actor){var e=0,n=1&t.actor.mirror,a=!0,i=tt(t.actor.angle),r=nt(0,0),o=it(t.actor.position,ct(nt(0,t.actor.hot_spot.y),-i)),c=t.actor.animation;switch(t.type){case Bc:if(c==_n(ps(Bc),0))r=nt(3,24),e=1;else if(c==_n(ps(Bc),1))switch(~~t.actor.animation_frame){case 0:e=2,r=nt(5,23);break;case 1:e=2,r=nt(4,25);break;case 2:e=1,r=nt(7,25);break;case 3:case 4:e=1,r=nt(5,23);break;case 5:e=1,r=nt(4,24);break;case 6:e=2,r=nt(6,24);break;case 7:e=2,r=nt(6,23)}else if(c==_n(ps(Bc),2))e=1,r=nt(8,26);else if(c==_n(ps(Bc),5))e=3,r=0==~~t.actor.animation_frame?nt(0,19):nt(-1,21);else if(c==_n(ps(Bc),7))e=1,r=~~t.actor.animation_frame<2?nt(8,26):nt(10,28);else if(c==_n(ps(Bc),10))switch(e=1,~~t.actor.animation_frame){case 0:r=nt(1,22);break;case 1:r=nt(-1,23);break;case 2:r=nt(1,23)}else c==_n(ps(Bc),11)?(e=3,r=nt(-4,30)):c==_n(ps(Bc),12)?(e=3,r=nt(1,19)):c==_n(ps(Bc),13)?(e=3,r=nt(4,13)):c==_n(ps(Bc),14)?(e=1,r=nt(12,31)):c==_n(ps(Bc),15)?(e=0,r=nt(3,23)):c==_n(ps(Bc),25)?(e=0,r=nt(3,22)):a=!1;break;case Yc:if(c==_n(ps(Yc),0))r=nt(5,34),e=1;else if(c==_n(ps(Yc),1))switch(e=2,~~t.actor.animation_frame){case 0:r=nt(2,33);break;case 1:case 5:r=nt(3,33);break;case 2:r=nt(8,33);break;case 3:case 7:r=nt(3,32);break;case 4:r=nt(1,33);break;case 6:r=nt(7,33)}else if(c==_n(ps(Yc),2))e=2,r=0==~~t.actor.animation_frame?nt(7,35):nt(6,34);else if(c==_n(ps(Yc),4))e=1,r=nt(9,44);else if(c==_n(ps(Yc),5))e=1,r=nt(7,32);else if(c==_n(ps(Yc),7))e=1,r=0==~~t.actor.animation_frame?nt(2,33):nt(4,33);else if(c==_n(ps(Yc),10))switch(e=4,~~t.actor.animation_frame){case 0:r=nt(5,33);break;case 1:r=nt(6,33)}else if(c==_n(ps(Yc),11))e=1,r=nt(1,33);else if(c==_n(ps(Yc),12))e=1,r=nt(6,28);else if(c==_n(ps(Yc),13))e=3,r=nt(2,17);else if(c==_n(ps(Yc),14))e=1,r=nt(9,35);else if(c==_n(ps(Yc),15))switch(e=4,~~t.actor.animation_frame){case 0:case 8:case 9:case 10:r=nt(5,34);break;default:r=nt(5,33)}else c==_n(ps(Yc),16)?(e=1,r=nt(8,37)):c==_n(ps(Yc),19)?(e=1,r=0==~~t.actor.animation_frame?nt(9,39):nt(9,40)):c==_n(ps(Yc),20)?(e=1,r=nt(8,39)):c==_n(ps(Yc),25)?(e=1,r=nt(0,23)):a=!1;break;case Hc:if(c==_n(ps(Hc),0))e=1,r=nt(1,24);else if(c==_n(ps(Hc),1))switch(~~t.actor.animation_frame){case 0:e=1,r=nt(5,29);break;case 1:e=2,r=nt(5,29);break;case 2:e=2,r=nt(8,29);break;case 3:e=2,r=nt(9,28);break;case 4:e=1,r=nt(6,28);break;case 5:e=1,r=nt(6,29);break;case 6:e=1,r=nt(5,28);break;case 7:e=1,r=nt(4,27)}else if(c==_n(ps(Hc),2))e=1,r=nt(7,29);else if(c==_n(ps(Hc),4))e=1,r=0==~~t.actor.animation_frame?nt(0,31):nt(0,40);else if(c==_n(ps(Hc),5))e=1,r=0==~~t.actor.animation_frame?nt(0,21):nt(-1,21);else if(c==_n(ps(Hc),7))e=0,r=nt(-2,27);else if(c==_n(ps(Hc),10))switch(e=1,~~t.actor.animation_frame){case 0:r=nt(9,30);break;case 1:r=nt(8,27)}else if(c==_n(ps(Hc),11))e=1,r=nt(-3,27);else if(c==_n(ps(Hc),12))e=1,r=nt(5,24);else if(c==_n(ps(Hc),13))e=3,r=nt(-1,16);else if(c==_n(ps(Hc),14))switch(~~t.actor.animation_frame){case 0:e=1,r=nt(5,29);break;case 1:e=2,r=nt(5,29);break;case 2:e=2,r=nt(8,29);break;case 3:e=2,r=nt(9,28);break;case 4:e=1,r=nt(6,28);break;case 5:e=1,r=nt(6,29);break;case 6:e=1,r=nt(5,28);break;case 7:e=1,r=nt(4,27)}else if(c==_n(ps(Hc),15))e=0,r=nt(1,23);else if(c==_n(ps(Hc),16))switch(e=1,~~t.actor.animation_frame){case 0:r=nt(6,23);break;case 1:r=nt(5,20);break;case 2:r=nt(0,22)}else if(c==_n(ps(Hc),17))switch(e=3,~~t.actor.animation_frame){case 0:r=nt(-1,22);break;case 1:r=nt(-2,20);break;case 2:r=nt(0,21);break;case 3:r=nt(-1,24);break;case 4:r=nt(0,23);break;case 5:r=nt(0,22)}else if(c==_n(ps(Hc),18))e=1,r=0==~~t.actor.animation_frame?nt(6,23):nt(5,20);else if(c==_n(ps(Hc),19))e=1,r=nt(8,44);else if(c==_n(ps(Hc),20))e=1,r=nt(8,39);else if(c==_n(ps(Hc),21))switch(e=4,~~t.actor.animation_frame){case 0:r=nt(-8,41);break;case 1:r=nt(0,43);break;case 2:r=nt(10,41)}else if(c==_n(ps(Hc),22))e=3,r=nt(0,22);else if(c==_n(ps(Hc),23))switch(~~t.actor.animation_frame){case 0:e=3,r=nt(7,17);break;case 1:e=3,r=nt(11,15);break;case 2:e=0,r=nt(12,13)}else c==_n(ps(Hc),25)?(e=0,r=nt(0,23)):a=!1}return r.x*=n?-1:1,Vn(t.glasses,_n("SD_GLASSES",e)),t.glasses.position=at(o,ct(r,-i)),t.glasses.angle=i,t.glasses.mirror=t.actor.mirror,t.glasses.visible=a&&t.actor.visible,t}},_s=function(t){},hs=function(t){var e=t.shield,n=t.actor,a=nt(0,0);switch(t.shield_type){case Wc:a=nt(0,-22),e.position=at(n.position,ct(a,-tt(n.angle))),Vn(e,_n("SD_SHIELD",0));break;case Fc:a=nt(0,-22),e.position=at(n.position,ct(a,-tt(n.angle))),Vn(e,_n("SD_FIRESHIELD",0));break;case Xc:a=nt(0,-22),e.position=at(n.position,ct(a,-tt(n.angle))),Vn(e,_n("SD_THUNDERSHIELD",0));break;case zc:a=nt(0,-22),e.position=at(n.position,ct(a,-tt(n.angle))),Vn(e,_n("SD_WATERSHIELD",0));break;case $c:a=nt(0,-22),e.position=at(n.position,ct(a,-tt(n.angle))),Vn(e,_n("SD_ACIDSHIELD",0));break;case Qc:a=nt(0,-22),e.position=at(n.position,ct(a,-tt(n.angle))),Vn(e,_n("SD_WINDSHIELD",0))}},ms=function(t){return t.disable_wall!==Cc},gs=function(t){var e=t.decorated_machine;e.init(e)},vs=function(t){var e=t.decorated_machine;e.release(e)},bs=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t;us(os()+c.rings),o.update(o,e,n,a,i,r)},ys=function(t,e){var n=t.decorated_machine;n.render(n,e)},xs=function(t){var e=t.decorated_machine;e.init(e)},ws=function(t){var e=t.decorated_machine;e.release(e)},ks=function(t,e,n,a,i,r){var o=t.decorated_machine;Gh(t.score),o.update(o,e,n,a,i,r)},Es=function(t,e){var n=t.decorated_machine;n.render(n,e)},Ss=function(t,e,n){var a={init:Ms,release:Ts,update:js,render:Is,get_object_instance:Mi},i=a;return i.decorated_machine=t,i.offset=nt(e,n),a},Ms=function(t){var e=t.decorated_machine;e.init(e)},Ts=function(t){var e=t.decorated_machine;e.release(e)},js=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t),u=Up(s);s.actor.position=at(u.actor.position,c.offset),o.update(o,e,n,a,i,r)},Is=function(t,e){var n=t.decorated_machine;n.render(n,e)},Ds=function(t,e,n,a,i,r){return Ns(t,Cs(e,n,a,i,r))},Os=function(t){var e=t.decorated_machine;e.init(e)},Rs=function(t){var e=t.decorated_machine;e.release(e)},As=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t;c.strategy.update(c.strategy),o.update(o,e,n,a,i,r)},Ls=function(t,e){var n=t.decorated_machine;n.render(n,e)},Ns=function(t,e){var n={init:Os,release:Rs,update:As,render:Ls,get_object_instance:Mi},a=n;return a.decorated_machine=t,a.strategy=e,n},Cs=function(t,e,n,a,i){return{update:Gs,sfx:Qe(t),vol:Math.min(e,0,1),pan:Math.min(n,-1,1),freq:a,loop:i}},Gs=function(t){L(t.sfx)},Ps=function(t,e){return{update:Us,mus:M(t),loop:e}},Us=function(t){var e=t;T(e.mus,e.loop)},Bs=function(t){Qh()},Ys=function(t){I(t.vol)},Hs=function(t){var e=t.decorated_machine;e.init(e)},Ws=function(t){var e=t.decorated_machine;e.release(e)},Fs=function(t,e,n,a,i,r){var o=t.decorated_machine,c=Up(t.get_object_instance(t));is(c),o.update(o,e,n,a,i,r)},Xs=function(t,e){var n=t.decorated_machine;n.render(n,e)},zs=function(t){var e=t.decorated_machine;e.init(e)},$s=function(t){var e=t.decorated_machine;e.release(e)},Qs=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t),u=X(),l=rt(c.speed,u);s.actor.position=at(s.actor.position,l),o.update(o,e,n,a,i,r)},Vs=function(t,e){var n=t.decorated_machine;n.render(n,e)},Ks=function(t){var e=t.decorated_machine;e.init(e)},qs=function(t){var e=t.decorated_machine;e.release(e)},Js=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t),u=tu(s,r,c.object_name,null);null!=u&&ki(u.vm,c.new_state_name),o.update(o,e,n,a,i,r)},Zs=function(t,e){var n=t.decorated_machine;n.render(n,e)},tu=function(t,e,n,a){var i,r,o=_,c=null;for(i=e;i;i=i.next)i.data.name==n&&(r=it(i.data.actor.position,t.actor.position),ot(r)<o&&(c=i.data,o=ot(r)));return a&&(a=o),c},eu=function(t,e,n,a,i){var r={init:nu,release:au,update:iu,render:ru,get_object_instance:Mi},o=r;return o.decorated_machine=t,o.strategy=ou,o.offset=nt(n,a),o.object_name=e,o.child_name=i,o.new_state_name=null,r},nu=function(t){var e=t.decorated_machine;e.init(e)},au=function(t){var e=t.decorated_machine;e.release(e)},iu=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t;c.strategy(c),o.update(o,e,n,a,i,r)},ru=function(t,e){var n=t.decorated_machine;n.render(n,e)},ou=function(t){var e=t,n=e.get_object_instance(e),a=Jh(t.object_name,at(n.actor.position,t.offset));null!=a&&Gp(n,t.child_name,a)},cu=function(t){var e=t,n=e.get_object_instance(e),a=Cp(n,t.child_name);null!=a&&ki(a.vm,t.new_state_name)},su=function(t){var e=t,n=e.get_object_instance(e),a=Np(n);null!=a&&ki(a.vm,t.new_state_name)},uu=function(t){var e=t.decorated_machine;e.init(e)},lu=function(t){var e=t.decorated_machine;e.release(e)},du=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t.get_object_instance(t);Yh(c.actor),o.update(o,e,n,a,i,r)},pu=function(t,e){var n=t.decorated_machine;n.render(n,e)},fu=function(t){var e=t.decorated_machine;e.init(e)},_u=function(t){var e=t.decorated_machine;e.release(e)},hu=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t);qh(c.item_id,at(s.actor.position,c.offset)),o.update(o,e,n,a,i,r)},mu=function(t,e){var n=t.decorated_machine;n.render(n,e)},gu=function(t){var e=t.decorated_machine;e.init(e)},vu=function(t){var e=t.decorated_machine;e.release(e)},bu=function(t,e,n,a,i,r){var o=t.decorated_machine;t.get_object_instance(t).state=jp,o.update(o,e,n,a,i,r)},yu=function(t,e){var n=t.decorated_machine;n.render(n,e)},xu=function(t,e,n,a){var i={init:wu,release:ku,update:Eu,render:Su,get_object_instance:Mi},r=i;return r.decorated_machine=t,r.title=e,r.message=n,r.strategy=a,i},wu=function(t){var e=t.decorated_machine;e.init(e)},ku=function(t){var e=t.decorated_machine;e.release(e)},Eu=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t;c.strategy(c),o.update(o,e,n,a,i,r)},Su=function(t,e){var n=t.decorated_machine;n.render(n,e)},Mu=function(t){Wh(t.title,t.message)},Tu=function(t){Fh()},ju=function(t){var e=t.decorated_machine;e.init(e)},Iu=function(t){var e=t.decorated_machine;e.release(e)},Du=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t).actor,u=X(),l=null,d=null,p=null,f=null,_=null,h=null,m=null,g=null,v=.001*z(),b=s.position;s.position.x+=-c.amplitude_x*c.angularspeed_x*Math.sin(c.initialphase_x+c.angularspeed_x*v)*u,s.position.y+=c.amplitude_y*c.angularspeed_y*Math.cos(c.initialphase_y+c.angularspeed_y*v)*u;var y=Zn(s,0,0,a,l,d,p,f,_,h,m,g);l=y.up,d=y.upright,p=y.right,f=y.downright,_=y.down,h=y.downleft,m=y.left,g=y.upleft;var x=na(s,0,l,d,p,f,_,h,m,g);l=x.up,d=x.upright,p=x.right,f=x.downright,_=x.down,h=x.downleft,m=x.left,g=x.upleft,null!=p&&s.position.x>b.x&&(s.position.x=s.hot_spot.x-$n(s).width+p.x),null!=m&&s.position.x<b.x&&(s.position.x=s.hot_spot.x+m.x+Ln(m).width),null!=_&&s.position.y>b.y&&(s.position.y=s.hot_spot.y-$n(s).height+_.y),null!=l&&s.position.y<b.y&&(s.position.y=s.hot_spot.y+l.y+Ln(l).height),o.update(o,e,n,a,i,r)},Ou=function(t,e){var n=t.decorated_machine;n.render(n,e)},Ru=function(t){var e=t.decorated_machine;e.init(e)},Au=function(t){var e=t.decorated_machine;e.release(e)},Lu=function(t,e,n,a,i,r){for(var o=t.decorated_machine,c=t,s=t.get_object_instance(t),u=0;u<n;u++){var l=e[u];l&&Jn(s.actor,l.actor)&&(rs(l)||l.invincible?(l.actor.is_jumping&&is(l),Gh(c.score),qh(Ec,at(s.actor.position,nt(0,-15))),em(s.actor.position),A(Qe("destroy")),s.state=jp):ns(l))}o&&o.update(o,e,n,a,i,r)},Nu=function(t,e){var n=t.decorated_machine;n.render(n,e)},Cu=function(t){var e=t.decorated_machine;e.init(e)},Gu=function(t){var e=t.decorated_machine;e.release(e)},Pu=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t.get_object_instance(t).actor;zn(c,aa(c,a,Vh())),o.update(o,e,n,a,i,r)},Uu=function(t,e){var n=t.decorated_machine;n.render(n,e)},Bu=function(t,e){var n={init:Yu,release:Hu,update:Wu,render:Fu,get_object_instance:Mi},a=n;return a.decorated_machine=t,a.should_hit_the_player=e,n},Yu=function(t){var e=t.decorated_machine;e.init(e)},Hu=function(t){var e=t.decorated_machine;e.release(e)},Wu=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=Up(t.get_object_instance(t));!s.invincible&&c.should_hit_the_player(s)&&ns(s),o.update(o,e,n,a,i,r)},Fu=function(t,e){var n=t.decorated_machine;n.render(n,e)},Xu=function(t){return!0},zu=function(t){return t.shield_type!=Fc&&t.shield_type!=zc},$u=function(t){return t.shield_type!=Xc},Qu=function(t){return t.shield_type!=$c},Vu=function(t){var e=t.decorated_machine;e.init(e)},Ku=function(t){var e=t.decorated_machine;e.release(e)},qu=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t.get_object_instance(t).actor;Zn(c,2,-4,a,null,null,null,null,null,null,null,null),na(c,-4,null,null,null,null,null,null,null,null),o.update(o,e,n,a,i,r)},Ju=function(t,e){var n=t.decorated_machine;n.render(n,e)},Zu=function(t){var e=t.decorated_machine,n=t,a=Math.abs(n.x2-n.x1),i=Math.abs(n.y2-n.y1);n.cute_image=al(a,i),n.has_locked_somebody=!1,e.init(e)},tl=function(t){var e=t.decorated_machine;e.release(e)},el=function(t,e,n,a,i,r){var o,c,s,u,l,d=t.decorated_machine,p=t,f=t.get_object_instance(t),_=Up(f),h=f.actor;o=h.position.x+p.x1,c=h.position.y+p.y1,s=p.x2-p.x1,u=p.y2-p.y1;for(var m=0;m<n;m++)if(l=e[m].actor,e[m]!=_||null!=l.carrying)l.position.x>o-30&&l.position.x<o&&(l.position.x=o-30,l.speed.x=0),l.position.x>o+s&&l.position.x<o+s+30&&(l.position.x=o+s+30,l.speed.x=0);else{var g=[],v=[];g[0]=l.position.x,g[1]=l.position.y,g[2]=l.position.x+1,g[3]=l.position.y+1,v[0]=o,v[1]=c,v[2]=o+s,v[3]=c+u,J(g,v)&&(p.has_locked_somebody=!0,e[m].in_locked_area=!0,$h(o,c,o+s,c+u))}p.has_locked_somebody&&((l=_.actor).position.x<o&&(l.position.x=o,l.speed.x=Math.max(0,l.speed.x),_.at_some_border=!0),l.position.x>o+s&&(l.position.x=o+s,l.speed.x=Math.min(0,l.speed.x),_.at_some_border=!0),l.position.y=Math.min(l.position.y,c,c+u)),d.update(d,e,n,a,i,r)},nl=function(t,e){var n=t.decorated_machine;n.render(n,e)},al=function(t,e){var n=tn(t,e);return rn(255,0,0),n},il=function(t,e){var n={init:rl,release:ol,update:cl,render:sl,get_object_instance:Mi},a=n;return a.decorated_machine=t,a.look_strategy=e,n},rl=function(t){var e=t.decorated_machine;e.init(e)},ol=function(t){var e=t.decorated_machine;e.release(e)},cl=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t;c.look_strategy(c),o.update(o,e,n,a,i,r)},sl=function(t,e){var n=t.decorated_machine;n.render(n,e)},ul=function(t){var e=t;e.get_object_instance(e).actor.mirror&=-2},ll=function(t){var e=t;e.get_object_instance(e).actor.mirror|=1},dl=function(t){var e=t,n=e.get_object_instance(e),a=Up(n);a&&(n.actor.position.x<a.actor.position.x?n.actor.mirror&=-2:n.actor.mirror|=1)},pl=function(t){var e=t,n=e.get_object_instance(e);n.actor.position.x>t.old_x?n.actor.mirror&=-2:n.actor.mirror|=1,t.old_x=n.actor.position.x},fl=function(t){var e=t.decorated_machine;e.init(e)},_l=function(t){var e=t.decorated_machine;e.release(e)},hl=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t),u=Up(s);if(u){var l=it(u.actor.position,s.actor.position);if(ot(l)>=5){var d=X(),p=st(l),f=rt(p,c.speed*d);s.actor.position=at(s.actor.position,f)}}o.update(o,e,n,a,i,r)},ml=function(t,e){var n=t.decorated_machine;n.render(n,e)},gl=function(t){var e=t.decorated_machine;e.init(e)},vl=function(t){var e=t.decorated_machine;e.release(e)},bl=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=X(),u=rt(c.speed,s),l=Up(t.get_object_instance(t));l.actor.position=at(l.actor.position,u),o.update(o,e,n,a,i,r)},yl=function(t,e){var n=t.decorated_machine;n.render(n,e)},xl=function(t,e){var n={init:kl,release:El,update:Sl,render:Ml,get_object_instance:Mi},a=n;return a.decorated_machine=t,a.strategy=e,n},wl=function(t,e,n){return{player_name:t,object:e,run:n}},kl=function(t){var e=t.decorated_machine;e.init(e)},El=function(t){var e=t.decorated_machine;e.release(e)},Sl=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t;c.strategy.run(c.strategy,e,n),o.update(o,e,n,a,i,r)},Ml=function(t,e){var n=t.decorated_machine;n.render(n,e)},Tl=function(t,e,n){Bp(t.object,null)},jl=function(t,e,n){Yp(t.object)},Il=function(t,e,n){Hp(t.object)},Dl=function(t,e,n){for(var a=Up(t.object),i=0;i<n;i++)if(e[i]==a){Bp(t.object,e[(i+1)%n]);break}},Ol=function(t,e,n){return Rl(t,n,Gl(e))},Rl=function(t,e,n){var a={init:Al,release:Ll,update:Nl,render:Cl,get_object_instance:Mi},i=a;return i.new_state_name=e,i.strategy=n,a},Al=function(t){var e=t.decorated_machine;e.init(e)},Ll=function(t){var e=t.decorated_machine;e.release(e)},Nl=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t);c.strategy.should_trigger_event(c.strategy,s,e,n,a,i,r)?ki(s.vm,c.new_state_name):o.update(o,e,n,a,i,r)},Cl=function(t,e){var n=t.decorated_machine;n.render(n,e)},Gl=function(t){var e={init:Pl,release:Ul,should_trigger_event:Bl},n=e;return n.timeout=t,n.timer=0,e},Pl=function(t){},Ul=function(t){},Bl=function(t,e,n,a,i,r,o){var c=t;return c.timer+=X(),c.timer>=c.timeout&&(c.timer=0,!0)},Yl=function(t){},Hl=function(t){},Wl=function(t,e,n,a,i,r,o){for(var c=t,s=o;null!=s;s=s.next)if(s.data.name==c.target_name&&Jn(s.data.actor,e.actor))return!0;return!1},Fl=function(t){},Xl=function(t){},zl=function(t,e,n,a,i,r,o){return Kn(e.actor)},$l=function(t){},Ql=function(t){},Vl=function(t,e,n,a,i,r,o){return 1e5*t.probability>K(1e5)},Kl=function(t){},ql=function(t){},Jl=function(t,e,n,a,i,r,o){var c=Up(e);return Jn(e.actor,c.actor)},Zl=function(t){},td=function(t){},ed=function(t,e,n,a,i,r,o){var c=Up(e);return rs(c)&&Jn(e.actor,c.actor)},nd=function(t){},ad=function(t){},id=function(t,e,n,a,i,r,o){var c=t,s=e.actor,u=Up(e),l=u.actor,d=$n(l),p=[],f=[];return p[0]=s.position.x+c.x1,p[1]=s.position.y+c.y1,p[2]=s.position.x+c.x2,p[3]=s.position.y+c.y2,f[0]=l.position.x-l.hot_spot.x,f[1]=l.position.y-l.hot_spot.y,f[2]=l.position.x-l.hot_spot.x+d.width,f[3]=l.position.y-l.hot_spot.y+d.height,!u.dying&&J(p,f)},rd=function(t){var e={init:od,release:cd,should_trigger_event:sd};return e.shield_type=t,e},od=function(t){},cd=function(t){},sd=function(t,e,n,a,i,r,o){var c=t;return Up(e).shield_type==c.shield_type},ud=function(t){},ld=function(t){},dd=function(t,e,n,a,i,r,o){var c=e.actor;Zn(c,1,0,i,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined)},pd=function(t){},fd=function(t){},_d=function(t,e,n,a,i,r,o){var c=e.actor;Zn(c,1,0,i,void 0,void 0,void 0,undefined,undefined,undefined,void 0,void 0)},hd=function(t){},md=function(t){},gd=function(t,e,n,a,i,r,o){var c=e.actor;Zn(c,1,0,i,undefined,undefined,void 0,void 0,void 0,void 0,void 0,undefined)},vd=function(t){},bd=function(t){},yd=function(t,e,n,a,i,r,o){var c=e.actor;Zn(c,1,0,i,void 0,void 0,void 0,void 0,void 0,void 0,undefined,undefined)},xd=function(t){},wd=function(t){},kd=function(t,e,n,a,i,r,o){var c=e.actor;Zn(c,1,0,i,void 0,undefined,undefined,void 0,void 0,void 0,void 0,void 0)},Ed=function(t,e){var n={init:Sd,release:Md,update:Td,render:jd,get_object_instance:Mi},a=n;return a.decorated_machine=t,a.update=e,n},Sd=function(t){var e=t.decorated_machine;e.init(e)},Md=function(t){var e=t.decorated_machine;e.release(e)},Td=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=Up(t.get_object_instance(t));c.update(s),o.update(o,e,n,a,i,r)},jd=function(t,e){var n=t.decorated_machine;n.render(n,e)},Id=function(t){t.spring=!0,t.spin=!1,t.flying=!1,t.climbing=!1,t.landing=!1,t.getting_hit=!1,t.is_fire_jumping=!1},Dd=function(t){t.spin=!0,t.spring=!1,t.flying=!1,t.climbing=!1,t.landing=!1,t.getting_hit=!1,t.is_fire_jumping=!1},Od=function(t,e){var n={init:Rd,release:Ad,update:Ld,render:Nd,get_object_instance:Mi},a=n;return a.decorated_machine=t,a.enable=e,n},Rd=function(t){var e=t.decorated_machine;e.init(e)},Ad=function(t){var e=t.decorated_machine;e.release(e)},Ld=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t;Up(t.get_object_instance(t)).disable_movement=!c.enable,o.update(o,e,n,a,i,r)},Nd=function(t,e){var n=t.decorated_machine;n.render(n,e)},Cd=function(t,e){var n={init:Gd,release:Pd,update:Ud,render:Bd,get_object_instance:Mi},a=n;return a.decorated_machine=t,a.alpha=Math.min(e,0,1),n},Gd=function(t){var e=t.decorated_machine;e.init(e)},Pd=function(t){var e=t.decorated_machine;e.release(e)},Ud=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t;t.get_object_instance(t).actor.alpha=c.alpha,o.update(o,e,n,a,i,r)},Bd=function(t,e){var n=t.decorated_machine;n.render(n,e)},Yd=function(t){var e=t.decorated_machine;e.init(e)},Hd=function(t){var e=t.decorated_machine;e.release(e)},Wd=function(t,e,n,a,i,r){var o=t.decorated_machine;Xd(t),o.update(o,e,n,a,i,r)},Fd=function(t,e){var n=t.decorated_machine;n.render(n,e)},Xd=function(t){var e=t,n=t.get_object_instance(t);Vn(n.actor,e.anim)},zd=function(t,e,n){var a={init:$d,release:Qd,update:Vd,render:Kd,get_object_instance:Mi},i=a;return i.decorated_machine=t,i.is_obstacle=e,i.angle=n,a},$d=function(t){var e=t.decorated_machine;e.init(e)},Qd=function(t){var e=t.decorated_machine;e.release(e)},Vd=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t);s.obstacle=c.is_obstacle,s.obstacle_angle=c.angle,o.update(o,e,n,a,i,r)},Kd=function(t,e){var n=t.decorated_machine;n.render(n,e)},qd=function(t){var e=t.decorated_machine;e.init(e)},Jd=function(t){var e=t.decorated_machine;e.release(e)},Zd=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=Up(t.get_object_instance(t));Vn(s.actor,c.anim),o.update(o,e,n,a,i,r)},tp=function(t,e){var n=t.decorated_machine;n.render(n,e)},ep=function(t){var e=t.decorated_machine;e.init(e)},np=function(t){var e=t.decorated_machine;e.release(e)},ap=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t);Up(s).actor.position=at(s.actor.position,c.offset),o.update(o,e,n,a,i,r)},ip=function(t,e){var n=t.decorated_machine;n.render(n,e)},rp=function(t){var e=t.decorated_machine;e.init(e)},op=function(t){var e=t.decorated_machine;e.release(e)},cp=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=Up(t.get_object_instance(t));c.strategy(s,c.speed),o.update(o,e,n,a,i,r)},sp=function(t,e){var n=t.decorated_machine;n.render(n,e)},up=function(t,e,n){var a={init:rp,release:op,update:cp,render:sp,get_object_instance:Mi},i=a;return i.decorated_machine=t,i.speed=e,i.strategy=n,a},lp=function(t,e){t.actor.speed.x=e},dp=function(t,e){t.actor.speed.y=e},pp=function(t){var e=t.decorated_machine;t.direction=0==K(2)?-1:1,e.init(e)},fp=function(t){var e=t.decorated_machine;e.release(e)},_p=function(t,e,n,a,i,r){var o=t.decorated_machine,c=t,s=t.get_object_instance(t).actor,u=X(),l=null,d=null,p=null,f=null,_=null,h=null,m=null,g=null;s.position.x+=c.direction*c.speed*u;var v=Zn(s,2,-2,a,l,d,p,f,_,h,m,g);l=v.up,d=v.upright,p=v.right,f=v.downright,_=v.down,h=v.downleft,m=v.left,g=v.upleft;var b=na(s,-2,l,d,p,f,_,h,m,g);l=b.up,d=b.upright,p=b.right,f=b.downright,_=b.down,h=b.downleft,m=b.left,g=b.upleft,null!=p&&c.direction>0&&(s.position.x=s.hot_spot.x-$n(s).width+p.x,c.direction=-1),null!=m&&c.direction<0&&(s.position.x=s.hot_spot.x+m.x+Ln(m).width,c.direction=1),null!=_&&(null==f&&null!=h?c.direction=-1:null==h&&null!=f&&(c.direction=1)),o.update(o,e,n,a,i,r)},hp=function(t,e){var n=t.decorated_machine;n.render(n,e)},mp=0,gp=[],vp=[{command:"set_animation",action:function(t,e,n){var a,i,r,o,c;return 2==e?(a=t,i=n[0],r=+n[1],(c=o={init:Yd,release:Hd,update:Wd,render:Fd,get_object_instance:Mi}).decorated_machine=a,c.anim=_n(i,r),t=o):E("Object script error - set_animation expects two parameters: sprite_name, animation_id"),t}},{command:"set_obstacle",action:function(t,e,n){return 1==e?t=zd(t,+n[0],0):2==e?t=zd(t,+n[0],+n[1]):E("Object script error - set_obstacle expects at least one and at most two parameters: is_obstacle (TRUE or FALSE) [, angle]"),t}},{command:"set_alpha",action:function(t,e,n){return 1==e?t=Cd(t,+n[0]):E("Object script error - set_alpha expects one parameter: alpha (0.0 (transparent) <= alpha <= 1.0 (opaque))"),t}},{command:"hide",action:function(t,e,n){return 0==e?t=Cd(t,0):E("Object script error - hide expects no parameters"),t}},{command:"show",action:function(t,e,n){return 0==e?t=Cd(t,1):E("Object script error - show expects no parameters"),t}},{command:"enemy",action:function(t,e,n){return 1==e?t=function(t,e){var n={init:Ru,release:Au,update:Lu,render:Nu,get_object_instance:Mi},a=n;return a.decorated_machine=t,a.score=e,n}(t,+n):E("Object script error - enemy expects one parameter: score"),t}},{command:"lock_camera",action:function(t,e,n){var a,i,r,o,c,s,u;return 4==e?(a=t,i=+n[0],r=+n[1],o=+n[2],c=+n[3],(u=s={init:Zu,release:tl,update:el,render:nl,get_object_instance:Mi}).decorated_machine=a,u.x1=Math.min(i,o),u.y1=Math.min(r,c),u.x2=Math.max(i,o),u.y2=Math.max(r,c),t=s):E("Object script error - lock_camera expects four parameters: x1, y1, x2, y2"),t}},{command:"move_player",action:function(t,e,n){var a,i,r,o,c;return 2==e?(a=t,i=+n[0],r=+n[1],(c=o={init:gl,release:vl,update:bl,render:yl,get_object_instance:Mi}).decorated_machine=a,c.speed=nt(i,r),t=o):E("Object script error - move_player expects two parameters: speed_x, speed_y"),t}},{command:"hit_player",action:function(t,e,n){return 0==e?t=Bu(t,Xu):E("Object script error - hit_player expects no parameters"),t}},{command:"burn_player",action:function(t,e,n){return 0==e?t=Bu(t,zu):E("Object script error - burn_player expects no parameters"),t}},{command:"shock_player",action:function(t,e,n){return 0==e?t=Bu(t,$u):E("Object script error - shock_player expects no parameters"),t}},{command:"acid_player",action:function(t,e,n){return 0==e?t=Bu(t,Qu):E("Object script error - acid_player expects no parameters"),t}},{command:"add_rings",action:function(t,e,n){return 1==e?t=function(t,e){var n={init:gs,release:vs,update:bs,render:ys,get_object_instance:Mi},a=n;return a.decorated_machine=t,a.rings=e,n}(t,+n[0]):E("Object script error - add_rings expects one parameter: number_of_rings"),t}},{command:"add_to_score",action:function(t,e,n){return 1==e?t=function(t,e){var n={init:xs,release:ws,update:ks,render:Es,get_object_instance:Mi},a=n;return a.decorated_machine=t,a.score=e,n}(t,+n[0]):E("Object script error - add_to_score expects one parameter: score"),t}},{command:"set_player_animation",action:function(t,e,n){var a,i,r,o,c;return 2==e?(a=t,i=n[0],r=+n[1],(c=o={init:qd,release:Jd,update:Zd,render:tp,get_object_instance:Mi}).decorated_machine=a,c.anim=_n(i,r),t=o):E("Object script error - set_player_animation expects two parameters: sprite_name, animation_id"),t}},{command:"enable_player_movement",action:function(t,e,n){return 0==e?t=Od(t,!0):E("Object script error - enable_player_movement expects no parameters"),t}},{command:"disable_player_movement",action:function(t,e,n){0==e?t=Od(t,!1):E("Object script error - disable_player_movement expects no parameters")}},{command:"set_player_xspeed",action:function(t,e,n){var a,i;return 1==e?(a=t,i=+n[0],t=up(a,i,lp)):E("Object script error - set_player_xspeed expects one parameter: speed"),t}},{command:"set_player_yspeed",action:function(t,e,n){var a,i;return 1==e?(a=t,i=+n[0],t=up(a,i,dp)):E("Object script error - set_player_yspeed expects one parameter: speed"),t}},{command:"set_player_position",action:function(t,e,n){var a,i,r,o,c;return 2==e?(a=t,i=+n[0],r=+n[1],(c=o={init:ep,release:np,update:ap,render:ip,get_object_instance:Mi}).decorated_machine=a,c.offset=nt(i,r),t=o):E("Object script error - set_player_position expects two parameters: xpos, ypos"),t}},{command:"bounce_player",action:function(t,e,n){var a;return 0==e?((a={init:Hs,release:Ws,update:Fs,render:Xs,get_object_instance:Mi}).decorated_machine=t,t=a):E("Object script error - bounce_player expects no parameters"),t}},{command:"observe_player",action:function(t,e,n){var a,i,r;return 1==e?(a=t,i=n[0],r=a.get_object_instance(a),t=xl(a,wl(i,r,Tl))):E("Object script error - observe_player expects one parameter: player_name"),t}},{command:"observe_current_player",action:function(t,e,n){var a,i;return 0==e?(i=(a=t).get_object_instance(a),t=xl(a,wl("foo",i,jl))):E("Object script error - observe_current_player expects no parameters"),t}},{command:"observe_active_player",action:function(t,e,n){var a,i;return 0==e?(i=(a=t).get_object_instance(a),t=xl(a,wl("bar",i,Il))):E("Object script error - observe_active_player expects no parameters"),t}},{command:"observe_all_players",action:kp},{command:"observe_next_player",action:kp},{command:"attach_to_player",action:function(t,e,n){return 0==e?t=Ss(t,0,0):1==e?t=Ss(t,+n[0],0):2==e?t=Ss(t,+n[0],+n[1]):E("Object script error - attach_to_player expects at most two parameters: [offset_x [, offset_y]]"),t}},{command:"springfy_player",action:function(t,e,n){return 0==e?t=Ed(t,Id):E("Object script error - springfy_player expects no parameters"),t}},{command:"roll_player",action:function(t,e,n){return 0==e?t=Ed(t,Dd):E("Object script error - roll_player expects no parameters"),t}},{command:"walk",action:function(t,e,n){var a,i,r;return 1==e?(a=+n,(r=i={init:pp,release:fp,update:_p,render:hp,get_object_instance:Mi}).decorated_machine=t,r.speed=a,t=i):E("Object script error - walk expects one parameter: speed"),t}},{command:"gravity",action:function(t,e,n){var a;return 0==e?((a={init:Cu,release:Gu,update:Pu,render:Uu,get_object_instance:Mi}).decorated_machine=t,t=a):E("Object script error - gravity expects no parameters"),t}},{command:"jump",action:function(t,e,n){var a,i,r,o;return 1==e?(a=t,i=+n[0],(o=r={init:Vu,release:Ku,update:qu,render:Ju,get_object_instance:Mi}).decorated_machine=a,o.jump_strength=i,t=r):E("Object script error - jump expects one parameter: jump_strength"),t}},{command:"move",action:Ep},{command:"bullet_trajectory",action:Ep},{command:"elliptical_trajectory",action:function(t,e,n){var a,i,r,o,c,s,u,l,d;return e>=4&&e<=6?(a=t,i=+n[0],r=+n[1],o=+n[2],c=+n[3],s=+n[4],u=+n[5],(d=l={init:ju,release:Iu,update:Du,render:Ou,get_object_instance:Mi}).decorated_machine=a,d.amplitude_x=i,d.amplitude_y=r,d.angularspeed_x=o*(2*m),d.angularspeed_y=c*(2*m),d.initialphase_x=s*m/180,d.initialphase_y=u*m/180,t=l):E("Object script error - elliptical_trajectory expects at least four and at most six parameters: amplitude_x, amplitude_y, angularspeed_x, angularspeed_y [, initialphase_x [, initialphase_y]]"),t}},{command:"mosquito_movement",action:function(t,e,n){var a,i,r;return 1==e?(a=+n,(r=i={init:fl,release:_l,update:hl,render:ml,get_object_instance:Mi}).decorated_machine=t,r.speed=a,t=i):E("Object script error - mosquito_movement expects one parameter: speed"),t}},{command:"look_left",action:function(t,e,n){return 0==e?t=il(t,ul):E("Object script error - look_left expects no parameters"),t}},{command:"look_right",action:function(t,e,n){return 0==e?t=il(t,ll):E("Object script error - look_right expects no parameters"),t}},{command:"look_at_player",action:function(t,e,n){return 0==e?t=il(t,dl):E("Object script error - look_at_player expects no parameters"),t}},{command:"look_at_walking_direction",action:function(t,e,n){return 0==e?t=il(t,pl):E("Object script error - look_at_walking_direction expects no parameters"),t}},{command:"create_item",action:function(t,e,n){var a,i,r,o,c,s;return 3==e?(a=t,i=+n[0],r=+n[1],o=+n[2],(s=c={init:fu,release:_u,update:hu,render:mu,get_object_instance:Mi}).decorated_machine=a,s.item_id=i,s.offset=nt(r,o),t=c):E("Object script error - create_item expects three parameters: item_id, offset_x, offset_y"),t}},{command:"change_closest_object_state",action:function(t,e,n){var a,i,r,o,c;return 2==e?(a=t,i=n[0],r=n[1],(c=o={init:Ks,release:qs,update:Js,render:Zs,get_object_instance:Mi}).decorated_machine=a,c.object_name=i,c.new_state_name=r,t=o):E("Object script error - change_closest_object_state expects two parameters: object_name, new_state_name"),t}},{command:"create_child",action:function(t,e,n){return 3==e?t=eu(t,n[0],+n[1],+n[2],""):4==e?t=eu(t,n[0],+n[1],+n[2],n[3]):E("Object script error - create_child expects three or four parameters: object_name, offset_x, offset_y [, child_name]"),t}},{command:"change_child_state",action:function(t,e,n){var a,i,r,o,c;return 2==e?(a=t,i=n[0],r=n[1],(c=o={init:nu,release:au,update:iu,render:ru,get_object_instance:Mi}).decorated_machine=a,c.strategy=cu,c.offset=nt(0,0),c.object_name=null,c.child_name=i,c.new_state_name=r,t=o):E("Object script error - change_child_state expects two parameters: child_name, new_state_name"),t}},{command:"change_parent_state",action:function(t,e,n){var a,i,r,o;return 1==e?(a=t,i=n[0],(o=r={init:nu,release:au,update:iu,render:ru,get_object_instance:Mi}).decorated_machine=a,o.strategy=su,o.offset=nt(0,0),o.object_name=null,o.child_name=null,o.new_state_name=i,t=r):E("Object script error - change_parent_state expects one parameter: new_state_name"),t}},{command:"destroy",action:function(t,e,n){var a;return 0==e?((a={init:gu,release:vu,update:bu,render:yu,get_object_instance:Mi}).decorated_machine=t,t=a):E("Object script error - destroy expects no parameters"),t}},{command:"change_state",action:function(t,e,n){return 1==e?t=Ol(t,0,n[0]):E("Object script error - change_state expects one parameter: new_state_name"),t}},{command:"on_timeout",action:function(t,e,n){return 2==e?t=Ol(t,+n[0],n[1]):E("Object script error - on_timeout expects two parameters: timeout (in seconds), new_state_name"),t}},{command:"on_collision",action:function(t,e,n){var a,i,r;return 2==e?(a=t,i=n[0],r=n[1],t=Rl(a,r,function(t){var e={init:Yl,release:Hl,should_trigger_event:Wl};return e.target_name=t,e}(i))):E("Object script error - on_collision expects two parameters: object_name, new_state_name"),t}},{command:"on_animation_finished",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Rl(a,i,{init:Fl,release:Xl,should_trigger_event:zl})):E("Object script error - on_animation_finished expects one parameter: new_state_name"),t}},{command:"on_random_event",action:function(t,e,n){var a,i,r;return 2==e?(a=t,i=+n[0],r=n[1],t=Rl(a,r,function(t){var e={init:$l,release:Ql,should_trigger_event:Vl};return e.probability=Math.min(t,0,1),e}(i))):E("Object script error - on_random_event expects two parameters: probability (0.0 <= probability <= 1.0), new_state_name"),t}},{command:"on_player_collision",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Rl(a,i,{init:Kl,release:ql,should_trigger_event:Jl})):E("Object script error - on_player_collision expects one parameter: new_state_name"),t}},{command:"on_player_attack",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Rl(a,i,{init:Zl,release:td,should_trigger_event:ed})):E("Object script error - on_player_attack expects one parameter: new_state_name"),t}},{command:"on_player_rect_collision",action:function(t,e,n){var a,i,r,o,c,s;return 5==e?(a=t,i=+n[0],r=+n[1],o=+n[2],c=+n[3],s=n[4],t=Rl(a,s,function(t,e,n,a){var i={init:nd,release:ad,should_trigger_event:id},r=i;return r.x1=Math.min(t,n),r.y1=Math.min(e,a),r.x2=Math.max(t,n),r.y2=Math.max(e,a),i}(i,r,o,c))):E("Object script error - on_player_rect_collision expects five parameters: offset_x1, offset_y1, offset_x2, offset_y2, new_state_name"),t}},{command:"on_no_shield",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Rl(a,i,rd(0))):E("Object script error - on_no_shield expects one parameter: new_state_name"),t}},{command:"on_shield",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Rl(a,i,rd(Wc))):E("Object script error - on_shield expects one parameter: new_state_name"),t}},{command:"on_fire_shield",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Rl(a,i,rd(Fc))):E("Object script error - on_fire_shield expects one parameter: new_state_name"),t}},{command:"on_thunder_shield",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Rl(a,i,rd(Xc))):E("Object script error - on_thunder_shield expects one parameter: new_state_name"),t}},{command:"on_water_shield",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Rl(a,i,rd(zc))):E("Object script error - on_water_shield expects one parameter: new_state_name"),t}},{command:"on_acid_shield",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Rl(a,i,rd($c))):E("Object script error - on_acid_shield expects one parameter: new_state_name"),t}},{command:"on_wind_shield",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Rl(a,i,rd(Qc))):E("Object script error - on_wind_shield expects one parameter: new_state_name"),t}},{command:"on_brick_collision",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Rl(a,i,{init:ud,release:ld,should_trigger_event:dd})):E("Object script error - on_brick_collision expects one parameter: new_state_name"),t}},{command:"on_floor_collision",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Rl(a,i,{init:pd,release:fd,should_trigger_event:_d})):E("Object script error - on_floor_collision expects one parameter: new_state_name"),t}},{command:"on_ceiling_collision",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Rl(a,i,{init:hd,release:md,should_trigger_event:gd})):E("Object script error - on_ceiling_collision expects one parameter: new_state_name"),t}},{command:"on_left_wall_collision",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Rl(a,i,{init:vd,release:bd,should_trigger_event:yd})):E("Object script error - on_left_wall_collision expects one parameter: new_state_name"),t}},{command:"on_right_wall_collision",action:function(t,e,n){var a,i;return 1==e?(a=t,i=n[0],t=Rl(a,i,{init:xd,release:wd,should_trigger_event:kd})):E("Object script error - on_right_wall_collision expects one parameter: new_state_name"),t}},{command:"show_dialog_box",action:function(t,e,n){return 2==e?t=function(t,e,n){return xu(t,e,n,Mu)}(t,n[0],n[1]):E("Object script error - show_dialog_box expects two parameters: title, message"),t}},{command:"hide_dialog_box",action:function(t,e,n){return 0==e?t=xu(t,"dead","beef",Tu):E("Object script error - hide_dialog_box expects no parameters"),t}},{command:"clear_level",action:function(t,e,n){var a;return 0==e?((a={init:uu,release:lu,update:du,render:pu,get_object_instance:Mi}).decorated_machine=t,t=a):E("Object script error - clear_level expects no parameters"),t}},{command:"play_sample",action:function(t,e,n){return 1==e?t=Ds(t,n[0],1,0,1,!1):2==e?t=Ds(t,n[0],+n[1],0,1,!1):3==e?t=Ds(t,n[0],+n[1],+n[2],1,!1):4==e||5==e?t=Ds(t,n[0],+n[1],+n[2],+n[3],!1):E("Object script error - play_sample expects at least one and at most five parameters: sound_name [, volume [, pan [, frequency [, loops]]]]"),t}},{command:"play_music",action:function(t,e,n){var a,i;return 1==e||2==e?(a=t,i=n[0],t=Ns(a,Ps(i,!1))):E("Object script error - play_music expects at least one and at most two parameters: music_name [, loops]"),t}},{command:"play_level_music",action:function(t,e,n){return 0==e?t=Ns(t,{update:Bs,mus:null,loop:!0}):E("Object script error - play_level_music expects no parameters"),t}},{command:"set_music_volume",action:function(t,e,n){var a,i;return 1==e?(a=t,i=+n[0],t=Ns(a,function(t){return{update:Ys,vol:q(t,0,1)}}(i))):E("Object script error - set_music_volume expects one parameter: volume"),t}},{command:null,action:null}],bp=function(t,e){return function(t,e){var n,a,i,r=e;if(0===r.state){var o=t.state.name;for(r.state,r.vm.state_list=(a=r.vm,i=t.state.list[0][0],null==Si(a.state_list,i)&&(a.state_list=function(t,e,n){var a,i;return{name:e,data:(a=n,i={init:gi,release:vi,update:bi,render:yi,get_object_instance:xi},i.object=a,i),next:t}}(a.state_list,i,a.owner)),a.state_list),r.vm=ki(r.vm,o),n=wi(r.vm),mp=0,function(t,e){mp<1024?(gp[mp]={stmt:t,machine:e},mp++):k("Object script error: you may write ".concat(1024," commands or less per state"))}(t.state.list,n);mp-- >0;)n=yp(gp[mp].stmt,gp[mp].machine);n&&n.init(n)}return r.vm.reference_to_current_state=n,t.destroy_if_far_from_play_area&&(r.preserve=!1),t.always_active&&(r.always_active=!0),t.hide_unless_in_editor_mode&&(r.hide_unless_in_editor_mode=!0),r}(e,t)};function yp(t,e){var n,a,i,r,o=t;for(a=o.length,n=0;n<a;n++)r=(i=o[n])[1]&&void 0!==i[1]?i[1].length?i[1].length:1:0,e=wp(e,i[0],r,i[1]);return e}function xp(t,e,n,a){return t(e,n,a)}function wp(t,e,n,a){for(var i=0,r=vp[i++];null!=r.command&&null!=r.action;)r.command==e&&(t=xp(r.action,t,n,a)),r=vp[i++];return t}function kp(t,e,n){var a,i;return 0==e?(i=(a=t).get_object_instance(a),t=xl(a,wl("boo",i,Dl))):E("Object script error - observe_all_players expects no parameters"),t}function Ep(t,e,n){var a,i,r,o,c;return 2==e?(a=t,i=+n[0],r=+n[1],(c=o={init:zs,release:$s,update:Qs,render:Vs,get_object_instance:Mi}).decorated_machine=a,c.speed=nt(i,r),t=o):E("Object script error - bullet_trajectory expects two parameters: speed_x, speed_y"),t}var Sp;!function(t){t[t.ES_IDLE=0]="ES_IDLE",t[t.ES_DEAD=1]="ES_DEAD"}(Sp||(Sp={}));var Mp,Tp=Sp.ES_IDLE,jp=Sp.ES_DEAD,Ip=null,Dp=[],Op=function(t){return Wp(t)},Rp=function(t){if(!t)return null;for(var e=t.children;e;e=e.next)e.data.parent=null;var n;return zp(t.children),null!=t.parent&&Pp(t.parent,t),(n=t.vm).state_list=Ei(n.state_list),n.reference_to_current_state=null,n.owner=null,Wn(t.actor),null},Ap=function(t,e,n,a,i,r){if(t){var o=wi(t.vm);o.update(o,e,n,a,i,r)}},Lp=function(t,e){if(t){var n=wi(t.vm);(!t.hide_unless_in_editor_mode||t.hide_unless_in_editor_mode&&Lh())&&n.render(n,e)}},Np=function(t){return t.parent},Cp=function(t,e){return Vp(t.children,e)},Gp=function(t,e,n){t.children=$p(t.children,e,n),n.parent=t,n.created_from_editor=!1},Pp=function(t,e){t.children=Qp(t.children,e)},Up=function(t){return null!=t.observed_player?t.observed_player:Nh()},Bp=function(t,e){t.observed_player=e},Yp=function(t){t.observed_player=Nh()},Hp=function(t){t.observed_player=null},Wp=function(t){var e={in_object_name:null,out_object_block:null},n={name:t,state:Tp,actor:Hn(),preserve:!0,obstacle:!1,obstacle_angle:0,always_active:!1,hide_unless_in_editor_mode:!1,vm:null,created_from_editor:!0,parent:null,children:Xp(),observed_player:null};return n.actor.input=xe(),Vn(n.actor,_n("SD_QUESTIONMARK",0)),n.vm={owner:n,state_list:null,reference_to_current_state:null},e.in_object_name=t,e.out_object_block=null,e.out_object_block=Fp(Ip,e),null!=e.out_object_block?n=bp(n,e.out_object_block):k("Object ".concat(t," does not exist")),n},Fp=function(t,e){var n=t[e.in_object_name];return n?(e.in_object_name,n):(k("Object script error: unknown keyword ".concat(n)),0)},Xp=function(){return null},zp=function(t){return null!=t&&(zp(t.next),t.name=null,t=null),null},$p=function(t,e,n){return{name:e,data:n,next:t}},Qp=function(t,e){var n,a;if(null!=t){if(t.data==e)return a=t.next,t.name=null,t=null,a;for(n=t;null!=n.next&&n.next.data!=e;)n=n.next;return null!=n.next&&(a=n.next.next,n.next.name=null,n.next=null,n.next=a),t}return null},Vp=function(t,e){for(var n=t;null!=n;){if(n.name==e)return n.data;n=n.next}return null};!function(t){t[t.EDITORGRP_ENTITY_BRICK=0]="EDITORGRP_ENTITY_BRICK",t[t.EDITORGRP_ENTITY_ITEM=1]="EDITORGRP_ENTITY_ITEM",t[t.EDITORGRP_ENTITY_ENEMY=2]="EDITORGRP_ENTITY_ENEMY"}(Mp||(Mp={}));var Kp,qp,Jp=Mp.EDITORGRP_ENTITY_BRICK,Zp=Mp.EDITORGRP_ENTITY_ITEM,tf=(Mp.EDITORGRP_ENTITY_ENEMY,[]),ef=0,nf=function(){return ef},af=function(t){return ef>0?(t=q(t,0,ef-1),tf[t]):null},rf=function(t){return null!=t&&(t.next=rf(t.next),t=null,t=null),t};!function(t){t[t.EDT_BRICK=1]="EDT_BRICK",t[t.EDT_ITEM=2]="EDT_ITEM",t[t.EDT_ENEMY=3]="EDT_ENEMY",t[t.EDT_GROUP=4]="EDT_GROUP"}(Kp||(Kp={})),function(t){t[t.EDA_NEWOBJECT=1]="EDA_NEWOBJECT",t[t.EDA_DELETEOBJECT=2]="EDA_DELETEOBJECT",t[t.EDA_CHANGESPAWN=3]="EDA_CHANGESPAWN",t[t.EDA_RESTORESPAWN=4]="EDA_RESTORESPAWN"}(qp||(qp={}));var of,cf,sf,uf,lf,df,pf,ff,_f,hf,mf,gf,vf,bf,yf,xf,wf,kf,Ef,Sf,Mf,Tf,jf,If,Df,Of,Rf,Af,Lf,Nf,Cf,Gf,Pf,Uf,Bf,Yf,Hf,Wf,Ff,Xf,zf,$f,Qf,Vf,Kf,qf,Jf,Zf,t_,e_,n_,a_,i_,r_,o_,c_,s_,u_,l_,d_,p_,f_,__,h_,m_,g_,v_,b_,y_,x_,w_,k_,E_=Kp.EDT_BRICK,S_=Kp.EDT_ITEM,M_=Kp.EDT_ENEMY,T_=Kp.EDT_GROUP,j_=qp.EDA_NEWOBJECT,I_=qp.EDA_DELETEOBJECT,D_=qp.EDA_CHANGESPAWN,O_=qp.EDA_RESTORESPAWN,R_=function(t){return t==Jp?E_:t==Zp?S_:M_},A_=!1,L_=[38,40,39,37,78,66,17,123],N_=[87,83,68,65,90,89,71,80],C_=0,G_=0,P_=[0,1,2,3,4,5,7,6,42,78,79,80,81,16,17,18,19,20,54,48,49,50,51,52,53,21,47,22,23,43,44,45,46,55,62,56,57,58,59,60,61,24,25,Sc,Mc,28,29,30,Tc,32,33,34,jc,36,37,75,76,77,38,63,64,65,66,67,68,69,39,70,71,72,73,74,-1],U_=!1,B_=nt(0,0),Y_=function(){return t=void 0,e=void 0,a=function(){var t;return function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(e){switch(e.label){case 0:return k("editor_init()"),kf=am(),A_=!1,gf=P_.length,_f=E_,C_=0,of=St(),cf=Mt(),vf=Dp,[4,en("data/images/editorbg.png")];case 1:return t=e.sent(),sf=t,lf=we(L_),df=we(N_),uf=function(){for(var t={type:Ct.IT_MOUSE,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},e=0;e<9;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return Re(t),t}(),hf=da(8),mf=da(8),pf=_i(),function(){ef=0;for(var t=0;t<501;t++)tf[t]=null}(),eh(),k("editor_init() ok"),[2]}}))},new((n=void 0)||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}));var t,e,n,a},H_=function(){return A_},W_=function(){var t=jh();Ih(t),A(Qe("level saved"))},F_=function(){var t,e=X();t=Se(lf,Wt)?3750:750,(Se(lf,Gt)||Se(df,Gt))&&(pf.y-=t*e),(Se(lf,Pt)||Se(df,Pt))&&(pf.y+=t*e),(Se(lf,Ut)||Se(df,Ut))&&(pf.x-=t*e),(Se(lf,Bt)||Se(df,Bt))&&(pf.x+=t*e),pf.x=~~Math.max(pf.x,240),pf.y=~~Math.max(pf.y,135.5),hi(pf)},X_=function(t){switch(t){case E_:return"brick";case S_:return"built-in item";case M_:return"object";case T_:return"group"}return"unknown"},z_=function(t,e){switch(t){case E_:On(e);break;case S_:Ac(e)}return""},$_=function(){C_=0,G_=0,(_f=_f==E_?S_:_f==S_?M_:_f==M_?T_:_f==T_?E_:_f)==T_&&0==nf()&&$_()},Q_=function(){C_=0,G_=0,(_f=_f==S_?E_:_f==M_?S_:_f==T_?M_:_f==E_?T_:_f)==T_&&0==nf()&&Q_()},V_=function(){var t;switch(_f){case E_:t=Rn(),null==On(C_=(C_+1)%t)&&V_();break;case S_:C_=P_[G_=(G_+1)%(t=gf)];break;case M_:C_=(C_+1)%(t=bf);break;case T_:t=nf(),C_=(C_+1)%t}},K_=function(){var t;switch(_f){case E_:t=Rn(),null==On(C_=(C_-1+t)%t)&&K_();break;case S_:C_=P_[G_=(G_-1+(t=gf))%t];break;case M_:C_=(C_-1+(t=bf))%t;break;case T_:t=nf(),C_=(C_-1+t)%t}},q_=function(t){var e;for(e=0;e<gf;e++)if(t==P_[e])return e;return-1},J_=function(t,e,n){var a=null,i=nt(0,0);switch(t){case E_:null!=On(e)&&(a=On(e).image);break;case S_:null!=(o=Ac(e))&&(a=$n(o.actor),(i=o.actor.hot_spot).y-=2);break;case M_:var r=Op(th(e));null!=r&&(a=$n(r.actor),(i=r.actor.hot_spot).y-=2,Rp(r));break;case T_:var o=void 0;for(o=af(e);o;o=o.next){var c=R_(o.entity.type);J_(c,o.entity.id,at(n,o.entity.position))}}null!=a&&nn(a.data,Et(),a.sx,a.sy,~~n.x-i.x,~~n.y-i.y,a.swidth,a.sheight)},Z_=function(t){var e;for(e=0;e<bf;e++)if(t==vf[e])return e;return-1},th=function(t){return t=q(t,0,NaN),vf[t]},eh=function(){U_=!1},nh=function(){},ah=function(){Me(df,Wt)&&(U_=!U_)},ih=function(t){var e=it(pf,nt(240,135.5)),n=~~(e.x%1),a=~~(e.y%1),i=-n+t.x/1*1,r=-a+t.y/1*1;return at(e,nt(i,r))},rh=function(t,e,n,a){return{type:t?j_:I_,obj_type:e,obj_id:n,obj_position:a,obj_old_position:a}},oh=function(t,e,n){return{type:t?D_:O_,obj_type:null,obj_id:null,obj_position:e,obj_old_position:n}},ch=function(){xf=uh(xf),yf=null,wf=null},sh=function(t){var e,n=!1;if(t.obj_type!=T_){var a=void 0,i=void 0,r={action:t,in_group:n,group_key:null,prev:null,next:null};for(r.in_group&&(r.group_key=e),null!=(a=wf)&&(a.next=uh(a.next)),i=yf;null!=i.next;)i=i.next;i.next=r,r.prev=i,r.next=null,wf=r}else{var o=48879;for(i=void 0,n=!0,e=o++,i=af(t.obj_id);i;i=i.next){var c,s=i.entity,u=R_(s.type);c=rh(!0,u,s.id,at(s.position,t.obj_position)),sh(c)}n=!1}},uh=function(t){var e,n;for(e=t;null!=e;)n=e.next,e=null,e=n;return null},lh=function(){var t,e;wf!=xf&&(t=wf,wf=wf.prev,t.in_group&&t.prev&&t.prev.in_group&&t.group_key==t.prev.group_key&&lh(),(e=t.action).type=e.type==j_?I_:e.type==I_?j_:e.type==D_?O_:e.type==O_?D_:e.type,ph(e))},dh=function(){var t,e;null!=wf.next&&((t=wf=wf.next).in_group&&t.next&&t.next.in_group&&t.group_key==t.next.group_key&&dh(),e=t.action,ph(e))},ph=function(t){if(t.type==j_)switch(t.obj_type){case E_:Kh(t.obj_id,t.obj_position);break;case S_:qh(t.obj_id,t.obj_position);break;case M_:Jh(th(t.obj_id),t.obj_position);break;case T_:var e=void 0;for(e=af(t.obj_id);e;e=e.next){var n,a=e.entity,i=R_(a.type);n=rh(!0,i,a.id,at(a.position,t.obj_position)),ph(n)}}else if(t.type==I_)switch(t.obj_type){case E_:e=void 0;var r=On(t.obj_id);for(e=kf;e;e=e.next)e.data.brick_ref==r&&ot(it(nt(e.data.x,e.data.y),t.obj_position))<p&&(e.data.state=1);break;case S_:e=void 0;var o=t.obj_id;for(e=Ef;e;e=e.next)e.data.type==o&&ot(it(e.data.actor.position,t.obj_position))<p&&(e.data.state=Rc);break;case M_:for(e=void 0,o=t.obj_id,e=Sf;e;e=e.next)Z_(e.data.name)==o&&ot(it(e.data.actor.position,t.obj_position))<p&&(e.data.state=jp)}else t.type==D_?(Bh(t.obj_position),rm()):t.type==O_&&(Bh(t.obj_old_position),rm())},fh=function(t,e){mh(t,e,!0),Fn(t.actor,e),mh(t,e,!1)},_h=function(t){return 1==t.state},hh=function(t,e){var n;for(n=0;n<e.length&&1!=t.state;n++)if(e[n]&&Jn(t.actor,e[n].actor))return!(!rs(e[n])&&!e[n].invincible&&(ns(e[n]),1));return!1},mh=function(t,e,n){var a=t.actor,i=.001*z();if(3===t.type){var r=void 0,o=nt(0,0);if(hn(_n("SD_INVSTAR",0),1),1!=t.state)for(r=0;r<5;r++)o.x=a.position.x+20*Math.cos(2*m*i+2*r*m/5),o.y=a.position.y+20*Math.sin(m*i+2*r*m/5)}},gh=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},vh=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},bh=[0,1,2],yh=ut,xh="data/levels/blue_ocean_1.json",wh={position:nt(0,0)},kh=[],Eh=[],Sh=[],Mh=[],Th=function(t){xh=t,k("level_setfile('#{level}')")},jh=function(){return xh},Ih=function(t){var e,n,a,i,r,o={name:Mf,act:Of,theme:jf,bgtheme:If,grouptheme:Df,spawn_point:Bf,music:Tf,boss:null,bricklist:[],itemlist:[],enemylist:[],dialogbox:[]};if(Cm()){var c={id:Vf.type,x:Vf.actor.spawn_point.x,y:Vf.actor.spawn_point.y,rx:Vf.rect_x,ry:Vf.rect_y,rw:Vf.rect_w,rh:Vf.rect_h};o.boss=c}var s=[];for(a=Cf;a;a=a.next){var u={id:cm(a.data),xpos:a.data.x,ypos:a.data.y};s.push(u)}o.bricklist=s;var l=[];for(i=Gf;i;i=i.next)if(i.data){var d={id:i.data.type,xpos:i.data.actor.spawn_point.x,ypos:i.data.actor.spawn_point.y};l.push(d)}o.itemlist=l;var p=[];for(r=Pf;r;r=r.next)if(r.data&&r.data.created_from_editor){var f={id:~~r.data.name,xpos:r.data.actor.spawn_point.x,ypos:r.data.actor.spawn_point.y};p.push(f)}o.enemylist=p;var _=[];for(e=0,n=Mh.length;e<n;e++){var h={xpos:Mh[e].rect_x,ypos:Mh[e].rect_y,width:Mh[e].rect_w,height:Mh[e].rect_h,title:Mh[e].title,message:Mh[e].message};_.push(h)}o.dialogbox=_;var m=t.split("/");m[m.length-1],k("level_save() ok")},Dh=function(){return gh(void 0,void 0,void 0,(function(){var t;return vh(this,(function(e){switch(e.label){case 0:return yh=ut,k("level_init()"),Cf=null,Gf=null,zf=[],Rf=800,Af=Lf=0,Nf=0,w_=0,e_=!1,Wf=!1,Ff=null,n_=a_=i_=0,s_=u_=l_=0,r_=o_=!1,c_=!1,Xf=null,_m(),Y_(),[4,Gm(xh)];case 1:for(e.sent(),k("Creating players..."),t=0;t<bh.length;t++)zf[t]=qc(bh[t]);for(xm(),$f=zf[Qf=0],pi.is_locked=!1,pi.speed=0,pi.region_topleft_speed=0,pi.region_bottomright_speed=0,pi.position=pi.dest=nt(0,0),pi.region_topleft.x=pi.dest_region_topleft.x=240,pi.region_topleft.y=pi.dest_region_topleft.y=135.5,pi.region_bottomright.x=pi.dest_region_bottomright.x=Ph().x-240,pi.region_bottomright.y=pi.dest_region_bottomright.y=Ph().y-135.5,hi(nt($f.actor.position.x,$f.actor.position.y)),Lm($f.actor),us(0),Kf=!1,qf=!1,k("Loading hud..."),(Jf=Hn()).position=nt(16,7),Vn(Jf,_n("SD_MAINGUI",0)),(Zf=Hn()).position=nt(16,248),Vn(Zf,_n("SD_LIFEGUI",0)),(t_=da(0)).position=at(Zf.position,nt(32,11)),t=0;t<3;t++)kh[t]=da(2),kh[t].position=at(Jf.position,nt(42,16*t+2));for((__=Hn()).position=nt(0,-240),Vn(__,_n("SD_LEVELOP",0)),(h_=Hn()).position=nt(260,250),Vn(h_,_n("SD_LEVELACT",Of-1)),(m_=da(3)).position=nt(330,50),fa(m_,"%s",Mf.toUpperCase()),ma(m_,180),d_=da(4),p_=da(7),f_=Hn(),t=0;t<3;t++)Eh[t]=da(2),Sh[t]=Hn();return g_=!1,v_=0,(b_=Hn()).position.y=lt,Vn(b_,_n("SD_DIALOGBOX",0)),y_=da(8),x_=da(8),[2]}}))}))},Oh=function(){var t,e;Nf+=X();var n,a,i,r,o,c,s,u,l,d,_=!1,h=!1,g=!1,v=X();if(Om(),Im(),Dm(),H_())!function(){kf||(kf=am());var t,e,n=hn(_n("SD_ARROW",0),0),a=ha(hf).x,i=ha(hf).y,r=it(pf,nt(240,135.5));if(Se(lf,Wt)&&Me(lf,Ft)&&W_(),Se(lf,Ft))return k("editor_disable()"),ch(),A_=!1,Dt(of,cf,Tt()),void k("editor_disable() ok");if(Se(lf,Wt)?((Me(lf,Yt)||Me(uf,Pt))&&$_(),(Me(lf,Ht)||Me(uf,Gt))&&Q_()):((Me(lf,Yt)||Me(uf,Pt))&&V_(),(Me(lf,Ht)||Me(uf,Gt))&&K_()),ff.x=q(Oe(uf).x,0,ut-n.width),ff.y=q(Oe(uf).y,0,lt-n.height),Me(uf,Yt)&&Se(lf,Wt)){var o=ih(ff),c=oh(!0,o,B_);ph(c),sh(c)}if(Me(uf,Yt)&&!Se(lf,Wt)&&(c=rh(!0,_f,C_,ih(ff)),ph(c),sh(c)),t=Me(uf,Wt),e=Me(uf,Ht),t||e){var s=void 0,u=void 0,l=void 0;switch(_f){case E_:for(s=kf;s;s=s.next){var d=[s.data.x,s.data.y,s.data.x+s.data.brick_ref.image.width,s.data.y+s.data.brick_ref.image.height],p=[ff.x+r.x,ff.y+r.y,ff.x+r.x+1,ff.y+r.y+1];if(J(d,p)){if(!t){c=rh(!1,E_,im(s.data),nt(s.data.x,s.data.y)),ph(c),sh(c);break}C_=im(s.data)}}break;case S_:for(u=Ef;u;u=u.next)if(d=[u.data.actor.position.x-u.data.actor.hot_spot.x,u.data.actor.position.y-u.data.actor.hot_spot.y,u.data.actor.position.x-u.data.actor.hot_spot.x+$n(u.data.actor).width,u.data.actor.position.y-u.data.actor.hot_spot.y+$n(u.data.actor).height],p=[ff.x+r.x,ff.y+r.y,ff.x+r.x+1,ff.y+r.y+1],J(d,p)){if(!t){c=rh(!1,S_,u.data.type,u.data.actor.position),ph(c),sh(c);break}var f=q_(u.data.type);f>=0&&(G_=f,C_=P_[f])}break;case M_:for(l=Sf;l;l=l.next){d=[l.data.actor.position.x-l.data.actor.hot_spot.x,l.data.actor.position.y-l.data.actor.hot_spot.y,l.data.actor.position.x-l.data.actor.hot_spot.x+$n(l.data.actor).width,l.data.actor.position.y-l.data.actor.hot_spot.y+$n(l.data.actor).height],p=[ff.x+r.x,ff.y+r.y,ff.x+r.x+1,ff.y+r.y+1];var _=Z_(l.data.name);if(_>=0&&J(d,p)){if(!t){c=rh(!1,M_,_,l.data.actor.position),ph(c),sh(c);break}C_=_}}}}Se(lf,Wt)&&(Me(df,Yt)?lh():Me(df,Ht)&&dh()),ah(),F_(),fa(hf,"%d,%d",ih(ff).x,ih(ff).y),hf.position.x=q(~~ff.x,10,ut-a*_a(hf).length-10),hf.position.y=q(~~ff.y-3*i,10,261),mf.position=nt(10,10),_f!=M_?fa(mf,"<color=ffff00>%s %d</color>\n%s",X_(_f),C_,z_(_f,C_)):fa(mf,'<color=ffff00>%s "%s"</color>\n%s',X_(_f),th(C_),z_(_f,C_))}();else{for(g=Nf<5,t=0;t<zf.length&&!g;t++)zf[t]&&(g=zf[t].dead);if($f&&$f.actor&&Me($f.actor.input,Ft)&&!g){var b=[];return Yf.pause(),b[0]=Be("CBOX_QUIT_QUESTION"),b[1]=Be("CBOX_QUIT_OPTION1"),b[2]=Be("CBOX_QUIT_OPTION2"),u=b[0],l=b[1],d=b[2],Ta=-1,Jt=u,Sa[0]=l,d?(Sa[1]=d,Ma=2):Ma=1,void Fe(By(Ly))}if(1==(e=La())?Wf=!0:2==e&&T(Yf,!0),Wf)return bt()?(Xe(),void Bg()):void vt(rn(0,0,0),1);if(Me(lf,Xt))return k("editor_enable()"),yf=xf={action:null,in_group:!1,group_key:null,prev:null,next:null},wf=xf,A_=!0,pf.x=~~_i().x,pf.y=~~_i().y,ff=nt(240,135.5),of=St(),cf=Mt(),Dt(3,!1,Tt()),void k("editor_enable() ok");for(h=Nf<5,t=0;t<zf.length&&!h;t++)h=zf[t].dying||zf[t].dead;if($f&&Me($f.actor.input,Wt)&&!h)return $f.spin_dash=$f.braking=!1,null==S||S.paused||S.pause(),void Fe(By(jy));Vn(Jf,_n("SD_MAINGUI",os()>0?0:1)),Vn(Zf,_n("SD_LIFEGUI",Qf)),fa(t_,"%d",cs()),fa(kh[0],"%d",ss());var y=~~(Nf/60),x=~~(Nf%60),w=x<10?"0"+x:x;if(fa(kh[1],"%s",y+":"+w),fa(kh[2],"%d",os()),__&&(Nf<5?Nf<1.5?(__.position.y+=360*v,__.position.y>-2&&(__.position.y=-2),m_.position.x-=320*v,m_.position.x<140&&(m_.position.x=140),h_.position.y-=200*v,h_.position.y<200&&(h_.position.y=200)):Nf>3.5&&(__.position.x-=320*v):(__.visible=!1,m_.visible=!1,h_.visible=!1)),e_){var E=0,M=z(),O=Qe("ring count"),R=Qe("cash"),L=Qe("glasses");if(M>=n_+2e3){for(t=0;t<zf.length;t++)zf[t]&&(zf[t].actor.speed.x=0);for(d_.position.x=Math.min(d_.position.x+800*v,30),p_.position.x=Math.min(p_.position.x+700*v,12),f_.position.x=Math.max(f_.position.x-700*v,250),t=0;t<3;t++)Sh[t].position.x=Math.min(Sh[t].position.x+(400-50*t)*v,50),Eh[t].position.x=Math.max(Eh[t].position.x-(400-50*t)*v,230);E=l_-(s_+u_),fa(Eh[0],"%d",~~s_),fa(Eh[1],"%d",~~u_),fa(Eh[2],"%d",~~E),c_||(j(),A(Qe("goal")),c_=!0)}if(M>=n_+6e3&&!r_)if(s_=Math.max(0,s_-400*v),u_=Math.max(0,u_-2e3*v),s_>0||u_>0)O&&M>=i_&&(i_=M+100,A(O));else for(r_=!0,a_=M+4e3,A(R),t=0;t<zf.length;t++)if(zf[t].got_glasses){A(L);break}r_&&M>=a_&&(o_=!0)}for(bm(),vm(),_=!1,t=0;t<zf.length;t++)zf[t].dying&&(_=!0);for(o=Tm(),n=Sm(),a=null,Ua(Xf),c=Gf;c;c=c.next)if(c.data&&c.data.actor){var N=c.data.actor.position.x,C=c.data.actor.position.y,G=$n(c.data.actor).width,P=$n(c.data.actor).height;if(Nm(N,C,G,P,yh)){if(Lc(c.data,zf,3,n,Gf,Pf),c.data.obstacle){var U=1,B=at(c.data.actor.hot_spot,nt(0,-U)),Y=$n(c.data.actor);(H=wm(Y.width,Y.height-U,it(c.data.actor.position,B),0)).brick_ref.zindex=c.data.bring_to_back?.4:.5,a={next:a,data:H},n={next:n,data:H}}}else c.data.preserve||(c.data.state=Rc)}for(s=Pf;s;s=s.next)if(s.data)if(N=s.data.actor.position.x,C=s.data.actor.position.y,G=$n(s.data.actor).width,P=$n(s.data.actor).height,Nm(N,C,G,P,yh)||s.data.always_active){if($f&&$f.actor&&$f.actor.input.enabled&&(_||e_||Ap(s.data,zf,zf.length,n,o,Pf)),s.data.obstacle){var H;U=1,B=at(s.data.actor.hot_spot,nt(0,-U)),Y=$n(s.data.actor),a={next:a,data:H=wm(Y.width,Y.height-U,it(s.data.actor.position,B),s.data.obstacle_angle)},n={next:n,data:H}}}else s.data.preserve?Nm(s.data.actor.spawn_point.x,s.data.actor.spawn_point.y,G,P,yh)||(s.data.actor.position=nt(s.data.actor.spawn_point.x,s.data.actor.spawn_point.y)):s.data.state=jp;if(Cm()&&$f&&$f.actor){var W,F=[(W=$f.actor).position.x,W.position.y,W.position.x+1,W.position.y+1],$=[Vf.rect_x,Vf.rect_y,Vf.rect_x+Vf.rect_w,Vf.rect_y+Vf.rect_h];if(_||function(t,e,n){var a=t.actor,i=null,r=null,o=null,c=null,s=null,u=null,l=null,d=null,p=[],f=Zn(a,2,-2,n,i,r,o,c,s,u,l,d);i=f.up,r=f.upright,o=f.right,c=f.downright,s=f.down,u=f.downleft,l=f.left,d=f.upleft;var _=na(a,-2,i,r,o,c,s,u,l,d);if(i=_.up,r=_.upright,o=_.right,c=_.downright,s=_.down,u=_.downleft,l=_.left,d=_.upleft,p[0]=i,p[1]=r,p[2]=o,p[3]=c,p[4]=s,p[5]=u,p[6]=l,p[7]=d,Xh())switch(t.hp<=0&&1!=t.state&&(zh(),t.state=1),t.type){case 0:!function(t,e,n,a){var i=Nh(),r=.001*z(),o=t.actor,c=t.value[0],s=t.value[1];if(1==t.state){if(t.bring_to_front=!0,Vn(o,_n("SD_SIMPLEBOSS",2)),o.position.y+=100*X(),r>=s+.15){var u=nt(o.position.x-o.hot_spot.x+K($n(o).width),o.position.y-o.hot_spot.y+K($n(o).height));qh(Ec,u),o.position.y<=o.spawn_point.y+406.5&&A(Qe("boss hit")),s=r}}else o.maxspeed=200-100/t.initial_hp*t.hp,o.acceleration=o.maxspeed,o.position.x<o.spawn_point.x-200&&(t.direction=1),o.position.x>o.spawn_point.x&&(t.direction=3),1==t.direction?je(o.input,Bt):3==t.direction&&je(o.input,Ut),o.position.y=o.spawn_point.y+20*Math.cos(m*r),o.mirror=1==t.direction?0:1,zn(o,ia(o)),r>=c+2/t.initial_hp*t.hp&&(Jh(["0","3"][K(2)],o.position).actor.speed.y=-150-K(50),c=r),hh(t,e)&&o.animation==_n("SD_SIMPLEBOSS",0)&&(Vn(o,_n("SD_SIMPLEBOSS",1)),A(Qe("boss hit")),i.actor.speed.x*=-1,i.actor.speed.y=100,t.hp--),Kn(o)&&Vn(o,_n("SD_SIMPLEBOSS",0)),t.value[0]=c,t.value[1]=s}(t,e);break;case 1:!function(t,e,n,a){var i,r=Nh(),o=t.actor,c=.001*z(),s=X(),u=t.value[0],l=t.value[1],d=t.value[2];switch(t.state){case 0:if(t.direction=r.actor.position.x<o.position.x?3:1,o.position.y=o.spawn_point.y+30*Math.cos(m*c),Kn(o)&&Vn(o,_n("SD_MECHASHADOW",0)),c>=u+5){var p,f=nt(r.actor.position.x-o.position.x,r.actor.position.y-o.position.y);f=rt(st(f),200),p=qh(40,o.position),mr(p,f),A(Qe("big shot")),u=c}if(c>=l+15){var _=t.rect_x+t.rect_w/2;t.direction=o.position.x>_?3:1,Vn(o,_n("SD_MECHASHADOW",2)),t.state=2,l=c}break;case 2:var h=t.rect_x+100,g=t.rect_x+t.rect_w-100,v=g-h+(o.position.x-h),b=3==t.direction?-1:1;o.position.x+=200*b*s,o.position.y=o.spawn_point.y-100*Math.sin(m/(g-h)*v),Kn(o)&&Vn(o,_n("SD_MECHASHADOW",2)),(-1==b&&o.position.x<=h||1==b&&o.position.x>=g)&&(Vn(o,_n("SD_MECHASHADOW",0)),t.state=0);break;case 1:if(t.bring_to_front=!0,Vn(o,_n("SD_MECHASHADOW",4)),o.position.y+=100*X(),c>=d+.15){var y=nt(o.position.x-o.hot_spot.x+K($n(o).width),o.position.y-o.hot_spot.y+K($n(o).height));qh(Ec,y),o.position.y<=o.spawn_point.y+406.5&&A(Qe("boss hit")),d=c}}i=o.animation==_n("SD_MECHASHADOW",1)||o.animation==_n("SD_MECHASHADOW",3),hh(t,e)&&!i&&1!=t.state&&(o.animation=_n("SD_MECHASHADOW",2==t.state?3:1),A(Qe("boss hit")),t.hp--,r.actor.speed.x*=-.5,r.actor.speed.y=r.actor.jump_strength),o.mirror=1==t.direction?0:1}(t,e);break;case 2:!function(t,e,n,a){var i=Nh(),r=.001*z(),o=t.actor,c=t.value[0],s=t.value[1],u=t.value[2];if(1==t.state){if(t.bring_to_front=!0,Vn(o,_n("SD_SIMPLEBOSS",2)),o.position.y+=100*X(),r>=s+.15){var l=nt(o.position.x-o.hot_spot.x+K($n(o).width),o.position.y-o.hot_spot.y+K($n(o).height));qh(Ec,l),o.position.y<=o.spawn_point.y+406.5&&A(Qe("boss hit")),s=r}}else o.maxspeed=200-100/t.initial_hp*t.hp,o.acceleration=o.maxspeed,o.position.x<o.spawn_point.x-200&&(t.direction=1),o.position.x>o.spawn_point.x&&(t.direction=3),1==t.direction?je(o.input,Bt):3==t.direction&&je(o.input,Ut),o.position.y=o.spawn_point.y+20*Math.cos(m*r),o.mirror=1==t.direction?0:1,zn(o,ia(o)),r>=c+2/t.initial_hp*t.hp&&(Jh(["9","6"][K(2)],o.position).actor.speed.y=-150-K(50),c=r),r>=u+3/t.initial_hp*t.hp&&(qh(41,o.position).actor.speed.y=100,A(Qe("fire")),u=r),hh(t,e)&&o.animation==_n("SD_SIMPLEBOSS",0)&&(Vn(o,_n("SD_SIMPLEBOSS",1)),A(Qe("boss hit")),i.actor.speed.x*=-1,i.actor.speed.y=100,t.hp--),Kn(o)&&Vn(o,_n("SD_SIMPLEBOSS",0)),t.value[0]=c,t.value[1]=s,t.value[2]=u}(t,e);break;case 3:!function(t,e,n,a){var i,r=Nh(),o=t.actor,c=.001*z(),s=X(),u=t.value[0],l=t.value[1],d=t.value[2],p=t.value[3];switch(t.state){case 0:if(t.direction=r.actor.position.x<o.position.x?3:1,o.position.y=o.spawn_point.y+30*Math.cos(m*c),Kn(o)&&Vn(o,_n("SD_MECHASHADOW",0)),c>=u+4){var f,_=nt(r.actor.position.x-o.position.x,r.actor.position.y-o.position.y);_=rt(st(_),200),f=qh(40,o.position),mr(f,_),A(Qe("big shot")),u=c}if(c>=l+8){var h=t.rect_x+t.rect_w/2;t.direction=o.position.x>h?3:1,Vn(o,_n("SD_MECHASHADOW",2)),t.state=2,l=c}break;case 2:var g=t.rect_x+100,v=t.rect_x+t.rect_w-100,b=v-g+(o.position.x-g),y=3==t.direction?-1:1;o.position.x+=200*y*s,o.position.y=o.spawn_point.y-100*Math.sin(m/(v-g)*b),c>=p+.2&&(qh(41,o.position).actor.speed.y=-200,A(Qe("fire")),p=c),Kn(o)&&Vn(o,_n("SD_MECHASHADOW",2)),(-1==y&&o.position.x<=g||1==y&&o.position.x>=v)&&(Vn(o,_n("SD_MECHASHADOW",0)),t.state=0);break;case 1:if(t.bring_to_front=!0,Vn(o,_n("SD_MECHASHADOW",4)),o.position.y+=100*X(),c>=d+.15){var x=nt(o.position.x-o.hot_spot.x+K($n(o).width),o.position.y-o.hot_spot.y+K($n(o).height));qh(Ec,x),o.position.y<=o.spawn_point.y+406.5&&A(Qe("boss hit")),d=c}}i=o.animation==_n("SD_MECHASHADOW",1)||o.animation==_n("SD_MECHASHADOW",3),hh(t,e)&&!i&&1!=t.state&&(o.animation=_n("SD_MECHASHADOW",2==t.state?3:1),A(Qe("boss hit")),t.hp--,r.actor.speed.x*=-.5,r.actor.speed.y=r.actor.jump_strength),o.mirror=1==t.direction?0:1,t.value[0]=u,t.value[1]=l,t.value[2]=d,t.value[3]=p}(t,e)}}(Vf,zf,Cf),!_h(Vf)&&J(F,$)&&(Kf=!0,qf=!0),!_h(Vf)){var Q=void 0;for(t=0;t<zf.length;t++)(zf[t]!=$f||$f.actor.carrying)&&((Q=zf[t].actor).position.x>Vf.rect_x-30&&Q.position.x<Vf.rect_x&&(Q.position.x=Vf.rect_x-30,Q.speed.x=0),Q.position.x>Vf.rect_x+Vf.rect_w&&Q.position.x<Vf.rect_x+Vf.rect_w+30&&(Q.position.x=Vf.rect_x+Vf.rect_w+30,Q.speed.x=0))}(_h(Vf)||$f.dying)&&(Kf=!1,Yf&&(I(D()-.5*v),D()<p&&(j(),I(1),Hf=!0)))}for(t=0;t<zf.length;t++)Ie(zf[t].actor.input);for($f&&$f.actor&&Nf>=3.5&&De($f.actor.input),t=0;t<zf.length;t++){N=zf[t].actor.position.x,C=zf[t].actor.position.y,G=$n(zf[t].actor).width,P=$n(zf[t].actor).height;var V=zf[t].actor.hot_spot.y;if(t!=Qf&&(zf[t].getting_hit&&ym(t),zf[t].dying&&(ym(t),wh!=zf[t].actor&&fi(zf[t].actor.position,0))),zf[t].dead){if(!(cs()>1))return Xe(),void Fe(By(Iy));if(bt())return ls(cs()-1),void sm();vt(rn(0,0,0),1)}if(o_){if(bt())return void Xe();vt(rn(0,0,0),1)}(Nm(N,C,G,P,yh/4)||zf[t].dying)&&(!_||zf[t].dying||zf[t].getting_hit)&&Zc(zf[t],zf,n),zf[t].actor.position.y<V&&!zf[t].dying?(zf[t].actor.position.y=V,zf[t].actor.speed.y=0):zf[t].actor.position.y>Lf-(P-V)&&Nm(N,C,G,P,yh/4)&&as(zf[t])}for(_||e_||(Nf+=X()/1e3,$f&&Me($f.actor.input,Ht)&&(!(Math.abs($f.actor.speed.y)<p)||$f.on_moveable_platform||Kf||$f.disable_movement||$f.in_locked_area?A(Qe("deny")):ym((Qf+1)%3))),Cm()&&Kf&&(W=$f.actor)&&(W.position.x<Vf.rect_x?(W.position.x=Vf.rect_x,W.speed.x=Math.max(0,W.speed.x)):W.position.x>Vf.rect_x+Vf.rect_w&&(W.position.x=Vf.rect_x+Vf.rect_w,W.speed.x=Math.min(W.speed.x,0)),W.position.y=q(W.position.y,Vf.rect_y,Vf.rect_y+Vf.rect_h)),hm(n),i=n;i;i=i.next){if(i.data&&2==i.data.brick_ref.behavior){var Z=i.data.brick_ref.image.width,tt=i.data.brick_ref.image.height,et=[i.data.x,i.data.y,i.data.x+Z,i.data.y+tt],ct=[i.data.x,i.data.y,i.data.x+Z,i.data.y+tt];for(t=0;t<zf.length;t++)if(zf[t]&&(et[0]=zf[t].actor.position.x-zf[t].actor.hot_spot.x-3,et[1]=zf[t].actor.position.y-zf[t].actor.hot_spot.y-3,et[2]=et[0]+$n(zf[t].actor).width+6,et[3]=et[1]+$n(zf[t].actor).height+6,(zf[t].spin_dash||zf[t].spin||zf[t].type==Hc)&&J(et,ct))){var dt=void 0,pt=void 0,ft=void 0,_t=void 0;for(_t=Math.max(i.data.brick_ref.behavior_arg[0],1),ft=Math.max(i.data.brick_ref.behavior_arg[1],1),dt=0;dt<_t;dt++)for(pt=0;pt<ft;pt++){var ht=nt(i.data.x+dt*Z/_t,i.data.y+pt*tt/ft),mt=nt(.3*-zf[t].actor.speed.x,-100-K(50)),gt=tn(Z/_t,tt/ft);Math.abs(mt.x)>p&&(mt.x+=(mt.x>0?1:-1)*K(50)),Zh(gt,ht,mt,!1)}A(Qe("break")),i.data.state=1}}if(i.data&&3==i.data.brick_ref.behavior&&2==i.data.state){var yt=i.data;if(yt.value[1]+=X(),yt.value[1]>=1){dt=void 0,pt=void 0,_t=void 0,ft=void 0;var xt=0!=yt.brick_ref.behavior_arg[2];for(gt=yt.brick_ref.image,_t=Math.max(yt.brick_ref.behavior_arg[0],1),ft=Math.max(yt.brick_ref.behavior_arg[1],1),dt=0;dt<_t;dt++)for(pt=0;pt<ft;pt++){var wt=nt(yt.x+dt*gt.width/_t,yt.y+pt*gt.height/ft),kt=nt(0,20+20*pt+20*(xt?dt:_t-dt)),Et=tn(gt.width/_t,gt.height/ft);Zh(Et,wt,kt,!1)}A(Qe("break")),yt.state=1}}Am(i.data)}for(i=a;i;i=r)r=i.next,Rm(i.data),i=null;if(a=null,Mm(n),jm(o),$f&&$f.actor&&Lm($f.actor),e_)fi(at(wh.position,nt(0,-90)),.17);else if(Kf){var jt=[Vf.rect_x+240,Vf.rect_x+Vf.rect_w-240],It=nt(q(wh.position.x,jt[0],jt[1]),wh.position.y);fi(at(It,nt(0,-90)),.17)}else _||wh&&fi(wh.position,.1);!function(){var t,e=X();pi.is_locked||mi(-f,-f,f,f),t=it(pi.dest,pi.position),ot(t)>10&&(t=st(t),pi.position.x+=t.x*pi.speed*e,pi.position.y+=t.y*pi.speed*e),t=it(pi.dest_region_topleft,pi.region_topleft),ot(t)>10&&(t=st(t),pi.region_topleft.x+=t.x*pi.region_topleft_speed*e,pi.region_topleft.y+=t.y*pi.region_topleft_speed*e),t=it(pi.dest_region_bottomright,pi.region_bottomright),ot(t)>10&&(t=st(t),pi.region_bottomright.x+=t.x*pi.region_bottomright_speed*e,pi.region_bottomright.y+=t.y*pi.region_bottomright_speed*e),pi.position.x=q(pi.position.x,pi.region_topleft.x,pi.region_bottomright.x),pi.position.y=q(pi.position.y,pi.region_topleft.y,pi.region_bottomright.y)}()}gm()},Rh=function(){if(xt(),H_())return e=it(pf,nt(240,135.5)),sf.width,sf.height,function(){if(U_){var t,e,n=void 0,a=void 0,i=it(pf,nt(240,135.5));for(t=tn(1,1),e=rn(0,128,160),on(t,0,0,0),n=0;n<t.height;n++)an(0,Et(),t.width-1,n,e);for(n=0;n<t.width;n++)an(0,Et(),n,t.height-1,e);for(n=0;n<=480;n++)for(a=0;a<=271;a++)it(ih(nt(n*t.width,a*t.height)),i);cn(t)}}(),nm(),J_(_f,C_,it(ih(ff),e)),t=hn(_n("SD_ARROW",0),0),nn(t.data,Et(),t.sx,t.sy,~~ff.x,~~ff.y,t.width,t.height),ga(hf,nt(240,135.5)),void ga(mf,nt(240,135.5));var t,e;Ba(Xf,_i()),um(),Ya(Xf,_i()),dm()},Ah=function(){var t;for(k("level_release()"),cn(Ff),om(),t=0;t<zf.length;t++)Jc(zf[t]);for(k("editor_release()"),nh(),function(){for(var t=0;t<ef;t++)tf[t]=rf(tf[t]);ef=0}(),Ee(df),Ee(lf),Ee(uf),pa(mf),pa(hf),A_=!1,_f=S_,C_=0,k("editor_release() ok"),Wn(Zf),Wn(Jf),pa(t_),t=0;t<zf.length;t++)pa(kh[t]);for(Wn(__),Wn(h_),pa(m_),pa(d_),pa(p_),Wn(f_),t=0;t<3;t++)pa(Eh[t]),Wn(Sh[t]);pa(y_),pa(x_),Wn(b_),k("level_release() ok")},Lh=function(){return H_()},Nh=function(){return $f},Ch=function(){return Qf},Gh=function(t){var e,n;t=Math.max(0,t),ds(ss()+t),e=qh(13,at($f.actor.position,nt(-9,0))),n=""+t,fa(e.font,n)},Ph=function(){return nt(Af,Lf)},Uh=function(t){Yf&&j(),A(t)},Bh=function(t){Bf=nt(t.x,t.y)},Yh=function(t){var e;if(!e_){for(e_=!0,n_=z(),s_=10*os(),l_+=s_,e=0;e<zf.length;e++)zf[e]&&zf[e].got_glasses&&Hh(5e3);for(ds(ss()+l_),e=0;e<zf.length;e++)zf[e]&&(Ie(zf[e].actor.input),zf[e].spin_dash=!1);for(Lm(t),Fh(),fa(d_,"TEAM SONIC"),d_.position=nt(-500,20),fa(p_,"GOT THROUGH"),p_.position=nt(-500,46),Vn(f_,_n("SD_LEVELACT",Of-1)),f_.position=nt(820,25),e=0;e<3;e++)Sh[e].position=nt(-500,120+20*e),Eh[e].position=nt(820,120+20*e);Vn(Sh[0],_n("SD_RINGBONUS",0)),Vn(Sh[1],_n("SD_SECRETBONUS",0)),Vn(Sh[2],_n("SD_TOTAL",0))}},Hh=function(t){u_+=t,l_+=t},Wh=function(t,e){(!g_||_a(y_)||_a(x_))&&(g_=!0,v_=z(),fa(y_,t),fa(x_,e),ma(x_,260))},Fh=function(){g_=!1},Xh=function(){return qf},zh=function(){var t,e;for(t=Pf;t;t=t.next)(e=t.data)&&(e.state=1)},$h=function(t,e,n,a){!function(t,e,n,a){pi.is_locked=!0,mi(t,e,n,a)}(t+240,e+135.5,n-240,a-135.5)},Qh=function(){null!=Yf&&j()},Vh=function(){return Rf},Kh=function(t,e){for(var n={brick_ref:On(t),x:e.x,y:e.y,sx:e.x,sy:e.y,enabled:!0,state:0,value:[],animation_frame:0},a=0;a<3;a++)n.value[a]=0;var i={data:n,next:null};return Em(i),i.data},qh=function(t,e){var n={data:Ac(t),next:null};return n.data.actor.spawn_point=nt(e.x,e.y),n.data.actor.position=nt(e.x,e.y),n.next=Gf,Gf=n,n.data},Jh=function(t,e){var n={data:Op(t),next:null};return n.data.actor.spawn_point=e,n.data.actor.position=e,n.next=Pf,Pf=n,n.data},Zh=function(t,e,n,a){var i={data:{image:t,position:e,speed:n,destroy_on_brick:a},next:Uf};H_()?cn(t):Uf=i},tm=function(t,e){var n,a,i,r,o,c;return t?(n=t.value[0],1===t.brick_ref.behavior?(a=t.brick_ref.behavior_arg[0],i=t.brick_ref.behavior_arg[1],r=t.brick_ref.behavior_arg[2]*(2*m),o=t.brick_ref.behavior_arg[3]*(2*m),c=t.brick_ref.behavior_arg[4]*m/180,nt(-a*r*Math.sin(r*n+c),i*o*Math.cos(o*n+c))):nt(0,0)):nt(0,0)},em=function(t){return qh(15,t)},nm=function(){um()},am=function(){return Cf},im=function(t){return cm(t)},rm=function(){xm()},om=function(){var t,e,n,a,i,r;for(k("level_unload()"),Yf.pause(),k("releasing brick list..."),t=Cf;t;t=e)e=t.next,t.data=null,t=null;for(Cf=null,k("releasing item list..."),n=Gf;n;n=a)a=n.next,n.data,n=null;for(Gf=null,k("releasing enemy list..."),i=Pf;i;i=r)r=i.next,Rp(i.data),i=null;Pf=null,Cm()&&(k("releasing the boss..."),function(t){Wn(t.actor)}(Vf),Vf=null),k("unloading the brickset..."),k("unloading the background..."),k("level_unload() ok")},cm=function(t){var e;for(e=0;e<Rn();e++)if(t.brick_ref==On(e))return e;return-1},sm=function(){var t=Bf;Ah(),Dh(),Bf=t},um=function(){for(var t,e,n,a=null,i=t=Sm();i;i=i.next)i.data&&(r=i.data.brick_ref).zindex<.5&&(An(i.data),a=Ln(i.data),Et().drawImage(a.data,a.sx,a.sy,a.swidth,a.sheight,i.data.x-(_i().x-240),i.data.y-(_i().y-135.5),1*a.width,1*a.height));for(lm(!0),i=t;i;i=i.next)if(i.data){var r=i.data.brick_ref;Math.abs(r.zindex-.5)<p&&1!=r.property&&(An(i.data),a=Ln(i.data),Et().drawImage(a.data,a.sx,a.sy,a.swidth,a.sheight,i.data.x-(_i().x-240),i.data.y-(_i().y-135.5),1*a.width,1*a.height))}for(e=Gf;e;e=e.next)e.data&&e.data.bring_to_back&&Nc(e.data,_i());for(i=t;i;i=i.next)i.data&&(r=i.data.brick_ref,Math.abs(r.zindex-.5)<p&&1==r.property&&(An(i.data),a=Ln(i.data),Et().drawImage(a.data,a.sx,a.sy,a.swidth,a.sheight,i.data.x-(_i().x-240),i.data.y-(_i().y-135.5),1*a.width,1*a.height)));for(Cm()&&!Vf.bring_to_front&&fh(Vf,_i()),n=Pf;n;n=n.next)Lp(n.data,_i());for(lm(!1),Cm()&&Vf.bring_to_front&&fh(Vf,_i()),e=Gf;e;e=e.next)e.data&&Nc(e.data,_i());for(mm(),i=t;i;i=i.next)i.data&&(r=i.data.brick_ref).zindex>.5&&(An(i.data),a=Ln(i.data),Et().drawImage(a.data,a.sx,a.sy,a.swidth,a.sheight,i.data.x-(_i().x-240),i.data.y-(_i().y-135.5),1*a.width,1*a.height));Mm(t)},lm=function(t){if($f){var e;for(e=zf.length-1;e>=0;e--)zf[e]!=$f&&!!zf[e].bring_to_back==t&&ts(zf[e],_i());!!$f.bring_to_back==t&&ts($f,_i())}},dm=function(){var t,e=nt(240,135.5);if(e_)for(Fn(f_,e),ga(d_,e),ga(p_,e),t=0;t<3;t++)Fn(Sh[t],e),ga(Eh[t],e);else{for(Fn(Jf,e),Fn(Zf,e),ga(t_,e),t=0;t<3;t++)ga(kh[t],e);pm()}Nf<2.5&&xt("rgb(0,0,0)"),Fn(__,e),Fn(h_,e),ga(m_,e),fm(e)},pm=function(){var t,e=[],n=[],a=0,i=.001*z();for(t=0;t<10;t++)n[t]=!0;if($f){switch($f.got_glasses&&(e[a++]=hn(_n("SD_ICON",6),0)),$f.shield_type){case Wc:e[a++]=hn(_n("SD_ICON",7),0);break;case Fc:e[a++]=hn(_n("SD_ICON",11),0);break;case Xc:e[a++]=hn(_n("SD_ICON",12),0);break;case zc:e[a++]=hn(_n("SD_ICON",13),0);break;case $c:e[a++]=hn(_n("SD_ICON",14),0);break;case Qc:e[a++]=hn(_n("SD_ICON",15),0)}if($f.invincible&&(e[a++]=hn(_n("SD_ICON",4),0),$f.invtimer>=17.25)){var r=(23-$f.invtimer)/5.75;n[a-1]=Math.sin(.5*m*i/(r+.1))>=0}$f.got_speedshoes&&(e[a++]=hn(_n("SD_ICON",5),0),$f.speedshoes_timer>=17.25)&&(r=(23-$f.speedshoes_timer)/5.75,n[a-1]=Math.sin(.5*m*i/(r+.1))>=0)}for(t=0;t<a;t++)n[t]&&nn(e[t].data,Et(),e[t].sx,e[t].sy,ut-(e[t].width+5)*(t+1),5,e[t].swidth,e[t].sheight)},fm=function(t){Fn(b_,t),ga(y_,t),ga(x_,t)},_m=function(){Uf=null},hm=function(t){var e,n,a,i,r=X(),o=Rf,c=null;for(a=Uf;a;a=i){var s=a.data;if(s){if(n=Nm(s.position.x,s.position.y,s.position.x+s.image.width,s.position.y+s.image.height,yh),e=!1,s.destroy_on_brick&&n&&s.speed.y>0){var u=[s.position.x,s.position.y,s.position.x+s.image.width,s.position.y+s.image.height],l=void 0;for(l=t;l&&!e;l=l.next){var d=l.data;if(d&&1==d.brick_ref.property&&0==d.brick_ref.angle){var p=[d.x,d.y,d.x+d.brick_ref.image.width,d.y+d.brick_ref.image.height];J(u,p)&&(e=!0)}}}!n||e?c?c.next=i:Uf=i:(s.position.x+=s.speed.x*r,s.position.y+=s.speed.y*r+.5*o*(r*r),s.speed.y+=o*r,c=a)}}},mm=function(){for(var t,e,n,a,i=nt(_i().x-240,_i().y-135.5),r=Uf;r;r=r.next){var o=r.data;o&&(t=o.image,e=Et(),n=o.position.x-i.x,a=o.position.y-i.y,e.putImageData(t,n,a))}},gm=function(){null==Yf||e_||Hf||O()||T(Yf,!0)},vm=function(){if(b_){var t=X(),e=z();if(g_){if(e>=v_+7e3)return void(g_=!1);b_.position.x=(ut-$n(b_).width)/2,b_.position.y=Math.max(b_.position.y-100*t,lt-1.3*$n(b_).height)}else b_.position.y=Math.min(b_.position.y+100*t,lt);y_.position=at(b_.position,nt(2,10)),x_.position=at(b_.position,nt(2,23))}},bm=function(){if($f&&$f.actor){var t,e=[],n=[];if(!(Nf<2))for(e[0]=$f.actor.position.x,e[1]=$f.actor.position.y,e[2]=e[0]+$n($f.actor).width,e[3]=e[1]+$n($f.actor).height,t=0;t<w_;t++)if(!Mh[t].disabled&&(n[0]=Mh[t].rect_x,n[1]=Mh[t].rect_y,n[2]=n[0]+Mh[t].rect_w,n[3]=n[1]+Mh[t].rect_h,J(e,n))){Mh[t].disabled=!0,Wh(Mh[t].title,Mh[t].message);break}}},ym=function(t){$f.spin_dash=$f.braking=!1,zf[Qf=t]&&($f=zf[Qf],Lm($f.actor),De($f.actor.input))},xm=function(){var t,e;for(t=0;t<zf.length;t++)e=Bf.x<=Af/2?2-t:t,zf[t].actor.mirror=Bf.x<=Af/2?0:1,zf[t].actor.spawn_point.x=zf[t].actor.position.x=Bf.x+15*e,zf[t].actor.spawn_point.y=zf[t].actor.position.y=Bf.y},wm=function(t,e,n,a){for(var i={data:null,image:{data:null,sx:0,sy:0,swidth:0,sheight:0,x:0,y:0,width:0,height:0},angle:a,property:1,behavior:0,zindex:.5,behavior_arg:[]},r=0;r<5;r++)i.behavior_arg[r]=0;return{brick_ref:i,x:n.x,y:n.y,sx:n.x,sy:n.y,enabled:!0,state:0,value:[],animation_frame:0}},km=function(t,e){var n=t.brick_ref,a=e.brick_ref;if(!n||!a)return!1;if(n.zindex<a.zindex)return-1;if(n.zindex>a.zindex)return 1;if(n.property!=a.property){var i=[0,100,50];return i[n.property]-i[a.property]}return n.angle%180!=0&&a.angle%180==0?-1:n.angle%180==0&&a.angle%180!=0?1:t.sy-e.sy},Em=function(t){var e;if(Cf)if(km(t.data,Cf.data))t.next=Cf,Cf=t;else{for(e=Cf;e.next&&km(e.next.data,t.data);)e=e.next;t.next=e.next,e.next=t}else t.next=null,Cf=t},Sm=function(){for(var t,e,n,a,i=null,r=Cf;r;r=r.next)t=Math.min(r.data.x,r.data.sx),e=Math.min(r.data.y,r.data.sy),n=r.data.brick_ref.image.width,a=r.data.brick_ref.image.height,(Nm(t,e,n,a,2*yh)||1==r.data.brick_ref.behavior)&&(i={data:r.data,next:i});return i},Mm=function(t){for(var e;t;)e=t.next,t=null,t=e},Tm=function(){for(var t,e,n,a,i=null,r=Gf;r;r=r.next)if(r.data){var o=$n(r.data.actor);o&&(t=~~r.data.actor.position.x,e=~~r.data.actor.position.y,n=o.width,a=o.height,Nm(t,e,n,a,yh)&&(i={data:r.data,next:i}))}return i},jm=function(t){for(var e;t;)e=t.next,t=null,t=e},Im=function(){var t,e;if(Gf)for(Gf.data&&Gf.data.state==Rc&&(e=Gf.next,Gf.data,Gf=e),t=Gf;t&&t.next;t=t.next)t.next&&t.next.data&&t.next.data.state==Rc&&(e=t.next,t.next=e.next,e.data,e=null)},Dm=function(){var t,e;if(Pf)for(Pf&&Pf.data&&Pf.data.state==jp&&(e=Pf.next,Rp(Pf.data),Pf=null,Pf=e),t=Pf;t&&t.next;t=t.next)t&&t.next&&t.next.data&&t.next.data.state==jp&&(e=t.next,t.next=e.next,Rp(e.data),e=null)},Om=function(){var t,e;if(Cf)for(Cf.data&&1==Cf.data.state&&(e=Cf.next,Cf.data=null,Cf=null,Cf=e),t=Cf;t&&t.next;t=t.next)1==t.next.data.state&&(e=t.next,t.next=e.next,e.data=null,e=null)},Rm=function(t){t.brick_ref=null,t=null},Am=function(t){var e,n,a,i,r,o;t&&(t.value[0]+=X(),e=t.value[0],1===t.brick_ref.behavior)&&(n=t.brick_ref.behavior_arg[0],a=t.brick_ref.behavior_arg[1],i=t.brick_ref.behavior_arg[2]*(2*m),r=t.brick_ref.behavior_arg[3]*(2*m),o=t.brick_ref.behavior_arg[4]*m/180,t.x=t.sx+Math.round(n*Math.cos(i*e+o)),t.y=t.sy+Math.round(a*Math.sin(r*e+o)))},Lm=function(t){wh.position.x=t.position.x,wh.position.y=t.position.y},Nm=function(t,e,n,a,i){var r=_i(),o=[t,e,t+n,e+a],c=[r.x-240-i,r.y-135.5-i,r.x+240+i,r.y+135.5+i];return J(o,c)},Cm=function(){return null!=Vf},Gm=function(t){return gh(void 0,void 0,void 0,(function(){var e;return vh(this,(function(n){switch(n.label){case 0:return Mf="Untitled",Tf="",jf="",If="",Df="",Bf=nt(0,0),w_=0,Vf=null,Of=1,k('level_load("'.concat(t,'")')),[4,x(t)];case 1:return e=n.sent(),[4,Pm(e)];case 2:return n.sent(),Yf=M(Tf),function(){for(var t=0,e=0,n=Cf;n;n=n.next)n.data&&n.data.brick_ref&&0!=n.data.brick_ref.property&&(t=Math.max(t,n.data.sx+Ln(n.data).width),e=Math.max(e,n.data.sy+Ln(n.data).height));Af=Math.max(t,ut),Lf=Math.max(e,lt)}(),k("level_load() ok"),[2]}}))}))},Pm=function(t){return gh(void 0,void 0,void 0,(function(){var e,n,a;return vh(this,(function(i){switch(i.label){case 0:for(jf=t.theme,If=t.bgtheme,Df=t.grouptheme,Tf=t.music,Mf=t.name,t.author,t.version,t.requires,Of=t.act,Bf=t.spawn_point,t.readonly,t.boss&&(Vf=function(t,e,n,a,i,r){for(var o={type:t,state:0,direction:0,actor:Hn(),bring_to_front:!1,initial_hp:0,hp:0,value:[],rect_x:n,rect_y:a,rect_w:i,rect_h:r},c=0;c<10;c++)o.value[c]=0;var s=o.actor;switch(s.spawn_point=nt(e.x,e.y),s.position=nt(e.x,e.y),s.input=xe(),t){case 0:case 2:Vn(s,_n("SD_SIMPLEBOSS",0)),o.initial_hp=o.hp=3,o.direction=3,s.maxspeed=100,s.acceleration=100;break;case 1:case 3:Vn(s,_n("SD_MECHASHADOW",0)),o.initial_hp=o.hp=10,o.direction=3,s.maxspeed=100,s.acceleration=100}return o}(t.boss.id,nt(t.boss.x,t.boss.y),t.boss.rx,t.boss.ry,t.boss.rw,t.boss.rh)),a=0;a<t.dialogbox.length;a++)e={disabled:!1,rect_x:t.dialogbox[a].xpos,rect_y:t.dialogbox[a].ypos,rect_w:t.dialogbox[a].width,rect_h:t.dialogbox[a].height,title:Ye(t.dialogbox[a].title),message:Ye(t.dialogbox[a].message)},Mh.push(e),w_=Mh.length;for(a=0;a<t.enemylist.length;a++)Jh(""+t.enemylist[a].id,nt(t.enemylist[a].xpos,t.enemylist[a].ypos));return[4,(r=t.theme,Tn(void 0,void 0,void 0,(function(){var t,e;return jn(this,(function(n){switch(n.label){case 0:return k('brickdata_load("'.concat(r,'")')),[4,x(r)];case 1:return t=n.sent(),[4,(a=t,Promise.all(a.bricks.map(Nn)))];case 2:return e=n.sent(),Dn=e,[2]}var a}))})))];case 1:for(i.sent(),a=0;a<t.bricklist.length;a++)Kh(t.bricklist[a].id,nt(t.bricklist[a].xpos,t.bricklist[a].ypos));return[4,Ga(t.bgtheme)];case 2:for(n=i.sent(),Xf=n,a=0;a<t.itemlist.length;a++)qh(t.itemlist[a].id,nt(t.itemlist[a].xpos,t.itemlist[a].ypos));return[2,Xf]}var r}))}))},Um=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},Bm=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Ym=function(t){return Um(void 0,void 0,void 0,(function(){var e,n;return Bm(this,(function(a){switch(a.label){case 0:return k('quest_load("'.concat(t,'")')),[4,x(t)];case 1:return e=a.sent(),[4,Wm(e)];case 2:return n=a.sent(),k("load_quest() ok!"),[2,n]}}))}))},Hm=function(t){return Um(void 0,void 0,void 0,(function(){return Bm(this,(function(e){switch(e.label){case 0:return[4,en(""+(t||"data/images/null.png"))];case 1:return[2,e.sent()]}}))}))},Wm=function(t){return Um(void 0,void 0,void 0,(function(){var e,n;return Bm(this,(function(a){switch(a.label){case 0:return e={file:"",name:t.name||"",author:t.author||"Open Sonic",version:t.version||"0",description:t.description||"",show_ending:t.show_ending||!1,image:null,levels:t.levels||[],level_count:t.levels?t.levels.length:0,level_path:t.levels||[]},[4,Hm(t.image)];case 1:return n=a.sent(),e.image=n,[2,e]}}))}))};!function(t){t[t.QUESTVALUE_TOTALTIME=0]="QUESTVALUE_TOTALTIME",t[t.QUESTVALUE_BIGRINGS=1]="QUESTVALUE_BIGRINGS",t[t.QUESTVALUE_GLASSES=2]="QUESTVALUE_GLASSES"}(k_||(k_={}));var Fm,Xm,zm,$m,Qm,Vm,Km,qm,Jm,Zm,tg,eg,ng,ag,ig,rg,og,cg,sg,ug,lg,dg,pg,fg,_g,hg,mg,gg,vg,bg,yg,xg,wg,kg,Eg,Sg,Mg,Tg,jg,Ig=k_.QUESTVALUE_TOTALTIME,Dg=k_.QUESTVALUE_BIGRINGS,Og=k_.QUESTVALUE_GLASSES,Rg=null,Ag=0,Lg=!1,Ng=[],Cg=function(){var t;for(Lg=!1,t=0;t<3;t++)Ng[t]=0},Gg=function(){if(0!=Rg.level_count)return Ag<Rg.level_count&&!Lg?(Th(Rg.level_path[Ag]),Fe(By(Ty)),void Ag++):(Xe(),void(Lg?Fe(By(Ry)):Rg.show_ending?Fe(By(Oy)):Fe(By(Ay))));k("Quest '%s' has no levels. ".concat(Rg.file))},Pg=function(){},Ug=function(){},Bg=function(){Lg=!0},Yg=function(t,e){var n=q(t,0,2);Ng[n]=e},Hg=function(t){var e=q(t,0,2);return Ng[e]},Wg=[],Fg=0,Xg=function(){Fg=0,Wg[0]=da(7),Wg[0].position=nt(-50,112),fa(Wg[0],"GAME"),Wg[1]=da(7),Wg[1].position=nt(298,112),fa(Wg[1],"OVER")},zg=function(){var t=X();if((Fg+=t)>5){if(bt())return Bg(),void Xe();vt(rn(0,0,0),2)}Wg[0].position.x+=200*t,Wg[0].position.x>80&&(Wg[0].position.x=80),Wg[1].position.x-=200*t,Wg[1].position.x<168&&(Wg[1].position.x=168)},$g=function(){xt();var t=nt(240,135.5);ga(Wg[0],t),ga(Wg[1],t)},Qg=function(){cn(null),pa(Wg[1]),pa(Wg[0]),Bg()},Vg=0,Kg=null,qg=function(){return t=void 0,e=void 0,a=function(){var t;return function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(e){switch(e.label){case 0:return Vg=0,[4,Ga("data/themes/intro.bg.json")];case 1:return t=e.sent(),Kg=t,gt(rn(0,0,0),1),[2]}}))},new((n=void 0)||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}));var t,e,n,a},Jg=function(){if(Kg&&(Vg+=X(),Ua(Kg),Vg>=3)){if(bt())return Xe(),void Fe(By(Ry));vt(rn(0,0,0),1)}},Zg=function(){if(Kg){var t=nt(240,135.5);Ba(Kg,t),Ya(Kg,t)}},tv=function(){Kg=null},ev=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},nv=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},av=["data/languages/deutsch.json","data/languages/dutch.json","data/languages/english.json","data/languages/francais.json","data/languages/indonesian.json","data/languages/italiano.json","data/languages/polish.json","data/languages/ptbr.json"],iv=1,rv=1,ov=!1,cv=0,sv=[],uv=[],lv=[],dv=0,pv=0,fv=function(){return ev(void 0,void 0,void 0,(function(){var t;return nv(this,(function(e){switch(e.label){case 0:return dv=0,ov=!1,pv=0,zm=ke(),Fm=da(8),sv[0]=da(4),fa(sv[0],"SELECT YOUR"),sv[0].position.x=(ut-_a(sv[0]).length*ha(sv[0]).x)/2-140,sv[0].position.y=10,sv[1]=da(4),fa(sv[1],"LANGUAGE"),sv[1].position.x=(ut-_a(sv[1]).length*ha(sv[1]).x)/2-120,sv[1].position.y=sv[0].position.y+ha(sv[1]).y+10+10,sv[2]=da(8),fa(sv[2],Ye("MENU_CQ_BACK")),sv[2].position.x=10,sv[2].position.y=lt-1.5*ha(sv[2]).y,[4,Ga("data/themes/langselect.bg.json")];case 1:return t=e.sent(),$m=t,Xm=Hn(),Vn(Xm,_n("SD_TITLEFOOT",0)),vv(),gt(rn(0,0,0),1),[2]}}))}))},_v=function(){var t=X();if(pv+=t,Ua($m),Xm&&uv.length&&(Xm.position=nt(uv[0][dv].position.x,uv[0][dv].position.y),Xm.position.x-=15,Xm.position.x+=5*Math.cos(2*m*pv)),!ov&&!yt()){if(Me(zm,Pt)&&(dv=(dv+1)%cv,A(Qe("choose"))),Me(zm,Gt)&&(dv=((dv-1)%cv+cv)%cv,A(Qe("choose"))),Me(zm,Yt)||Me(zm,Wt)){if(!lv)return;var e=lv[dv].filepath;k("Loading language ".concat(lv[dv].title," ").concat(e)),Ue("data/languages/english.json"),Ue(e),gv(e),A(Qe("select"))}Me(zm,Ft)&&(A(Qe("return")),ov=!0)}if(iv=Math.floor(1+dv/8),rv=Math.floor(1+Math.max(0,cv-1)/8),fa(Fm,"page %d/%d",iv,rv),Fm.position.x=ut-_a(Fm).length*ha(Fm).x-10,Fm.position.y=lt-ha(Fm).y-3,!O()){var n=M("data/music/options.mp4");T(n,!0)}if(ov){if(bt())return void Xe();vt(rn(0,0,0),1)}},hv=function(){var t,e=nt(240,135.5);for(xt(),Ba($m,e),Ya($m,e),ga(sv[0],e),ga(sv[1],e),ga(sv[2],e),rv>1&&ga(Fm,e),t=8*(iv-1);t<8*iv;t++)av[t]&&uv.length>1&&ga(uv[dv==t?1:0][t],e);Fn(Xm,e)},mv=function(){bv(),$m=Pa($m),Wn(Xm),pa(sv[0]),pa(sv[1]),pa(Fm),Ee(zm)},gv=function(t){var e;e=t,C.language=e,G()},vv=function(){return ev(void 0,void 0,void 0,(function(){var t,e;return nv(this,(function(n){switch(n.label){case 0:return k("load_lang_list()"),[4,y(av)];case 1:for(t=n.sent(),cv=(lv=t).length,uv[0]=[],uv[1]=[],e=0;e<cv;e++)lv[e].filepath=av[e],uv[0][e]=da(8),uv[1][e]=da(8),fa(uv[0][e],lv[e].LANG_LANGUAGE),fa(uv[1][e],lv[e].LANG_LANGUAGE),uv[0][e].position=nt(25,75+e%8*20),uv[1][e].position=nt(25,75+e%8*20);return[2]}}))}))},bv=function(){var t;for(k("unload_lang_list()"),t=0;t<cv;t++)pa(uv[0][t]),pa(uv[1][t]);uv[0]=null,uv[1]=null,lv=null,cv=0},yv=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},xv=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},wv=["data/quests/default.json","data/quests/extra.json","data/quests/superbosses.json","data/quests/tutorial.json"],kv=3,Ev=[],Sv=[],Mv=[],Tv=[],jv=function(){return yv(void 0,void 0,void 0,(function(){var t,e,n;return xv(this,(function(a){switch(a.label){case 0:for(ug=!1,Qm=0,Jm=.001*z(),Zm=!1,Km=null,Vm=ke(),Ie(Vm),Av(),fg=M("data/music/title.mp4"),T(fg,!0),ag=!0,ig=Hn(),Vn(ig,_n("SD_TITLESURGE",0)),ig.position.x=(ut-$n(ig).width)/2+5,ig.position.y=-15,rg=Hn(),Vn(rg,_n("SD_TITLEBG",0)),rg.position.x=(ut-$n(rg).width)/2,rg.position.y=ig.position.y+25,og=Hn(),Vn(og,_n("SD_TITLEGAMENAME",0)),og.position.x=(ut-$n(og).width)/2,og.position.y=ig.position.y+$n(ig).height-9,(cg=da(8)).position=nt(3,259),fa(cg,"%s",d),(sg=da(0)).position=nt(405,3),fa(sg,"V%d.%d.%d",1,1,1),eg=0,ng=Hn(),Vn(ng,_n("SD_TITLEFOOT",0)),(tg=[])[0]=Be("MENU_1PGAME"),tg[1]=Be("MENU_TUTORIAL"),tg[2]=Be("MENU_CUSTOMQUESTS"),tg[3]=Be("MENU_OPTIONS"),kv=tg.length,Ev=[],t=0;t<2;t++)for(e=0;e<kv;e++)Ev[e]||(Ev[e]=[]),Ev[e][t]=da(t),Ev[e][t].position=nt(240-$n(rg).width/5,og.position.y+65+10*e),fa(Ev[e][t],tg[e]);return Sv[0]=da(8),Sv[0].position=nt(5,3),Sv[1]=da(8),Sv[1].position=nt(5,258),(lg=da(8)).position=nt(5,170),[4,Ga("data/themes/menu.bg.json")];case 1:return n=a.sent(),qm=n,gt(rn(0,0,0),1.5),[2]}}))}))},Iv=function(){var t,e=.001*z();if(null!=Km&&bt())return Xe(),void Fe(Km);switch(e<=Jm+2?Ie(Vm):Zm||(De(Vm),Zm=!0),Ua(qm),Qm){case 0:ag&&Kn(ig)&&(ag=!1,Vn(ig,_n("SD_TITLESURGE",1)),De(Vm)),og.visible=!ag,ng.position.x=Ev[eg][0].position.x-20+3*Math.cos(2*m*e),ng.position.y=Ev[eg][0].position.y,Me(Vm,Gt)&&(A(Qe("choose")),eg--),Me(Vm,Pt)&&(A(Qe("choose")),eg++),eg=(eg%kv+kv)%kv,(Me(Vm,Yt)||Me(Vm,Wt))&&(A(Qe("select")),Rv(eg));break;case 1:for(Me(Vm,Ft)&&(A(Qe("return")),Qm=0),t=0;t<pg;t++)Mv[t].position=nt(30,20+t%14*10),Mv[t].visible=Lv(t)==Lv(dg);if(ng.position.x=10,ng.position.y=Mv[dg].position.y,Me(Vm,Gt)&&(A(Qe("choose")),dg--),Me(Vm,Pt)&&(A(Qe("choose")),dg++),dg=(dg%pg+pg)%pg,fa(Sv[0],Ye("MENU_CQ_SELECT"),Lv(dg),Nv()),fa(Sv[1],Ye("MENU_CQ_BACK")),fa(lg,Ye("MENU_CQ_INFO"),Tv[dg].version,Tv[dg].name,Tv[dg].author,Tv[dg].description),Me(Vm,Yt)||Me(Vm,Wt))return A(Qe("select")),void Cv(Tv[dg])}},Dv=function(){var t,e=nt(240,135.5);if(xt(),!ug||!bt())switch(Ba(qm,e),Ya(qm,e),Qm){case 0:for(t=0;t<kv;t++)ga(Ev[t][t==eg?1:0],e);Fn(ng,e),ga(cg,e),ga(sg,e),Fn(rg,e),ag&&xt(),Fn(ig,e),Fn(og,e);break;case 1:var n=Tv[dg].image;for(ga(lg,e),nn(n,Et(),0,0,ut-n.width-25,Mv[0].position.y,n.width,n.height),ga(Sv[0],e),ga(Sv[1],e),t=0;t<pg;t++)ga(Mv[t],e);Fn(ng,e)}},Ov=function(){var t,e;for(fg.pause(),pa(cg),pa(sg),t=0;t<2;t++)for(e=0;e<kv;e++)pa(Ev[e][t]);Wn(rg),Wn(og),Wn(ig),Wn(ng),Ee(Vm)},Rv=function(t){return yv(void 0,void 0,void 0,(function(){var e,n;return xv(this,(function(a){switch(a.label){case 0:switch(e=wv[0],t){case 0:return[3,1];case 1:return[3,3];case 2:return[3,5];case 3:return[3,6]}return[3,7];case 1:return[4,Ym(e)];case 2:case 4:return n=a.sent(),Cv(n),[2];case 3:return[4,Ym("data/quests/tutorial.json")];case 5:return Qm=1,dg=0,[3,7];case 6:return Km=By(Gy),vt(rn(0,0,0),.5),[2];case 7:return[2]}}))}))},Av=function(){pg=wv.length,Tv=[];for(var t=function(t){var e;e=t,yv(void 0,void 0,void 0,(function(){var n;return xv(this,(function(a){switch(a.label){case 0:return[4,Ym(wv[t])];case 1:return n=a.sent(),Mv[e]=da(8),Tv[e]=n,fa(Mv[e],n.name),[2]}}))}))},e=0;e<pg;e++)t(e)},Lv=function(t){return Math.floor(t/14+1)},Nv=function(){return Math.floor(pg/14+(pg%14==0?0:1))},Cv=function(t){var e,n;Rg=e=t,ls(5),ds(0),k("Running quest %s, '%s'... ".concat(e.file," ").concat(e.name)),n=0,Ag=Math.max(0,n),Km=By(Dy),Ie(Vm),vt(rn(0,0,0),.5)},Gv=function(t){if(t){t.init(t);for(var e=0;e<t.child_count;e++)Gv(t.child[e])}},Pv=function(t){if(t){for(var e=0;e<t.child_count;e++)Pv(t.child[e]);t.update(t)}},Uv=function(t,e){if(t){for(var n=0;n<t.child_count;n++)Uv(t.child[n],e);t.render(t,e)}},Bv=function(t){var e=0;if(t){for(var n=0;n<t.child_count;n++)e+=Bv(t.child[n]);return 1+e}return 0},Yv=function(t,e,n,a){return{font:null,init:t,release:e,update:n,render:a,data:null,parent:null,child:[],child_count:0}},Hv=function(t,e){t.child_count<10&&(t.child[t.child_count++]=e,e.parent=t)},Wv=function(t){if(t.font=da(8),fa(t.font,"LABEL"),null!=t.parent){var e=void 0,n=void 0,a=0,i=null!=t.parent.font?ha(t.parent.font):nt(12,12);for(e=0;e<t.parent.child_count&&t.parent.child[e]!=t;e++);for(n=0;n<e;n++)a+=Bv(t.parent.child[n])-1;t.font.position={x:t.parent.font.position.x,y:t.parent.font.position.y},t.font.position.x+=3*i.x,t.font.position.y+=(1+a+e)*i.y*2}},Fv=function(t){pa(t.font)},Xv=function(t,e){ga(t.font,e)},zv=function(){return t=void 0,e=void 0,a=function(){var t;return function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(e){switch(e.label){case 0:return wg=0,_g=!1,yg=0,vg=ke(),bg=null,hg=!0,mg=da(4),fa(mg,Ye("OPTIONS_TITLE")),mg.position.x=140,mg.position.y=10,[4,Ga("data/themes/options.bg.json")];case 1:return t=e.sent(),xg=t,gg=Hn(),Vn(gg,_n("SD_TITLEFOOT",0)),gg.position=nt(-50,-50),kg=Pb(),Gv(kg),[2]}}))},new((n=void 0)||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}));var t,e,n,a},$v=function(){var t=X();if(yg+=t,fa(mg,Ye("OPTIONS_TITLE")),hg&&(gt(rn(0,0,0),1),hg=!1),Ua(xg),_g||null!=bg||yt()||(Me(vg,Pt)&&(wg=(wg+1)%5,A(Qe("choose"))),Me(vg,Gt)&&(wg=((wg-1)%5+5)%5,A(Qe("choose"))),Me(vg,Ft)&&(A(Qe("return")),_g=!0)),Pv(kg),_g)yt()||j();else if(!O()&&yg>=.2){var e=M("data/music/options.mp4");T(e,!0)}if(_g){if(bt())return Kv(),Xe(),void Fe(By(Ry));vt(rn(0,0,0),1)}if(null!=bg){if(bt())return Kv(),Fe(bg),bg=null,void(hg=!0);vt(rn(0,0,0),1)}},Qv=function(){var t=nt(240,135.5);Ba(xg,t),Ya(xg,t),ga(mg,t),Uv(kg,t),Fn(gg,t)},Vv=function(){Wn(gg),pa(mg),Ee(vg)},Kv=function(){var t,e,n;t=Tt(),C.fullscreen=t,G(),e=Mt(),C.smooth_graphics=e,G(),n=jt(),C.show_fps=n,G()},qv=function(t,e){Wv(t),t.data=e,fa(t.font,Ye(e))},Jv=function(t){t.data=null,Fv(t)},Zv=function(t){fa(t.font,Ye(t.data))},tb=function(t,e){Xv(t,e)},eb=function(t,e,n){var a;Wv(t),fa(t.font,Ye(e)),t.data={},(a=t.data).option_index=n,a.lang_key=e},nb=function(t){t.data=null,Fv(t)},ab=function(t){var e=t.data;return wg==e.option_index},ib=function(t){var e=t.data;fa(t.font,Ye(e.lang_key)),ab(t)&&(fa(t.font,"<color=ffff00>%s</color>",Ye(e.lang_key)),gg.position=at(t.font.position,nt(3*Math.cos(2*m*yg)-20,0)))},rb=function(t,e){Xv(t,e)},ob=function(t){Wv(t),fa(t.font,""),t.font.position=nt(0,25)},cb=function(t){Fv(t)},sb=function(t){},ub=function(t,e){Xv(t,e)},lb=function(t){qv(t,"OPTIONS_GRAPHICS")},db=function(t){Jv(t)},pb=function(t){Zv(t)},fb=function(t,e){tb(t,e)},_b=function(t){eb(t,"OPTIONS_FPS",0)},hb=function(t){nb(t)},mb=function(t){ib(t),function(t){return ab(t)}(t)&&(yt()||((Me(vg,Yt)||Me(vg,Wt))&&(A(Qe("select")),It(!jt())),Me(vg,Bt)&&jt()&&(A(Qe("select")),It(!1)),Me(vg,Ut)&&(jt()||(A(Qe("select")),It(!0)))))},gb=function(t,e){var n,a=[];rb(t,e),(n=da(8)).position=nt(175,t.font.position.y),a[0]=Ye("OPTIONS_YES"),a[1]=Ye("OPTIONS_NO"),jt()?fa(n,"<color=ffff00>%s</color>  %s",a[0],a[1]):fa(n,"%s  <color=ffff00>%s</color>",a[0],a[1]),ga(n,e),pa(n)},vb=function(t){qv(t,"OPTIONS_GAME")},bb=function(t){Jv(t)},yb=function(t){Zv(t)},xb=function(t,e){tb(t,e)},wb=function(t){eb(t,"OPTIONS_LANGUAGE",1)},kb=function(t){nb(t)},Eb=function(t){ib(t),function(t){return ab(t)}(t)&&(yt()||(Me(vg,Yt)||Me(vg,Wt))&&(A(Qe("select")),bg=By(Ny)))},Sb=function(t,e){rb(t,e)},Mb=function(t){eb(t,"OPTIONS_STAGESELECT",2)},Tb=function(t){nb(t)},jb=function(t){ib(t),function(t){return ab(t)}(t)&&(yt()||(Me(vg,Yt)||Me(vg,Wt))&&(A(Qe("select")),bg=By(Py)))},Ib=function(t,e){rb(t,e)},Db=function(t){eb(t,"OPTIONS_CREDITS",3)},Ob=function(t){nb(t)},Rb=function(t){ib(t),function(t){return ab(t)}(t)&&(yt()||(Me(vg,Yt)||Me(vg,Wt))&&(A(Qe("select")),bg=By(Cy)))},Ab=function(t,e){rb(t,e)},Lb=function(t){eb(t,"OPTIONS_BACK",4)},Nb=function(t){nb(t)},Cb=function(t){ib(t),function(t){return ab(t)}(t)&&(yt()||(Me(vg,Yt)||Me(vg,Wt))&&(A(Qe("select")),_g=!0))},Gb=function(t,e){rb(t,e)},Pb=function(){var t,e,n,a,i,r,o,c;return n=Yv(_b,hb,mb,gb),e=Yv(lb,db,pb,fb),Hv(e,n),i=Yv(wb,kb,Eb,Sb),r=Yv(Db,Ob,Rb,Ab),o=Yv(Mb,Tb,jb,Ib),a=Yv(vb,bb,yb,xb),Hv(a,i),Hv(a,o),Hv(a,r),c=Yv(Lb,Nb,Cb,Gb),t=Yv(ob,cb,sb,ub),Hv(t,e),Hv(t,a),Hv(t,c),t},Ub=null,Bb=null,Yb=!1,Hb=!1,Wb=0,Fb=function(){Bb=ke(),(Ub=new Image).src=Et().canvas.toDataURL(),Yb=!1,Hb=!1,Wb=0},Xb=function(){if(Me(Bb,Ft))return Be("CBOX_QUIT_QUESTION"),Be("CBOX_QUIT_OPTION1"),Be("CBOX_QUIT_OPTION2"),void Fe(By(Ly));if(1==La()&&(Hb=!0),Hb)return bt()?(Xe(),Xe(),void Bg()):void vt(rn(0,0,0),1);if(Yb){if(Me(Bb,Wt))return null!=S&&S.paused&&S.play(),void Xe()}else Te(Bb,Wt)&&(Yb=!0)},zb=function(){var t=hn(_n("SD_PAUSE",0),0),e=1+.5*Math.abs(Math.cos(m/2*Wb)),n=nt((ut-t.width)/2-(e-1)*t.width/2,(lt-t.height)/2-(e-1)*t.height/2);nn(Ub,Et(),0,0,0,0,Ub.width,Ub.height),Et().drawImage(t.data,t.sx,t.sy,t.swidth,t.sheight,~~n.x,~~n.y,~~(t.swidth*e),~~(t.sheight*e)),Hb||(Wb+=X())},$b=function(){Ee(Bb)},Qb=!1,Vb=function(){z(),Qb=!1,(Eg=da(8)).position=nt(5,35),Sg=da(4),fa(Sg,Ye("QUESTCLEARED_TITLE")),Sg.position=nt((ut-ha(Sg).x*_a(Sg).length)/2,5),Mg=Hn(),Vn(Mg,_n("SD_SONIC",24)),Mg.position=nt(20,150),T(M("data/music/invincible.mp4"),!1),Tg=ke(),gt(rn(0,0,0),2)},Kb=function(){var t=ss(),e=Hg(Ig)/3600,n=Hg(Ig)/60%60,a=Hg(Ig)%60,i=Hg(Og),r=Hg(Dg);if(z(),fa(Eg,Ye("QUESTCLEARED_TEXT"),"NO_QUEST_NAME",t,e,n,a,i,r,l,d),Me(Tg,Yt)&&(Qb=!0),Qb){if(bt())return Xe(),void Fe(By(Ry));vt(rn(0,0,0),2)}},qb=function(){var t=nt(240,135.5);xt(),ga(Sg,t),ga(Eg,t),Fn(Mg,t)},Jb=function(){Ee(Tg),Wn(Mg),pa(Sg),pa(Eg)},Zb=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},ty=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},ey=["data/levels/blue_ocean_1.json","data/levels/blue_ocean_2.json","data/levels/blue_ocean_3.json","data/levels/desert1.json","data/levels/exotic_1.json","data/levels/exotic_2.json","data/levels/exotic_3.json","data/levels/exotichell_1.json","data/levels/prototype.json","data/levels/superboss_1.json","data/levels/superboss_2.json","data/levels/template.json","data/levels/tutorial_1.json","data/levels/tutorial_2.json","data/levels/test.json"];!function(t){t[t.STAGESTATE_NORMAL=0]="STAGESTATE_NORMAL",t[t.STAGESTATE_QUIT=1]="STAGESTATE_QUIT",t[t.STAGESTATE_PLAY=2]="STAGESTATE_PLAY",t[t.STAGESTATE_FADEIN=3]="STAGESTATE_FADEIN"}(jg||(jg={}));var ny,ay,iy,ry,oy,cy,sy,uy,ly=jg.STAGESTATE_NORMAL,dy=jg.STAGESTATE_QUIT,py=jg.STAGESTATE_PLAY,fy=jg.STAGESTATE_FADEIN,_y=1,hy=1,my=0,gy=[],vy=0,by=0,yy=[],xy=function(){return Zb(void 0,void 0,void 0,(function(){var t;return ty(this,(function(e){switch(e.label){case 0:return by=0,my=0,sy=ly,oy=ke(),ny=da(4),fa(ny,Ye("STAGESELECT_TITLE")),ny.position.x=(ut-_a(ny).length*ha(ny).x)/2-150,ny.position.y=10,ay=da(8),fa(ay,Ye("STAGESELECT_MSG")),ay.position.x=10,ay.position.y=lt-1.5*ha(ay).y,iy=da(8),fa(iy,Ye("STAGESELECT_PAGE"),0,0),iy.position.x=ut-_a(iy).length*ha(iy).x-10,iy.position.y=40,[4,Ga("data/themes/levelselect.bg.json")];case 1:return t=e.sent(),cy=t,ry=Hn(),Vn(ry,_n("SD_TITLEFOOT",0)),Sy(),gt(rn(0,0,0),1),[2]}}))}))},wy=function(){var t=X();if(my+=t,Ua(cy),yy.length){if(ry.position=nt(yy[by].position.x,yy[by].position.y),ry.position.x+=3*Math.cos(2*m*my)-20,_y=Math.floor(by/8+1),hy=Math.floor(vy/8+(vy%8==0?0:1)),fa(iy,Ye("STAGESELECT_PAGE"),_y,hy),iy.position.x=ut-_a(iy).length*ha(iy).x-10,sy==py)yt()||j();else if(!O()){var e=M("data/music/options.mp4");T(e,!0)}switch(sy){case ly:yt()||(Me(oy,Pt)&&(by=(by+1)%vy,A(Qe("choose"))),Me(oy,Gt)&&(by=((by-1)%vy+vy)%vy,A(Qe("choose"))),(Me(oy,Yt)||Me(oy,Wt))&&(k("Loading level ".concat(gy[by].name," ").concat(gy[by].filepath)),Th(gy[by].filepath),A(Qe("select")),sy=py),Me(oy,Ft)&&(A(Qe("return")),sy=dy));break;case dy:if(bt())return void Xe();vt(rn(0,0,0),1);break;case py:if(bt())return ls(5),ds(0),Fe(By(Ty)),void(sy=fy);vt(rn(0,0,0),1);break;case fy:gt(rn(0,0,0),1),sy=ly}}},ky=function(){var t,e=nt(240,135.5);for(Ba(cy,e),Ya(cy,e),ga(ny,e),ga(ay,e),hy>1&&ga(iy,e),t=8*(_y-1);t<8*_y;t++)gy[t]&&(fa(yy[t],by==t?"<color=ffff00>%s - %s %s</color>":"%s - %s %s",gy[t].name,Ye("STAGESELECT_ACT"),gy[t].act),ga(yy[t],e));Fn(ry,e)},Ey=function(){My(),cy=Pa(cy),Wn(ry),pa(ny),pa(ay),pa(iy),Ee(oy)},Sy=function(){return Zb(void 0,void 0,void 0,(function(){var t,e;return ty(this,(function(n){switch(n.label){case 0:return k("load_stage_list()"),[4,y(ey)];case 1:for(t=n.sent(),vy=(gy=t).length,e=0;e<vy;e++)yy[e]=da(8),yy[e].position=nt(25,60+e%8*20),gy[e].filepath=ey[e];return[2]}}))}))},My=function(){},Ty=1,jy=2,Iy=3,Dy=4,Oy=5,Ry=6,Ay=7,Ly=8,Ny=9,Cy=10,Gy=11,Py=12,Uy=[],By=function(t){return Uy[t]},Yy=function(t,e,n,a){return{init:t,update:e,render:n,release:a}},Hy=function(t,e,n,a){return new(n||(n=Promise))((function(i,r){function o(t){try{s(a.next(t))}catch(t){r(t)}}function c(t){try{s(a.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((a=a.apply(t,e||[])).next())}))},Wy=function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Fy=function(){var t,e;t=function(){!function(){var t=0,e=0;for(e=0;e<10;)e=(t=z())>H?t-H:0,H=t>=H?H:t;e=Math.min(e,16),W=.001*e,U++,(B+=e)>=1e3&&(Y=U,U=0,B=0),H=z()}(),function(){var t,e,n=X();for(e=ce;e;e=e.next){for(t=0;t<9;t++)e.data.oldstate[t]=e.data.state[t];for(t=0;t<9;t++)Se(e.data,t)?e.data.howlong[t]+=n:e.data.howlong[t]=0;switch(e.data.type){case Ct.IT_KEYBOARD:e.data.state[Gt]=pe.up,e.data.state[Pt]=pe.down,e.data.state[Ut]=pe.left,e.data.state[Bt]=pe.right,e.data.state[Yt]=pe.space,e.data.state[Ht]=pe.lcontrol,e.data.state[Wt]=pe.enter,e.data.state[Ft]=pe.esc,e.data.state[Xt]=pe.tilda;break;case Ct.IT_MOUSE:e.data.x=be.x,e.data.y=be.y,e.data.state[Yt]=ye.left,e.data.state[Wt]=ye.middle,e.data.state[Ht]=ye.right;break;case Ct.IT_COMPUTER:for(t=0;t<9;t++)e.data.state[t]=!1;break;case Ct.IT_JOYSTICK:se&&!ue&&(e.data.state[Gt]=fe[0].stick[0].axis[1].d1,e.data.state[Pt]=fe[0].stick[0].axis[1].d2,e.data.state[Ut]=fe[0].stick[0].axis[0].d1,e.data.state[Bt]=fe[0].stick[0].axis[0].d2,e.data.state[Yt]=fe[0].button[0].b,e.data.state[Ht]=fe[0].button[1].b,e.data.state[Wt]=fe[0].button[2].b,e.data.state[Ft]=fe[0].button[3].b);break;case Ct.IT_USER:e.data.state[Gt]=pe.up,e.data.state[Pt]=pe.down,e.data.state[Ut]=pe.left,e.data.state[Bt]=pe.right,e.data.state[Yt]=pe.space,e.data.state[Ht]=pe.lcontrol,e.data.state[Wt]=pe.enter,e.data.state[Ft]=pe.esc,le&&(e.data.state[Gt]=_e.up(),e.data.state[Pt]=_e.down(),e.data.state[Ut]=_e.left(),e.data.state[Bt]=_e.right(),e.data.state[Yt]=he._pressed,e.data.state[Ft]=me._pressed,e.data.state[Ht]=ge._pressed),zt&&(ve="undefined"==typeof navigator?null:navigator.getGamepads()[0]||null),ve&&(e.data.state[Gt]=ve.buttons[12].pressed,e.data.state[Pt]=ve.buttons[13].pressed,e.data.state[Ut]=ve.buttons[14].pressed,e.data.state[Bt]=ve.buttons[15].pressed,e.data.state[Yt]=ve.buttons[0].pressed,e.data.state[Ht]=ve.buttons[1].pressed,e.data.state[Wt]=ve.buttons[2].pressed,e.data.state[Ft]=ve.buttons[3].pressed)}}}();var t=ze();t&&(t.update(),t==ze()&&t.render()),function(){if(o=!1,0!=r)if((s+=X())<u){var t=void 0;t=q(t=1.25*s/u*100,0,100),t=1==r?100-t:t,t/=100,Et().fillStyle=c,Et().globalAlpha=t,Et().fillRect(0,0,n.width,n.height)}else 2==r&&(Et().fillStyle=c,Et().fillRect(0,0,n.width,n.height)),r=0,u=s=0,c=null,o=!0;Et().globalAlpha=1,jt()&&(Et().font="14px Arial",Et().fillStyle="white",Et().fillText(""+Y,450,20))}(),_e&&_e.render(Et()),he&&he.render(Et()),me&&me.render(Et()),ge&&ge.render(Et())},e=null,requestAnimationFrame((function n(a){var i=!1;if(null!=e){Math.min(a-e,100);i=!1===t()}e=a,i||requestAnimationFrame(n)}))},Xy=function(){k("preferences_init()"),function(){if(C.video_resolution="TINY",C.fullscreen=!1,C.smooth_graphics=!1,C.show_fps=!1,C.language="data/languages/english.json","undefined"!=typeof window)for(var t in C){var e=window.localStorage.getItem(t)?localStorage.getItem(t):C[t];"false"==e&&(e=!1),"true"==e&&(e=!0),C[t]=e}}()},zy=function(i){k("timer_init()"),U=0,B=0,Y=0,W=0,H=z(),function(t,e,i,r,o,c){Dt(e,i,r),It(c);var s=document.getElementById("canvas");s?(a=(n=s).getContext("2d"),_t=n.width/ut,ht=n.height/lt,a.scale(n.width/ut,n.height/lt)):(s=document.createElement("canvas"),a=(n=s).getContext("2d"),n.width=ut,n.height=lt,document.body.appendChild(n)),_t=ut/window.innerWidth,ht=_t,a.imageSmoothingEnabled=!1,xt()}(Qy(),i.video_resolution,i.smooth_graphics,i.fullscreen,i.color_depth,i.show_fps),k("input_init()"),ce=null,kt().addEventListener("contextmenu",(function(t){if(2===t.button)return t.preventDefault(),!1}),!1),kt().addEventListener("mousemove",(function(t){be=function(t,e){var n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}}(kt(),t)}),!1),kt().addEventListener("mousedown",(function(t){switch(t.which){case 1:ye.left=!0;break;case 2:ye.middle=!0;break;case 3:ye.right=!0}}),!1),kt().addEventListener("mouseup",(function(t){switch(t.which){case 1:ye.left=!1;break;case 2:ye.middle=!1;break;case 3:ye.right=!1}}),!1),se=!1,ue=!1,zt="undefined"!=typeof navigator&&"getGamepads"in navigator,(le=function(){try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}}())&&((_e=new Nt({container:kt(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX>=window.innerWidth/2||e.pageY<window.innerHeight/2)})),(he=new Nt({container:kt(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX<window.innerWidth/2||e.pageY<window.innerHeight/2)})),(me=new Nt({container:kt(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX>window.innerWidth/2||e.pageY>window.innerHeight/2)})),(ge=new Nt({container:kt(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX<window.innerWidth/2||e.pageY>window.innerHeight/2)}))),pe=Le(de),g.images={},g.images,g.samples={},t=g.samples,g.musics={},e=g.musics},$y=function(t){return Hy(void 0,void 0,void 0,(function(){return Wy(this,(function(e){switch(e.label){case 0:return Ve(),n=void 0,a=void 0,r=function(){var t;return function(t,e){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(o=0)),o;)try{if(n=1,a&&(i=2&c[0]?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,a=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=e.call(t,o)}catch(t){c=[6,t],a=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(e){switch(e.label){case 0:return k("Loading objects scripts..."),Ip=null,[4,x("data/objects/enemies.json")];case 1:return t=e.sent(),Ip=t,[2]}}))},new((i=void 0)||(i=Promise))((function(t,e){function o(t){try{s(r.next(t))}catch(t){e(t)}}function c(t){try{s(r.throw(t))}catch(t){e(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(t){t(n)}))).then(o,c)}s((r=r.apply(n,a||[])).next())})),function(){for(var t=0;t<256;t++)Uy[t]=null;Uy[Ty]=Yy(Dh,Oh,Rh,Ah),Uy[jy]=Yy(Fb,Xb,zb,$b),Uy[Iy]=Yy(Xg,zg,$g,Qg),Uy[Dy]=Yy(Cg,Gg,Pg,Ug),Uy[Ry]=Yy(jv,Iv,Dv,Ov),Uy[0]=Yy(qg,Jg,Zg,tv),Uy[Oy]=Yy(si,ui,li,di),Uy[Ay]=Yy(Vb,Kb,qb,Jb),Uy[Ly]=Yy(Da,Oa,Ra,Aa),Uy[Ny]=Yy(fv,_v,hv,mv),Uy[Cy]=Yy(Za,ti,ei,ni),Uy[Gy]=Yy(zv,$v,Qv,Vv),Uy[Py]=Yy(xy,wy,ky,Ey)}(),[4,(o=t.language,Ne(void 0,void 0,void 0,(function(){return Ce(this,(function(t){switch(t.label){case 0:return k("Initializing the language module"),[4,Ue(Ge=o||Ge)];case 1:return t.sent(),k("lang_init() ok!"),[2]}}))})))];case 1:return e.sent(),function(){We=0;for(var t=0;t<16;t++)He[t]=null}(),[2]}var n,a,i,r,o}))}))},Qy=function(){return""};uy={},Hy(void 0,void 0,void 0,(function(){var t;return Wy(this,(function(e){switch(e.label){case 0:return t=function(t){var e={};return e.video_resolution=C.video_resolution,e.smooth_graphics=C.smooth_graphics,e.fullscreen=C.fullscreen,e.show_fps=C.show_fps,e.language=C.language,e.video_resolution=t.video_resolution?t.video_resolution:e.video_resolution,e.smooth_graphics=t.smooth_graphics?t.smooth_graphics:e.smooth_graphics,e.fullscreen=t.fullscreen?t.fullscreen:e.fullscreen,e.show_fps=t.show_fps?t.show_fps:e.show_fps,e.color_depth=t.color_depth?t.color_depth:32,e.level=t.level?t.level:null,e.quest=t.quest?t.quest:null,e.language=t.language?t.language:e.language,e.video_resolution=P("video_resolution")?+P("video_resolution"):e.video_resolution,e.smooth_graphics=!!P("smooth_graphics")||e.smooth_graphics,e.fullscreen=!!P("fullscreen")||e.fullscreen,e.show_fps=!!P("show_fps")||e.show_fps,e.color_depth=P("color_depth")?+P("color_depth"):e.color_depth,e.level=P("level")?P("level"):e.level,e.quest=P("quest")?P("quest"):e.quest,e.language=P("language")?P("language"):e.language,e}(uy),console.log("ENGINE OPTIONS",t),Xy(),zy(t),[4,sn(void 0,void 0,void 0,(function(){var t,e,n,a;return un(this,(function(i){switch(i.label){case 0:for(k("Loading sprites..."),g.sprites={},ln=g.sprites,n=0;n<dn.length;n++)dn[n]="data/sprites/"+dn[n]+".json";return wt("Loading...",0),[4,y(dn)];case 1:for(t=i.sent(),e=t,n=0;n<e.length;n++)for(a in e[n])e[n][a].name=a,fn.push(e[n][a]);return[4,wn(fn)];case 2:return i.sent(),k("All sprites have been loaded!"),[2,ln=v()]}}))}))];case 1:return e.sent(),function(){var t,e,n,a=["ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","0123456789:","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_abcdefghijklmnopqrstuvwxyz{|}~"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_abcdefghijklmnopqrstuvwxyz{|}~"];for(k("font_init()"),t=0;t<a.length;t++)for(sa[t]={ch:{}},n="FT_FONT"+t,e=0;e<a[t].length;e++)sa[t].ch[a[t][e]]=hn(_n(n,0),e);k("font_init() ok")}(),[4,$y(t)];case 2:return e.sent(),ls(5),ds(0),function(t){Hy(void 0,void 0,void 0,(function(){return Wy(this,(function(e){return t.level?(Th(t.level),Fe(By(Ty))):Fe(By(0)),[2]}))}))}(t),Fy(),[2]}}))}))})();